<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- CRITICAL: Load theme BEFORE CSS to prevent flash -->
  <script src="../../../../../../playground/theme-init.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UI Components Reference · PAN Documentation</title>
  <meta name="description" content="PAN (Page Area Network) Documentation - UI Components Reference">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/theme.css">
  <link rel="stylesheet" href="../assets/docs.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" integrity="sha384-wH75j6z1lH97ZOpMOInqhgKzFkAInZPPSPlZpYKYTOqsaizPvhQZmAtLcPKXpLyH" crossorigin="anonymous">
</head>
<body>
  <header class="docs-header">
    <div class="docs-header-content">
      <a href="../index.html" class="logo">
        <span>PAN</span>
      </a>
      <nav class="docs-nav">
        <a href="../index.html">Home</a>
        <a href="index.html" class="active">Docs</a>
        <a href="../examples.html">Examples</a>
        <a href="../apps.html">Apps</a>
        <a href="https://github.com/chrisrobison/pan" target="_blank">GitHub</a>
      </nav>
    </div>
  </header>

  <div class="docs-layout">
    <aside class="docs-sidebar">
      <div class="docs-sidebar-content">
        <h3>Documentation</h3>
        <nav class="docs-menu" id="docs-menu">
          <!-- Will be populated by JavaScript -->
        </nav>
      </div>
    </aside>

    <main class="docs-main">
      <div class="docs-breadcrumb">
        <a href="../index.html">Home</a> / <a href="#">books</a> / <a href="#">building-with-larc</a> / <a href="#">chapters</a> / <span>19-ui-components</span>
      </div>
      <article class="docs-content">
        <h1>UI Components Reference</h1>
<p>API documentation for LARC's UI components. For tutorials, see <em>Learning LARC</em> Chapter 10.</p>
<h2>pan-files</h2>
<strong>Purpose</strong>: OPFS-backed file system browser with visual UI and programmatic API  
<strong>Import</strong>: <code><script type="module" src="/ui/pan-files.mjs"></script></code>
<h3>Quick Example</h3>
<pre><code class="language-html">&lt;pan-files filter=&quot;.md,.txt&quot;&gt;&lt;/pan-files&gt;

&lt;script type=&quot;module&quot;&gt;
const files = document.querySelector(&#039;pan-files&#039;);

// Write file
await files.writeFile(&#039;/notes.txt&#039;, &#039;Hello, World!&#039;);

// Read file
const content = await files.readFile(&#039;/notes.txt&#039;);

// List files
const allFiles = await files.listFiles();
&lt;/script&gt;</code></pre>
<h3>Attributes</h3>
<p>| Attribute | Type | Default | Description |
|-----------|------|---------|-------------|
| <code>path</code> | String | "/" | Current directory path (root level only) |
| <code>filter</code> | String | "" | Comma-separated file extensions to display |
| <code>show-hidden</code> | Boolean | false | Show files starting with dot |</p>
<h3>Methods</h3>
<p>| Method | Parameters | Returns | Description |
|--------|-----------|---------|-------------|
| <code>writeFile(path, content)</code> | path: String, content: String | Promise\<void\> | Write file (creates or overwrites) |
| <code>readFile(path)</code> | path: String | Promise\<String\> | Read file contents |
| <code>deleteFile(path)</code> | path: String | Promise\<void\> | Delete file |
| <code>listFiles()</code> | - | Promise\<Array\<FileInfo\>\> | Get all files in directory |
| <code>refresh()</code> | - | Promise\<void\> | Reload file list and update UI |</p>
<strong>FileInfo structure:</strong>
<pre><code class="language-javascript">{
  name: &#039;example.txt&#039;,
  path: &#039;/example.txt&#039;,
  isDirectory: false,
  size: 1024,
  entry: FileSystemHandle
}</code></pre>
<h3>PAN Events</h3>
<p>#### Published</p>
<p>| Topic | Data | Description |
|-------|------|-------------|
| <code>file.selected</code> | <code>{ path, name, isDirectory }</code> | User clicked file |
| <code>file.created</code> | <code>{ path, name, isDirectory }</code> | File/folder created |
| <code>file.deleted</code> | <code>{ path }</code> | File deleted |
| <code>file.renamed</code> | <code>{ oldPath, newPath }</code> | File renamed |
| <code>file.content-loaded</code> | <code>{ path, content }</code> | Response to file.load |</p>
<p>#### Subscribed</p>
<p>| Topic | Data | Description |
|-------|------|-------------|
| <code>file.save</code> | <code>{ path, content }</code> | Save file |
| <code>file.load</code> | <code>{ path }</code> | Load file (triggers file.content-loaded) |
| <code>file.delete</code> | <code>{ path }</code> | Delete file |
| <code>file.create</code> | <code>{ path, content? }</code> | Create file with optional content |</p>
<h3>Complete Example</h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;script type=&quot;module&quot;&gt;
    import &#039;./pan-bus.mjs&#039;;
    import &#039;./pan-files.mjs&#039;;

    customElements.whenDefined(&#039;pan-bus&#039;).then(() =&gt; {
      const bus = document.querySelector(&#039;pan-bus&#039;);
      const files = document.querySelector(&#039;pan-files&#039;);

      // Load file content when selected
      bus.subscribe(&#039;file.selected&#039;, (msg) =&gt; {
        bus.publish(&#039;file.load&#039;, { path: msg.data.path });
      });

      bus.subscribe(&#039;file.content-loaded&#039;, (msg) =&gt; {
        document.getElementById(&#039;preview&#039;).textContent = msg.data.content;
      });

      // Create quick note
      window.createNote = async () =&gt; {
        await files.writeFile(
          `/note-${Date.now()}.txt`,
          `Created at ${new Date().toISOString()}`
        );
        await files.refresh();
      };
    });
  &lt;/script&gt;
  &lt;style&gt;
    body { display: grid; grid-template-columns: 300px 1fr; gap: 1rem; padding: 1rem; }
    #preview { padding: 1rem; border: 1px solid #ccc; white-space: pre-wrap; font-family: monospace; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;pan-bus&gt;&lt;/pan-bus&gt;
  &lt;pan-files filter=&quot;.txt,.md&quot;&gt;&lt;/pan-files&gt;
  &lt;div&gt;
    &lt;button onclick=&quot;createNote()&quot;&gt;Create Note&lt;/button&gt;
    &lt;pre id=&quot;preview&quot;&gt;Select a file...&lt;/pre&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<h3>Errors</h3>
<p>pan-files dispatches custom <code>error</code> events and publishes to <code>file.error</code> topic:</p>
<p>| Error Code | Cause | Resolution |
|------------|-------|------------|
| <code>OPFS_NOT_SUPPORTED</code> | Browser doesn't support OPFS | Use Chrome 102+, Edge 102+, or provide fallback |
| <code>OPFS_INIT_FAILED</code> | Failed to initialize file system | Check HTTPS connection (or localhost) |
| <code>FILE_NOT_FOUND</code> | File doesn't exist | Verify path or catch error gracefully |
| <code>WRITE_FAILED</code> | Cannot write file | Check storage quota or permissions |
| <code>READ_FAILED</code> | Cannot read file | Verify file exists and is accessible |
| <code>DELETE_FAILED</code> | Cannot delete file | Check if file is locked or in use |
| <code>QUOTA_EXCEEDED</code> | Storage quota exceeded | Clear old files or request persistent storage |
| <code>INVALID_PATH</code> | Path contains invalid characters | Use valid path format (no <code><>:"|?*</code>) |</p>
<strong>Error handling example</strong>:
<pre><code class="language-javascript">const files = document.querySelector(&#039;pan-files&#039;);
const bus = document.querySelector(&#039;pan-bus&#039;);

// Listen for errors via DOM event
files.addEventListener(&#039;error&#039;, (e) =&gt; {
  const { code, message, path } = e.detail;
  console.error(`File error [${code}]:`, message);

  switch (code) {
    case &#039;OPFS_NOT_SUPPORTED&#039;:
      showFallbackUI();
      break;
    case &#039;QUOTA_EXCEEDED&#039;:
      promptUserToCleanup();
      break;
    case &#039;FILE_NOT_FOUND&#039;:
      console.warn(`File not found: ${path}`);
      break;
  }
});

// Or subscribe via PAN bus
bus.subscribe(&#039;file.error&#039;, (msg) =&gt; {
  const { code, message, path } = msg.data;
  displayErrorToUser(message);
});

// Safe file operations with try-catch
async function safeWriteFile(path, content) {
  try {
    await files.writeFile(path, content);
    await files.refresh();
  } catch (err) {
    console.error(&#039;Write failed:&#039;, err.message);
    // Fallback to localStorage or download
    localStorage.setItem(`backup_${path}`, content);
  }
}

// Check quota before large operations
if (navigator.storage &amp;&amp; navigator.storage.estimate) {
  const estimate = await navigator.storage.estimate();
  const percentUsed = (estimate.usage / estimate.quota) * 100;
  
  if (percentUsed &gt; 90) {
    console.warn(&#039;Storage nearly full, cleanup recommended&#039;);
  }
}</code></pre>
<strong>Exceptions thrown</strong>:
<ul><li><code>DOMException</code>: OPFS-specific errors (NotFoundError, QuotaExceededError)</li>
<li><code>TypeError</code>: Invalid parameters (non-string path, invalid content type)</li>
<li><code>Error</code>: General file operation failures</li>
</ul>
<strong>Browser Compatibility Notes</strong>:
<ul><li>OPFS requires Chrome 102+, Edge 102+, Opera 88+</li>
<li>Not available in Firefox as of December 2024</li>
<li>Requires HTTPS or localhost (not available on <code>http://</code>)</li>
<li>Private/incognito mode may have reduced quota</li>
<li>Check support: <code>if ('storage' in navigator && 'getDirectory' in navigator.storage)</code></li>
</ul>
<h3>Common Issues</h3>
<strong>Files don't persist</strong>: OPFS storage clears if user clears browser data, uses private mode, or exceeds quota. Provide export functionality for critical data.
<strong>"Failed to initialize OPFS"</strong>: Requires HTTPS (or localhost). Check browser support: Chrome 102+, Edge 102+, Opera 88+.
<strong>File list doesn't update</strong>: Call <code>refresh()</code> after <code>writeFile()</code> or <code>deleteFile()</code>.
<strong>Can't access files from network</strong>: OPFS is origin-private by design. Read content and send via fetch/WebSocket to share.
<hr>
<h2>pan-markdown-editor</h2>
<strong>Purpose</strong>: Rich markdown editor with toolbar, preview, and auto-save  
<strong>Import</strong>: <code><script type="module" src="/ui/pan-markdown-editor.mjs"></script></code>
<h3>Quick Example</h3>
<pre><code class="language-html">&lt;pan-markdown-editor
  value=&quot;# Hello World&quot;
  preview=&quot;true&quot;
  autosave=&quot;true&quot;
  placeholder=&quot;Start writing...&quot;&gt;
&lt;/pan-markdown-editor&gt;

&lt;script type=&quot;module&quot;&gt;
const editor = document.querySelector(&#039;pan-markdown-editor&#039;);

// Get content
const markdown = editor.getValue();

// Set content
editor.setValue(&#039;# New Content&#039;);

// Insert at cursor
editor.insertText(&#039;\n\n---\n\n&#039;);
&lt;/script&gt;</code></pre>
<h3>Attributes</h3>
<p>| Attribute | Type | Default | Description |
|-----------|------|---------|-------------|
| <code>value</code> | String | "" | Initial markdown content |
| <code>placeholder</code> | String | "Start writing..." | Placeholder text |
| <code>preview</code> | Boolean | false | Show live preview pane |
| <code>autosave</code> | Boolean | false | Enable auto-save (1s debounce) |</p>
<h3>Methods</h3>
<p>| Method | Parameters | Returns | Description |
|--------|-----------|---------|-------------|
| <code>setValue(value)</code> | value: String | void | Set editor content |
| <code>getValue()</code> | - | String | Get current content |
| <code>insertText(text)</code> | text: String | void | Insert at cursor position |
| <code>focus()</code> | - | void | Focus editor textarea |</p>
<h3>Toolbar Actions</h3>
<p>| Button | Action | Shortcut | Result |
|--------|--------|----------|--------|
| <strong>B</strong> | Bold | Ctrl+B | <code><strong>text</strong></code> |
| <strong>I</strong> | Italic | Ctrl+I | <code><em>text</em></code> |
| <strong>S</strong> | Strikethrough | - | <code>~~text~~</code> |
| H1-H3 | Headings | - | <code># text</code> |
| <em> | Bullet list | - | <code></em> item</code> |
| 1. | Numbered list | - | <code>1. item</code> |
| [v] | Task list | - | <code>- [ ] task</code> |
| [link] | Link | Ctrl+K | <code><a href="url">text</a></code> |
| [img] | Image | - | <code>!<a href="url">alt</a></code> |
| { } | Inline code | - | `<code> </code>code<code> </code><code> |
| </> | Code block | - | </code> ``<code>lang\ncode\n</code>`<code> </code> |
| " | Blockquote | - | <code>> quote</code> |
| - | Horizontal rule | - | <code>---</code> |
| [+] | Table | - | Markdown table |
| [eye] | Preview | - | Toggle preview pane |</p>
<strong>Additional shortcuts:</strong>
<ul><li>Ctrl+S: Save (triggers <code>markdown.saved</code>)</li>
<li>Tab: Insert two spaces</li>
<li>Enter: Auto-continue lists</li>
</ul>
<h3>PAN Events</h3>
<p>#### Published</p>
<p>| Topic | Data | Description |
|-------|------|-------------|
| <code>markdown.changed</code> | <code>{ content, wordCount, charCount }</code> | Content changed |
| <code>markdown.saved</code> | <code>{ content }</code> | Ctrl+S pressed or auto-save |</p>
<p>#### Subscribed</p>
<p>| Topic | Data | Description |
|-------|------|-------------|
| <code>markdown.set-content</code> | <code>{ content }</code> | Set editor content |
| <code>markdown.get-content</code> | <code>{}</code> | Request content (responds with markdown.content-response) |</p>
<h3>Complete Example</h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;script type=&quot;module&quot;&gt;
    import &#039;./pan-bus.mjs&#039;;
    import &#039;./pan-files.mjs&#039;;
    import &#039;./pan-markdown-editor.mjs&#039;;
    import &#039;./pan-markdown-renderer.mjs&#039;;

    customElements.whenDefined(&#039;pan-bus&#039;).then(() =&gt; {
      const bus = document.querySelector(&#039;pan-bus&#039;);
      let currentFile = null;

      // Load file into editor
      bus.subscribe(&#039;file.selected&#039;, (msg) =&gt; {
        if (msg.data.path.endsWith(&#039;.md&#039;)) {
          currentFile = msg.data.path;
          bus.publish(&#039;file.load&#039;, { path: msg.data.path });
        }
      });

      bus.subscribe(&#039;file.content-loaded&#039;, (msg) =&gt; {
        const editor = document.querySelector(&#039;pan-markdown-editor&#039;);
        editor.setValue(msg.data.content);
        document.getElementById(&#039;filename&#039;).textContent = 
          msg.data.path.split(&#039;/&#039;).pop();
      });

      // Save editor to file
      bus.subscribe(&#039;markdown.saved&#039;, (msg) =&gt; {
        if (currentFile) {
          bus.publish(&#039;file.save&#039;, {
            path: currentFile,
            content: msg.data.content
          });
        }
      });

      window.createNote = () =&gt; {
        currentFile = `/note-${Date.now()}.md`;
        document.getElementById(&#039;filename&#039;).textContent = 
          currentFile.split(&#039;/&#039;).pop();
        const editor = document.querySelector(&#039;pan-markdown-editor&#039;);
        editor.setValue(&#039;# New Note\n\n&#039;);
        editor.focus();
      };
    });
  &lt;/script&gt;
  &lt;style&gt;
    body { margin: 0; display: grid; grid-template-rows: auto 1fr; height: 100vh; }
    .toolbar { padding: 1rem; border-bottom: 1px solid #ccc; display: flex; gap: 1rem; }
    .content { display: grid; grid-template-columns: 250px 1fr; gap: 1rem; padding: 1rem; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;pan-bus&gt;&lt;/pan-bus&gt;
  &lt;div class=&quot;toolbar&quot;&gt;
    &lt;span id=&quot;filename&quot;&gt;No file selected&lt;/span&gt;
    &lt;button onclick=&quot;createNote()&quot;&gt;New Note&lt;/button&gt;
  &lt;/div&gt;
  &lt;div class=&quot;content&quot;&gt;
    &lt;pan-files filter=&quot;.md&quot;&gt;&lt;/pan-files&gt;
    &lt;pan-markdown-editor preview=&quot;true&quot; autosave=&quot;true&quot;&gt;&lt;/pan-markdown-editor&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<h3>Errors</h3>
<p>pan-markdown-editor dispatches <code>error</code> events for error conditions:</p>
<p>| Error Code | Cause | Resolution |
|------------|-------|------------|
| <code>RENDER_FAILED</code> | Preview rendering failed | Check markdown syntax or disable preview |
| <code>AUTOSAVE_FAILED</code> | Auto-save operation failed | Check storage or disable autosave |
| <code>INVALID_CONTENT</code> | Non-string content passed to <code>setValue()</code> | Pass valid string to <code>setValue()</code> |
| <code>TOOLBAR_ACTION_FAILED</code> | Toolbar button action threw error | Check custom toolbar handlers |</p>
<strong>Error handling example</strong>:
<pre><code class="language-javascript">const editor = document.querySelector(&#039;pan-markdown-editor&#039;);

// Listen for errors
editor.addEventListener(&#039;error&#039;, (e) =&gt; {
  const { code, message, action } = e.detail;
  console.error(`Editor error [${code}]:`, message);

  switch (code) {
    case &#039;RENDER_FAILED&#039;:
      // Disable preview temporarily
      editor.removeAttribute(&#039;preview&#039;);
      showNotification(&#039;Preview disabled due to rendering error&#039;);
      break;

    case &#039;AUTOSAVE_FAILED&#039;:
      // Manual save prompt
      if (confirm(&#039;Auto-save failed. Save manually?&#039;)) {
        const content = editor.getValue();
        manualSave(content);
      }
      break;

    case &#039;INVALID_CONTENT&#039;:
      console.warn(&#039;Attempted to set invalid content&#039;);
      break;
  }
});

// Safe setValue with validation
function safeSetValue(content) {
  if (typeof content !== &#039;string&#039;) {
    console.error(&#039;Content must be a string&#039;);
    return;
  }
  
  try {
    editor.setValue(content);
  } catch (err) {
    console.error(&#039;Failed to set editor content:&#039;, err);
    // Fallback to plain textarea
    useFallbackEditor(content);
  }
}

// Monitor autosave with error handling
const bus = document.querySelector(&#039;pan-bus&#039;);
bus.subscribe(&#039;markdown.saved&#039;, (msg) =&gt; {
  try {
    localStorage.setItem(&#039;backup&#039;, msg.data.content);
    console.log(&#039;Content backed up&#039;);
  } catch (err) {
    console.error(&#039;Backup failed:&#039;, err);
  }
});</code></pre>
<strong>Exceptions thrown</strong>:
<ul><li><code>TypeError</code>: Invalid parameters (non-string content, invalid position)</li>
<li><code>Error</code>: General operation failures (toolbar actions, preview rendering)</li>
</ul>
<strong>Performance Notes</strong>:
<ul><li>Documents over 50KB may cause lag with preview enabled</li>
<li>Autosave debounces input by 1 second</li>
<li>Consider disabling preview for large documents: <code>if (content.length > 50000) editor.removeAttribute('preview')</code></li>
</ul>
<h3>Common Issues</h3>
<strong>Toolbar doesn't work on mobile</strong>: Component optimized for desktop. Hide toolbar on mobile.
<strong>Preview doesn't update</strong>: Ensure <code>pan-markdown-renderer</code> is imported.
<strong>Large documents lag</strong>: Disable preview or add debouncing for documents over 50KB.
<strong>Keyboard shortcuts conflict</strong>: Component uses <code>preventDefault()</code> but browser behavior varies.
<hr>
<h2>pan-markdown-renderer</h2>
<strong>Purpose</strong>: Render markdown as formatted HTML with syntax highlighting structure  
<strong>Import</strong>: <code><script type="module" src="/ui/pan-markdown-renderer.mjs"></script></code>
<h3>Quick Example</h3>
<pre><code class="language-html">&lt;pan-markdown-renderer content=&quot;# Hello World

This is **bold** and *italic*.</code></pre>javascript
console.log('Code block');
<pre><code class="language-plaintext">&quot;&gt;&lt;/pan-markdown-renderer&gt;

&lt;script type=&quot;module&quot;&gt;
const renderer = document.querySelector(&#039;pan-markdown-renderer&#039;);

// Set content
renderer.setContent(&#039;# Dynamic Content&#039;);

// Get markdown
const markdown = renderer.getContent();

// Get rendered HTML
const html = renderer.getHtml();
&lt;/script&gt;</code></pre>
<h3>Attributes</h3>
<p>| Attribute | Type | Default | Description |
|-----------|------|---------|-------------|
| <code>content</code> | String | "" | Markdown content to render |
| <code>sanitize</code> | Boolean | true | Escape raw HTML (disable only if trusted) |</p>
<h3>Methods</h3>
<p>| Method | Parameters | Returns | Description |
|--------|-----------|---------|-------------|
| <code>setContent(content)</code> | content: String | void | Set and render markdown |
| <code>getContent()</code> | - | String | Get current markdown |
| <code>getHtml()</code> | - | String | Get rendered HTML output |</p>
<h3>Supported Syntax</h3>
<strong>Standard markdown:</strong>
<ul><li>Headings: <code># H1</code> through <code>###### H6</code></li>
<li>Emphasis: <code><strong>bold</strong></code>, <code><em>italic</em></code>, <code>~~strikethrough~~</code></li>
<li>Lists: Bullet (<code>*</code>), numbered (<code>1.</code>), task (<code>- [ ]</code>)</li>
<li>Links: <code><a href="url">text</a></code> and images: <code>!<a href="url">alt</a></code></li>
<li>Code: Inline `<code> </code>code<code> </code><code> and fenced </code> ``<code>lang </code> blocks</li>
<li>Blockquotes: <code>> quote</code></li>
<li>Horizontal rules: <code>---</code></li>
</ul>
<strong>GitHub-flavored:</strong>
<ul><li>Tables with <code>|</code> delimiters</li>
<li>Task lists: <code>- [x] Done</code> and <code>- [ ] Todo</code></li>
</ul>
<h3>Styling</h3>
<p>Customize with CSS variables:</p>
<pre><code class="language-css">pan-markdown-renderer {
  --color-text: #1e293b;
  --color-text-muted: #64748b;
  --color-bg-alt: #f8fafc;
  --color-border: #e2e8f0;
  --color-code-bg: #1e293b;
  --color-code-text: #e2e8f0;
  --color-primary: #006699;
  --font-mono: &#039;Courier New&#039;, monospace;
}

/* Dark mode */
pan-markdown-renderer.dark {
  --color-text: #e2e8f0;
  --color-bg-alt: #1e293b;
  --color-code-bg: #0f172a;
  --color-primary: #38bdf8;
}</code></pre>
<h3>PAN Events</h3>
<p>#### Subscribed</p>
<p>| Topic | Data | Description |
|-------|------|-------------|
| <code>markdown.render</code> | <code>{ content }</code> | Render new content |</p>
<h3>Complete Example</h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;script type=&quot;module&quot;&gt;
    import &#039;./pan-bus.mjs&#039;;
    import &#039;./pan-markdown-renderer.mjs&#039;;

    const docs = {
      intro: `# Getting Started

Welcome! This guide covers the basics.

## Prerequisites

- Modern web browser
- Basic HTML/JavaScript knowledge
- 15 minutes

## Installation

\`\`\`javascript
import &#039;./components/app.mjs&#039;;
\`\`\``,

      api: `# API Reference

## Core Methods

### \`initialize(config)\`

Initializes the application.

**Parameters:**
- \`config.debug\` (Boolean): Enable debug mode
- \`config.theme\` (String): Theme name

\`\`\`javascript
await initialize({ debug: true, theme: &#039;dark&#039; });
\`\`\``,

      examples: `# Examples

## Task List

- [x] Create component
- [x] Write docs
- [ ] Deploy

## Data Table

| Feature | Status | Version |
|---------|--------|---------|
| Import  | ✓      | 1.0     |
| Export  | ✓      | 1.0     |
| Sync    | ⏳     | 2.0     |`
    };

    customElements.whenDefined(&#039;pan-bus&#039;).then(() =&gt; {
      const renderer = document.querySelector(&#039;pan-markdown-renderer&#039;);

      window.showDoc = (section) =&gt; {
        renderer.setContent(docs[section]);
        document.querySelectorAll(&#039;nav button&#039;).forEach(btn =&gt; {
          btn.classList.toggle(&#039;active&#039;, btn.dataset.section === section);
        });
      };

      showDoc(&#039;intro&#039;);
    });
  &lt;/script&gt;
  &lt;style&gt;
    body { margin: 0; display: grid; grid-template-columns: 200px 1fr; height: 100vh; }
    nav { background: #f8fafc; padding: 1rem; border-right: 1px solid #e2e8f0; }
    nav button { display: block; width: 100%; padding: 0.5rem; margin: 0.25rem 0; 
                 border: none; background: transparent; text-align: left; cursor: pointer; }
    nav button:hover { background: #e2e8f0; }
    nav button.active { background: #006699; color: white; }
    main { padding: 2rem; overflow-y: auto; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;pan-bus&gt;&lt;/pan-bus&gt;
  &lt;nav&gt;
    &lt;h2&gt;Documentation&lt;/h2&gt;
    &lt;button data-section=&quot;intro&quot; onclick=&quot;showDoc(&#039;intro&#039;)&quot; class=&quot;active&quot;&gt;Getting Started&lt;/button&gt;
    &lt;button data-section=&quot;api&quot; onclick=&quot;showDoc(&#039;api&#039;)&quot;&gt;API Reference&lt;/button&gt;
    &lt;button data-section=&quot;examples&quot; onclick=&quot;showDoc(&#039;examples&#039;)&quot;&gt;Examples&lt;/button&gt;
  &lt;/nav&gt;
  &lt;main&gt;
    &lt;pan-markdown-renderer&gt;&lt;/pan-markdown-renderer&gt;
  &lt;/main&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<h3>Errors</h3>
<p>pan-markdown-renderer dispatches <code>error</code> events when rendering fails:</p>
<p>| Error Code | Cause | Resolution |
|------------|-------|------------|
| <code>PARSE_ERROR</code> | Invalid markdown syntax | Check markdown format or sanitize input |
| <code>RENDER_ERROR</code> | HTML generation failed | Simplify content or report bug |
| <code>SANITIZATION_ERROR</code> | HTML sanitization failed | Check content or disable sanitization |
| <code>INVALID_CONTENT</code> | Non-string content passed | Pass valid string to <code>setContent()</code> |</p>
<strong>Error handling example</strong>:
<pre><code class="language-javascript">const renderer = document.querySelector(&#039;pan-markdown-renderer&#039;);

// Listen for errors
renderer.addEventListener(&#039;error&#039;, (e) =&gt; {
  const { code, message, content } = e.detail;
  console.error(`Renderer error [${code}]:`, message);

  switch (code) {
    case &#039;PARSE_ERROR&#039;:
      // Show raw markdown as fallback
      renderer.shadowRoot.querySelector(&#039;.content&#039;).textContent = content;
      showWarning(&#039;Markdown parsing failed, showing raw content&#039;);
      break;

    case &#039;RENDER_ERROR&#039;:
      console.error(&#039;Failed to render markdown&#039;);
      showFallbackRenderer();
      break;

    case &#039;SANITIZATION_ERROR&#039;:
      // Retry with stricter sanitization
      renderer.setAttribute(&#039;sanitize&#039;, &#039;true&#039;);
      break;

    case &#039;INVALID_CONTENT&#039;:
      console.warn(&#039;Invalid content type provided&#039;);
      break;
  }
});

// Safe setContent with validation
function safeSetContent(content) {
  if (typeof content !== &#039;string&#039;) {
    console.error(&#039;Content must be a string&#039;);
    return;
  }

  try {
    renderer.setContent(content);
  } catch (err) {
    console.error(&#039;Failed to render content:&#039;, err);
    // Fallback to plain text
    renderer.shadowRoot.querySelector(&#039;.content&#039;).textContent = content;
  }
}

// Validate markdown before rendering
function validateAndRender(markdown) {
  // Check for balanced code fences
  const fenceCount = (markdown.match(/</code></pre>/g) || []).length;
  if (fenceCount % 2 !== 0) {
    console.warn('Unbalanced code fences detected');
    markdown += '\n``<code>'; // Auto-close
  }
<p>renderer.setContent(markdown);
}
<pre><code class="language-plaintext">**Exceptions thrown**:

- `TypeError`: Invalid parameters (non-string content)
- `Error`: Parse or render failures

**Performance Notes**:

- Large documents (&gt;100KB) may slow rendering
- Complex tables with many rows cause layout reflow
- Consider debouncing content updates for live preview

### Common Issues

**No syntax highlighting**: Renderer provides structure only. Add Prism.js or similar for color syntax highlighting.

**Tables render incorrectly**: Ensure separator row with dashes: `|---|---|`

**Raw HTML appears**: Sanitization enabled by default. Only set `sanitize=&quot;false&quot;` for trusted content.

**Content doesn&#039;t wrap on mobile**: Add responsive CSS:</code></pre>css
pan-markdown-renderer { overflow-x: auto; }
pan-markdown-renderer pre { max-width: 100%; overflow-x: auto; }
</code>``</p>
<hr>
<h2>Summary</h2>
<p>This chapter documented LARC's UI components:</p>
<ul><li><strong>pan-files</strong>: OPFS file system browser with visual UI and programmatic API</li>
<li><strong>pan-markdown-editor</strong>: Rich markdown editor with toolbar, preview, and auto-save</li>
<li><strong>pan-markdown-renderer</strong>: Markdown-to-HTML renderer with GitHub-flavored syntax</li>
</ul>
Use together for complete markdown applications or individually as needed.
<strong>See Also</strong>:
<ul><li>Tutorial: <em>Learning LARC</em> Chapter 10</li>
<li>Core components: Chapter 17</li>
<li>Data components: Chapter 18</li>
<li>Integration patterns: Chapter 20</li>
</ul>
      </article>
      <footer class="docs-footer">
        <a href="https://github.com/chrisrobison/pan/edit/main/books/building-with-larc/chapters/19-ui-components.md" target="_blank">
          Edit this page on GitHub
        </a>
      </footer>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp" crossorigin="anonymous"></script>
  <script src="../assets/docs.js"></script>
  <pan-theme-provider></pan-theme-provider>
</body>
</html>