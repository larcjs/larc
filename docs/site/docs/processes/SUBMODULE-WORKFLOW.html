<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Git Submodules Workflow Guide · PAN Documentation</title>
  <meta name="description" content="PAN (Page Area Network) Documentation - Git Submodules Workflow Guide">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/theme.css">
  <link rel="stylesheet" href="../assets/docs.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" integrity="sha384-wH75j6z1lH97ZOpMOInqhgKzFkAInZPPSPlZpYKYTOqsaizPvhQZmAtLcPKXpLyH" crossorigin="anonymous">
</head>
<body>
  <header class="docs-header">
    <div class="docs-header-content">
      <a href="../index.html" class="logo">
        <span>PAN</span>
      </a>
      <nav class="docs-nav">
        <a href="../index.html">Home</a>
        <a href="index.html" class="active">Docs</a>
        <a href="../examples.html">Examples</a>
        <a href="../apps.html">Apps</a>
        <a href="https://github.com/chrisrobison/pan" target="_blank">GitHub</a>
      </nav>
    </div>
  </header>

  <div class="docs-layout">
    <aside class="docs-sidebar">
      <div class="docs-sidebar-content">
        <h3>Documentation</h3>
        <nav class="docs-menu" id="docs-menu">
          <!-- Will be populated by JavaScript -->
        </nav>
      </div>
    </aside>

    <main class="docs-main">
      <div class="docs-breadcrumb">
        <a href="../index.html">Home</a> / <a href="#">processes</a> / <span>SUBMODULE-WORKFLOW</span>
      </div>
      <article class="docs-content">
        <h1>Git Submodules Workflow Guide</h1>
<p>This document explains how to work with the LARC meta repository and its submodules effectively.</p>
<h2>Repository Structure</h2>
<pre><code class="language-plaintext">larc/ (meta repo)
├── apps/ (submodule -&gt; github.com/larcjs/apps)
│   ├── components/ (nested submodule -&gt; github.com/larcjs/components)
│   └── core/ (nested submodule -&gt; github.com/larcjs/core)
├── site/ (submodule -&gt; github.com/larcjs/site)
├── core/ (submodule -&gt; github.com/larcjs/core)
├── ui/ (submodule -&gt; github.com/larcjs/components)
├── examples/ (submodule -&gt; github.com/larcjs/examples)
├── devtools/ (submodule -&gt; github.com/larcjs/devtools)
├── components-types/ (submodule)
└── core-types/ (submodule)</code></pre>
<hr>
<h2>Understanding Git Submodules</h2>
<h3>The Key Concept</h3>
<strong>A submodule reference is just a pointer to a specific commit SHA in another repo.</strong>
<p>When the meta repo has changes like:
<pre><code class="language-plaintext">modified:   apps (new commits)</code></pre></p>
<p>This means the <code>apps</code> submodule has moved to a different commit than what the meta repo expects.</p>
<h3>Why Detached HEAD?</h3>
When you enter a submodule directory, git checks out the <strong>exact commit SHA</strong> that the parent repo points to, not a branch. This is by design to ensure reproducibility. You're in "detached HEAD" state because you're viewing a specific point in history, not following a branch.
<hr>
<h2>Essential Commands</h2>
<h3>1. Pulling Latest Updates (All Repos)</h3>
<p>Use the provided script:
<pre><code class="language-bash"># From meta repo root
./pull-updates.sh</code></pre></p>
<p>Or manually:
<pre><code class="language-bash"># Pull meta repo
git pull

# Update all submodules to their latest remote main branches
git submodule update --init --recursive --remote

# OR use the combined command
git pull --recurse-submodules &amp;&amp; git submodule update --init --recursive --remote</code></pre></p>
<strong>What this does:</strong>
<ul><li>Pulls latest changes in the meta repo</li>
<li>Updates ALL submodules (including nested ones) to their latest remote <code>main</code> branch</li>
<li>Initializes any new submodules that were added</li>
</ul>
<hr>
<h2>Common Workflows</h2>
<h3>Workflow 1: Making Changes to a Submodule (e.g., apps, components)</h3>
<strong>Scenario:</strong> You want to edit files in <code>apps/</code> or <code>apps/components/</code>
<p>#### Step 1: Enter the submodule and switch to a branch
<pre><code class="language-bash">cd apps
git checkout main  # Get off detached HEAD!
git pull           # Get latest changes</code></pre></p>
<p>#### Step 2: Make your changes and commit
<pre><code class="language-bash"># Edit files...
git add .
git commit -m &quot;Your commit message&quot;</code></pre></p>
<p>#### Step 3: Push your changes to the submodule's remote
<pre><code class="language-bash">git push origin main</code></pre></p>
<p>#### Step 4: Update the meta repo to point to your new commit
<pre><code class="language-bash">cd ..  # Back to meta repo root
git add apps
git commit -m &quot;Update apps submodule to latest version&quot;
git push</code></pre></p>
<strong>Important:</strong> The meta repo must be updated to "know" about the new commit in the submodule!
<hr>
<h3>Workflow 2: Making Changes to Nested Submodules (e.g., apps/components)</h3>
<strong>Scenario:</strong> You want to edit <code>apps/components/</code>
<p>#### Step 1: Navigate to nested submodule and switch to branch
<pre><code class="language-bash">cd apps/components
git checkout main
git pull</code></pre></p>
<p>#### Step 2: Make changes and commit
<pre><code class="language-bash"># Edit files...
git add .
git commit -m &quot;Enhance components&quot;
git push origin main</code></pre></p>
<p>#### Step 3: Update the parent submodule (apps)
<pre><code class="language-bash">cd ..  # Now in apps/
git add components
git commit -m &quot;Update components submodule to latest version&quot;
git push origin main</code></pre></p>
<p>#### Step 4: Update the meta repo
<pre><code class="language-bash">cd ..  # Now in meta repo root
git add apps
git commit -m &quot;Update apps submodule (which includes updated components)&quot;
git push</code></pre></p>
<strong>You must update TWO levels:</strong> first the intermediate repo (<code>apps</code>), then the meta repo.
<hr>
<h3>Workflow 3: Syncing Production with Latest Changes</h3>
<strong>Scenario:</strong> You've pushed changes to submodule repos and want production to get them.
<p>#### On your production server:
<pre><code class="language-bash">cd /path/to/larc
./pull-updates.sh

# Verify everything is on correct branches
git submodule foreach --recursive &#039;git checkout main || true&#039;</code></pre></p>
<hr>
<h3>Workflow 4: Someone Else Updated a Submodule</h3>
<strong>Scenario:</strong> A teammate pushed changes to <code>apps</code> or <code>components</code>.
<p>#### Step 1: Pull meta repo
<pre><code class="language-bash">git pull</code></pre></p>
<p>You'll see:
<pre><code class="language-plaintext">modified:   apps (new commits)</code></pre></p>
<p>#### Step 2: Update submodules
<pre><code class="language-bash">git submodule update --init --recursive</code></pre></p>
<p>This checks out the exact commits the meta repo now points to.</p>
<strong>Optional:</strong> If you want submodules on their <code>main</code> branches:
<pre><code class="language-bash">git submodule foreach --recursive &#039;git checkout main &amp;&amp; git pull&#039;</code></pre>
<hr>
<h2>Preventing Detached HEAD Issues</h2>
<h3>Always Work on Branches</h3>
When you enter a submodule to make changes:
<pre><code class="language-bash">cd apps
git checkout main  # DO THIS FIRST!</code></pre>
<h3>Create a Helper Script</h3>
Create <code>work-on-submodule.sh</code>:
<pre><code class="language-bash">#!/bin/bash
# Usage: ./work-on-submodule.sh apps

SUBMODULE=$1
cd &quot;$SUBMODULE&quot; || exit 1
git checkout main
git pull
echo &quot;Ready to work on $SUBMODULE (on main branch)&quot;</code></pre>
<hr>
<h2>Quick Reference Commands</h2>
<h3>Status Check</h3>
<pre><code class="language-bash"># See which submodules have uncommitted changes or are on different commits
git status

# See status of all submodules
git submodule status

# Recursively check status of nested submodules
git submodule foreach --recursive &#039;echo &quot;=== $name ===&quot; &amp;&amp; git status&#039;</code></pre>
<h3>Fix Detached HEAD</h3>
<pre><code class="language-bash"># If you&#039;re in a submodule in detached HEAD:
git checkout main
git pull</code></pre>
<h3>View Submodule Changes</h3>
<pre><code class="language-bash"># See which commit the submodule moved to
git diff apps

# See the actual code changes in a submodule
cd apps &amp;&amp; git log</code></pre>
<h3>Update Single Submodule</h3>
<pre><code class="language-bash"># Update just one submodule to its latest remote main
git submodule update --remote apps</code></pre>
<hr>
<h2>Best Practices</h2>
<h3>1. Always commit submodule changes first, meta repo second</h3>
<pre><code class="language-bash"># ❌ WRONG ORDER
cd meta-repo
git add apps
git commit -m &quot;Update apps&quot;  # But apps changes aren&#039;t pushed yet!

# ✅ CORRECT ORDER
cd apps
git push                      # Push submodule changes first
cd ..
git add apps
git commit -m &quot;Update apps&quot;   # Then update meta repo pointer
git push</code></pre>
<h3>2. Use descriptive commit messages in meta repo</h3>
<pre><code class="language-bash"># ❌ Vague
git commit -m &quot;Update submodules&quot;

# ✅ Descriptive
git commit -m &quot;Update apps submodule to include new routing features&quot;</code></pre>
<h3>3. Verify before pushing</h3>
<pre><code class="language-bash"># Check submodule commits are pushed
cd apps &amp;&amp; git log origin/main..HEAD  # Should be empty
cd ../site &amp;&amp; git log origin/main..HEAD  # Should be empty

# Then push meta repo
cd .. &amp;&amp; git push</code></pre>
<h3>4. Document nested submodule changes</h3>
When updating nested submodules, your commit chain should be:
<li>Commit in <code>apps/components</code> with message about component changes</li>
<li>Commit in <code>apps</code> with message "Update components submodule: [reason]"</li>
<li>Commit in meta repo with message "Update apps submodule: [reason]"</li>
<hr>
<h2>Troubleshooting</h2>
<h3>"I'm stuck in detached HEAD!"</h3>
<pre><code class="language-bash">git checkout main
git pull</code></pre>
<h3>"My changes are missing after submodule update!"</h3>
If you made commits while in detached HEAD, they're not lost:
<pre><code class="language-bash">git reflog  # Find your commit SHA
git checkout main
git cherry-pick &lt;commit-sha&gt;  # Apply your changes to main</code></pre>
<h3>"Submodule conflicts after pull"</h3>
<pre><code class="language-bash"># Option 1: Take remote version
git submodule update --init --recursive --remote

# Option 2: Keep your version (don&#039;t update submodules)
git submodule update --init --recursive

# Option 3: Manually resolve
cd problem-submodule
git checkout main
git pull
cd ..
git add problem-submodule</code></pre>
<h3>"I can't push - authentication failed"</h3>
Check your git remote URL:
<pre><code class="language-bash">git remote -v</code></pre>
<p>If it shows <code>https://github.com/...</code>, you may need to:
<li>Set up SSH keys and use <code>git@github.com:...</code></li>
<li>Or use GitHub personal access token</li>
<li>Or configure credential helper</li></p>
<hr>
<h2>Automation Tips</h2>
<h3>Git Aliases</h3>
Add to <code>~/.gitconfig</code>:
<pre><code class="language-ini">[alias]
  sup = submodule update --init --recursive --remote
  spull = !git pull &amp;&amp; git submodule update --init --recursive --remote
  spush = push --recurse-submodules=on-demand</code></pre>
<p>Usage:
<pre><code class="language-bash">git spull   # Pull everything
git spush   # Push with submodule safety check</code></pre></p>
<h3>Pre-commit Hook</h3>
Create <code>.git/hooks/pre-commit</code> in meta repo:
<pre><code class="language-bash">#!/bin/bash
# Check if any submodule has unpushed commits
git submodule foreach --quiet --recursive &#039;
  if [ $(git log origin/$(git rev-parse --abbrev-ref HEAD)..HEAD --oneline | wc -l) -gt 0 ]; then
    echo &quot;Error: Submodule $name has unpushed commits!&quot;
    exit 1
  fi
&#039;</code></pre>
<hr>
<h2>Summary Cheatsheet</h2>
<p>| Action | Commands |
|--------|----------|
| Pull all updates | <code>./pull-updates.sh</code> |
| Work on submodule | <code>cd apps && git checkout main</code> |
| Commit submodule change | <code>git add . && git commit && git push</code> |
| Update meta repo pointer | <code>cd .. && git add apps && git commit -m "Update apps"</code> |
| Fix detached HEAD | <code>git checkout main</code> |
| Check all status | <code>git submodule foreach --recursive git status</code> |
| Sync to specific commit | <code>git submodule update --init --recursive</code> |
| Sync to latest remote | <code>git submodule update --init --recursive --remote</code> |</p>
<hr>
<h2>Deploy to Production Checklist</h2>
<ul><li>[ ] All submodule changes committed and pushed</li>
<li>[ ] Meta repo updated to point to new submodule commits</li>
<li>[ ] Meta repo changes pushed</li>
<li>[ ] On production server: <code>git pull</code></li>
<li>[ ] On production server: <code>./pull-updates.sh</code></li>
<li>[ ] Verify: <code>git submodule status</code> shows expected commits</li>
<li>[ ] Test application functionality</li>
</ul>
<hr>
<em>Last updated: 2025-12-06</em>
      </article>
      <footer class="docs-footer">
        <a href="https://github.com/chrisrobison/pan/edit/main/processes/SUBMODULE-WORKFLOW.md" target="_blank">
          Edit this page on GitHub
        </a>
      </footer>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp" crossorigin="anonymous"></script>
  <script src="../assets/docs.js"></script>
</body>
</html>