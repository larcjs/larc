<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- CRITICAL: Load theme BEFORE CSS to prevent flash -->
  <script src="../../../../../../playground/theme-init.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Node.js Backend Examples for LARC/PAN · PAN Documentation</title>
  <meta name="description" content="PAN (Page Area Network) Documentation - Node.js Backend Examples for LARC/PAN">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/theme.css">
  <link rel="stylesheet" href="../assets/docs.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" integrity="sha384-wH75j6z1lH97ZOpMOInqhgKzFkAInZPPSPlZpYKYTOqsaizPvhQZmAtLcPKXpLyH" crossorigin="anonymous">
</head>
<body>
  <header class="docs-header">
    <div class="docs-header-content">
      <a href="../index.html" class="logo">
        <span>PAN</span>
      </a>
      <nav class="docs-nav">
        <a href="../index.html">Home</a>
        <a href="index.html" class="active">Docs</a>
        <a href="../examples.html">Examples</a>
        <a href="../apps.html">Apps</a>
        <a href="https://github.com/chrisrobison/pan" target="_blank">GitHub</a>
      </nav>
    </div>
  </header>

  <div class="docs-layout">
    <aside class="docs-sidebar">
      <div class="docs-sidebar-content">
        <h3>Documentation</h3>
        <nav class="docs-menu" id="docs-menu">
          <!-- Will be populated by JavaScript -->
        </nav>
      </div>
    </aside>

    <main class="docs-main">
      <div class="docs-breadcrumb">
        <a href="../index.html">Home</a> / <a href="#">examples</a> / <a href="#">backends</a> / <a href="#">nodejs</a> / <span>README</span>
      </div>
      <article class="docs-content">
        <h1>Node.js Backend Examples for LARC/PAN</h1>
<p>This directory contains Node.js versions of the PHP backend examples, making it easier to get started with LARC without requiring PHP.</p>
<h2>Available Backends</h2>
<h3>1. Legacy API (<code>api-legacy.js</code>)</h3>
Simple database API with basic CRUD operations. No authentication required.
<strong>Port:</strong> 3000
<strong>Endpoints:</strong>
<ul><li><code>GET /?x=list_resources</code> - List available database tables</li>
<li><code>GET /?x=get&rsc=tablename</code> - Get records from a table (with pagination)</li>
<li><code>GET /?x=list_fields&rsc=tablename</code> - Get table schema</li>
</ul>
<h3>2. Secure API (<code>apps/api.js</code>)</h3>
Production-ready API with security features.
<strong>Port:</strong> 3001
<strong>Features:</strong>
<ul><li>Session-based authentication</li>
<li>CSRF protection</li>
<li>Rate limiting</li>
<li>Resource whitelisting</li>
<li>SQL injection protection</li>
<li>Security headers</li>
</ul>
<strong>Endpoints:</strong> Same as Legacy API, but requires authentication
<h3>3. Authentication (<code>auth.js</code>)</h3>
Handles user authentication with JWT tokens.
<strong>Port:</strong> 3002
<strong>Endpoints:</strong>
<ul><li><code>GET /?action=login</code> - User login (returns JWT)</li>
<li><code>GET /?action=logout</code> - User logout</li>
<li><code>GET /?action=refresh</code> - Refresh JWT token</li>
<li><code>GET /?action=check</code> - Check authentication status</li>
<li><code>GET /?action=csrf</code> - Get CSRF token</li>
</ul>
<strong>Demo Credentials:</strong>
<ul><li>Email: <code>demo@example.com</code></li>
<li>Password: <code>demo123</code></li>
</ul>
<h3>4. SSE Server (<code>sse.js</code>)</h3>
Server-Sent Events hub for real-time PAN messaging.
<strong>Port:</strong> 3003
<strong>Endpoints:</strong>
<ul><li><code>GET /?topics=topic1,topic2&lastEventId=123</code> - Subscribe to event stream</li>
<li><code>POST /</code> with <code>{"topic": "demo.ping", "data": {...}, "retain": false}</code> - Publish event</li>
</ul>
<h2>Installation</h2>
<pre><code class="language-bash"># Install dependencies
npm install

# Or with yarn
yarn install</code></pre>
<h2>Usage</h2>
<h3>Run Individual Servers</h3>
<pre><code class="language-bash"># Legacy API
npm run api-legacy

# Secure API
npm run api

# Authentication
npm run auth

# SSE Server
npm run sse</code></pre>
<h3>Run All Servers Concurrently</h3>
<pre><code class="language-bash">npm run backends</code></pre>
<p>This will start all four servers on their respective ports:
<ul><li>Legacy API: http://localhost:3000</li>
<li>Secure API: http://localhost:3001</li>
<li>Auth: http://localhost:3002</li>
<li>SSE: http://localhost:3003</li>
</ul>
<h2>Configuration</h2></p>
<p>Create a <code>.env</code> file in this directory with your database settings:</p>
<pre><code class="language-ini">[db]
type=mysql
host=localhost
user=root
pass=
db=test

# For SQLite (optional)
# type=sqlite
# file=pan_demo.db

[demo]
mode=true

[security]
jwt_secret=change-this-secret-in-production</code></pre>
<h2>Database Support</h2>
<p>Both <strong>MySQL</strong> and <strong>SQLite</strong> are supported:</p>
<ul><li><strong>MySQL</strong>: Use the <code>mysql2</code> package (already included)</li>
<li><strong>SQLite</strong>: Use the <code>better-sqlite3</code> package (already included)</li>
</ul>
Set the database type in your <code>.env</code> file.
<h2>Security Notes</h2>
<h3>Development vs Production</h3>
<p>The examples are configured for <strong>development</strong> use. For production:</p>
<li><strong>Change the JWT secret</strong> in <code>.env</code></li>
<li><strong>Disable demo mode</strong> (<code>demo.mode=false</code>)</li>
<li><strong>Use HTTPS</strong> for all endpoints</li>
<li><strong>Configure proper CORS</strong> origins in each file</li>
<li><strong>Set up proper database authentication</strong></li>
<li><strong>Use environment variables</strong> instead of <code>.env</code> file</li>
<li><strong>Enable proper logging</strong> and monitoring</li>
<h3>Password Hashing</h3>
<p>The authentication server uses <code>bcryptjs</code> for password hashing. The demo password is pre-hashed for convenience.</p>
<h2>Comparison with PHP Versions</h2>
<p>| Feature | PHP Version | Node.js Version |
|---------|-------------|-----------------|
| No build step | ✓ | ✓ |
| MySQL support | ✓ | ✓ |
| SQLite support | ✓ (PDO) | ✓ (better-sqlite3) |
| Sessions | ✓ (built-in) | ✓ (in-memory Map) |
| CSRF protection | ✓ | ✓ |
| Rate limiting | ✓ | ✓ |
| JWT support | ✓ (manual) | ✓ (crypto) |
| SSE | ✓ (file-based) | ✓ (file-based + in-memory) |</p>
<h2>Examples</h2>
<h3>Fetch Resources</h3>
<pre><code class="language-javascript">// Get list of available resources
const response = await fetch(&#039;http://localhost:3000/?x=list_resources&#039;);
const data = await response.json();
console.log(data.Resources);</code></pre>
<h3>Get Data with Pagination</h3>
<pre><code class="language-javascript">// Get first 10 products
const response = await fetch(&#039;http://localhost:3000/?x=get&amp;rsc=products&amp;page_size=10&amp;start=0&#039;);
const data = await response.json();
console.log(data.results);</code></pre>
<h3>Authenticate</h3>
<pre><code class="language-javascript">// Login
const response = await fetch(&#039;http://localhost:3002/?action=login&#039;, {
  method: &#039;POST&#039;,
  headers: { &#039;Content-Type&#039;: &#039;application/json&#039; },
  body: JSON.stringify({
    email: &#039;demo@example.com&#039;,
    password: &#039;demo123&#039;
  })
});
const data = await response.json();
console.log(data.token);</code></pre>
<h3>Subscribe to SSE</h3>
<pre><code class="language-javascript">const events = new EventSource(&#039;http://localhost:3003/?topics=demo.*&#039;);

events.addEventListener(&#039;demo.ping&#039;, (e) =&gt; {
  const data = JSON.parse(e.data);
  console.log(&#039;Received:&#039;, data);
});</code></pre>
<h3>Publish SSE Event</h3>
<pre><code class="language-javascript">await fetch(&#039;http://localhost:3003/&#039;, {
  method: &#039;POST&#039;,
  headers: { &#039;Content-Type&#039;: &#039;application/json&#039; },
  body: JSON.stringify({
    topic: &#039;demo.ping&#039;,
    data: { message: &#039;Hello from Node.js!&#039; },
    retain: false
  })
});</code></pre>
<h2>Troubleshooting</h2>
<h3>Port Already in Use</h3>
<p>If you get an "EADDRINUSE" error, another process is using the port. Either:
<li>Stop the other process</li>
<li>Pass a different port: <code>node api-legacy.js 3010</code></li></p>
<h3>Database Connection Errors</h3>
<ul><li>Check your <code>.env</code> configuration</li>
<li>Ensure MySQL is running (if using MySQL)</li>
<li>Verify database credentials</li>
<li>Create the database if it doesn't exist</li>
</ul>
<h3>Module Not Found</h3>
<p>Run <code>npm install</code> to install all dependencies.</p>
<h2>License</h2>
<p>MIT © LARC Contributors</p>
      </article>
      <footer class="docs-footer">
        <a href="https://github.com/chrisrobison/pan/edit/main/examples/backends/nodejs/README.md" target="_blank">
          Edit this page on GitHub
        </a>
      </footer>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp" crossorigin="anonymous"></script>
  <script src="../assets/docs.js"></script>
  <pan-bus debug="false"></pan-bus>
  <pan-theme-provider></pan-theme-provider>
</body>
</html>