<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- CRITICAL: Load theme BEFORE CSS to prevent flash -->
  <script src="../../../../playground/theme-init.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Migration Plan: From Git Submodules to Monorepo Â· PAN Documentation</title>
  <meta name="description" content="PAN (Page Area Network) Documentation - Migration Plan: From Git Submodules to Monorepo">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/theme.css">
  <link rel="stylesheet" href="../assets/docs.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" integrity="sha384-wH75j6z1lH97ZOpMOInqhgKzFkAInZPPSPlZpYKYTOqsaizPvhQZmAtLcPKXpLyH" crossorigin="anonymous">
</head>
<body>
  <header class="docs-header">
    <div class="docs-header-content">
      <a href="../index.html" class="logo">
        <span>PAN</span>
      </a>
      <nav class="docs-nav">
        <a href="../index.html">Home</a>
        <a href="index.html" class="active">Docs</a>
        <a href="../examples.html">Examples</a>
        <a href="../apps.html">Apps</a>
        <a href="https://github.com/chrisrobison/pan" target="_blank">GitHub</a>
      </nav>
    </div>
  </header>

  <div class="docs-layout">
    <aside class="docs-sidebar">
      <div class="docs-sidebar-content">
        <h3>Documentation</h3>
        <nav class="docs-menu" id="docs-menu">
          <!-- Will be populated by JavaScript -->
        </nav>
      </div>
    </aside>

    <main class="docs-main">
      <div class="docs-breadcrumb">
        <a href="../index.html">Home</a> / <a href="#">migration</a> / <span>MONOREPO-MIGRATION-PLAN</span>
      </div>
      <article class="docs-content">
        <h1>Migration Plan: From Git Submodules to Monorepo</h1>
<h2>ğŸ¯ Goal</h2>
Transform the LARC project from a git submodules architecture to a modern monorepo that's easier to develop and maintain.
<h2>ğŸ“Š Current State Analysis</h2>
<h3>Current Architecture (Submodules - PAINFUL ğŸ˜«)</h3>
<pre><code class="language-plaintext">larc/ (meta repo)
â”œâ”€â”€ core/ (submodule â†’ @larcjs/core)
â”œâ”€â”€ ui/ (submodule â†’ @larcjs/ui)
â”œâ”€â”€ apps/ (submodule)
â”‚   â”œâ”€â”€ components/ (nested submodule)
â”‚   â””â”€â”€ core/ (nested submodule)
â”œâ”€â”€ site/ (submodule)
â”œâ”€â”€ examples/ (submodule)
â”œâ”€â”€ devtools/ (submodule)
â”œâ”€â”€ cli/ (submodule?)
â”œâ”€â”€ playground/ (submodule?)
â”œâ”€â”€ react-adapter/ (submodule?)
â”œâ”€â”€ components-types/ (submodule)
â””â”€â”€ core-types/ (submodule)</code></pre>
<strong>Problems:</strong>
<ul><li>8+ separate git repos to manage</li>
<li>Detached HEAD confusion</li>
<li>Complex push/pull workflows</li>
<li>Nested submodules (apps has its own submodules!)</li>
<li>Hard for new contributors</li>
<li>Difficult to make atomic changes across packages</li>
</ul>
<hr>
<h2>ğŸ¨ Proposed Architecture (Monorepo - EASY ğŸ˜Š)</h2>
<h3>Option A: npm/yarn/pnpm Workspaces (RECOMMENDED)</h3>
<pre><code class="language-plaintext">larc/ (single git repo)
â”œâ”€â”€ package.json (workspace root)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/              (@larcjs/core)
â”‚   â”œâ”€â”€ components/        (@larcjs/ui)
â”‚   â”œâ”€â”€ components-types/  (@larcjs/ui-types)
â”‚   â”œâ”€â”€ core-types/        (@larcjs/core-types)
â”‚   â”œâ”€â”€ react-adapter/     (@larcjs/react-adapter)
â”‚   â”œâ”€â”€ cli/               (@larcjs/cli)
â”‚   â””â”€â”€ devtools/          (@larcjs/devtools)
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ contact-manager/
â”‚   â”œâ”€â”€ invoice/
â”‚   â”œâ”€â”€ markdown-notes/
â”‚   â””â”€â”€ data-browser/
â”œâ”€â”€ examples/
â”œâ”€â”€ site/ (documentation site)
â””â”€â”€ playground/</code></pre>
<strong>Workflow:</strong>
<pre><code class="language-bash"># One clone
git clone https://github.com/larcjs/larc.git

# One install (links all packages automatically)
npm install

# Work across packages easily
cd packages/core
# edit core...
cd ../components
# edit components that depend on core...
# Both changes tested together!

# One commit for atomic changes
git add packages/core packages/ui
git commit -m &quot;Add feature across core and components&quot;
git push</code></pre>
<hr>
<h2>ğŸš€ Migration Steps</h2>
<h3>Phase 1: Assessment (1 hour)</h3>
<ul><li>[ ] Identify which "submodules" are actually published packages vs. just code organization</li>
<li>[ ] List cross-package dependencies</li>
<li>[ ] Document current release process</li>
</ul>
<h3>Phase 2: Preparation (2 hours)</h3>
<ul><li>[ ] Create new branch <code>feature/monorepo-migration</code></li>
<li>[ ] Backup current state</li>
<li>[ ] Create root <code>package.json</code> with workspaces config</li>
<li>[ ] Set up build tooling (turborepo, nx, or just npm workspaces)</li>
</ul>
<h3>Phase 3: Migration (4-6 hours)</h3>
<ul><li>[ ] Copy submodule code into packages/ directory</li>
<li>[ ] Remove .git directories from former submodules</li>
<li>[ ] Update package.json dependencies to use workspace protocol</li>
<li>[ ] Update import paths if needed</li>
<li>[ ] Test that everything builds and runs</li>
<li>[ ] Update CI/CD pipelines</li>
</ul>
<h3>Phase 4: Cleanup (1 hour)</h3>
<ul><li>[ ] Archive old submodule repos (keep for history)</li>
<li>[ ] Update documentation</li>
<li>[ ] Update contributor guide</li>
<li>[ ] Test deployment</li>
</ul>
<hr>
<h2>ğŸ“ Detailed Implementation</h2>
<h3>1. Root package.json</h3>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;larc-monorepo&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;private&quot;: true,
  &quot;workspaces&quot;: [
    &quot;packages/*&quot;
  ],
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;npm run build --workspaces&quot;,
    &quot;test&quot;: &quot;npm run test --workspaces&quot;,
    &quot;dev&quot;: &quot;npm run dev --workspaces --if-present&quot;,
    &quot;clean&quot;: &quot;npm run clean --workspaces --if-present&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;turbo&quot;: &quot;^2.0.0&quot;,  // Optional: faster builds
    &quot;changesets&quot;: &quot;^2.0.0&quot;  // Optional: version management
  }
}</code></pre>
<h3>2. Update Package Dependencies</h3>
<strong>Before (submodules):</strong>
<pre><code class="language-json">// packages/ui/package.json
{
  &quot;peerDependencies&quot;: {
    &quot;@larcjs/core&quot;: &quot;^1.1.0&quot;
  }
}</code></pre>
<strong>After (monorepo):</strong>
<pre><code class="language-json">// packages/ui/package.json
{
  &quot;dependencies&quot;: {
    &quot;@larcjs/core&quot;: &quot;workspace:*&quot;
  },
  &quot;peerDependencies&quot;: {
    &quot;@larcjs/core&quot;: &quot;^1.1.0&quot;  // Still needed for external consumers
  }
}</code></pre>
<h3>3. Migration Script</h3>
<p>Create <code>migrate-to-monorepo.sh</code>:</p>
<pre><code class="language-bash">#!/bin/bash
set -e

echo &quot;ğŸš€ Starting migration to monorepo...&quot;

# Create packages directory
mkdir -p packages

# Move submodules to packages (preserving git history)
PACKAGES=&quot;core ui components-types core-types react-adapter cli devtools&quot;

for pkg in $PACKAGES; do
  echo &quot;ğŸ“¦ Migrating $pkg...&quot;

  # Get the actual directory name (ui â†’ components)
  if [ &quot;$pkg&quot; = &quot;ui&quot; ]; then
    SOURCE=&quot;ui&quot;
    DEST=&quot;packages/ui&quot;
  else
    SOURCE=&quot;$pkg&quot;
    DEST=&quot;packages/$pkg&quot;
  fi

  # Move with history preservation
  if [ -d &quot;$SOURCE&quot; ]; then
    # Remove submodule connection
    git submodule deinit -f &quot;$SOURCE&quot; 2&gt;/dev/null || true
    rm -rf &quot;.git/modules/$SOURCE&quot; 2&gt;/dev/null || true

    # Move the directory
    mv &quot;$SOURCE&quot; &quot;$DEST&quot;

    # Remove .git reference if it exists
    rm -f &quot;$DEST/.git&quot;
  fi
done

# Move apps, examples, site to root (not in packages)
echo &quot;ğŸ“ Organizing other directories...&quot;
# These are already in place

# Remove submodule config
rm -f .gitmodules

echo &quot;âœ… Physical migration complete!&quot;
echo &quot;ğŸ“ Next steps:&quot;
echo &quot;  1. Update package.json files with workspace: protocol&quot;
echo &quot;  2. Run npm install&quot;
echo &quot;  3. Test builds&quot;
echo &quot;  4. Update documentation&quot;</code></pre>
<hr>
<h2>ğŸ”„ Alternative: Keep Some Repos Separate</h2>
<p>If you want to keep <code>@larcjs/core</code> and <code>@larcjs/ui</code> in separate repos (for independent versioning), use a hybrid approach:</p>
<h3>Hybrid Option: Monorepo + External Packages</h3>
<pre><code class="language-plaintext">larc/ (monorepo)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ cli/
â”‚   â”œâ”€â”€ react-adapter/
â”‚   â””â”€â”€ devtools/
â”œâ”€â”€ apps/        (links to @larcjs/core, @larcjs/ui via npm)
â”œâ”€â”€ examples/    (links via npm)
â””â”€â”€ site/        (links via npm)

# Separate repos:
github.com/larcjs/core        â†’ published as @larcjs/core
github.com/larcjs/components  â†’ published as @larcjs/ui</code></pre>
<strong>Development workflow:</strong>
<pre><code class="language-bash"># For core development
npm link @larcjs/core
npm link @larcjs/ui

# Or use npm install git+https://...</code></pre>
<p>This is simpler but loses the "atomic commits" benefit.</p>
<hr>
<h2>ğŸ“¦ Tooling Options</h2>
<h3>Option 1: Plain npm Workspaces (Simple)</h3>
<strong>Pros:</strong> Built-in, no extra tools
<strong>Cons:</strong> Slower builds, basic features
<pre><code class="language-json">// package.json
{
  &quot;workspaces&quot;: [&quot;packages/*&quot;]
}</code></pre>
<h3>Option 2: pnpm Workspaces (Better)</h3>
<strong>Pros:</strong> Faster, better disk usage, workspace protocol
<strong>Cons:</strong> Need to install pnpm
<pre><code class="language-yaml"># pnpm-workspace.yaml
packages:
  - &#039;packages/*&#039;</code></pre>
<h3>Option 3: Turborepo (Best for scaling)</h3>
<strong>Pros:</strong> Caching, parallel builds, remote caching
<strong>Cons:</strong> Extra complexity
<pre><code class="language-json">// turbo.json
{
  &quot;pipeline&quot;: {
    &quot;build&quot;: {
      &quot;dependsOn&quot;: [&quot;^build&quot;],
      &quot;outputs&quot;: [&quot;dist/**&quot;]
    }
  }
}</code></pre>
<h3>Option 4: Nx (Most features)</h3>
<strong>Pros:</strong> Everything + graph viz, generators
<strong>Cons:</strong> Steeper learning curve
<hr>
<h2>ğŸ¯ Recommended Path for LARC</h2>
<h3><strong>Recommendation: pnpm Workspaces + Changesets</strong></h3>
<strong>Why:</strong>
<ul><li>Fast, reliable package manager (pnpm)</li>
<li>Excellent monorepo support</li>
<li>Simple workspace protocol</li>
<li>Changesets for version/changelog management</li>
<li>Not too complex, not too simple</li>
</ul>
<strong>Steps:</strong>
<pre><code class="language-bash"># 1. Install pnpm
npm install -g pnpm

# 2. Create pnpm-workspace.yaml
cat &gt; pnpm-workspace.yaml &lt;&lt; EOF
packages:
  - &#039;packages/*&#039;
EOF

# 3. Create root package.json
cat &gt; package.json &lt;&lt; EOF
{
  &quot;name&quot;: &quot;larc&quot;,
  &quot;private&quot;: true,
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;pnpm -r build&quot;,
    &quot;test&quot;: &quot;pnpm -r test&quot;,
    &quot;dev&quot;: &quot;pnpm -r --parallel dev&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@changesets/cli&quot;: &quot;^2.27.0&quot;
  }
}
EOF

# 4. Migrate packages
./migrate-to-monorepo.sh

# 5. Update package.json dependencies
# Change peerDependencies to: &quot;@larcjs/core&quot;: &quot;workspace:*&quot;

# 6. Install
pnpm install

# 7. Test
pnpm build
pnpm test</code></pre>
<hr>
<h2>ğŸ“Š Comparison: Before vs After</h2>
<p>| Aspect | Submodules | Monorepo |
|--------|-----------|----------|
| Clone | <code>git clone --recurse-submodules</code> | <code>git clone</code> |
| Update | <code>git pull && git submodule update --init --recursive --remote</code> | <code>git pull</code> |
| Work on package | <code>cd pkg && git checkout main && git pull</code> | <code>cd packages/pkg</code> |
| Cross-package change | 3+ commits, 3+ pushes | 1 commit, 1 push |
| Dependencies | Manual, error-prone | Automatic via workspaces |
| Build | Manual coordination | Orchestrated |
| New contributor | 30min + docs | 5min |
| CI/CD | Complex, multiple triggers | Simple, single trigger |</p>
<hr>
<h2>ğŸš¨ Migration Risks & Mitigation</h2>
<h3>Risk 1: Lost Git History</h3>
<strong>Mitigation:</strong> Use git subtree or keep old repos as archives
<pre><code class="language-bash"># Preserve history when moving
git subtree add --prefix=packages/core https://github.com/larcjs/core.git main</code></pre>
<h3>Risk 2: Breaking External Dependents</h3>
<strong>Mitigation:</strong> Keep old repos as "release mirrors"
<ul><li>Keep github.com/larcjs/core for npm registry</li>
<li>Monorepo becomes source of truth</li>
<li>Auto-push releases to old repos</li>
</ul>
<h3>Risk 3: Large Repo Size</h3>
<strong>Mitigation:</strong> Use git partial clone for CI
<pre><code class="language-bash">git clone --filter=blob:none --depth=1</code></pre>
<h3>Risk 4: Team Resistance</h3>
<strong>Mitigation:</strong>
<ul><li>Pilot with small team first</li>
<li>Document benefits clearly</li>
<li>Provide scripts/aliases for common tasks</li>
</ul>
<hr>
<h2>ğŸ¬ Quick Start: Try It Out (Non-Destructive)</h2>
<p>Want to try before committing? Test on a copy:</p>
<pre><code class="language-bash"># 1. Clone into new directory
git clone https://github.com/larcjs/larc.git larc-monorepo-test
cd larc-monorepo-test

# 2. Create test branch
git checkout -b test-monorepo

# 3. Run migration script (I&#039;ll create this)
./test-monorepo.sh

# 4. Try the workflow
pnpm install
pnpm build
# Make changes...
git add .
git commit -m &quot;Test change&quot;

# 5. If you like it, do it for real. If not, delete the directory.</code></pre>
<hr>
<h2>ğŸ“š Resources</h2>
<ul><li><a href="https://pnpm.io/workspaces">pnpm Workspaces</a></li>
<li><a href="https://turbo.build/repo">Turborepo</a></li>
<li><a href="https://github.com/changesets/changesets">Changesets</a></li>
<li><a href="https://monorepo.tools/">Monorepo.tools</a></li>
<li><a href="https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/fulltext">Why Google Stores Billions of Lines of Code in a Single Repository</a></li>
</ul>
<hr>
<h2>âœ… Success Criteria</h2>
<p>Migration is successful when:
<ul><li>[ ] <code>git clone</code> + <code>pnpm install</code> + <code>pnpm build</code> works</li>
<li>[ ] All tests pass</li>
<li>[ ] Can edit core and see changes in components immediately</li>
<li>[ ] Single commit can update multiple packages</li>
<li>[ ] New contributors can get started in < 10 minutes</li>
<li>[ ] CI/CD is simpler and faster</li>
<li>[ ] Team is happier ğŸ˜Š</li>
</ul>
<hr></p>
<h2>ğŸ¤” Still Want Submodules?</h2>
<p>If you must keep submodules for some reason, at least use <code>git-subrepo</code> instead of <code>git submodule</code>:
<ul><li>No detached HEAD</li>
<li>Simpler workflow</li>
<li>Better for contributors</li>
</ul>
But honestly, <strong>just use a monorepo</strong>. Your future self will thank you.</p>
<hr>
<em>Created: 2025-12-06</em>
      </article>
      <footer class="docs-footer">
        <a href="https://github.com/chrisrobison/pan/edit/main/migration/MONOREPO-MIGRATION-PLAN.md" target="_blank">
          Edit this page on GitHub
        </a>
      </footer>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp" crossorigin="anonymous"></script>
  <script src="../assets/docs.js"></script>
  <pan-bus debug="false"></pan-bus>
  <pan-theme-provider></pan-theme-provider>
</body>
</html>