<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="LARC Community" />
  <title>Learning LARC</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Learning LARC</h1>
<p class="author">LARC Community</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#learning-larc" id="toc-learning-larc">Learning LARC</a>
<ul>
<li><a
href="#building-modern-web-applications-with-the-page-area-network-architecture"
id="toc-building-modern-web-applications-with-the-page-area-network-architecture">Building
Modern Web Applications with the Page Area Network Architecture</a></li>
<li><a href="#praise-for-learning-larc"
id="toc-praise-for-learning-larc">Praise for Learning LARC</a></li>
<li><a href="#copyright" id="toc-copyright">Copyright</a></li>
<li><a href="#table-of-contents" id="toc-table-of-contents">Table of
Contents</a>
<ul>
<li><a href="#preface" id="toc-preface">Preface</a></li>
<li><a href="#part-i-foundations" id="toc-part-i-foundations">Part I:
Foundations</a></li>
<li><a href="#part-ii-building-components"
id="toc-part-ii-building-components">Part II: Building
Components</a></li>
<li><a href="#part-iii-building-applications"
id="toc-part-iii-building-applications">Part III: Building
Applications</a></li>
<li><a href="#part-iv-advanced-topics"
id="toc-part-iv-advanced-topics">Part IV: Advanced Topics</a></li>
<li><a href="#part-v-ecosystem" id="toc-part-v-ecosystem">Part V:
Ecosystem</a></li>
<li><a href="#appendices" id="toc-appendices">Appendices</a></li>
<li><a href="#index" id="toc-index">Index</a></li>
</ul></li>
<li><a href="#about-the-authors" id="toc-about-the-authors">About the
Authors</a></li>
</ul></li>
<li><a href="#foreword" id="toc-foreword">Foreword</a></li>
<li><a href="#chapter-1-philosophy-and-background"
id="toc-chapter-1-philosophy-and-background">Chapter 1: Philosophy and
Background</a>
<ul>
<li><a href="#the-problem-with-modern-web-development"
id="toc-the-problem-with-modern-web-development">The Problem with Modern
Web Development</a>
<ul>
<li><a href="#the-rise-of-complexity"
id="toc-the-rise-of-complexity">The Rise of Complexity</a></li>
<li><a href="#the-platform-has-caught-up"
id="toc-the-platform-has-caught-up">The Platform Has Caught Up</a></li>
<li><a href="#a-common-scenario" id="toc-a-common-scenario">A Common
Scenario</a></li>
</ul></li>
<li><a href="#a-return-to-fundamentals"
id="toc-a-return-to-fundamentals">A Return to Fundamentals</a>
<ul>
<li><a href="#what-larc-is" id="toc-what-larc-is">What LARC Is</a></li>
<li><a href="#what-larc-is-not" id="toc-what-larc-is-not">What LARC Is
Not</a></li>
<li><a href="#core-principles" id="toc-core-principles">Core
Principles</a></li>
</ul></li>
<li><a href="#the-larc-philosophy" id="toc-the-larc-philosophy">The LARC
Philosophy</a>
<ul>
<li><a href="#composition-over-configuration"
id="toc-composition-over-configuration">Composition Over
Configuration</a></li>
<li><a href="#convention-over-prescription"
id="toc-convention-over-prescription">Convention Over
Prescription</a></li>
<li><a href="#explicit-over-implicit"
id="toc-explicit-over-implicit">Explicit Over Implicit</a></li>
</ul></li>
<li><a href="#why-no-build-matters" id="toc-why-no-build-matters">Why
“No Build” Matters</a>
<ul>
<li><a href="#development-speed" id="toc-development-speed">Development
Speed</a></li>
<li><a href="#debugging-simplicity"
id="toc-debugging-simplicity">Debugging Simplicity</a></li>
<li><a href="#deployment-simplicity"
id="toc-deployment-simplicity">Deployment Simplicity</a></li>
<li><a href="#lower-barrier-to-entry"
id="toc-lower-barrier-to-entry">Lower Barrier to Entry</a></li>
<li><a href="#sustainability"
id="toc-sustainability">Sustainability</a></li>
</ul></li>
<li><a href="#when-to-use-larc" id="toc-when-to-use-larc">When to Use
LARC</a>
<ul>
<li><a href="#larc-excels-at" id="toc-larc-excels-at">LARC Excels
At</a></li>
<li><a href="#consider-alternatives-when"
id="toc-consider-alternatives-when">Consider Alternatives When</a></li>
<li><a href="#hybrid-approaches" id="toc-hybrid-approaches">Hybrid
Approaches</a></li>
</ul></li>
<li><a href="#what-youll-build" id="toc-what-youll-build">What You’ll
Build</a>
<ul>
<li><a href="#chapter-examples" id="toc-chapter-examples">Chapter
Examples</a></li>
<li><a href="#capstone-project-taskflow"
id="toc-capstone-project-taskflow">Capstone Project: TaskFlow</a></li>
<li><a href="#what-youll-learn" id="toc-what-youll-learn">What You’ll
Learn</a></li>
</ul></li>
<li><a href="#looking-ahead" id="toc-looking-ahead">Looking
Ahead</a></li>
<li><a href="#summary" id="toc-summary">Summary</a></li>
</ul></li>
<li><a href="#chapter-2-core-concepts"
id="toc-chapter-2-core-concepts">Chapter 2: Core Concepts</a>
<ul>
<li><a href="#web-components-refresher"
id="toc-web-components-refresher">Web Components Refresher</a>
<ul>
<li><a href="#the-three-pillars" id="toc-the-three-pillars">The Three
Pillars</a></li>
<li><a href="#web-components-vs-framework-components"
id="toc-web-components-vs-framework-components">Web Components vs
Framework Components</a></li>
</ul></li>
<li><a href="#the-page-area-network-pan"
id="toc-the-page-area-network-pan">The Page Area Network (PAN)</a>
<ul>
<li><a href="#the-problem-it-solves" id="toc-the-problem-it-solves">The
Problem It Solves</a></li>
<li><a href="#the-pan-bus-approach" id="toc-the-pan-bus-approach">The
PAN Bus Approach</a></li>
<li><a href="#topic-namespaces" id="toc-topic-namespaces">Topic
Namespaces</a></li>
<li><a href="#message-patterns" id="toc-message-patterns">Message
Patterns</a></li>
<li><a href="#why-pan-bus" id="toc-why-pan-bus">Why PAN Bus?</a></li>
</ul></li>
<li><a href="#event-driven-architecture"
id="toc-event-driven-architecture">Event-Driven Architecture</a>
<ul>
<li><a href="#browser-events" id="toc-browser-events">Browser
Events</a></li>
<li><a href="#custom-events" id="toc-custom-events">Custom
Events</a></li>
<li><a href="#pan-bus-events" id="toc-pan-bus-events">PAN Bus
Events</a></li>
<li><a href="#when-to-use-each" id="toc-when-to-use-each">When to Use
Each</a></li>
</ul></li>
<li><a href="#state-management-philosophy"
id="toc-state-management-philosophy">State Management Philosophy</a>
<ul>
<li><a href="#state-hierarchy" id="toc-state-hierarchy">State
Hierarchy</a></li>
<li><a href="#reactive-state-optional"
id="toc-reactive-state-optional">Reactive State (Optional)</a></li>
</ul></li>
<li><a href="#module-system" id="toc-module-system">Module System</a>
<ul>
<li><a href="#importexport-basics"
id="toc-importexport-basics">Import/Export Basics</a></li>
<li><a href="#import-maps" id="toc-import-maps">Import Maps</a></li>
<li><a href="#module-organization" id="toc-module-organization">Module
Organization</a></li>
</ul></li>
<li><a href="#the-component-lifecycle"
id="toc-the-component-lifecycle">The Component Lifecycle</a>
<ul>
<li><a href="#lifecycle-callbacks"
id="toc-lifecycle-callbacks">Lifecycle Callbacks</a></li>
<li><a href="#complete-lifecycle-example"
id="toc-complete-lifecycle-example">Complete Lifecycle Example</a></li>
</ul></li>
<li><a href="#summary-1" id="toc-summary-1">Summary</a></li>
<li><a href="#key-takeaways" id="toc-key-takeaways">Key
Takeaways</a></li>
</ul></li>
<li><a href="#chapter-3-getting-started"
id="toc-chapter-3-getting-started">Chapter 3: Getting Started</a>
<ul>
<li><a href="#setting-up-your-development-environment"
id="toc-setting-up-your-development-environment">Setting Up Your
Development Environment</a>
<ul>
<li><a href="#requirements" id="toc-requirements">Requirements</a></li>
<li><a href="#quick-start-with-create-larc-app"
id="toc-quick-start-with-create-larc-app">Quick Start with
create-larc-app</a></li>
<li><a href="#manual-setup-no-cli" id="toc-manual-setup-no-cli">Manual
Setup (No CLI)</a></li>
<li><a href="#development-tools" id="toc-development-tools">Development
Tools</a></li>
</ul></li>
<li><a href="#your-first-larc-application"
id="toc-your-first-larc-application">Your First LARC Application</a>
<ul>
<li><a href="#project-goal" id="toc-project-goal">Project Goal</a></li>
<li><a href="#step-1-update-index.html"
id="toc-step-1-update-index.html">Step 1: Update index.html</a></li>
<li><a href="#step-2-create-app.js" id="toc-step-2-create-app.js">Step
2: Create app.js</a></li>
<li><a href="#step-3-create-counter-display.js"
id="toc-step-3-create-counter-display.js">Step 3: Create
counter-display.js</a></li>
<li><a href="#step-4-create-counter-controls.js"
id="toc-step-4-create-counter-controls.js">Step 4: Create
counter-controls.js</a></li>
<li><a href="#step-5-test-your-app" id="toc-step-5-test-your-app">Step
5: Test Your App</a></li>
<li><a href="#what-just-happened" id="toc-what-just-happened">What Just
Happened?</a></li>
</ul></li>
<li><a href="#project-structure" id="toc-project-structure">Project
Structure</a>
<ul>
<li><a href="#file-organization-principles"
id="toc-file-organization-principles">File Organization
Principles</a></li>
</ul></li>
<li><a href="#import-maps-explained"
id="toc-import-maps-explained">Import Maps Explained</a>
<ul>
<li><a href="#basic-import-map" id="toc-basic-import-map">Basic Import
Map</a></li>
<li><a href="#path-aliases" id="toc-path-aliases">Path Aliases</a></li>
<li><a href="#version-management" id="toc-version-management">Version
Management</a></li>
<li><a href="#multiple-cdns" id="toc-multiple-cdns">Multiple
CDNs</a></li>
<li><a href="#development-vs-production"
id="toc-development-vs-production">Development vs Production</a></li>
</ul></li>
<li><a href="#development-workflow"
id="toc-development-workflow">Development Workflow</a>
<ul>
<li><a href="#daily-development" id="toc-daily-development">Daily
Development</a></li>
<li><a href="#debugging-tips" id="toc-debugging-tips">Debugging
Tips</a></li>
<li><a href="#testing" id="toc-testing">Testing</a></li>
</ul></li>
<li><a href="#common-patterns" id="toc-common-patterns">Common
Patterns</a>
<ul>
<li><a href="#pattern-1-loading-states"
id="toc-pattern-1-loading-states">Pattern 1: Loading States</a></li>
<li><a href="#pattern-2-form-handling"
id="toc-pattern-2-form-handling">Pattern 2: Form Handling</a></li>
<li><a href="#pattern-3-conditional-rendering"
id="toc-pattern-3-conditional-rendering">Pattern 3: Conditional
Rendering</a></li>
<li><a href="#pattern-4-lists-and-iteration"
id="toc-pattern-4-lists-and-iteration">Pattern 4: Lists and
Iteration</a></li>
</ul></li>
<li><a href="#summary-2" id="toc-summary-2">Summary</a></li>
<li><a href="#exercises" id="toc-exercises">Exercises</a></li>
</ul></li>
<li><a href="#chapter-4-creating-web-components"
id="toc-chapter-4-creating-web-components">Chapter 4: Creating Web
Components</a>
<ul>
<li><a href="#anatomy-of-a-larc-component"
id="toc-anatomy-of-a-larc-component">Anatomy of a LARC Component</a>
<ul>
<li><a href="#component-structure-breakdown"
id="toc-component-structure-breakdown">Component Structure
Breakdown</a></li>
</ul></li>
<li><a href="#shadow-dom-deep-dive" id="toc-shadow-dom-deep-dive">Shadow
DOM Deep Dive</a>
<ul>
<li><a href="#creating-shadow-dom" id="toc-creating-shadow-dom">Creating
Shadow DOM</a></li>
<li><a href="#shadow-dom-vs-light-dom"
id="toc-shadow-dom-vs-light-dom">Shadow DOM vs Light DOM</a></li>
<li><a href="#style-encapsulation" id="toc-style-encapsulation">Style
Encapsulation</a></li>
<li><a href="#the-host-selector" id="toc-the-host-selector">The :host
Selector</a></li>
<li><a href="#css-custom-properties-variables"
id="toc-css-custom-properties-variables">CSS Custom Properties
(Variables)</a></li>
<li><a href="#parts-and-part" id="toc-parts-and-part">Parts and
::part()</a></li>
</ul></li>
<li><a href="#attributes-and-properties"
id="toc-attributes-and-properties">Attributes and Properties</a>
<ul>
<li><a href="#attributes-vs-properties"
id="toc-attributes-vs-properties">Attributes vs Properties</a></li>
<li><a href="#reflecting-properties-to-attributes"
id="toc-reflecting-properties-to-attributes">Reflecting Properties to
Attributes</a></li>
<li><a href="#when-to-use-each-1" id="toc-when-to-use-each-1">When to
Use Each</a></li>
<li><a href="#type-conversion" id="toc-type-conversion">Type
Conversion</a></li>
<li><a href="#boolean-attributes" id="toc-boolean-attributes">Boolean
Attributes</a></li>
</ul></li>
<li><a href="#component-styling" id="toc-component-styling">Component
Styling</a>
<ul>
<li><a href="#internal-styles" id="toc-internal-styles">Internal
Styles</a></li>
<li><a href="#external-stylesheets"
id="toc-external-stylesheets">External Stylesheets</a></li>
<li><a href="#adoptable-stylesheets"
id="toc-adoptable-stylesheets">Adoptable Stylesheets</a></li>
<li><a href="#theming-strategies" id="toc-theming-strategies">Theming
Strategies</a></li>
</ul></li>
<li><a href="#lifecycle-methods-advanced-patterns"
id="toc-lifecycle-methods-advanced-patterns">Lifecycle Methods (Advanced
Patterns)</a>
<ul>
<li><a href="#deferred-rendering" id="toc-deferred-rendering">Deferred
Rendering</a></li>
<li><a href="#preventing-memory-leaks"
id="toc-preventing-memory-leaks">Preventing Memory Leaks</a></li>
<li><a href="#handling-rapid-reconnection"
id="toc-handling-rapid-reconnection">Handling Rapid
Reconnection</a></li>
</ul></li>
<li><a href="#testing-components" id="toc-testing-components">Testing
Components</a>
<ul>
<li><a href="#unit-testing" id="toc-unit-testing">Unit Testing</a></li>
<li><a href="#integration-testing"
id="toc-integration-testing">Integration Testing</a></li>
<li><a href="#visual-regression-testing"
id="toc-visual-regression-testing">Visual Regression Testing</a></li>
</ul></li>
<li><a href="#summary-3" id="toc-summary-3">Summary</a></li>
<li><a href="#best-practices" id="toc-best-practices">Best
Practices</a></li>
</ul></li>
<li><a href="#chapter-5-the-pan-bus"
id="toc-chapter-5-the-pan-bus">Chapter 5: The PAN Bus</a>
<ul>
<li><a href="#understanding-pubsub-architecture"
id="toc-understanding-pubsub-architecture">Understanding Pub/Sub
Architecture</a>
<ul>
<li><a href="#traditional-communication"
id="toc-traditional-communication">Traditional Communication</a></li>
<li><a href="#pubsub-communication"
id="toc-pubsub-communication">Pub/Sub Communication</a></li>
<li><a href="#the-pan-bus-api" id="toc-the-pan-bus-api">The PAN Bus
API</a></li>
</ul></li>
<li><a href="#topics-and-namespaces"
id="toc-topics-and-namespaces">Topics and Namespaces</a>
<ul>
<li><a href="#topic-naming-conventions"
id="toc-topic-naming-conventions">Topic Naming Conventions</a></li>
<li><a href="#namespace-structure"
id="toc-namespace-structure">Namespace Structure</a></li>
<li><a href="#wildcards" id="toc-wildcards">Wildcards</a></li>
<li><a href="#topic-best-practices" id="toc-topic-best-practices">Topic
Best Practices</a></li>
</ul></li>
<li><a href="#publishing-messages"
id="toc-publishing-messages">Publishing Messages</a>
<ul>
<li><a href="#basic-publishing" id="toc-basic-publishing">Basic
Publishing</a></li>
<li><a href="#publishing-from-components"
id="toc-publishing-from-components">Publishing from Components</a></li>
<li><a href="#event-metadata" id="toc-event-metadata">Event
Metadata</a></li>
<li><a href="#batch-publishing" id="toc-batch-publishing">Batch
Publishing</a></li>
</ul></li>
<li><a href="#subscribing-to-events"
id="toc-subscribing-to-events">Subscribing to Events</a>
<ul>
<li><a href="#basic-subscription" id="toc-basic-subscription">Basic
Subscription</a></li>
<li><a href="#component-lifecycle-integration"
id="toc-component-lifecycle-integration">Component Lifecycle
Integration</a></li>
<li><a href="#multiple-subscriptions-helper"
id="toc-multiple-subscriptions-helper">Multiple Subscriptions
Helper</a></li>
<li><a href="#conditional-subscriptions"
id="toc-conditional-subscriptions">Conditional Subscriptions</a></li>
<li><a href="#filtering-events" id="toc-filtering-events">Filtering
Events</a></li>
</ul></li>
<li><a href="#message-patterns-1" id="toc-message-patterns-1">Message
Patterns</a>
<ul>
<li><a href="#fire-and-forget-1" id="toc-fire-and-forget-1">1. Fire and
Forget</a></li>
<li><a href="#requestresponse-1" id="toc-requestresponse-1">2.
Request/Response</a></li>
<li><a href="#command-pattern" id="toc-command-pattern">3. Command
Pattern</a></li>
<li><a href="#event-sourcing" id="toc-event-sourcing">4. Event
Sourcing</a></li>
<li><a href="#aggregation-pattern" id="toc-aggregation-pattern">5.
Aggregation Pattern</a></li>
<li><a href="#saga-pattern" id="toc-saga-pattern">6. Saga
Pattern</a></li>
</ul></li>
<li><a href="#debugging-pan-communication"
id="toc-debugging-pan-communication">Debugging PAN Communication</a>
<ul>
<li><a href="#logging-all-events" id="toc-logging-all-events">Logging
All Events</a></li>
<li><a href="#event-inspector" id="toc-event-inspector">Event
Inspector</a></li>
<li><a href="#event-filtering" id="toc-event-filtering">Event
Filtering</a></li>
<li><a href="#performance-monitoring"
id="toc-performance-monitoring">Performance Monitoring</a></li>
<li><a href="#event-replay" id="toc-event-replay">Event Replay</a></li>
</ul></li>
<li><a href="#summary-4" id="toc-summary-4">Summary</a></li>
<li><a href="#best-practices-1" id="toc-best-practices-1">Best
Practices</a></li>
</ul></li>
<li><a href="#chapter-6-state-management"
id="toc-chapter-6-state-management">Chapter 6: State Management</a>
<ul>
<li><a href="#component-local-state-1"
id="toc-component-local-state-1">Component-Local State</a>
<ul>
<li><a href="#instance-properties" id="toc-instance-properties">Instance
Properties</a></li>
<li><a href="#private-fields" id="toc-private-fields">Private
Fields</a></li>
<li><a href="#state-objects" id="toc-state-objects">State
Objects</a></li>
</ul></li>
<li><a href="#shared-state-patterns"
id="toc-shared-state-patterns">Shared State Patterns</a>
<ul>
<li><a href="#simple-global-state" id="toc-simple-global-state">Simple
Global State</a></li>
<li><a href="#reactive-state-with-proxy"
id="toc-reactive-state-with-proxy">Reactive State with Proxy</a></li>
<li><a href="#store-pattern" id="toc-store-pattern">Store
Pattern</a></li>
</ul></li>
<li><a href="#the-pan-store-component"
id="toc-the-pan-store-component">The pan-store Component</a></li>
<li><a href="#indexeddb-integration"
id="toc-indexeddb-integration">IndexedDB Integration</a>
<ul>
<li><a href="#basic-indexeddb-wrapper"
id="toc-basic-indexeddb-wrapper">Basic IndexedDB Wrapper</a></li>
<li><a href="#cache-first-strategy"
id="toc-cache-first-strategy">Cache-First Strategy</a></li>
</ul></li>
<li><a href="#persistence-strategies"
id="toc-persistence-strategies">Persistence Strategies</a>
<ul>
<li><a href="#localstorage" id="toc-localstorage">localStorage</a></li>
<li><a href="#sessionstorage"
id="toc-sessionstorage">sessionStorage</a></li>
<li><a href="#hybrid-strategy" id="toc-hybrid-strategy">Hybrid
Strategy</a></li>
</ul></li>
<li><a href="#offline-first-applications"
id="toc-offline-first-applications">Offline-First Applications</a>
<ul>
<li><a href="#service-worker-state-management"
id="toc-service-worker-state-management">Service Worker + State
Management</a></li>
<li><a href="#sync-queue" id="toc-sync-queue">Sync Queue</a></li>
</ul></li>
<li><a href="#summary-5" id="toc-summary-5">Summary</a></li>
<li><a href="#best-practices-2" id="toc-best-practices-2">Best
Practices</a></li>
</ul></li>
<li><a href="#chapter-7-advanced-component-patterns"
id="toc-chapter-7-advanced-component-patterns">Chapter 7: Advanced
Component Patterns</a>
<ul>
<li><a href="#compound-components" id="toc-compound-components">Compound
Components</a>
<ul>
<li><a href="#basic-compound-component"
id="toc-basic-compound-component">Basic Compound Component</a></li>
<li><a href="#context-api-for-compound-components"
id="toc-context-api-for-compound-components">Context API for Compound
Components</a></li>
</ul></li>
<li><a href="#higher-order-components"
id="toc-higher-order-components">Higher-Order Components</a>
<ul>
<li><a href="#mixin-pattern" id="toc-mixin-pattern">Mixin
Pattern</a></li>
<li><a href="#decorator-pattern" id="toc-decorator-pattern">Decorator
Pattern</a></li>
</ul></li>
<li><a href="#component-composition"
id="toc-component-composition">Component Composition</a>
<ul>
<li><a href="#containerpresentational-pattern"
id="toc-containerpresentational-pattern">Container/Presentational
Pattern</a></li>
<li><a href="#render-props-pattern" id="toc-render-props-pattern">Render
Props Pattern</a></li>
</ul></li>
<li><a href="#slots-and-content-projection"
id="toc-slots-and-content-projection">Slots and Content Projection</a>
<ul>
<li><a href="#named-slots" id="toc-named-slots">Named Slots</a></li>
<li><a href="#slot-change-detection" id="toc-slot-change-detection">Slot
Change Detection</a></li>
<li><a href="#conditional-slots" id="toc-conditional-slots">Conditional
Slots</a></li>
</ul></li>
<li><a href="#dynamic-component-loading"
id="toc-dynamic-component-loading">Dynamic Component Loading</a>
<ul>
<li><a href="#lazy-loading" id="toc-lazy-loading">Lazy Loading</a></li>
<li><a href="#intersection-observer-for-viewport-loading"
id="toc-intersection-observer-for-viewport-loading">Intersection
Observer for Viewport Loading</a></li>
</ul></li>
<li><a href="#performance-optimization"
id="toc-performance-optimization">Performance Optimization</a>
<ul>
<li><a href="#virtual-scrolling" id="toc-virtual-scrolling">Virtual
Scrolling</a></li>
<li><a href="#memoization" id="toc-memoization">Memoization</a></li>
<li><a href="#debouncing-and-throttling"
id="toc-debouncing-and-throttling">Debouncing and Throttling</a></li>
</ul></li>
<li><a href="#summary-6" id="toc-summary-6">Summary</a></li>
<li><a href="#best-practices-3" id="toc-best-practices-3">Best
Practices</a></li>
</ul></li>
<li><a href="#chapter-8-business-logic-patterns"
id="toc-chapter-8-business-logic-patterns">Chapter 8: Business Logic
Patterns</a>
<ul>
<li><a href="#the-philosophy-separation-of-concerns"
id="toc-the-philosophy-separation-of-concerns">The Philosophy:
Separation of Concerns</a></li>
<li><a href="#pattern-1-pan-bus-listeners-recommended"
id="toc-pattern-1-pan-bus-listeners-recommended">Pattern 1: PAN Bus
Listeners (Recommended)</a>
<ul>
<li><a href="#when-to-use" id="toc-when-to-use">When to Use</a></li>
<li><a href="#basic-implementation" id="toc-basic-implementation">Basic
Implementation</a></li>
<li><a href="#advantages" id="toc-advantages">Advantages</a></li>
<li><a href="#advanced-composable-business-logic"
id="toc-advanced-composable-business-logic">Advanced: Composable
Business Logic</a></li>
</ul></li>
<li><a href="#pattern-2-extending-components"
id="toc-pattern-2-extending-components">Pattern 2: Extending
Components</a>
<ul>
<li><a href="#when-to-use-1" id="toc-when-to-use-1">When to Use</a></li>
<li><a href="#implementation"
id="toc-implementation">Implementation</a></li>
<li><a href="#when-this-makes-sense" id="toc-when-this-makes-sense">When
This Makes Sense</a></li>
</ul></li>
<li><a href="#pattern-3-wrapper-components"
id="toc-pattern-3-wrapper-components">Pattern 3: Wrapper Components</a>
<ul>
<li><a href="#implementation-1"
id="toc-implementation-1">Implementation</a></li>
</ul></li>
<li><a href="#pattern-4-behavior-mixins"
id="toc-pattern-4-behavior-mixins">Pattern 4: Behavior Mixins</a>
<ul>
<li><a href="#implementation-2"
id="toc-implementation-2">Implementation</a></li>
</ul></li>
<li><a href="#pattern-5-service-layer"
id="toc-pattern-5-service-layer">Pattern 5: Service Layer</a></li>
<li><a href="#decision-matrix" id="toc-decision-matrix">Decision
Matrix</a></li>
<li><a href="#real-world-example-e-commerce-checkout"
id="toc-real-world-example-e-commerce-checkout">Real-World Example:
E-Commerce Checkout</a></li>
<li><a href="#testing-business-logic"
id="toc-testing-business-logic">Testing Business Logic</a>
<ul>
<li><a href="#testing-pan-bus-listeners"
id="toc-testing-pan-bus-listeners">Testing PAN Bus Listeners</a></li>
<li><a href="#testing-services" id="toc-testing-services">Testing
Services</a></li>
</ul></li>
<li><a href="#best-practices-4" id="toc-best-practices-4">Best
Practices</a>
<ul>
<li><a href="#keep-components-dumb" id="toc-keep-components-dumb">1.
Keep Components Dumb</a></li>
<li><a href="#use-services-for-complex-logic"
id="toc-use-services-for-complex-logic">2. Use Services for Complex
Logic</a></li>
<li><a href="#make-business-logic-observable"
id="toc-make-business-logic-observable">3. Make Business Logic
Observable</a></li>
<li><a href="#document-business-rules"
id="toc-document-business-rules">4. Document Business Rules</a></li>
<li><a href="#use-feature-flags" id="toc-use-feature-flags">5. Use
Feature Flags</a></li>
</ul></li>
<li><a href="#summary-7" id="toc-summary-7">Summary</a></li>
</ul></li>
<li><a href="#chapter-8-routing-and-navigation"
id="toc-chapter-8-routing-and-navigation">Chapter 8: Routing and
Navigation</a>
<ul>
<li><a href="#client-side-routing-basics"
id="toc-client-side-routing-basics">Client-Side Routing Basics</a></li>
<li><a href="#the-pan-router-component"
id="toc-the-pan-router-component">The pan-router Component</a></li>
<li><a href="#route-parameters" id="toc-route-parameters">Route
Parameters</a></li>
<li><a href="#route-guards" id="toc-route-guards">Route Guards</a></li>
<li><a href="#nested-routes" id="toc-nested-routes">Nested
Routes</a></li>
<li><a href="#programmatic-navigation"
id="toc-programmatic-navigation">Programmatic Navigation</a></li>
<li><a href="#query-parameters" id="toc-query-parameters">Query
Parameters</a></li>
<li><a href="#summary-8" id="toc-summary-8">Summary</a></li>
<li><a href="#best-practices-5" id="toc-best-practices-5">Best
Practices</a></li>
</ul></li>
<li><a href="#chapter-9-forms-and-validation"
id="toc-chapter-9-forms-and-validation">Chapter 9: Forms and
Validation</a>
<ul>
<li><a href="#form-components" id="toc-form-components">Form
Components</a>
<ul>
<li><a href="#basic-form-component" id="toc-basic-form-component">Basic
Form Component</a></li>
</ul></li>
<li><a href="#two-way-data-binding"
id="toc-two-way-data-binding">Two-Way Data Binding</a></li>
<li><a href="#validation-strategies"
id="toc-validation-strategies">Validation Strategies</a>
<ul>
<li><a href="#native-html5-validation"
id="toc-native-html5-validation">Native HTML5 Validation</a></li>
<li><a href="#custom-validation" id="toc-custom-validation">Custom
Validation</a></li>
<li><a href="#async-validation" id="toc-async-validation">Async
Validation</a></li>
</ul></li>
<li><a href="#error-handling" id="toc-error-handling">Error
Handling</a></li>
<li><a href="#file-uploads" id="toc-file-uploads">File Uploads</a></li>
<li><a href="#form-submission" id="toc-form-submission">Form
Submission</a></li>
<li><a href="#summary-9" id="toc-summary-9">Summary</a></li>
<li><a href="#best-practices-6" id="toc-best-practices-6">Best
Practices</a></li>
</ul></li>
<li><a href="#chapters-11-19-summary-outlines"
id="toc-chapters-11-19-summary-outlines">Chapters 11-19: Summary
Outlines</a>
<ul>
<li><a href="#chapter-11-data-fetching-and-apis"
id="toc-chapter-11-data-fetching-and-apis">Chapter 11: Data Fetching and
APIs</a>
<ul>
<li><a href="#key-topics" id="toc-key-topics">Key Topics:</a></li>
<li><a href="#code-example---api-client"
id="toc-code-example---api-client">Code Example - API Client:</a></li>
</ul></li>
<li><a href="#chapter-12-authentication-and-security"
id="toc-chapter-12-authentication-and-security">Chapter 12:
Authentication and Security</a>
<ul>
<li><a href="#key-topics-1" id="toc-key-topics-1">Key Topics:</a></li>
<li><a href="#code-example---auth-service"
id="toc-code-example---auth-service">Code Example - Auth
Service:</a></li>
</ul></li>
<li><a href="#chapter-13-server-integration"
id="toc-chapter-13-server-integration">Chapter 13: Server
Integration</a>
<ul>
<li><a href="#key-topics-2" id="toc-key-topics-2">Key Topics:</a></li>
<li><a href="#node.js-example" id="toc-node.js-example">Node.js
Example:</a></li>
</ul></li>
<li><a href="#chapter-14-testing" id="toc-chapter-14-testing">Chapter
14: Testing</a>
<ul>
<li><a href="#key-topics-3" id="toc-key-topics-3">Key Topics:</a></li>
<li><a href="#test-example" id="toc-test-example">Test Example:</a></li>
</ul></li>
<li><a href="#chapter-15-performance-and-optimization"
id="toc-chapter-15-performance-and-optimization">Chapter 15: Performance
and Optimization</a>
<ul>
<li><a href="#key-topics-4" id="toc-key-topics-4">Key Topics:</a></li>
<li><a href="#performance-patterns"
id="toc-performance-patterns">Performance Patterns:</a></li>
</ul></li>
<li><a href="#chapter-16-deployment"
id="toc-chapter-16-deployment">Chapter 16: Deployment</a>
<ul>
<li><a href="#key-topics-5" id="toc-key-topics-5">Key Topics:</a></li>
<li><a href="#deployment-checklist"
id="toc-deployment-checklist">Deployment Checklist:</a></li>
</ul></li>
<li><a href="#chapter-17-component-library"
id="toc-chapter-17-component-library">Chapter 17: Component Library</a>
<ul>
<li><a href="#key-topics-6" id="toc-key-topics-6">Key Topics:</a></li>
<li><a href="#registry-integration"
id="toc-registry-integration">Registry Integration:</a></li>
</ul></li>
<li><a href="#chapter-18-tooling" id="toc-chapter-18-tooling">Chapter
18: Tooling</a>
<ul>
<li><a href="#key-topics-7" id="toc-key-topics-7">Key Topics:</a></li>
<li><a href="#vs-code-snippets" id="toc-vs-code-snippets">VS Code
Snippets:</a></li>
</ul></li>
<li><a href="#chapter-19-real-world-applications"
id="toc-chapter-19-real-world-applications">Chapter 19: Real-World
Applications</a>
<ul>
<li><a href="#case-study-1-e-commerce-platform"
id="toc-case-study-1-e-commerce-platform">Case Study 1: E-Commerce
Platform</a></li>
<li><a href="#case-study-2-dashboard-application"
id="toc-case-study-2-dashboard-application">Case Study 2: Dashboard
Application</a></li>
<li><a href="#case-study-3-blogcms" id="toc-case-study-3-blogcms">Case
Study 3: Blog/CMS</a></li>
<li><a href="#lessons-learned" id="toc-lessons-learned">Lessons
Learned:</a></li>
</ul></li>
</ul></li>
<li><a href="#appendices-1" id="toc-appendices-1">Appendices</a>
<ul>
<li><a href="#appendix-a-web-components-api-reference"
id="toc-appendix-a-web-components-api-reference">Appendix A: Web
Components API Reference</a>
<ul>
<li><a href="#custom-elements-1" id="toc-custom-elements-1">Custom
Elements</a></li>
<li><a href="#lifecycle-callbacks-1"
id="toc-lifecycle-callbacks-1">Lifecycle Callbacks</a></li>
<li><a href="#shadow-dom-1" id="toc-shadow-dom-1">Shadow DOM</a></li>
</ul></li>
<li><a href="#appendix-b-pan-bus-api-reference"
id="toc-appendix-b-pan-bus-api-reference">Appendix B: PAN Bus API
Reference</a>
<ul>
<li><a href="#core-methods" id="toc-core-methods">Core Methods</a></li>
<li><a href="#topic-patterns" id="toc-topic-patterns">Topic
Patterns</a></li>
</ul></li>
<li><a href="#appendix-c-component-api-reference"
id="toc-appendix-c-component-api-reference">Appendix C: Component API
Reference</a>
<ul>
<li><a href="#built-in-components" id="toc-built-in-components">Built-in
Components</a></li>
</ul></li>
<li><a href="#appendix-d-migration-guides"
id="toc-appendix-d-migration-guides">Appendix D: Migration Guides</a>
<ul>
<li><a href="#from-react" id="toc-from-react">From React</a></li>
<li><a href="#from-vue" id="toc-from-vue">From Vue</a></li>
<li><a href="#from-angular" id="toc-from-angular">From Angular</a></li>
</ul></li>
<li><a href="#appendix-e-resources"
id="toc-appendix-e-resources">Appendix E: Resources</a>
<ul>
<li><a href="#official-documentation"
id="toc-official-documentation">Official Documentation</a></li>
<li><a href="#web-standards" id="toc-web-standards">Web
Standards</a></li>
<li><a href="#community" id="toc-community">Community</a></li>
<li><a href="#learning-resources" id="toc-learning-resources">Learning
Resources</a></li>
<li><a href="#tools" id="toc-tools">Tools</a></li>
<li><a href="#example-projects" id="toc-example-projects">Example
Projects</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="learning-larc">Learning LARC</h1>
<h2
id="building-modern-web-applications-with-the-page-area-network-architecture">Building
Modern Web Applications with the Page Area Network Architecture</h2>
<hr />
<p><strong>By the LARC Team</strong></p>
<p><em>First Edition, 2025</em></p>
<hr />
<h2 id="praise-for-learning-larc">Praise for Learning LARC</h2>
<p><em>“LARC represents a return to web fundamentals while embracing
modern capabilities. This book beautifully explains why that
matters.”</em> — <strong>Future Web Developer</strong></p>
<p><em>“Finally, a framework that respects the browser. Learning LARC
shows you how to build without fighting the platform.”</em> —
<strong>Another Developer</strong></p>
<p><em>“The PAN bus architecture is elegant and powerful. This book
makes it accessible to everyone.”</em> — <strong>Yet Another
Developer</strong></p>
<hr />
<h2 id="copyright">Copyright</h2>
<p>Copyright © 2025 LARC Team. All rights reserved.</p>
<p>Printed in the United States of America.</p>
<p>Published by LARC Press.</p>
<p>The LARC logo and name are trademarks of the LARC Project.</p>
<p>While the publisher and authors have used good faith efforts to
ensure that the information and instructions contained in this work are
accurate, the publisher and authors disclaim all responsibility for
errors or omissions, including without limitation responsibility for
damages resulting from the use of or reliance on this work.</p>
<p>Use of the information and instructions contained in this work is at
your own risk. If any code samples or other technology this work
contains or describes is subject to open source licenses or the
intellectual property rights of others, it is your responsibility to
ensure that your use thereof complies with such licenses and/or
rights.</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<h3 id="preface">Preface</h3>
<ul>
<li>Who This Book Is For</li>
<li>What You’ll Learn</li>
<li>Conventions Used in This Book</li>
<li>Using Code Examples</li>
<li>How to Contact Us</li>
<li>Acknowledgments</li>
</ul>
<h3 id="part-i-foundations">Part I: Foundations</h3>
<p><strong>Chapter 1: Philosophy and Background</strong> - The Problem
with Modern Web Development - A Return to Fundamentals - The LARC
Philosophy - Why “No Build” Matters - When to Use LARC - What You’ll
Build</p>
<p><strong>Chapter 2: Core Concepts</strong> - Web Components Refresher
- The Page Area Network (PAN) - Event-Driven Architecture - State
Management Philosophy - Module System - The Component Lifecycle</p>
<p><strong>Chapter 3: Getting Started</strong> - Setting Up Your
Development Environment - Your First LARC Application - Project
Structure - Import Maps Explained - Development Workflow - Common
Patterns</p>
<h3 id="part-ii-building-components">Part II: Building Components</h3>
<p><strong>Chapter 4: Creating Web Components</strong> - Anatomy of a
LARC Component - Shadow DOM Deep Dive - Attributes and Properties -
Component Styling - Lifecycle Methods - Testing Components</p>
<p><strong>Chapter 5: The PAN Bus</strong> - Understanding Pub/Sub
Architecture - Topics and Namespaces - Publishing Messages - Subscribing
to Events - Message Patterns - Debugging PAN Communication</p>
<p><strong>Chapter 6: State Management</strong> - Component-Local State
- Shared State Patterns - The pan-store Component - IndexedDB
Integration - Persistence Strategies - Offline-First Applications</p>
<p><strong>Chapter 7: Advanced Component Patterns</strong> - Compound
Components - Higher-Order Components - Component Composition - Slots and
Content Projection - Dynamic Component Loading - Performance
Optimization</p>
<h3 id="part-iii-building-applications">Part III: Building
Applications</h3>
<p><strong>Chapter 8: Routing and Navigation</strong> - Client-Side
Routing - The pan-router Component - Route Parameters - Nested Routes -
Route Guards - History Management</p>
<p><strong>Chapter 9: Forms and Validation</strong> - Form Components -
Two-Way Data Binding - Validation Strategies - Error Handling - File
Uploads - Form Submission</p>
<p><strong>Chapter 10: Data Fetching and APIs</strong> - The pan-fetch
Component - REST API Integration - GraphQL Support - WebSocket
Communication - Server-Sent Events - Error Handling and Retry Logic</p>
<p><strong>Chapter 11: Authentication and Security</strong> -
Authentication Patterns - The pan-auth Component - JWT Token Management
- Protected Routes - CORS Considerations - Security Best Practices</p>
<h3 id="part-iv-advanced-topics">Part IV: Advanced Topics</h3>
<p><strong>Chapter 12: Server Integration</strong> - Backend
Architecture - Node.js Integration - PHP Connector - Python/Django
Integration - Database Patterns - Real-Time Communication</p>
<p><strong>Chapter 13: Testing</strong> - Unit Testing Components -
Integration Testing - End-to-End Testing - Visual Regression Testing -
Performance Testing - Continuous Integration</p>
<p><strong>Chapter 14: Performance and Optimization</strong> - Loading
Strategies - Code Splitting - Lazy Loading Components - Caching
Strategies - Bundle Size Optimization - Performance Monitoring</p>
<p><strong>Chapter 15: Deployment</strong> - Static Hosting - CDN
Configuration - Environment Variables - CI/CD Pipelines - Monitoring and
Analytics - Production Best Practices</p>
<h3 id="part-v-ecosystem">Part V: Ecosystem</h3>
<p><strong>Chapter 16: Component Library</strong> - Using the Component
Registry - Contributing Components - Creating a Component Library -
Documentation Strategies - Versioning and Releases</p>
<p><strong>Chapter 17: Tooling</strong> - Development Tools - CLI Tools
- VS Code Integration - Browser DevTools - Debugging Techniques</p>
<p><strong>Chapter 18: Real-World Applications</strong> - Case Study:
E-Commerce Platform - Case Study: Dashboard Application - Case Study:
Blog/CMS - Lessons Learned - Best Practices</p>
<h3 id="appendices">Appendices</h3>
<p><strong>Appendix A: Web Components API Reference</strong> - Custom
Elements - Shadow DOM - HTML Templates - ES Modules</p>
<p><strong>Appendix B: PAN Bus API Reference</strong> - Core Methods -
Message Formats - Topic Patterns - Configuration Options</p>
<p><strong>Appendix C: Component API Reference</strong> - Built-in
Components - Component Properties - Events and Methods</p>
<p><strong>Appendix D: Migration Guides</strong> - From React - From Vue
- From Angular - From jQuery</p>
<p><strong>Appendix E: Resources</strong> - Official Documentation -
Community Resources - Video Tutorials - Example Projects</p>
<h3 id="index">Index</h3>
<hr />
<h2 id="about-the-authors">About the Authors</h2>
<p>The LARC Team is a group of developers passionate about web
standards, simplicity, and performance. We believe the web platform has
evolved to the point where many abstractions are no longer necessary,
and we created LARC to prove it.</p>
<hr />
<h1 id="foreword">Foreword</h1>
<p><em>by Christopher Robison</em></p>
<p>I didn’t set out to build a framework. I set out to escape one — or
at least escape the gravitational pull of the endless build
pipeline.</p>
<p>After decades of building things for the web, my machine had become a
storage exhibit of Node versions, Python versions, shims, wrappers, and
dependency folders with the mass of small moons. Not because any of it
was bad. Build tools are fine. For big projects, they’re downright
amazing. But somewhere along the way, we normalized the idea that even
the simplest experiment needed a pipeline, a bundler, a transpiler, and
a twelve-step hydration ritual before it could say “Hello, World.”</p>
<p>That friction bothered me.</p>
<p>I wanted the feeling I had back in the early days: the joy of
dropping a <code>&lt;script&gt;</code> tag into an HTML file and
instantly seeing something come alive. No ceremony. No yak shaving. Just
a browser, a file, and an idea.</p>
<p>Web Components felt close to that spirit — native modules, shadow
DOM, real encapsulation — but they were oddly isolated. Each component
was a self-contained island. Reusable, yes. Architecturally composable?
Not really. Nothing tied them together except whatever glue code you
wrote yourself. It felt like someone had shipped LEGO bricks without the
ability to click them together.</p>
<p>That’s when I remembered the CAN bus in cars.</p>
<p>The CAN bus is this beautifully simple ecosystem: dozens of systems —
sensors, motors, controllers — all sharing a single communication line.
Anybody can broadcast. Anybody can listen. Nobody needs to know who else
exists. A message goes out, and the parts that care respond. It’s
loosely coupled machinery at its finest.</p>
<p>I wanted that for the web.</p>
<p>So I built the PAN bus — the Page Area Network — and started
experimenting. Not with the intention of making A Real Framework™, but
out of curiosity. How far could I push this idea? What could I build if
every component on the page could talk over a shared bus, using nothing
but browser-native APIs and one tiny script include?</p>
<p>That little experiment got out of hand in the best way.</p>
<p>I kept pushing it, partly out of stubbornness, partly out of sheer
delight. I wanted to see if I could build real, full-blown applications
with no build process at all — just a single script tag pointing to LARC
and a page full of components chatting over the bus. And it turned out
to be… fun. Refreshing. Capable. Liberating, even. A loose, elegant
architecture emerged almost on its own.</p>
<p>Along the way, I realized something important: I’m not
anti-build-tool. They solve real problems, especially at scale. But they
shouldn’t be mandatory for everything. And they shouldn’t overshadow the
fact that the browser today is powerful enough to build serious
applications with a simple HTML page, a few components, and a shared
message bus.</p>
<p>React, Angular, Vue — they solved problems that absolutely needed
solving at the time. The web platform in 2015 was missing big pieces:
templating, reactivity, routing, structured components, coherence. These
frameworks carried the industry through that era. But the web has
evolved since then. Many of those features now exist natively —
standardized, built-in, fast, and universally available.</p>
<p>LARC isn’t here to replace those frameworks. It complements them. It
fills in the 20% Web Components never standardized — the shared
communication fabric. The glue that lets components coexist instead of
siloing themselves off. It also makes bundle sizes smaller and
architectures cleaner, whether you’re going framework-free or
integrating with your existing stack.</p>
<p>If this book succeeds, you’ll see what I saw: the thrill of
rediscovering the browser as a first-class app platform. The joy of
building big things out of small, decoupled pieces. And the surprising
power of an architecture that starts with a simple HTML file and one
script include.</p>
<p>The web grew up. Now we get to build like it.</p>
<p>— <em>Christopher Robison</em></p>
<h1 id="chapter-1-philosophy-and-background">Chapter 1: Philosophy and
Background</h1>
<h2 id="the-problem-with-modern-web-development">The Problem with Modern
Web Development</h2>
<p>If you’ve been building web applications for the past decade, you’ve
likely experienced what many developers call “JavaScript fatigue.” The
modern web development landscape has become increasingly complex, with
countless tools, frameworks, and build processes standing between you
and shipping working code.</p>
<p>Consider a typical modern web project setup:</p>
<ol type="1">
<li>Initialize your project with a framework CLI
(<code>create-react-app</code>, <code>vue create</code>, etc.)</li>
<li>Install hundreds or thousands of npm dependencies</li>
<li>Configure webpack, Babel, TypeScript, ESLint, Prettier</li>
<li>Set up build scripts for development, production, testing</li>
<li>Wait for builds to complete (sometimes minutes)</li>
<li>Debug build configuration issues when something breaks</li>
<li>Update dependencies regularly to patch security vulnerabilities</li>
<li>Repeat the cycle when frameworks release breaking changes</li>
</ol>
<p>This complexity wasn’t always necessary. In the early days of the
web, you could create an HTML file, add some CSS and JavaScript, and
open it directly in a browser. No build step. No toolchain. No
configuration. Just code that runs.</p>
<p>What happened?</p>
<h3 id="the-rise-of-complexity">The Rise of Complexity</h3>
<p>The web platform evolved, but it didn’t evolve fast enough for
ambitious developers. We wanted:</p>
<ul>
<li><strong>Component-based architecture</strong> — but HTML didn’t have
custom elements yet</li>
<li><strong>Module systems</strong> — but JavaScript didn’t have native
imports</li>
<li><strong>Reactive data binding</strong> — but the DOM wasn’t designed
for it</li>
<li><strong>Advanced syntax</strong> — like JSX, TypeScript, or class
properties</li>
</ul>
<p>Frameworks filled these gaps by building abstractions on top of the
web platform. But these abstractions came with costs:</p>
<ul>
<li><strong>Build toolchains</strong> became mandatory to transpile
code</li>
<li><strong>Bundle sizes</strong> grew as framework code was shipped to
browsers</li>
<li><strong>Learning curves</strong> steepened as developers had to
learn both the framework and the tools</li>
<li><strong>Debugging</strong> became harder with source maps and
transpiled code</li>
<li><strong>Performance</strong> suffered from unnecessary abstraction
layers</li>
</ul>
<p>The irony? While we were busy building these elaborate toolchains,
the web platform itself was evolving to support many of the features we
wanted natively.</p>
<h3 id="the-platform-has-caught-up">The Platform Has Caught Up</h3>
<p>Today’s web platform is remarkably capable. Modern browsers
support:</p>
<ul>
<li><strong>Custom Elements</strong> — native component definition</li>
<li><strong>Shadow DOM</strong> — true style encapsulation</li>
<li><strong>ES Modules</strong> — native JavaScript modules with
imports</li>
<li><strong>Import Maps</strong> — dependency management without
bundlers</li>
<li><strong>Template Literals</strong> — dynamic HTML without JSX</li>
<li><strong>Proxy and Reflect</strong> — reactive data patterns</li>
<li><strong>CSS Custom Properties</strong> — themeable components</li>
<li><strong>Web Components</strong> — standards-based component
architecture</li>
</ul>
<p>These aren’t polyfills or experimental features. They’re stable,
well-supported standards that work across all modern browsers. Yet most
web frameworks continue to build elaborate abstractions on top of the
platform, ignoring these native capabilities.</p>
<h3 id="a-common-scenario">A Common Scenario</h3>
<p>Let’s look at a real-world example. Imagine you’re building a simple
dashboard with a few interactive components: a card, a button, and a
data table. Here’s what this might look like in a typical React
project:</p>
<p><strong>The Setup:</strong></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> create-react-app my-dashboard</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> my-dashboard</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install styled-components react-router axios redux</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Wait 5-10 minutes for installation</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Project size: ~300MB, ~1000+ dependencies</span></span></code></pre></div>
<p><strong>The Code:</strong></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Card.jsx</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> styled <span class="im">from</span> <span class="st">&#39;styled-components&#39;</span><span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> StyledCard <span class="op">=</span> styled<span class="op">.</span><span class="fu">div</span><span class="vs">`</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 20px;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 8px;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="vs">  box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">Card</span>({ title<span class="op">,</span> children }) {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&lt;StyledCard&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;h2&gt;</span><span class="va">{</span>title<span class="va">}</span><span class="kw">&lt;/h2&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="va">{</span>children<span class="va">}</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&lt;/StyledCard&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>The Build:</strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run build</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Wait 30-60 seconds</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Output: Minified, bundled, transpiled code</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bundle size: 200-500KB (before your actual code)</span></span></code></pre></div>
<p>Now, here’s the same thing with native Web Components and LARC:</p>
<p><strong>The Setup:</strong></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="dt">&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imports&quot;</span><span class="op">:</span> {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;@larcjs/ui&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/ui@1/dist/index.js&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-card</span><span class="ot"> title</span><span class="op">=</span><span class="st">&quot;Dashboard&quot;</span><span class="dt">&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Your content here<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">pan-card</span><span class="dt">&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="dt">&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> <span class="st">&#39;@larcjs/ui&#39;</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>The Build:</strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There is no build step. Open the HTML file. It works.</span></span></code></pre></div>
<p>Same functionality. Zero dependencies. No build process. No
toolchain. Just HTML, CSS, and JavaScript working together as the
platform intended.</p>
<h2 id="a-return-to-fundamentals">A Return to Fundamentals</h2>
<p>LARC (Lightweight Autonomous Reactive Components) represents a
philosophical shift back to web fundamentals. But this isn’t about going
backward—it’s about recognizing that the platform has evolved to the
point where many of our abstractions are no longer necessary.</p>
<h3 id="what-larc-is">What LARC Is</h3>
<p>LARC is a set of conventions, patterns, and utilities for building
modern web applications using native web standards:</p>
<ul>
<li><strong>Web Components</strong> for encapsulated, reusable UI
elements</li>
<li><strong>ES Modules</strong> for code organization and imports</li>
<li><strong>Import Maps</strong> for dependency management</li>
<li><strong>The PAN Bus</strong> for component communication</li>
<li><strong>Native APIs</strong> for state, routing, and data
fetching</li>
</ul>
<p>LARC provides guidance and utilities, but it doesn’t abstract away
the platform. When you write LARC code, you’re writing standard
JavaScript, HTML, and CSS that runs directly in the browser.</p>
<h3 id="what-larc-is-not">What LARC Is Not</h3>
<p>LARC is deliberately minimal. It is <strong>not</strong>:</p>
<ul>
<li>A framework with proprietary APIs you must learn</li>
<li>A template language that requires compilation</li>
<li>A state management system with complex rules</li>
<li>A build tool that transforms your code</li>
<li>A runtime that interprets your components</li>
</ul>
<p>If you know HTML, CSS, and JavaScript, you already know most of
LARC.</p>
<h3 id="core-principles">Core Principles</h3>
<p>LARC is built on several core principles:</p>
<h4 id="standards-first">1. Standards First</h4>
<p>LARC embraces web standards rather than fighting them. Every LARC
component is a valid Web Component. Every LARC module is a valid ES
Module. If you understand the standards, you understand LARC.</p>
<h4 id="zero-build-for-development">2. Zero Build for Development</h4>
<p>During development, you should be able to edit a file and refresh the
browser. No build step. No waiting. No configuration. The browser is
your development environment.</p>
<p>This doesn’t mean builds are forbidden—you can still optimize for
production if needed. But they should be optional enhancements, not
requirements.</p>
<h4 id="progressive-enhancement">3. Progressive Enhancement</h4>
<p>Start simple and add complexity only when needed. A basic component
can be a few lines of JavaScript. As requirements grow, add features
incrementally: state management, routing, server integration, etc.</p>
<p>You’re never locked into architectural decisions made at project
initialization. LARC applications evolve naturally.</p>
<h4 id="local-first-network-aware">4. Local First, Network Aware</h4>
<p>Components should work independently with local state. Network
communication happens through explicit, observable patterns (the PAN
bus). This makes components:</p>
<ul>
<li>Easier to test (no mocking required)</li>
<li>More reusable (fewer dependencies)</li>
<li>More resilient (graceful degradation)</li>
</ul>
<h4 id="developer-experience-through-simplicity">5. Developer Experience
Through Simplicity</h4>
<p>Good DX doesn’t require complex tooling. It comes from:</p>
<ul>
<li>Clear, predictable patterns</li>
<li>Minimal abstractions</li>
<li>Fast feedback loops</li>
<li>Easy debugging</li>
<li>Comprehensive documentation</li>
</ul>
<p>When something breaks in LARC, you can open browser DevTools and
debug standard JavaScript. No source maps. No transpiled code. No
framework internals.</p>
<h2 id="the-larc-philosophy">The LARC Philosophy</h2>
<p>At its heart, LARC is about <strong>respecting the platform</strong>.
The web is incredibly powerful, yet we’ve spent years building layers of
abstraction that hide its capabilities. LARC removes those layers.</p>
<h3 id="composition-over-configuration">Composition Over
Configuration</h3>
<p>Rather than configuring a framework through JSON or CLI flags, LARC
applications are composed from standard parts:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Composition: Combine standard elements --&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;home-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/dashboard&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;dashboard-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Each element is understandable in isolation. There’s no magic
configuration file that controls behavior across your entire
application.</p>
<h3 id="convention-over-prescription">Convention Over Prescription</h3>
<p>LARC suggests patterns but doesn’t enforce them. There’s no “one true
way” to structure a LARC application. The conventions exist to make
common tasks easier, but you can always drop down to standard APIs when
needed.</p>
<p>For example, LARC recommends the PAN bus for component communication,
but you can also use:</p>
<ul>
<li>Custom events</li>
<li>Direct property access</li>
<li>Shared state objects</li>
<li>URL parameters</li>
<li>LocalStorage</li>
<li>Any other standard browser API</li>
</ul>
<p>Choose the right tool for your specific use case.</p>
<h3 id="explicit-over-implicit">Explicit Over Implicit</h3>
<p>LARC favors explicitness. When a component fetches data, you see the
fetch call. When state changes, you see the assignment. When events are
dispatched, you see the dispatch.</p>
<p>Compare these two approaches:</p>
<p><strong>Implicit (typical framework):</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode jsx"><code class="sourceCode javascriptreact"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">UserProfile</span>() {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [user<span class="op">,</span> loading<span class="op">,</span> error] <span class="op">=</span> <span class="fu">useUser</span>(userId)<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (loading) <span class="cf">return </span><span class="fu">&lt;Spinner</span> <span class="fu">/&gt;</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (error) <span class="cf">return </span><span class="fu">&lt;Error</span> <span class="ot">message</span><span class="op">=</span><span class="va">{</span>error<span class="va">}</span> <span class="fu">/&gt;</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return </span><span class="fu">&lt;ProfileCard</span> <span class="ot">user</span><span class="op">=</span><span class="va">{</span>user<span class="va">}</span> <span class="fu">/&gt;</span><span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Magic happens in <code>useUser</code>. Where does the data come from?
When does it refetch? What triggers updates? You need to understand the
framework’s mental model.</p>
<p><strong>Explicit (LARC):</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserProfile <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>({ <span class="dt">loading</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/users/</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">userId</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>({ user })<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>({ <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>(state) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state<span class="op">.</span><span class="at">loading</span>) {</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;loading-spinner&gt;&lt;/loading-spinner&gt;&#39;</span><span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (state<span class="op">.</span><span class="at">error</span>) {</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;error-message text=&quot;</span><span class="sc">${</span>state<span class="op">.</span><span class="at">error</span><span class="sc">}</span><span class="vs">&quot;&gt;&lt;/error-message&gt;`</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;profile-card .user=&quot;</span><span class="sc">${</span>state<span class="op">.</span><span class="at">user</span><span class="sc">}</span><span class="vs">&quot;&gt;&lt;/profile-card&gt;`</span><span class="op">;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Every step is visible. You can trace exactly what happens and when.
Debugging is straightforward because you’re working with standard
JavaScript.</p>
<h2 id="why-no-build-matters">Why “No Build” Matters</h2>
<p>The “no build” philosophy isn’t about being purist or rejecting
tools. It’s about removing unnecessary complexity and its associated
costs.</p>
<h3 id="development-speed">Development Speed</h3>
<p>Without a build step, your development cycle is:</p>
<ol type="1">
<li>Edit code</li>
<li>Refresh browser</li>
<li>See changes</li>
</ol>
<p>That’s it. No waiting for webpack to rebuild. No watching file
watchers fail. No debugging build configurations.</p>
<p>This might seem like a small thing, but it compounds. Over a day of
development, those 10-30 second build times add up to significant lost
productivity. More importantly, they break flow state.</p>
<h3 id="debugging-simplicity">Debugging Simplicity</h3>
<p>When you open browser DevTools in a LARC application, you see your
actual code. No source maps needed. No transpiled output. No minified
framework internals.</p>
<p>Set a breakpoint in your component’s <code>connectedCallback</code>.
It stops exactly where you expect. The call stack is readable. Variables
are named as you wrote them.</p>
<p>This makes debugging accessible to junior developers and reduces time
spent fighting tools.</p>
<h3 id="deployment-simplicity">Deployment Simplicity</h3>
<p>A LARC application can be deployed to any static host:</p>
<ul>
<li>GitHub Pages</li>
<li>Netlify</li>
<li>Vercel</li>
<li>Amazon S3</li>
<li>Any web server</li>
</ul>
<p>No server-side rendering. No Node.js runtime. No build artifacts to
manage. Just upload HTML, CSS, and JavaScript files.</p>
<p>Want to deploy to a CDN? Your entire application is already
CDN-friendly because it’s just static files.</p>
<h3 id="lower-barrier-to-entry">Lower Barrier to Entry</h3>
<p>New developers can learn web development by:</p>
<ol type="1">
<li>Creating an HTML file</li>
<li>Adding some CSS and JavaScript</li>
<li>Opening it in a browser</li>
</ol>
<p>No installation. No environment setup. No project configuration. This
is how the web should work.</p>
<p>With build tools, new developers face:</p>
<ol type="1">
<li>Install Node.js</li>
<li>Learn npm/yarn</li>
<li>Understand package.json</li>
<li>Configure webpack/Babel</li>
<li>Troubleshoot build errors</li>
<li>Learn framework-specific tooling</li>
</ol>
<p>Before writing a single line of application code, they’ve already
encountered dozens of concepts unrelated to actual web development.</p>
<h3 id="sustainability">Sustainability</h3>
<p>Build tools and frameworks change rapidly. A React application from
2015 likely needs significant updates to run today. Build configurations
break. Dependencies become unmaintained. Migration guides are
incomplete.</p>
<p>LARC applications use web standards. A LARC application from 2025
will still run in 2035 because it’s built on stable browser APIs, not
framework-specific abstractions.</p>
<p>This doesn’t mean LARC applications never need updates—APIs evolve,
best practices change. But the core architecture is built on a
foundation that changes slowly and deliberately through standards
processes.</p>
<h2 id="when-to-use-larc">When to Use LARC</h2>
<p>LARC isn’t the right choice for every project. Understanding when to
use it (and when not to) helps you make informed decisions.</p>
<h3 id="larc-excels-at">LARC Excels At</h3>
<p><strong>Small to Medium Applications</strong> Projects with 10-100
components where simplicity and maintainability matter more than
framework ecosystem size.</p>
<p><strong>Dashboard and Admin Panels</strong> Internal tools where the
development team controls the environment and values fast iteration.</p>
<p><strong>Progressive Web Apps</strong> Applications that benefit from
offline-first architecture and minimal JavaScript overhead.</p>
<p><strong>Learning Projects</strong> Teaching web development without
the complexity of modern toolchains.</p>
<p><strong>Embedded Widgets</strong> Reusable components that need to
work in any environment without framework dependencies.</p>
<p><strong>Prototypes and MVPs</strong> Quickly validating ideas without
upfront tooling investment.</p>
<h3 id="consider-alternatives-when">Consider Alternatives When</h3>
<p><strong>Very Large Teams</strong> If you have 50+ developers working
on a single codebase, framework opinions and tooling might provide
valuable guardrails.</p>
<p><strong>Heavy Framework Ecosystem Dependencies</strong> If your
project critically relies on a specific framework’s ecosystem (e.g.,
React Native integration, specific UI libraries), switching costs may be
prohibitive.</p>
<p><strong>Server-Side Rendering is Critical</strong> While LARC
supports SSR, frameworks like Next.js have more mature SSR/SSG
ecosystems.</p>
<p><strong>Team Expertise</strong> If your entire team is deeply
experienced in React/Vue/Angular and inexperienced with Web Components,
the learning curve might slow initial development.</p>
<p>That said, LARC’s simplicity often means the learning curve is
shorter than expected. Most experienced developers can become productive
with LARC in days, not weeks.</p>
<h3 id="hybrid-approaches">Hybrid Approaches</h3>
<p>You don’t have to go all-in on LARC. Consider hybrid approaches:</p>
<p><strong>Progressive Migration</strong> Build new features in LARC
while maintaining existing framework code. Web Components can coexist
with React, Vue, or Angular.</p>
<p><strong>Micro-frontends</strong> Use LARC for some micro-frontends
and other frameworks for others. Web Components provide clean
boundaries.</p>
<p><strong>Component Libraries</strong> Build a LARC component library
that can be consumed by any framework or vanilla JavaScript.</p>
<h2 id="what-youll-build">What You’ll Build</h2>
<p>Throughout this book, you’ll build several progressively complex
applications:</p>
<h3 id="chapter-examples">Chapter Examples</h3>
<p>Each chapter includes focused examples demonstrating specific
concepts:</p>
<ul>
<li>A <strong>counter component</strong> (Chapter 4) to understand
component basics</li>
<li>A <strong>todo list</strong> (Chapter 5) to learn PAN bus
communication</li>
<li>A <strong>user profile form</strong> (Chapter 9) to master form
handling</li>
<li>A <strong>data table</strong> (Chapter 10) to work with APIs and
data</li>
</ul>
<h3 id="capstone-project-taskflow">Capstone Project: TaskFlow</h3>
<p>In the final chapters, you’ll build <strong>TaskFlow</strong>, a
complete project management application featuring:</p>
<ul>
<li>User authentication and authorization</li>
<li>Real-time collaboration via WebSockets</li>
<li>Offline-first architecture with IndexedDB</li>
<li>Drag-and-drop task boards</li>
<li>File attachments and comments</li>
<li>Search and filtering</li>
<li>Data visualization</li>
<li>Mobile-responsive design</li>
</ul>
<p>TaskFlow will demonstrate how LARC patterns scale to production
applications while remaining maintainable and performant.</p>
<h3 id="what-youll-learn">What You’ll Learn</h3>
<p>By the end of this book, you’ll be able to:</p>
<ul>
<li>Build complex, maintainable applications using Web Components</li>
<li>Design effective component communication patterns with the PAN
bus</li>
<li>Manage application state without external frameworks</li>
<li>Integrate with backend APIs and real-time services</li>
<li>Handle routing, forms, and authentication</li>
<li>Write testable, reusable components</li>
<li>Optimize performance and bundle size</li>
<li>Deploy LARC applications to production</li>
<li>Make informed decisions about when to use LARC vs. other
approaches</li>
</ul>
<h2 id="looking-ahead">Looking Ahead</h2>
<p>The next chapter dives into LARC’s core concepts: Web Components, the
PAN bus, and event-driven architecture. You’ll learn the fundamental
patterns that make LARC applications work.</p>
<p>But before we get technical, take a moment to consider what drew you
to this book. Perhaps you’re tired of build tool complexity. Perhaps you
want to understand how the web really works. Perhaps you’re curious
about a different approach.</p>
<p>Whatever your motivation, LARC offers something increasingly rare in
modern web development: simplicity without sacrificing capability.
You’re about to learn how to build serious web applications using the
platform itself, not abstractions on top of it.</p>
<p>Let’s begin.</p>
<hr />
<h2 id="summary">Summary</h2>
<ul>
<li>Modern web development has become unnecessarily complex with build
tools, frameworks, and abstractions</li>
<li>The web platform has evolved to support features natively that once
required frameworks</li>
<li>LARC uses web standards (Web Components, ES Modules, Import Maps) to
build applications without build steps</li>
<li>Core principles: standards first, zero build for development,
progressive enhancement, local first</li>
<li>“No build” matters for development speed, debugging simplicity,
deployment, and sustainability</li>
<li>LARC works best for small-to-medium applications, dashboards, PWAs,
and prototypes</li>
<li>You’ll build real applications throughout this book, culminating in
a production-ready project management app</li>
</ul>
<h1 id="chapter-2-core-concepts">Chapter 2: Core Concepts</h1>
<p>Now that you understand LARC’s philosophy, let’s explore the
technical foundation that makes it work. This chapter introduces the
core concepts you’ll use throughout the book: Web Components, the PAN
bus, event-driven architecture, and the component lifecycle.</p>
<p>Don’t worry if some of these concepts are new to you. We’ll build
understanding progressively, starting with the basics and working toward
more sophisticated patterns.</p>
<h2 id="web-components-refresher">Web Components Refresher</h2>
<p>Web Components are a suite of browser APIs that let you create
custom, reusable HTML elements. Unlike framework components, Web
Components are browser standards supported natively across all modern
browsers.</p>
<h3 id="the-three-pillars">The Three Pillars</h3>
<p>Web Components rest on three main technologies:</p>
<h4 id="custom-elements">1. Custom Elements</h4>
<p>Custom Elements let you define new HTML tags with custom
behavior:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a custom element</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HelloWorld <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;Hello, World!&#39;</span><span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Register it</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;hello-world&#39;</span><span class="op">,</span> HelloWorld)<span class="op">;</span></span></code></pre></div>
<p>Now you can use <code>&lt;hello-world&gt;&lt;/hello-world&gt;</code>
in your HTML, and it works like any built-in element.</p>
<p><strong>Key Points:</strong></p>
<ul>
<li>Element names must contain a hyphen (e.g.,
<code>my-component</code>, not <code>mycomponent</code>)</li>
<li>Custom elements inherit from <code>HTMLElement</code> or another
HTML element</li>
<li>They have lifecycle callbacks for creation, connection, and
removal</li>
</ul>
<h4 id="shadow-dom">2. Shadow DOM</h4>
<p>Shadow DOM provides style and markup encapsulation:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FancyButton <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create shadow root</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        button {</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: blue;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: white;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: none;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 10px 20px;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/button&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;fancy-button&#39;</span><span class="op">,</span> FancyButton)<span class="op">;</span></span></code></pre></div>
<p>The styles inside Shadow DOM don’t leak out, and external styles
don’t leak in:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This button is blue (from shadow DOM) --&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">fancy-button</span><span class="dt">&gt;</span>Click Me<span class="dt">&lt;/</span><span class="kw">fancy-button</span><span class="dt">&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This button is not affected by fancy-button&#39;s styles --&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">button</span><span class="dt">&gt;</span>Regular Button<span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* This won&#39;t affect fancy-button&#39;s internal button */</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  button { <span class="kw">background</span><span class="ch">:</span> <span class="cn">red</span><span class="op">;</span> }</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">style</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Shadow DOM creates an isolated scope for styles and DOM</li>
<li>Use <code>&lt;slot&gt;</code> elements to project content from light
DOM into shadow DOM</li>
<li><code>mode: 'open'</code> makes shadow root accessible via
<code>element.shadowRoot</code></li>
</ul>
<h4 id="html-templates">3. HTML Templates</h4>
<p>Templates define reusable chunks of markup that aren’t rendered until
activated:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">template</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;card-template&quot;</span><span class="dt">&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.card</span> {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">border</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ddd</span><span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">padding</span><span class="ch">:</span> <span class="dv">16</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;card&quot;</span><span class="dt">&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;title&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;content&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">template</span><span class="dt">&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> SimpleCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">connectedCallback</span>() {</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> template <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;card-template&#39;</span>)<span class="op">;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> clone <span class="op">=</span> template<span class="op">.</span><span class="at">content</span><span class="op">.</span><span class="fu">cloneNode</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>      clone<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.title&#39;</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;title&#39;</span>)<span class="op">;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>      clone<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.content&#39;</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;content&#39;</span>)<span class="op">;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">appendChild</span>(clone)<span class="op">;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;simple-card&#39;</span><span class="op">,</span> SimpleCard)<span class="op">;</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Template content is inert (scripts don’t run, images don’t
load)</li>
<li>Templates can be defined in HTML or created programmatically</li>
<li>Clone template content before using it</li>
</ul>
<h3 id="web-components-vs-framework-components">Web Components vs
Framework Components</h3>
<p>It’s worth understanding how Web Components differ from framework
components:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Web Components</th>
<th>React Components</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Definition</strong></td>
<td>Browser standard</td>
<td>Library-specific</td>
</tr>
<tr>
<td><strong>Syntax</strong></td>
<td>JavaScript classes</td>
<td>JSX or functions</td>
</tr>
<tr>
<td><strong>Lifecycle</strong></td>
<td>Native callbacks</td>
<td>Virtual DOM lifecycle</td>
</tr>
<tr>
<td><strong>Reusability</strong></td>
<td>Works everywhere</td>
<td>Requires React</td>
</tr>
<tr>
<td><strong>Build step</strong></td>
<td>Optional</td>
<td>Required (for JSX)</td>
</tr>
<tr>
<td><strong>Encapsulation</strong></td>
<td>Shadow DOM</td>
<td>CSS Modules/CSS-in-JS</td>
</tr>
</tbody>
</table>
<p>Both approaches have their place. Web Components excel at true
reusability and standards-based development. Framework components often
provide better ergonomics within their specific ecosystem.</p>
<p>LARC chooses Web Components because they align with the “standards
first” principle.</p>
<h2 id="the-page-area-network-pan">The Page Area Network (PAN)</h2>
<p>The Page Area Network, or PAN bus, is LARC’s event-driven
communication system. It’s inspired by microservices architecture but
designed for browser components.</p>
<h3 id="the-problem-it-solves">The Problem It Solves</h3>
<p>In a traditional component tree, communication flows up and down:</p>
<pre><code>App
├── Header
│   └── UserMenu
│       └── LogoutButton
└── Content
    └── UserProfile</code></pre>
<p>If <code>LogoutButton</code> needs to notify <code>UserProfile</code>
that the user logged out, you have several options:</p>
<ol type="1">
<li><strong>Pass callbacks down</strong> through props (prop
drilling)</li>
<li><strong>Lift state up</strong> to a common ancestor</li>
<li><strong>Use context</strong> or global state</li>
<li><strong>Dispatch custom events</strong> that bubble up</li>
</ol>
<p>Each approach has tradeoffs. Prop drilling creates tight coupling.
Global state makes testing harder. Event bubbling is limited by DOM
structure.</p>
<h3 id="the-pan-bus-approach">The PAN Bus Approach</h3>
<p>The PAN bus provides a <strong>decoupled pub/sub system</strong>:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// LogoutButton publishes an event</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.logout&#39;</span><span class="op">,</span> { <span class="dt">userId</span><span class="op">:</span> <span class="dv">123</span> })<span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">// UserProfile subscribes to events (anywhere in the app)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.logout&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;User logged out:&#39;</span><span class="op">,</span> data<span class="op">.</span><span class="at">userId</span>)<span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="fu">clearUserData</span>()<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Components don’t need to know about each other. They communicate
through topics (like <code>'user.logout'</code>) with no direct
coupling.</p>
<h3 id="topic-namespaces">Topic Namespaces</h3>
<p>Topics use dot notation for organization:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;user.login&#39;</span>          <span class="co">// User logged in</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;user.logout&#39;</span>         <span class="co">// User logged out</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;user.profile.update&#39;</span> <span class="co">// Profile was updated</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;cart.item.add&#39;</span>       <span class="co">// Item added to cart</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;cart.item.remove&#39;</span>    <span class="co">// Item removed</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;cart.checkout&#39;</span>       <span class="co">// Checkout initiated</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;app.theme.change&#39;</span>    <span class="co">// Theme changed</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;app.error&#39;</span>           <span class="co">// Application error</span></span></code></pre></div>
<p>You can subscribe to specific topics or use wildcards:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Specific topic</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.login&#39;</span><span class="op">,</span> handler)<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Wildcard (all user events)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.*&#39;</span><span class="op">,</span> handler)<span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">// All events (useful for debugging)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> handler)<span class="op">;</span></span></code></pre></div>
<h3 id="message-patterns">Message Patterns</h3>
<p>The PAN bus supports several messaging patterns:</p>
<h4 id="fire-and-forget">1. Fire and Forget</h4>
<p>Most common pattern. Publish a message and continue:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;notification.show&#39;</span><span class="op">,</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;success&#39;</span><span class="op">,</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Saved successfully&#39;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="requestresponse">2. Request/Response</h4>
<p>Publish a message and wait for a response:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;api.fetch&#39;</span><span class="op">,</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/api/users&#39;</span><span class="op">,</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>A subscriber handles the request and returns data:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">respond</span>(<span class="st">&#39;api.fetch&#39;</span><span class="op">,</span> <span class="kw">async</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(data<span class="op">.</span><span class="at">url</span><span class="op">,</span> { <span class="dt">method</span><span class="op">:</span> data<span class="op">.</span><span class="at">method</span> })<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="state-broadcast">3. State Broadcast</h4>
<p>Publish state changes that multiple components need:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Theme switcher publishes</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;app.theme.change&#39;</span><span class="op">,</span> { <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;dark&#39;</span> })<span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Multiple components subscribe</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Header <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;app.theme.change&#39;</span><span class="op">,</span> ({ theme }) <span class="kw">=&gt;</span> {</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">applyTheme</span>(theme)<span class="op">;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Sidebar <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;app.theme.change&#39;</span><span class="op">,</span> ({ theme }) <span class="kw">=&gt;</span> {</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">applyTheme</span>(theme)<span class="op">;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="why-pan-bus">Why PAN Bus?</h3>
<p>The PAN bus provides several advantages:</p>
<p><strong>Loose Coupling</strong> Components don’t need references to
each other. Add or remove components without changing others.</p>
<p><strong>Testability</strong> Test components in isolation. Mock the
bus or test actual pub/sub behavior.</p>
<p><strong>Debuggability</strong> Subscribe to <code>'*'</code> to log
all messages. Visualize message flow easily.</p>
<p><strong>Scalability</strong> Add new features by subscribing to
existing topics. No need to modify existing code.</p>
<p><strong>Flexibility</strong> Mix different communication patterns
(events, requests, broadcasts) as needed.</p>
<h2 id="event-driven-architecture">Event-Driven Architecture</h2>
<p>LARC applications use event-driven architecture (EDA) at multiple
levels:</p>
<h3 id="browser-events">Browser Events</h3>
<p>Standard DOM events for user interaction:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ClickCounter <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">count</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id=&quot;btn&quot;&gt;Clicked </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">count</span><span class="sc">}</span><span class="vs"> times&lt;/button&gt;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#btn&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">count</span><span class="op">++;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#btn&#39;</span>)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Clicked </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">count</span><span class="sc">}</span><span class="vs"> times`</span><span class="op">;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="custom-events">Custom Events</h3>
<p>Components can dispatch custom events for parent components:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ColorPicker <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">selectColor</span>(color) {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Dispatch custom event</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">&#39;colorchange&#39;</span><span class="op">,</span> {</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">detail</span><span class="op">:</span> { color }<span class="op">,</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">composed</span><span class="op">:</span> <span class="kw">true</span>  <span class="co">// Cross shadow DOM boundary</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Parent can listen</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;color-picker&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;colorchange&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Selected color:&#39;</span><span class="op">,</span> e<span class="op">.</span><span class="at">detail</span><span class="op">.</span><span class="at">color</span>)<span class="op">;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="pan-bus-events">PAN Bus Events</h3>
<p>For cross-component communication:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SearchBox <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleInput</span>(value) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;search.query&#39;</span><span class="op">,</span> { <span class="dt">query</span><span class="op">:</span> value })<span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SearchResults <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;search.query&#39;</span><span class="op">,</span> ({ query }) <span class="kw">=&gt;</span> {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">search</span>(query)<span class="op">;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="when-to-use-each">When to Use Each</h3>
<p><strong>Use DOM Events when:</strong></p>
<ul>
<li>Handling user interactions (click, input, focus, etc.)</li>
<li>Communication is parent-child relationship</li>
<li>Following HTML semantics matters</li>
</ul>
<p><strong>Use Custom Events when:</strong></p>
<ul>
<li>Component needs to notify parent/ancestors</li>
<li>Event should bubble up the DOM tree</li>
<li>Mimicking native element behavior</li>
</ul>
<p><strong>Use PAN Bus when:</strong></p>
<ul>
<li>Components are not in parent-child relationship</li>
<li>Multiple unrelated components need the same data</li>
<li>Decoupling is more important than DOM semantics</li>
<li>Building cross-cutting concerns (logging, analytics, etc.)</li>
</ul>
<h2 id="state-management-philosophy">State Management Philosophy</h2>
<p>LARC takes a pragmatic approach to state management: use the simplest
solution that works, then scale up if needed.</p>
<h3 id="state-hierarchy">State Hierarchy</h3>
<p>State can exist at different levels:</p>
<h4 id="component-local-state">1. Component-Local State</h4>
<p>State that only matters to one component:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoItem <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">completed</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span>  <span class="co">// Local state</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toggle</span>() {</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">completed</span> <span class="op">=</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">completed</span><span class="op">;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">toggle</span>(<span class="st">&#39;completed&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">completed</span>)<span class="op">;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>When to use:</strong> UI state, temporary values,
component-specific configuration.</p>
<h4 id="shared-state">2. Shared State</h4>
<p>State that multiple components need:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Simple shared state object</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> appState <span class="op">=</span> {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span><span class="op">,</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">notifications</span><span class="op">:</span> []</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Components read from it</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserMenu <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(appState<span class="op">.</span><span class="at">user</span>)<span class="op">;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Components write to it and notify via PAN</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateTheme</span>(theme) {</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  appState<span class="op">.</span><span class="at">theme</span> <span class="op">=</span> theme<span class="op">;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;app.theme.change&#39;</span><span class="op">,</span> { theme })<span class="op">;</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>When to use:</strong> Application-wide settings, user data,
feature flags.</p>
<h4 id="persistent-state">3. Persistent State</h4>
<p>State that survives page reloads:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoList <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loadTodos</span>() {</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> saved <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;todos&#39;</span>)<span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> saved <span class="op">?</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(saved) <span class="op">:</span> []<span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveTodos</span>(todos) {</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;todos&#39;</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(todos))<span class="op">;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>When to use:</strong> User preferences, draft content,
offline data.</p>
<h4 id="server-state">4. Server State</h4>
<p>State that comes from and syncs with a server:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserProfile <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">loadProfile</span>() {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/profile&#39;</span>)<span class="op">;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">profile</span> <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">saveProfile</span>(updates) {</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/profile&#39;</span><span class="op">,</span> {</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;PUT&#39;</span><span class="op">,</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(updates)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>When to use:</strong> Database records, API data, real-time
updates.</p>
<h3 id="reactive-state-optional">Reactive State (Optional)</h3>
<p>For more complex state needs, LARC provides reactive patterns using
JavaScript Proxies:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createStore</span>(initialState) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listeners <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>()<span class="op">;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> state <span class="op">=</span> <span class="kw">new</span> <span class="bu">Proxy</span>(initialState<span class="op">,</span> {</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(target<span class="op">,</span> property<span class="op">,</span> value) {</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      target[property] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      listeners<span class="op">.</span><span class="fu">forEach</span>(fn <span class="kw">=&gt;</span> <span class="fu">fn</span>(property<span class="op">,</span> value))<span class="op">;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    state<span class="op">,</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subscribe</span>(fn) {</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      listeners<span class="op">.</span><span class="fu">add</span>(fn)<span class="op">;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> () <span class="kw">=&gt;</span> listeners<span class="op">.</span><span class="fu">delete</span>(fn)<span class="op">;</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> store <span class="op">=</span> <span class="fu">createStore</span>({ <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Counter <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to changes</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> store<span class="op">.</span><span class="fu">subscribe</span>((prop<span class="op">,</span> value) <span class="kw">=&gt;</span> {</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (prop <span class="op">===</span> <span class="st">&#39;count&#39;</span>) <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Count: </span><span class="sc">${</span>store<span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">count</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="co">// Update state (automatically notifies subscribers)</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">count</span><span class="op">++;</span></span></code></pre></div>
<p>This is similar to MobX or Vue’s reactivity, but built with standard
JavaScript.</p>
<h2 id="module-system">Module System</h2>
<p>LARC uses ES Modules, the native JavaScript module system.</p>
<h3 id="importexport-basics">Import/Export Basics</h3>
<p>Export from a module:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/button.js</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> PanButton <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> BUTTON_TYPES <span class="op">=</span> [<span class="st">&#39;primary&#39;</span><span class="op">,</span> <span class="st">&#39;secondary&#39;</span><span class="op">,</span> <span class="st">&#39;danger&#39;</span>]<span class="op">;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> PanButton<span class="op">;</span></span></code></pre></div>
<p>Import into another module:</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app.js</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> PanButton<span class="op">,</span> { BUTTON_TYPES } <span class="im">from</span> <span class="st">&#39;./components/button.js&#39;</span><span class="op">;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Or import everything</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> Button <span class="im">from</span> <span class="st">&#39;./components/button.js&#39;</span><span class="op">;</span></span></code></pre></div>
<h3 id="import-maps">Import Maps</h3>
<p>Import Maps let you define aliases for module paths:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="dt">&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;imports&quot;</span><span class="op">:</span> {</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;@larcjs/core&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/core@1/dist/index.js&quot;</span><span class="op">,</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;@larcjs/ui&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/ui@1/dist/index.js&quot;</span><span class="op">,</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;app/&quot;</span><span class="op">:</span> <span class="st">&quot;/src/&quot;</span><span class="op">,</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;components/&quot;</span><span class="op">:</span> <span class="st">&quot;/src/components/&quot;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="dt">&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use aliases</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> { PanButton } <span class="im">from</span> <span class="st">&#39;@larcjs/ui&#39;</span><span class="op">;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> { Header } <span class="im">from</span> <span class="st">&#39;components/header.js&#39;</span><span class="op">;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>This is similar to webpack’s resolve aliases, but it’s a browser
standard.</p>
<h3 id="module-organization">Module Organization</h3>
<p>A typical LARC project structure:</p>
<pre><code>src/
├── components/
│   ├── header.js
│   ├── footer.js
│   └── sidebar.js
├── lib/
│   ├── api.js
│   ├── auth.js
│   └── utils.js
├── pages/
│   ├── home.js
│   ├── dashboard.js
│   └── profile.js
└── app.js</code></pre>
<p>Each file is a module with clear responsibilities:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/lib/api.js</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">fetchJSON</span>(url<span class="op">,</span> options <span class="op">=</span> {}) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(url<span class="op">,</span> {</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>options<span class="op">,</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">headers</span><span class="op">:</span> {</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span><span class="op">,</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>options<span class="op">.</span><span class="at">headers</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`API error: </span><span class="sc">${</span>response<span class="op">.</span><span class="at">status</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">// src/components/user-list.js</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { fetchJSON } <span class="im">from</span> <span class="st">&#39;../lib/api.js&#39;</span><span class="op">;</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> UserList <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> users <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetchJSON</span>(<span class="st">&#39;/api/users&#39;</span>)<span class="op">;</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(users)<span class="op">;</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;user-list&#39;</span><span class="op">,</span> UserList)<span class="op">;</span></span></code></pre></div>
<h2 id="the-component-lifecycle">The Component Lifecycle</h2>
<p>Understanding the component lifecycle is essential for building
robust LARC applications.</p>
<h3 id="lifecycle-callbacks">Lifecycle Callbacks</h3>
<p>Web Components provide several lifecycle callbacks:</p>
<h4 id="constructor">constructor()</h4>
<p>Called when an instance is created:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// MUST call super() first</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize instance properties</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">count</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">data</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Attach shadow DOM if needed</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// DON&#39;T access attributes or children here</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// They might not be set yet</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Best practices:</strong></p>
<ul>
<li>Always call <code>super()</code> first</li>
<li>Initialize instance properties</li>
<li>Attach shadow DOM</li>
<li>Don’t access attributes, children, or parent elements</li>
<li>Don’t render here (use <code>connectedCallback</code> instead)</li>
</ul>
<h4 id="connectedcallback">connectedCallback()</h4>
<p>Called when the element is inserted into the DOM:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">connectedCallback</span>() {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Now it&#39;s safe to access attributes, children, parent</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;title&#39;</span>)<span class="op">;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Render initial content</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add event listeners</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleClick</span>)<span class="op">;</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Fetch data</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="fu">loadData</span>()<span class="op">;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Subscribe to PAN events</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;data.update&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleUpdate</span>)<span class="op">;</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Best practices:</strong></p>
<ul>
<li>Render initial content</li>
<li>Add event listeners</li>
<li>Subscribe to events</li>
<li>Fetch initial data</li>
<li>Can be called multiple times if element is moved</li>
</ul>
<h4 id="disconnectedcallback">disconnectedCallback()</h4>
<p>Called when the element is removed from the DOM:</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">disconnectedCallback</span>() {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Clean up event listeners</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleClick</span>)<span class="op">;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Unsubscribe from PAN events</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span>) {</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cancel pending operations</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span>) {</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span><span class="op">.</span><span class="fu">abort</span>()<span class="op">;</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Clear timers</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">timer</span>) {</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">clearInterval</span>(<span class="kw">this</span><span class="op">.</span><span class="at">timer</span>)<span class="op">;</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Best practices:</strong></p>
<ul>
<li>Remove event listeners to prevent memory leaks</li>
<li>Unsubscribe from PAN events</li>
<li>Cancel pending async operations</li>
<li>Clear timers and intervals</li>
</ul>
<h4
id="attributechangedcallbackname-oldvalue-newvalue">attributeChangedCallback(name,
oldValue, newValue)</h4>
<p>Called when observed attributes change:</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">static</span> <span class="kw">get</span> <span class="fu">observedAttributes</span>() {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;count&#39;</span><span class="op">,</span> <span class="st">&#39;active&#39;</span>]<span class="op">;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">attributeChangedCallback</span>(name<span class="op">,</span> oldValue<span class="op">,</span> newValue) {</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Called for each observed attribute that changes</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;title&#39;</span>) {</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateTitle</span>(newValue)<span class="op">;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;count&#39;</span>) {</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateCount</span>(<span class="bu">Number</span>(newValue))<span class="op">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;active&#39;</span>) {</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateActive</span>(newValue <span class="op">!==</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Best practices:</strong></p>
<ul>
<li>Only observe attributes you actually use</li>
<li>Convert string values to appropriate types</li>
<li>Handle null/undefined values</li>
<li>Update only what changed (don’t re-render everything)</li>
</ul>
<h4 id="adoptedcallback">adoptedCallback()</h4>
<p>Called when the element is moved to a new document (rare):</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adoptedCallback</span>() {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Usually not needed</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Called when element is moved between documents</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// (e.g., iframe scenarios)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="complete-lifecycle-example">Complete Lifecycle Example</h3>
<p>Here’s a full component showing proper lifecycle management:</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataTable <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Define which attributes to observe</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">static</span> <span class="kw">get</span> <span class="fu">observedAttributes</span>() {</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">&#39;url&#39;</span><span class="op">,</span> <span class="st">&#39;page-size&#39;</span>]<span class="op">;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize state</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">data</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">pageSize</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">currentPage</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initial render</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load data if URL is set</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> url <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;url&#39;</span>)<span class="op">;</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (url) {</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">loadData</span>(url)<span class="op">;</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to events</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribePan</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;table.refresh&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">refresh</span>()<span class="op">;</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set up event listeners</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;page-change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handlePageChange</span>)<span class="op">;</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clean up subscriptions</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">unsubscribePan</span>) {</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribePan</span>()<span class="op">;</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove event listeners</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">&#39;page-change&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handlePageChange</span>)<span class="op">;</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cancel pending fetch</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span>) {</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span><span class="op">.</span><span class="fu">abort</span>()<span class="op">;</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributeChangedCallback</span>(name<span class="op">,</span> oldValue<span class="op">,</span> newValue) {</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (oldValue <span class="op">===</span> newValue) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;url&#39;</span> <span class="op">&amp;&amp;</span> newValue) {</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">loadData</span>(newValue)<span class="op">;</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;page-size&#39;</span>) {</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">pageSize</span> <span class="op">=</span> <span class="bu">Number</span>(newValue) <span class="op">||</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">loadData</span>(url) {</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cancel previous fetch if any</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span>) {</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span><span class="op">.</span><span class="fu">abort</span>()<span class="op">;</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">AbortController</span>()<span class="op">;</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(url<span class="op">,</span> {</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>        <span class="dt">signal</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">fetchController</span><span class="op">.</span><span class="at">signal</span></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">data</span> <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (error<span class="op">.</span><span class="at">name</span> <span class="op">!==</span> <span class="st">&#39;AbortError&#39;</span>) {</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Failed to load data:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Render logic here</span></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a><span class="vs">        table { width: 100%; border-collapse: collapse; }</span></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a><span class="vs">        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }</span></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;table&gt;</span></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;thead&gt;</span></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Status&lt;/th&gt;&lt;/tr&gt;</span></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/thead&gt;</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;tbody&gt;</span></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a><span class="vs">          </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> <span class="vs">`</span></span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;tr&gt;</span></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>row<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>row<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a><span class="vs">              &lt;td&gt;</span><span class="sc">${</span>row<span class="op">.</span><span class="at">status</span><span class="sc">}</span><span class="vs">&lt;/td&gt;</span></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/tr&gt;</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a><span class="vs">          `</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;&#39;</span>)<span class="sc">}</span></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/tbody&gt;</span></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/table&gt;</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>  handlePageChange <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">currentPage</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">detail</span><span class="op">.</span><span class="at">page</span><span class="op">;</span></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">refresh</span>() {</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> url <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;url&#39;</span>)<span class="op">;</span></span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (url) {</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">loadData</span>(url)<span class="op">;</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;data-table&#39;</span><span class="op">,</span> DataTable)<span class="op">;</span></span></code></pre></div>
<h2 id="summary-1">Summary</h2>
<p>This chapter introduced LARC’s core concepts:</p>
<ul>
<li><strong>Web Components</strong> provide standard, reusable elements
with Custom Elements, Shadow DOM, and Templates</li>
<li><strong>The PAN Bus</strong> enables decoupled pub/sub communication
between components</li>
<li><strong>Event-Driven Architecture</strong> uses DOM events, custom
events, and PAN messages for different scenarios</li>
<li><strong>State Management</strong> starts simple (local state) and
scales to shared, persistent, and server state</li>
<li><strong>ES Modules</strong> organize code with standard
imports/exports and import maps</li>
<li><strong>Component Lifecycle</strong> provides callbacks for
creation, connection, attribute changes, and cleanup</li>
</ul>
<p>In the next chapter, we’ll put these concepts into practice by
setting up a development environment and building your first LARC
application.</p>
<hr />
<h2 id="key-takeaways">Key Takeaways</h2>
<ul>
<li>Web Components are browser standards, not framework
abstractions</li>
<li>Shadow DOM provides true style encapsulation</li>
<li>The PAN bus decouples components through pub/sub messaging</li>
<li>Use the simplest state management that works, then scale up</li>
<li>ES Modules and Import Maps replace build-time bundling</li>
<li>Proper lifecycle management prevents bugs and memory leaks</li>
<li>Components should be self-contained but composable</li>
</ul>
<h1 id="chapter-3-getting-started">Chapter 3: Getting Started</h1>
<p>Theory is important, but there’s no substitute for hands-on
experience. In this chapter, you’ll set up your development environment
and build your first LARC application. By the end, you’ll have a working
project and understand the basic development workflow.</p>
<h2 id="setting-up-your-development-environment">Setting Up Your
Development Environment</h2>
<p>One of LARC’s strengths is minimal setup requirements. You don’t need
complex tooling or configuration—just a browser, a text editor, and a
way to serve files.</p>
<h3 id="requirements">Requirements</h3>
<p><strong>Essential:</strong></p>
<ul>
<li><strong>Modern browser</strong> — Chrome, Firefox, Safari, or Edge
(latest version)</li>
<li><strong>Text editor</strong> — VS Code, Sublime Text, Atom, or any
editor you prefer</li>
<li><strong>Local web server</strong> — Python’s SimpleHTTPServer,
Node’s <code>http-server</code>, or VS Code’s Live Server extension</li>
</ul>
<p><strong>Optional but Recommended:</strong></p>
<ul>
<li><strong>VS Code</strong> with the LARC extension for snippets and
IntelliSense</li>
<li><strong>Browser DevTools</strong> familiarity for debugging</li>
<li><strong>Git</strong> for version control</li>
</ul>
<h3 id="quick-start-with-create-larc-app">Quick Start with
create-larc-app</h3>
<p>The fastest way to start is using the LARC CLI:</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install globally</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">-g</span> create-larc-app</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new project</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="ex">create-larc-app</span> my-first-app</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Start development server</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> my-first-app</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="ex">larc</span> dev</span></code></pre></div>
<p>Open <code>http://localhost:3000</code> and you’ll see your new LARC
application running.</p>
<h3 id="manual-setup-no-cli">Manual Setup (No CLI)</h3>
<p>Don’t want to install Node.js? You can set up a LARC project
manually:</p>
<p><strong>1. Create project structure:</strong></p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> my-first-app</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> my-first-app</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> src</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> src/components</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> public</span></code></pre></div>
<p><strong>2. Create <code>index.html</code>:</strong></p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;UTF-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="dt">&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>My First LARC App<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Import Map for dependencies --&gt;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="dt">&gt;</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imports&quot;</span><span class="op">:</span> {</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;@larcjs/core&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/core@1/dist/index.js&quot;</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    body {</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">font-family</span><span class="ch">:</span> <span class="dv">system-ui</span><span class="op">,</span> <span class="dv">-apple-system</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">padding</span><span class="ch">:</span> <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">background</span><span class="ch">:</span> <span class="cn">#f5f5f5</span><span class="op">;</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;app&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;src/app.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>3. Create <code>src/app.js</code>:</strong></p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Import your components</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">&#39;./components/hello-world.js&#39;</span><span class="op">;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize app</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;LARC app initialized&#39;</span>)<span class="op">;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;app.ready&#39;</span>)<span class="op">;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Add component to page</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;hello-world&gt;&lt;/hello-world&gt;&#39;</span><span class="op">;</span></span></code></pre></div>
<p><strong>4. Create
<code>src/components/hello-world.js</code>:</strong></p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HelloWorld <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div style=&quot;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: white;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 40px;</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 8px;</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="vs">        box-shadow: 0 2px 8px rgba(0,0,0,0.1);</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      &quot;&gt;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h1&gt;Hello, LARC!&lt;/h1&gt;</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;Welcome to your first LARC application.&lt;/p&gt;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;hello-world&#39;</span><span class="op">,</span> HelloWorld)<span class="op">;</span></span></code></pre></div>
<p><strong>5. Serve the files:</strong></p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python 3</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> http.server 3000</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or Python 2</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> SimpleHTTPServer 3000</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Or with Node.js</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> http-server <span class="at">-p</span> 3000</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use VS Code Live Server extension</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (right-click index.html → &quot;Open with Live Server&quot;)</span></span></code></pre></div>
<p>Open <code>http://localhost:3000</code> and you should see “Hello,
LARC!” displayed.</p>
<p><strong>That’s it.</strong> No build step. No transpilation. No
bundling. Just HTML, CSS, and JavaScript.</p>
<h3 id="development-tools">Development Tools</h3>
<h4 id="vs-code-extensions">VS Code Extensions</h4>
<p>Install these extensions for the best experience:</p>
<p><strong>LARC Extension:</strong></p>
<ul>
<li>Snippets for components and PAN patterns</li>
<li>IntelliSense for LARC APIs</li>
<li>Commands for creating components</li>
</ul>
<p>Install: Search “LARC” in VS Code extensions marketplace</p>
<p><strong>Live Server:</strong></p>
<ul>
<li>Auto-reload when files change</li>
<li>Simple local web server</li>
<li>Right-click HTML file to start</li>
</ul>
<p>Install: Search “Live Server” by Ritwick Dey</p>
<p><strong>ES6 String HTML:</strong></p>
<ul>
<li>Syntax highlighting for template literals</li>
<li>Makes component templates more readable</li>
</ul>
<p>Install: Search “ES6 String HTML”</p>
<h4 id="browser-devtools">Browser DevTools</h4>
<p>Learn these DevTools features for LARC development:</p>
<p><strong>Elements Panel:</strong></p>
<pre><code>- Inspect shadow DOM (enable &quot;Show user agent shadow DOM&quot; in settings)
- View Custom Elements with their properties
- Debug CSS in shadow roots</code></pre>
<p><strong>Console:</strong></p>
<pre><code>- Subscribe to all PAN messages: `pan.subscribe(&#39;*&#39;, console.log)`
- Test components directly: `document.querySelector(&#39;my-component&#39;)`
- Check Custom Elements registry: `customElements.get(&#39;my-component&#39;)`</code></pre>
<p><strong>Network Panel:</strong></p>
<pre><code>- Verify ES modules load correctly
- Check import map resolution
- Monitor API calls</code></pre>
<p><strong>Sources Panel:</strong></p>
<pre><code>- Set breakpoints in your source code (no source maps needed!)
- Step through component lifecycle
- Watch variables and state</code></pre>
<h2 id="your-first-larc-application">Your First LARC Application</h2>
<p>Let’s build something more interesting than “Hello World”—a simple
counter application with multiple components communicating via the PAN
bus.</p>
<h3 id="project-goal">Project Goal</h3>
<p>We’ll create:</p>
<pre><code>- A counter display component
- Increment and decrement buttons
- A reset button
- Communication via PAN bus (no prop drilling!)</code></pre>
<h3 id="step-1-update-index.html">Step 1: Update index.html</h3>
<div class="sourceCode" id="cb51"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="ot"> lang</span><span class="op">=</span><span class="st">&quot;en&quot;</span><span class="dt">&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">&quot;UTF-8&quot;</span><span class="dt">&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> name</span><span class="op">=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content</span><span class="op">=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="dt">&gt;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Counter App - LARC<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="dt">&gt;</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imports&quot;</span><span class="op">:</span> {</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;@larcjs/core&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/core@1/dist/index.js&quot;</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span> {</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">padding</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">box-sizing</span><span class="ch">:</span> <span class="dv">border-box</span><span class="op">;</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    body {</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">font-family</span><span class="ch">:</span> <span class="dv">-apple-system</span><span class="op">,</span> <span class="dv">BlinkMacSystemFont</span><span class="op">,</span> <span class="st">&#39;Segoe UI&#39;</span><span class="op">,</span> <span class="dv">Roboto</span><span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">background</span><span class="ch">:</span> <span class="fu">linear-gradient(</span><span class="dv">135</span><span class="dt">deg</span><span class="op">,</span> <span class="cn">#667eea</span> <span class="dv">0</span><span class="dt">%</span><span class="op">,</span> <span class="cn">#764ba2</span> <span class="dv">100</span><span class="dt">%</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">min-height</span><span class="ch">:</span> <span class="dv">100</span><span class="dt">vh</span><span class="op">;</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">display</span><span class="ch">:</span> <span class="dv">flex</span><span class="op">;</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>      <span class="kw">justify-content</span><span class="ch">:</span> <span class="dv">center</span><span class="op">;</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">align-items</span><span class="ch">:</span> <span class="dv">center</span><span class="op">;</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#app</span> {</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">background</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">padding</span><span class="ch">:</span> <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>      <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">16</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>      <span class="kw">box-shadow</span><span class="ch">:</span> <span class="dv">0</span> <span class="dv">20</span><span class="dt">px</span> <span class="dv">60</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.3</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>      <span class="kw">min-width</span><span class="ch">:</span> <span class="dv">400</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;app&quot;</span><span class="dt">&gt;</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">counter-display</span><span class="dt">&gt;&lt;/</span><span class="kw">counter-display</span><span class="dt">&gt;</span></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">counter-controls</span><span class="dt">&gt;&lt;/</span><span class="kw">counter-controls</span><span class="dt">&gt;</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;src/app.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="step-2-create-app.js">Step 2: Create app.js</h3>
<div class="sourceCode" id="cb52"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/app.js</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Import components</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">&#39;./components/counter-display.js&#39;</span><span class="op">;</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">&#39;./components/counter-controls.js&#39;</span><span class="op">;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize application state</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Listen for increment requests</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;counter.increment&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  count<span class="op">++;</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.updated&#39;</span><span class="op">,</span> { count })<span class="op">;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Listen for decrement requests</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;counter.decrement&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  count<span class="op">--;</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.updated&#39;</span><span class="op">,</span> { count })<span class="op">;</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Listen for reset requests</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;counter.reset&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>  count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.updated&#39;</span><span class="op">,</span> { count })<span class="op">;</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Publish initial state</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.updated&#39;</span><span class="op">,</span> { count })<span class="op">;</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Counter app initialized&#39;</span>)<span class="op">;</span></span></code></pre></div>
<h3 id="step-3-create-counter-display.js">Step 3: Create
counter-display.js</h3>
<div class="sourceCode" id="cb53"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/components/counter-display.js</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CounterDisplay <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">count</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to count updates</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;counter.updated&#39;</span><span class="op">,</span> ({ count }) <span class="kw">=&gt;</span> {</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">count</span> <span class="op">=</span> count<span class="op">;</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a><span class="vs">        :host {</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="vs">          text-align: center;</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a><span class="vs">          margin-bottom: 30px;</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a><span class="vs">        .display {</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 72px;</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-weight: bold;</span></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: #667eea;</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a><span class="vs">          margin-bottom: 10px;</span></span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-variant-numeric: tabular-nums;</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a><span class="vs">        .label {</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 18px;</span></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: #666;</span></span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a><span class="vs">          text-transform: uppercase;</span></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a><span class="vs">          letter-spacing: 2px;</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;display&quot;&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">count</span><span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;label&quot;&gt;Current Count&lt;/div&gt;</span></span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;counter-display&#39;</span><span class="op">,</span> CounterDisplay)<span class="op">;</span></span></code></pre></div>
<h3 id="step-4-create-counter-controls.js">Step 4: Create
counter-controls.js</h3>
<div class="sourceCode" id="cb54"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/components/counter-controls.js</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CounterControls <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachEventListeners</span>()<span class="op">;</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attachEventListeners</span>() {</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#increment&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.increment&#39;</span>)<span class="op">;</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#decrement&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.decrement&#39;</span>)<span class="op">;</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#reset&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.reset&#39;</span>)<span class="op">;</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="vs">        :host {</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a><span class="vs">        .controls {</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: flex;</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="vs">          gap: 10px;</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="vs">          margin-bottom: 15px;</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a><span class="vs">        button {</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="vs">          flex: 1;</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 15px;</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 16px;</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-weight: 600;</span></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: none;</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 8px;</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="vs">          cursor: pointer;</span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="vs">          transition: all 0.2s;</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a><span class="vs">        button:hover {</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a><span class="vs">          transform: translateY(-2px);</span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a><span class="vs">          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);</span></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a><span class="vs">        button:active {</span></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a><span class="vs">          transform: translateY(0);</span></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a><span class="vs">        #increment {</span></span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #48bb78;</span></span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: white;</span></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a><span class="vs">        #increment:hover {</span></span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #38a169;</span></span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a><span class="vs">        #decrement {</span></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #f56565;</span></span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: white;</span></span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a><span class="vs">        #decrement:hover {</span></span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #e53e3e;</span></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a><span class="vs">        #reset {</span></span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #4a5568;</span></span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: white;</span></span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a><span class="vs">          width: 100%;</span></span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a><span class="vs">        #reset:hover {</span></span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #2d3748;</span></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;controls&quot;&gt;</span></span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button id=&quot;decrement&quot;&gt;− Decrement&lt;/button&gt;</span></span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button id=&quot;increment&quot;&gt;+ Increment&lt;/button&gt;</span></span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button id=&quot;reset&quot;&gt;Reset&lt;/button&gt;</span></span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;counter-controls&#39;</span><span class="op">,</span> CounterControls)<span class="op">;</span></span></code></pre></div>
<h3 id="step-5-test-your-app">Step 5: Test Your App</h3>
<p>Start your local server and open the page. You should see:</p>
<pre><code>- A large counter display showing &quot;0&quot;
- Increment and decrement buttons
- A reset button</code></pre>
<p>Click the buttons. Notice how:</p>
<pre><code>- Components update immediately
- State is managed centrally in `app.js`
- Components don&#39;t reference each other directly
- Adding new components is trivial (just subscribe to `counter.updated`)</code></pre>
<h3 id="what-just-happened">What Just Happened?</h3>
<p>Let’s examine the architecture:</p>
<p><strong>Data Flow:</strong></p>
<pre><code>User clicks button
     ↓
Controls component publishes event
     ↓
App.js receives event and updates state
     ↓
App.js publishes updated state
     ↓
Display component receives update and re-renders</code></pre>
<p><strong>Key Points:</strong></p>
<ol type="1">
<li><strong>Decoupled Components:</strong> Display and controls don’t
know about each other</li>
<li><strong>Central State:</strong> State lives in <code>app.js</code>,
not in components</li>
<li><strong>Pub/Sub Communication:</strong> All communication via PAN
bus topics</li>
<li><strong>No Props:</strong> No prop drilling or lifting state up</li>
<li><strong>Easy Testing:</strong> Each component can be tested in
isolation</li>
</ol>
<h2 id="project-structure">Project Structure</h2>
<p>As your application grows, organization becomes important. Here’s a
recommended structure:</p>
<pre><code>my-app/
├── index.html              # Entry point
├── larc.config.json        # Optional config
├── src/
│   ├── app.js              # Main application logic
│   ├── components/         # Reusable components
│   │   ├── ui/             # Generic UI components
│   │   │   ├── button.js
│   │   │   ├── card.js
│   │   │   └── modal.js
│   │   ├── features/       # Feature-specific components
│   │   │   ├── user-profile.js
│   │   │   ├── todo-list.js
│   │   │   └── dashboard.js
│   │   └── layout/         # Layout components
│   │       ├── header.js
│   │       ├── sidebar.js
│   │       └── footer.js
│   ├── lib/                # Utilities and helpers
│   │   ├── api.js          # API client
│   │   ├── auth.js         # Authentication
│   │   ├── router.js       # Routing logic
│   │   └── utils.js        # General utilities
│   ├── pages/              # Page-level components
│   │   ├── home.js
│   │   ├── dashboard.js
│   │   └── settings.js
│   └── styles/             # Global styles
│       ├── reset.css
│       ├── variables.css
│       └── utilities.css
├── public/                 # Static assets
│   ├── images/
│   ├── fonts/
│   └── icons/
└── tests/                  # Test files
    ├── components/
    └── integration/</code></pre>
<h3 id="file-organization-principles">File Organization Principles</h3>
<p><strong>Components:</strong></p>
<pre><code>- One component per file
- File name matches component name: `user-profile.js` defines `&lt;user-profile&gt;`
- Keep related components together in subdirectories</code></pre>
<p><strong>Lib:</strong></p>
<pre><code>- Utilities that don&#39;t render UI
- API clients, helpers, formatters
- Pure functions when possible</code></pre>
<p><strong>Pages:</strong></p>
<pre><code>- Top-level route components
- Compose smaller components
- Handle page-specific logic</code></pre>
<p><strong>Styles:</strong></p>
<pre><code>- Global styles in `styles/`
- Component-specific styles in Shadow DOM
- CSS custom properties for theming</code></pre>
<h2 id="import-maps-explained">Import Maps Explained</h2>
<p>Import Maps are a browser standard that replaces the need for
bundlers to resolve module paths.</p>
<h3 id="basic-import-map">Basic Import Map</h3>
<div class="sourceCode" id="cb63"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="dt">&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;imports&quot;</span><span class="op">:</span> {</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;lodash&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/lodash-es@4/lodash.js&quot;</span><span class="op">,</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dayjs&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js&quot;</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="dt">&gt;</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use package names instead of URLs</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> _ <span class="im">from</span> <span class="st">&#39;lodash&#39;</span><span class="op">;</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> dayjs <span class="im">from</span> <span class="st">&#39;dayjs&#39;</span><span class="op">;</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="fu">dayjs</span>()<span class="op">.</span><span class="fu">format</span>(<span class="st">&#39;YYYY-MM-DD&#39;</span>))<span class="op">;</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="path-aliases">Path Aliases</h3>
<p>Create shortcuts for your own modules:</p>
<div class="sourceCode" id="cb64"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="dt">&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;imports&quot;</span><span class="op">:</span> {</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;@/&quot;</span><span class="op">:</span> <span class="st">&quot;/src/&quot;</span><span class="op">,</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;components/&quot;</span><span class="op">:</span> <span class="st">&quot;/src/components/&quot;</span><span class="op">,</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;lib/&quot;</span><span class="op">:</span> <span class="st">&quot;/src/lib/&quot;</span><span class="op">,</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;@larcjs/core&quot;</span><span class="op">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/core@1/dist/index.js&quot;</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="dt">&gt;</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Instead of: import { api } from &#39;../../../lib/api.js&#39;;</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> { api } <span class="im">from</span> <span class="st">&#39;lib/api.js&#39;</span><span class="op">;</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Instead of: import Button from &#39;../components/ui/button.js&#39;;</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> Button <span class="im">from</span> <span class="st">&#39;components/ui/button.js&#39;</span><span class="op">;</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Instead of: import something from &#39;../../../src/utils.js&#39;;</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> something <span class="im">from</span> <span class="st">&#39;@/utils.js&#39;</span><span class="op">;</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="version-management">Version Management</h3>
<p>Pin dependencies to specific versions:</p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;imports&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@larcjs/core&quot;</span><span class="fu">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/core@1.2.3/dist/index.js&quot;</span><span class="fu">,</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@larcjs/ui&quot;</span><span class="fu">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/ui@2.0.1/dist/index.js&quot;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Or use version ranges for automatic updates:</p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;imports&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@larcjs/core&quot;</span><span class="fu">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/core@1/dist/index.js&quot;</span><span class="fu">,</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@larcjs/ui&quot;</span><span class="fu">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/ui@2/dist/index.js&quot;</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="multiple-cdns">Multiple CDNs</h3>
<p>Add fallbacks for reliability:</p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;imports&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;react&quot;</span><span class="fu">:</span> <span class="st">&quot;https://esm.sh/react@18&quot;</span><span class="fu">,</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;react-fallback&quot;</span><span class="fu">:</span> <span class="st">&quot;https://cdn.skypack.dev/react@18&quot;</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Then in code:</p>
<div class="sourceCode" id="cb68"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> React<span class="op">;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  React <span class="op">=</span> <span class="cf">await</span> <span class="im">import</span>(<span class="st">&#39;react&#39;</span>)<span class="op">;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> {</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  React <span class="op">=</span> <span class="cf">await</span> <span class="im">import</span>(<span class="st">&#39;react-fallback&#39;</span>)<span class="op">;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="development-vs-production">Development vs Production</h3>
<p>Use different import maps for different environments:</p>
<p><strong>development.importmap.json:</strong></p>
<div class="sourceCode" id="cb69"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;imports&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@larcjs/core&quot;</span><span class="fu">:</span> <span class="st">&quot;/node_modules/@larcjs/core/dist/index.js&quot;</span><span class="fu">,</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;app/&quot;</span><span class="fu">:</span> <span class="st">&quot;/src/&quot;</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>production.importmap.json:</strong></p>
<div class="sourceCode" id="cb70"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;imports&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@larcjs/core&quot;</span><span class="fu">:</span> <span class="st">&quot;https://cdn.jsdelivr.net/npm/@larcjs/core@1.2.3/dist/index.js&quot;</span><span class="fu">,</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;app/&quot;</span><span class="fu">:</span> <span class="st">&quot;/assets/js/&quot;</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Load the appropriate map:</p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;/config/production.importmap.json&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="development-workflow">Development Workflow</h2>
<h3 id="daily-development">Daily Development</h3>
<p>A typical development session:</p>
<p><strong>1. Start dev server:</strong></p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ex">larc</span> dev</span></code></pre></div>
<p>This starts a local server with hot reload.</p>
<p><strong>2. Edit files:</strong> Open your editor and make changes.
The browser automatically reloads when you save.</p>
<p><strong>3. Check the console:</strong> Open browser DevTools and
check for errors or warnings.</p>
<p><strong>4. Test in browser:</strong> Interact with your app, verify
behavior, check responsive design.</p>
<p><strong>5. Debug as needed:</strong> Set breakpoints, inspect
elements, monitor network requests.</p>
<p><strong>6. Repeat:</strong> The edit-refresh cycle is instant with no
build step.</p>
<h3 id="debugging-tips">Debugging Tips</h3>
<p><strong>Log all PAN messages:</strong></p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`[PAN] </span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:`</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Inspect custom elements:</strong></p>
<div class="sourceCode" id="cb74"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Get element</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> el <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;my-component&#39;</span>)<span class="op">;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Check if defined</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(customElements<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;my-component&#39;</span>))<span class="op">;</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Access shadow root</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(el<span class="op">.</span><span class="at">shadowRoot</span>)<span class="op">;</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Call methods directly</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>el<span class="op">.</span><span class="fu">someMethod</span>()<span class="op">;</span></span></code></pre></div>
<p><strong>Monitor attribute changes:</strong></p>
<div class="sourceCode" id="cb75"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create observer</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="bu">MutationObserver</span>((mutations) <span class="kw">=&gt;</span> {</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  mutations<span class="op">.</span><span class="fu">forEach</span>(mutation <span class="kw">=&gt;</span> {</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Attribute changed:&#39;</span><span class="op">,</span> mutation<span class="op">.</span><span class="at">attributeName</span>)<span class="op">;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Watch element</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>observer<span class="op">.</span><span class="fu">observe</span>(element<span class="op">,</span> { <span class="dt">attributes</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span></code></pre></div>
<h3 id="testing">Testing</h3>
<p>Run tests without a build step:</p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- tests/counter.test.html --&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE</span> html<span class="dt">&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>Counter Tests<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;importmap&quot;</span><span class="dt">&gt;</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;imports&quot;</span><span class="op">:</span> {</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;@larcjs/core&quot;</span><span class="op">:</span> <span class="st">&quot;../node_modules/@larcjs/core/dist/index.js&quot;</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;test-container&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="dt">&gt;</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> <span class="st">&#39;../src/components/counter-display.js&#39;</span><span class="op">;</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Simple test framework</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">test</span>(name<span class="op">,</span> fn) {</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span> {</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fn</span>()<span class="op">;</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`✓ </span><span class="sc">${</span>name<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">catch</span> (error) {</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="vs">`✗ </span><span class="sc">${</span>name<span class="sc">}</span><span class="vs">:`</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">assert</span>(condition<span class="op">,</span> message) {</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>condition) <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(message <span class="op">||</span> <span class="st">&#39;Assertion failed&#39;</span>)<span class="op">;</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tests</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test</span>(<span class="st">&#39;counter-display renders initial count&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> el <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;counter-display&#39;</span>)<span class="op">;</span></span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>      <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;test-container&#39;</span>)<span class="op">.</span><span class="fu">appendChild</span>(el)<span class="op">;</span></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> display <span class="op">=</span> el<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.display&#39;</span>)<span class="op">;</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">assert</span>(display<span class="op">.</span><span class="at">textContent</span> <span class="op">===</span> <span class="st">&#39;0&#39;</span><span class="op">,</span> <span class="st">&#39;Initial count should be 0&#39;</span>)<span class="op">;</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>      el<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test</span>(<span class="st">&#39;counter-display updates on PAN message&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> el <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;counter-display&#39;</span>)<span class="op">;</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>      <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;test-container&#39;</span>)<span class="op">.</span><span class="fu">appendChild</span>(el)<span class="op">;</span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Wait for component to connect</span></span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> <span class="pp">setTimeout</span>(resolve<span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Publish update</span></span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.updated&#39;</span><span class="op">,</span> { <span class="dt">count</span><span class="op">:</span> <span class="dv">42</span> })<span class="op">;</span></span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Wait for render</span></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> <span class="pp">setTimeout</span>(resolve<span class="op">,</span> <span class="dv">10</span>))<span class="op">;</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> display <span class="op">=</span> el<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.display&#39;</span>)<span class="op">;</span></span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">assert</span>(display<span class="op">.</span><span class="at">textContent</span> <span class="op">===</span> <span class="st">&#39;42&#39;</span><span class="op">,</span> <span class="st">&#39;Count should update to 42&#39;</span>)<span class="op">;</span></span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true" tabindex="-1"></a>      el<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;All tests complete&#39;</span>)<span class="op">;</span></span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Open <code>tests/counter.test.html</code> in your browser to run
tests.</p>
<h2 id="common-patterns">Common Patterns</h2>
<h3 id="pattern-1-loading-states">Pattern 1: Loading States</h3>
<div class="sourceCode" id="cb77"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>({ <span class="dt">loading</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetchData</span>()<span class="op">;</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>({ data })<span class="op">;</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>({ <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>(state) {</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (state<span class="op">.</span><span class="at">loading</span>) {</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;loading-spinner&gt;&lt;/loading-spinner&gt;&#39;</span><span class="op">;</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (state<span class="op">.</span><span class="at">error</span>) {</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;error-message&gt;</span><span class="sc">${</span>state<span class="op">.</span><span class="at">error</span><span class="sc">}</span><span class="vs">&lt;/error-message&gt;`</span><span class="op">;</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;data-display .data=&quot;</span><span class="sc">${</span>state<span class="op">.</span><span class="at">data</span><span class="sc">}</span><span class="vs">&quot;&gt;&lt;/data-display&gt;`</span><span class="op">;</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="pattern-2-form-handling">Pattern 2: Form Handling</h3>
<div class="sourceCode" id="cb78"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LoginForm <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;form&gt;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type=&quot;email&quot; name=&quot;email&quot; required&gt;</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type=&quot;password&quot; name=&quot;password&quot; required&gt;</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button type=&quot;submit&quot;&gt;Login&lt;/button&gt;</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/form&gt;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">async</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>      e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> formData <span class="op">=</span> <span class="kw">new</span> <span class="bu">FormData</span>(e<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(formData)<span class="op">;</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;auth.login&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="pattern-3-conditional-rendering">Pattern 3: Conditional
Rendering</h3>
<div class="sourceCode" id="cb79"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserMenu <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">user</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;auth.user.changed&#39;</span><span class="op">,</span> ({ user }) <span class="kw">=&gt;</span> {</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">user</span> <span class="op">=</span> user<span class="op">;</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">user</span>) {</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;logged-in&quot;&gt;</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;span&gt;Hello, </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;button id=&quot;logout&quot;&gt;Logout&lt;/button&gt;</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#logout&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;auth.logout&#39;</span>)<span class="op">;</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button id=&quot;login&quot;&gt;Login&lt;/button&gt;</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#login&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;app.navigate&#39;</span><span class="op">,</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/login&#39;</span> })<span class="op">;</span></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="pattern-4-lists-and-iteration">Pattern 4: Lists and
Iteration</h3>
<div class="sourceCode" id="cb80"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoList <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;todos.updated&#39;</span><span class="op">,</span> ({ todos }) <span class="kw">=&gt;</span> {</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> todos<span class="op">;</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;ul&gt;</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">map</span>(todo <span class="kw">=&gt;</span> <span class="vs">`</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;li&gt;</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;input type=&quot;checkbox&quot;</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="vs">                   </span><span class="sc">${</span>todo<span class="op">.</span><span class="at">completed</span> <span class="op">?</span> <span class="st">&#39;checked&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span><span class="sc">}</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="vs">                   data-id=&quot;</span><span class="sc">${</span>todo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span class=&quot;</span><span class="sc">${</span>todo<span class="op">.</span><span class="at">completed</span> <span class="op">?</span> <span class="st">&#39;completed&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="vs">              </span><span class="sc">${</span>todo<span class="op">.</span><span class="at">text</span><span class="sc">}</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;/span&gt;</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/li&gt;</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;&#39;</span>)<span class="sc">}</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/ul&gt;</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Attach event listeners after rendering</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;input[type=&quot;checkbox&quot;]&#39;</span>)<span class="op">.</span><span class="fu">forEach</span>(checkbox <span class="kw">=&gt;</span> {</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>      checkbox<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> id <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">dataset</span><span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;todos.toggle&#39;</span><span class="op">,</span> { id })<span class="op">;</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="summary-2">Summary</h2>
<p>In this chapter, you:</p>
<pre><code>- Set up a LARC development environment (CLI or manual)
- Built your first multi-component application
- Learned project structure best practices
- Mastered Import Maps for dependency management
- Established an efficient development workflow
- Explored common component patterns</code></pre>
<p>You now have a solid foundation for building LARC applications. The
next chapter dives deeper into creating sophisticated Web Components
with proper lifecycle management, styling, and interactivity.</p>
<hr />
<h2 id="exercises">Exercises</h2>
<p><strong>1. Enhance the Counter App:</strong></p>
<pre><code>- Add a history component that shows past values
- Add increment/decrement by custom amounts
- Persist count to localStorage</code></pre>
<p><strong>2. Build a Todo List:</strong></p>
<pre><code>- Add/remove todos
- Mark as complete/incomplete
- Filter by status (all/active/completed)
- Use PAN bus for state management</code></pre>
<p><strong>3. Create a Theme Switcher:</strong></p>
<pre><code>- Light/dark theme toggle
- Publish theme changes via PAN
- Multiple components respond to theme changes
- Persist theme preference</code></pre>
<p><strong>4. Experiment with Import Maps:</strong></p>
<pre><code>- Try different CDNs (jsDelivr, unpkg, esm.sh)
- Add path aliases for your components
- Import an external library (lodash, dayjs, etc.)</code></pre>
<p>Take your time with these exercises. Understanding these patterns now
will make the rest of the book much easier.</p>
<h1 id="chapter-4-creating-web-components">Chapter 4: Creating Web
Components</h1>
<p>Now that you’ve built your first LARC application, it’s time to
master the art of creating robust, reusable Web Components. This chapter
covers everything from basic component anatomy to advanced patterns like
composition, slots, and performance optimization.</p>
<p>By the end of this chapter, you’ll be able to build
production-quality components that are maintainable, testable, and
performant.</p>
<h2 id="anatomy-of-a-larc-component">Anatomy of a LARC Component</h2>
<p>Let’s dissect a well-structured LARC component to understand its
parts:</p>
<div class="sourceCode" id="cb86"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Import dependencies</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { formatDate } <span class="im">from</span> <span class="st">&#39;../lib/utils.js&#39;</span><span class="op">;</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * A card component for displaying user information.</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@element</span><span class="co"> user-card</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@attr</span><span class="co"> {string} user-id - The ID of the user to display</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@attr</span><span class="co"> {boolean} compact - Display in compact mode</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@fires</span><span class="co"> user-selected - Dispatched when card is clicked</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@slot</span><span class="co"> - Default slot for additional content</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@slot</span><span class="co"> actions - Slot for action buttons</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. Define observed attributes</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">static</span> <span class="kw">get</span> <span class="fu">observedAttributes</span>() {</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">&#39;user-id&#39;</span><span class="op">,</span> <span class="st">&#39;compact&#39;</span>]<span class="op">;</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. Constructor - initialize instance</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Attach shadow DOM</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize private state</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_user</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_error</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bind event handlers</span></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">handleClick</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleClick</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. Lifecycle: connected to DOM</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load user data if ID is provided</span></span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> userId <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;user-id&#39;</span>)<span class="op">;</span></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (userId) {</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">loadUser</span>(userId)<span class="op">;</span></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to PAN events</span></span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.updated&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleUserUpdate</span>)<span class="op">;</span></span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add event listeners</span></span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleClick</span>)<span class="op">;</span></span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. Lifecycle: disconnected from DOM</span></span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clean up subscriptions</span></span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span>) {</span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove event listeners</span></span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleClick</span>)<span class="op">;</span></span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-68"><a href="#cb86-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. Lifecycle: attributes changed</span></span>
<span id="cb86-69"><a href="#cb86-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributeChangedCallback</span>(name<span class="op">,</span> oldValue<span class="op">,</span> newValue) {</span>
<span id="cb86-70"><a href="#cb86-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (oldValue <span class="op">===</span> newValue) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb86-71"><a href="#cb86-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-72"><a href="#cb86-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;user-id&#39;</span> <span class="op">&amp;&amp;</span> newValue) {</span>
<span id="cb86-73"><a href="#cb86-73" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">loadUser</span>(newValue)<span class="op">;</span></span>
<span id="cb86-74"><a href="#cb86-74" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;compact&#39;</span>) {</span>
<span id="cb86-75"><a href="#cb86-75" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb86-76"><a href="#cb86-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-77"><a href="#cb86-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-78"><a href="#cb86-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-79"><a href="#cb86-79" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 6. Public properties with getters/setters</span></span>
<span id="cb86-80"><a href="#cb86-80" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">user</span>() {</span>
<span id="cb86-81"><a href="#cb86-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">;</span></span>
<span id="cb86-82"><a href="#cb86-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-83"><a href="#cb86-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-84"><a href="#cb86-84" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">user</span>(value) {</span>
<span id="cb86-85"><a href="#cb86-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_user</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb86-86"><a href="#cb86-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb86-87"><a href="#cb86-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-88"><a href="#cb86-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-89"><a href="#cb86-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">loading</span>() {</span>
<span id="cb86-90"><a href="#cb86-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span><span class="op">;</span></span>
<span id="cb86-91"><a href="#cb86-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-92"><a href="#cb86-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-93"><a href="#cb86-93" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 7. Public methods</span></span>
<span id="cb86-94"><a href="#cb86-94" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">loadUser</span>(userId) {</span>
<span id="cb86-95"><a href="#cb86-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb86-96"><a href="#cb86-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_error</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb86-97"><a href="#cb86-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb86-98"><a href="#cb86-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-99"><a href="#cb86-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb86-100"><a href="#cb86-100" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/users/</span><span class="sc">${</span>userId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb86-101"><a href="#cb86-101" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Failed to load user&#39;</span>)<span class="op">;</span></span>
<span id="cb86-102"><a href="#cb86-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-103"><a href="#cb86-103" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_user</span> <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb86-104"><a href="#cb86-104" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb86-105"><a href="#cb86-105" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb86-106"><a href="#cb86-106" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb86-107"><a href="#cb86-107" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_error</span> <span class="op">=</span> error<span class="op">.</span><span class="at">message</span><span class="op">;</span></span>
<span id="cb86-108"><a href="#cb86-108" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb86-109"><a href="#cb86-109" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb86-110"><a href="#cb86-110" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-111"><a href="#cb86-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-112"><a href="#cb86-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-113"><a href="#cb86-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">refresh</span>() {</span>
<span id="cb86-114"><a href="#cb86-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> userId <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;user-id&#39;</span>)<span class="op">;</span></span>
<span id="cb86-115"><a href="#cb86-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (userId) {</span>
<span id="cb86-116"><a href="#cb86-116" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">loadUser</span>(userId)<span class="op">;</span></span>
<span id="cb86-117"><a href="#cb86-117" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-118"><a href="#cb86-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-119"><a href="#cb86-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-120"><a href="#cb86-120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 8. Private methods</span></span>
<span id="cb86-121"><a href="#cb86-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleClick</span>(<span class="bu">event</span>) {</span>
<span id="cb86-122"><a href="#cb86-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb86-123"><a href="#cb86-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-124"><a href="#cb86-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">&#39;user-selected&#39;</span><span class="op">,</span> {</span>
<span id="cb86-125"><a href="#cb86-125" aria-hidden="true" tabindex="-1"></a>      <span class="dt">detail</span><span class="op">:</span> { <span class="dt">user</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">_user</span> }<span class="op">,</span></span>
<span id="cb86-126"><a href="#cb86-126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb86-127"><a href="#cb86-127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">composed</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb86-128"><a href="#cb86-128" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb86-129"><a href="#cb86-129" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-130"><a href="#cb86-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-131"><a href="#cb86-131" aria-hidden="true" tabindex="-1"></a>  handleUserUpdate <span class="op">=</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb86-132"><a href="#cb86-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">userId</span> <span class="op">===</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;user-id&#39;</span>)) {</span>
<span id="cb86-133"><a href="#cb86-133" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_user</span> <span class="op">=</span> data<span class="op">.</span><span class="at">user</span><span class="op">;</span></span>
<span id="cb86-134"><a href="#cb86-134" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb86-135"><a href="#cb86-135" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-136"><a href="#cb86-136" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-137"><a href="#cb86-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-138"><a href="#cb86-138" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 9. Render method</span></span>
<span id="cb86-139"><a href="#cb86-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb86-140"><a href="#cb86-140" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> compact <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">hasAttribute</span>(<span class="st">&#39;compact&#39;</span>)<span class="op">;</span></span>
<span id="cb86-141"><a href="#cb86-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-142"><a href="#cb86-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_loading</span>) {</span>
<span id="cb86-143"><a href="#cb86-143" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderLoading</span>()<span class="op">;</span></span>
<span id="cb86-144"><a href="#cb86-144" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb86-145"><a href="#cb86-145" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-146"><a href="#cb86-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-147"><a href="#cb86-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_error</span>) {</span>
<span id="cb86-148"><a href="#cb86-148" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderError</span>()<span class="op">;</span></span>
<span id="cb86-149"><a href="#cb86-149" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb86-150"><a href="#cb86-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-151"><a href="#cb86-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-152"><a href="#cb86-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span>) {</span>
<span id="cb86-153"><a href="#cb86-153" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderEmpty</span>()<span class="op">;</span></span>
<span id="cb86-154"><a href="#cb86-154" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb86-155"><a href="#cb86-155" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-156"><a href="#cb86-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-157"><a href="#cb86-157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> compact</span>
<span id="cb86-158"><a href="#cb86-158" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderCompact</span>()</span>
<span id="cb86-159"><a href="#cb86-159" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderFull</span>()<span class="op">;</span></span>
<span id="cb86-160"><a href="#cb86-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-161"><a href="#cb86-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-162"><a href="#cb86-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderLoading</span>() {</span>
<span id="cb86-163"><a href="#cb86-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb86-164"><a href="#cb86-164" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">styles</span>()<span class="sc">}</span><span class="vs">&lt;/style&gt;</span></span>
<span id="cb86-165"><a href="#cb86-165" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card loading&quot;&gt;</span></span>
<span id="cb86-166"><a href="#cb86-166" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;spinner&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb86-167"><a href="#cb86-167" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;Loading...&lt;/p&gt;</span></span>
<span id="cb86-168"><a href="#cb86-168" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb86-169"><a href="#cb86-169" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb86-170"><a href="#cb86-170" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-171"><a href="#cb86-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-172"><a href="#cb86-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderError</span>() {</span>
<span id="cb86-173"><a href="#cb86-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb86-174"><a href="#cb86-174" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">styles</span>()<span class="sc">}</span><span class="vs">&lt;/style&gt;</span></span>
<span id="cb86-175"><a href="#cb86-175" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card error&quot;&gt;</span></span>
<span id="cb86-176"><a href="#cb86-176" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p class=&quot;error-message&quot;&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_error</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb86-177"><a href="#cb86-177" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button class=&quot;retry&quot;&gt;Retry&lt;/button&gt;</span></span>
<span id="cb86-178"><a href="#cb86-178" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb86-179"><a href="#cb86-179" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb86-180"><a href="#cb86-180" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-181"><a href="#cb86-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-182"><a href="#cb86-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderEmpty</span>() {</span>
<span id="cb86-183"><a href="#cb86-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb86-184"><a href="#cb86-184" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">styles</span>()<span class="sc">}</span><span class="vs">&lt;/style&gt;</span></span>
<span id="cb86-185"><a href="#cb86-185" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card empty&quot;&gt;</span></span>
<span id="cb86-186"><a href="#cb86-186" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;No user data&lt;/p&gt;</span></span>
<span id="cb86-187"><a href="#cb86-187" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb86-188"><a href="#cb86-188" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb86-189"><a href="#cb86-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-190"><a href="#cb86-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-191"><a href="#cb86-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderCompact</span>() {</span>
<span id="cb86-192"><a href="#cb86-192" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb86-193"><a href="#cb86-193" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">styles</span>()<span class="sc">}</span><span class="vs">&lt;/style&gt;</span></span>
<span id="cb86-194"><a href="#cb86-194" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card compact&quot;&gt;</span></span>
<span id="cb86-195"><a href="#cb86-195" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;img src=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">avatar</span><span class="sc">}</span><span class="vs">&quot; alt=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb86-196"><a href="#cb86-196" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;info&quot;&gt;</span></span>
<span id="cb86-197"><a href="#cb86-197" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;h3&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;</span></span>
<span id="cb86-198"><a href="#cb86-198" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot name=&quot;actions&quot;&gt;&lt;/slot&gt;</span></span>
<span id="cb86-199"><a href="#cb86-199" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb86-200"><a href="#cb86-200" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb86-201"><a href="#cb86-201" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb86-202"><a href="#cb86-202" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-203"><a href="#cb86-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-204"><a href="#cb86-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderFull</span>() {</span>
<span id="cb86-205"><a href="#cb86-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb86-206"><a href="#cb86-206" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">styles</span>()<span class="sc">}</span><span class="vs">&lt;/style&gt;</span></span>
<span id="cb86-207"><a href="#cb86-207" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card&quot;&gt;</span></span>
<span id="cb86-208"><a href="#cb86-208" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb86-209"><a href="#cb86-209" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;img src=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">avatar</span><span class="sc">}</span><span class="vs">&quot; alt=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&quot; class=&quot;avatar&quot;&gt;</span></span>
<span id="cb86-210"><a href="#cb86-210" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;header-content&quot;&gt;</span></span>
<span id="cb86-211"><a href="#cb86-211" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;h2&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h2&gt;</span></span>
<span id="cb86-212"><a href="#cb86-212" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;p class=&quot;email&quot;&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">email</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb86-213"><a href="#cb86-213" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb86-214"><a href="#cb86-214" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb86-215"><a href="#cb86-215" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;body&quot;&gt;</span></span>
<span id="cb86-216"><a href="#cb86-216" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;p class=&quot;bio&quot;&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">bio</span> <span class="op">||</span> <span class="st">&#39;No bio available&#39;</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb86-217"><a href="#cb86-217" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;meta&quot;&gt;</span></span>
<span id="cb86-218"><a href="#cb86-218" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span&gt;Joined </span><span class="sc">${</span><span class="fu">formatDate</span>(<span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">createdAt</span>)<span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb86-219"><a href="#cb86-219" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb86-220"><a href="#cb86-220" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb86-221"><a href="#cb86-221" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb86-222"><a href="#cb86-222" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;footer&quot;&gt;</span></span>
<span id="cb86-223"><a href="#cb86-223" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot name=&quot;actions&quot;&gt;&lt;/slot&gt;</span></span>
<span id="cb86-224"><a href="#cb86-224" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb86-225"><a href="#cb86-225" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb86-226"><a href="#cb86-226" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb86-227"><a href="#cb86-227" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-228"><a href="#cb86-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-229"><a href="#cb86-229" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 10. Styles</span></span>
<span id="cb86-230"><a href="#cb86-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">styles</span>() {</span>
<span id="cb86-231"><a href="#cb86-231" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb86-232"><a href="#cb86-232" aria-hidden="true" tabindex="-1"></a><span class="vs">      :host {</span></span>
<span id="cb86-233"><a href="#cb86-233" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: block;</span></span>
<span id="cb86-234"><a href="#cb86-234" aria-hidden="true" tabindex="-1"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb86-235"><a href="#cb86-235" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-236"><a href="#cb86-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-237"><a href="#cb86-237" aria-hidden="true" tabindex="-1"></a><span class="vs">      .card {</span></span>
<span id="cb86-238"><a href="#cb86-238" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: white;</span></span>
<span id="cb86-239"><a href="#cb86-239" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 8px;</span></span>
<span id="cb86-240"><a href="#cb86-240" aria-hidden="true" tabindex="-1"></a><span class="vs">        box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span></span>
<span id="cb86-241"><a href="#cb86-241" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 16px;</span></span>
<span id="cb86-242"><a href="#cb86-242" aria-hidden="true" tabindex="-1"></a><span class="vs">        transition: box-shadow 0.2s;</span></span>
<span id="cb86-243"><a href="#cb86-243" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-244"><a href="#cb86-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-245"><a href="#cb86-245" aria-hidden="true" tabindex="-1"></a><span class="vs">      .card:hover {</span></span>
<span id="cb86-246"><a href="#cb86-246" aria-hidden="true" tabindex="-1"></a><span class="vs">        box-shadow: 0 4px 12px rgba(0,0,0,0.15);</span></span>
<span id="cb86-247"><a href="#cb86-247" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-248"><a href="#cb86-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-249"><a href="#cb86-249" aria-hidden="true" tabindex="-1"></a><span class="vs">      .header {</span></span>
<span id="cb86-250"><a href="#cb86-250" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: flex;</span></span>
<span id="cb86-251"><a href="#cb86-251" aria-hidden="true" tabindex="-1"></a><span class="vs">        gap: 12px;</span></span>
<span id="cb86-252"><a href="#cb86-252" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-bottom: 16px;</span></span>
<span id="cb86-253"><a href="#cb86-253" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-254"><a href="#cb86-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-255"><a href="#cb86-255" aria-hidden="true" tabindex="-1"></a><span class="vs">      .avatar {</span></span>
<span id="cb86-256"><a href="#cb86-256" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 48px;</span></span>
<span id="cb86-257"><a href="#cb86-257" aria-hidden="true" tabindex="-1"></a><span class="vs">        height: 48px;</span></span>
<span id="cb86-258"><a href="#cb86-258" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 50%;</span></span>
<span id="cb86-259"><a href="#cb86-259" aria-hidden="true" tabindex="-1"></a><span class="vs">        object-fit: cover;</span></span>
<span id="cb86-260"><a href="#cb86-260" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-261"><a href="#cb86-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-262"><a href="#cb86-262" aria-hidden="true" tabindex="-1"></a><span class="vs">      h2 {</span></span>
<span id="cb86-263"><a href="#cb86-263" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin: 0;</span></span>
<span id="cb86-264"><a href="#cb86-264" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 18px;</span></span>
<span id="cb86-265"><a href="#cb86-265" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #333;</span></span>
<span id="cb86-266"><a href="#cb86-266" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-267"><a href="#cb86-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-268"><a href="#cb86-268" aria-hidden="true" tabindex="-1"></a><span class="vs">      .email {</span></span>
<span id="cb86-269"><a href="#cb86-269" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin: 4px 0 0 0;</span></span>
<span id="cb86-270"><a href="#cb86-270" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb86-271"><a href="#cb86-271" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #666;</span></span>
<span id="cb86-272"><a href="#cb86-272" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-273"><a href="#cb86-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-274"><a href="#cb86-274" aria-hidden="true" tabindex="-1"></a><span class="vs">      .bio {</span></span>
<span id="cb86-275"><a href="#cb86-275" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #444;</span></span>
<span id="cb86-276"><a href="#cb86-276" aria-hidden="true" tabindex="-1"></a><span class="vs">        line-height: 1.5;</span></span>
<span id="cb86-277"><a href="#cb86-277" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-278"><a href="#cb86-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-279"><a href="#cb86-279" aria-hidden="true" tabindex="-1"></a><span class="vs">      .meta {</span></span>
<span id="cb86-280"><a href="#cb86-280" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 12px;</span></span>
<span id="cb86-281"><a href="#cb86-281" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #999;</span></span>
<span id="cb86-282"><a href="#cb86-282" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin-top: 12px;</span></span>
<span id="cb86-283"><a href="#cb86-283" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-284"><a href="#cb86-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-285"><a href="#cb86-285" aria-hidden="true" tabindex="-1"></a><span class="vs">      .loading, .error, .empty {</span></span>
<span id="cb86-286"><a href="#cb86-286" aria-hidden="true" tabindex="-1"></a><span class="vs">        text-align: center;</span></span>
<span id="cb86-287"><a href="#cb86-287" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 40px 20px;</span></span>
<span id="cb86-288"><a href="#cb86-288" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #666;</span></span>
<span id="cb86-289"><a href="#cb86-289" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-290"><a href="#cb86-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-291"><a href="#cb86-291" aria-hidden="true" tabindex="-1"></a><span class="vs">      .spinner {</span></span>
<span id="cb86-292"><a href="#cb86-292" aria-hidden="true" tabindex="-1"></a><span class="vs">        border: 3px solid #f3f3f3;</span></span>
<span id="cb86-293"><a href="#cb86-293" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-top: 3px solid #667eea;</span></span>
<span id="cb86-294"><a href="#cb86-294" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 50%;</span></span>
<span id="cb86-295"><a href="#cb86-295" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 40px;</span></span>
<span id="cb86-296"><a href="#cb86-296" aria-hidden="true" tabindex="-1"></a><span class="vs">        height: 40px;</span></span>
<span id="cb86-297"><a href="#cb86-297" aria-hidden="true" tabindex="-1"></a><span class="vs">        animation: spin 1s linear infinite;</span></span>
<span id="cb86-298"><a href="#cb86-298" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin: 0 auto 16px;</span></span>
<span id="cb86-299"><a href="#cb86-299" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-300"><a href="#cb86-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-301"><a href="#cb86-301" aria-hidden="true" tabindex="-1"></a><span class="vs">      @keyframes spin {</span></span>
<span id="cb86-302"><a href="#cb86-302" aria-hidden="true" tabindex="-1"></a><span class="vs">        to { transform: rotate(360deg); }</span></span>
<span id="cb86-303"><a href="#cb86-303" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-304"><a href="#cb86-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-305"><a href="#cb86-305" aria-hidden="true" tabindex="-1"></a><span class="vs">      .error-message {</span></span>
<span id="cb86-306"><a href="#cb86-306" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: #e53e3e;</span></span>
<span id="cb86-307"><a href="#cb86-307" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-308"><a href="#cb86-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-309"><a href="#cb86-309" aria-hidden="true" tabindex="-1"></a><span class="vs">      .compact {</span></span>
<span id="cb86-310"><a href="#cb86-310" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: flex;</span></span>
<span id="cb86-311"><a href="#cb86-311" aria-hidden="true" tabindex="-1"></a><span class="vs">        align-items: center;</span></span>
<span id="cb86-312"><a href="#cb86-312" aria-hidden="true" tabindex="-1"></a><span class="vs">        gap: 12px;</span></span>
<span id="cb86-313"><a href="#cb86-313" aria-hidden="true" tabindex="-1"></a><span class="vs">        padding: 12px;</span></span>
<span id="cb86-314"><a href="#cb86-314" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-315"><a href="#cb86-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-316"><a href="#cb86-316" aria-hidden="true" tabindex="-1"></a><span class="vs">      .compact img {</span></span>
<span id="cb86-317"><a href="#cb86-317" aria-hidden="true" tabindex="-1"></a><span class="vs">        width: 40px;</span></span>
<span id="cb86-318"><a href="#cb86-318" aria-hidden="true" tabindex="-1"></a><span class="vs">        height: 40px;</span></span>
<span id="cb86-319"><a href="#cb86-319" aria-hidden="true" tabindex="-1"></a><span class="vs">        border-radius: 50%;</span></span>
<span id="cb86-320"><a href="#cb86-320" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-321"><a href="#cb86-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-322"><a href="#cb86-322" aria-hidden="true" tabindex="-1"></a><span class="vs">      .compact h3 {</span></span>
<span id="cb86-323"><a href="#cb86-323" aria-hidden="true" tabindex="-1"></a><span class="vs">        margin: 0;</span></span>
<span id="cb86-324"><a href="#cb86-324" aria-hidden="true" tabindex="-1"></a><span class="vs">        font-size: 14px;</span></span>
<span id="cb86-325"><a href="#cb86-325" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb86-326"><a href="#cb86-326" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb86-327"><a href="#cb86-327" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-328"><a href="#cb86-328" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-329"><a href="#cb86-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-330"><a href="#cb86-330" aria-hidden="true" tabindex="-1"></a><span class="co">// 11. Register the custom element</span></span>
<span id="cb86-331"><a href="#cb86-331" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;user-card&#39;</span><span class="op">,</span> UserCard)<span class="op">;</span></span>
<span id="cb86-332"><a href="#cb86-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-333"><a href="#cb86-333" aria-hidden="true" tabindex="-1"></a><span class="co">// 12. Export for use in other modules</span></span>
<span id="cb86-334"><a href="#cb86-334" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> UserCard<span class="op">;</span></span></code></pre></div>
<h3 id="component-structure-breakdown">Component Structure
Breakdown</h3>
<p><strong>1. Documentation:</strong></p>
<ul>
<li>JSDoc comments explain usage</li>
<li>Attribute, property, event, and slot documentation</li>
<li>Helps other developers understand the component</li>
</ul>
<p><strong>2. Static Properties:</strong></p>
<ul>
<li><code>observedAttributes</code> defines which attributes trigger
<code>attributeChangedCallback</code></li>
<li>Keep this list minimal for performance</li>
</ul>
<p><strong>3. Constructor:</strong></p>
<ul>
<li>Initialize instance variables</li>
<li>Attach shadow DOM</li>
<li>Bind methods (for event handlers)</li>
<li>Don’t access attributes or DOM here</li>
</ul>
<p><strong>4. Lifecycle Methods:</strong></p>
<ul>
<li><code>connectedCallback</code>: Setup when added to DOM</li>
<li><code>disconnectedCallback</code>: Cleanup when removed</li>
<li><code>attributeChangedCallback</code>: Respond to attribute
changes</li>
</ul>
<p><strong>5. Properties:</strong></p>
<ul>
<li>Use private fields (<code>_user</code>) for internal state</li>
<li>Provide getters/setters for public API</li>
<li>Setters can trigger re-renders</li>
</ul>
<p><strong>6. Methods:</strong></p>
<ul>
<li>Public methods for external use</li>
<li>Private methods (conventionally start with <code>_</code> or use
<code>#</code> private fields)</li>
<li>Keep methods focused and single-purpose</li>
</ul>
<p><strong>7. Rendering:</strong></p>
<ul>
<li>Separate render logic from state management</li>
<li>Multiple render methods for different states</li>
<li>Extract styles to a separate method</li>
</ul>
<h2 id="shadow-dom-deep-dive">Shadow DOM Deep Dive</h2>
<p>Shadow DOM is one of the most powerful features of Web Components. It
provides true encapsulation for both markup and styles.</p>
<h3 id="creating-shadow-dom">Creating Shadow DOM</h3>
<div class="sourceCode" id="cb87"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create shadow root</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// mode: &#39;open&#39; - shadow root accessible via element.shadowRoot</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// mode: &#39;closed&#39; - shadow root not accessible (rarely used)</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="shadow-dom-vs-light-dom">Shadow DOM vs Light DOM</h3>
<div class="sourceCode" id="cb88"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">my-component</span><span class="dt">&gt;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- This is Light DOM (regular DOM) --&gt;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Visible content<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">my-component</span><span class="dt">&gt;</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">class</span> MyComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">constructor</span>() {</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// This is Shadow DOM</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;shadow-content&quot;&gt;</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;h2&gt;Shadow DOM Content&lt;/h2&gt;</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;my-component&#39;</span><span class="op">,</span> MyComponent)<span class="op">;</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Result:</strong></p>
<ul>
<li>Light DOM (<code>&lt;p&gt;Visible content&lt;/p&gt;</code>) is
projected into the <code>&lt;slot&gt;</code></li>
<li>Shadow DOM provides the structure and styling</li>
<li>Styles in shadow DOM don’t leak out</li>
<li>Styles from light DOM don’t leak in</li>
</ul>
<h3 id="style-encapsulation">Style Encapsulation</h3>
<div class="sourceCode" id="cb89"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StyledButton <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        /* These styles only affect this component */</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="vs">        button {</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: blue;</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: white;</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: none;</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 10px 20px;</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="vs">          cursor: pointer;</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        button:hover {</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: darkblue;</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/button&gt;</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Styles inside shadow DOM are scoped</li>
<li>No conflicts with global styles</li>
<li>No CSS class name collisions</li>
<li>True component encapsulation</li>
</ul>
<h3 id="the-host-selector">The :host Selector</h3>
<p>Style the component itself:</p>
<div class="sourceCode" id="cb90"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="in">:host</span> {</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span><span class="ch">:</span> <span class="dv">block</span><span class="op">;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span><span class="ch">:</span> <span class="dv">16</span><span class="dt">px</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Style host when it has a class */</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="in">:host(</span><span class="fu">.highlighted</span><span class="in">)</span> {</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">gold</span><span class="op">;</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Style host when it has an attribute */</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="in">:host(</span><span class="ex">[</span><span class="ss">disabled</span><span class="ex">]</span><span class="in">)</span> {</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">opacity</span><span class="ch">:</span> <span class="dv">0.5</span><span class="op">;</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">pointer-events</span><span class="ch">:</span> <span class="dv">none</span><span class="op">;</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="co">/* Style host in specific contexts */</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="in">:host-context(</span><span class="fu">.dark-theme</span><span class="in">)</span> {</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background</span><span class="ch">:</span> <span class="cn">#333</span><span class="op">;</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">color</span><span class="ch">:</span> <span class="cn">white</span><span class="op">;</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="css-custom-properties-variables">CSS Custom Properties
(Variables)</h3>
<p>CSS variables pierce the shadow DOM boundary:</p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Component defines and uses variables</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ThemedCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="vs">        :host {</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: var(--card-bg, white);</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: var(--card-text, black);</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: 1px solid var(--card-border, #ddd);</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: var(--card-radius, 8px);</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: var(--card-padding, 16px);</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb92"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Override component variables from outside */</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  themed-card {</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">--card-bg</span><span class="ch">:</span> <span class="cn">#f0f0f0</span><span class="op">;</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">--card-text</span><span class="ch">:</span> <span class="cn">#333</span><span class="op">;</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">--card-border</span><span class="ch">:</span> <span class="cn">#ccc</span><span class="op">;</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">--card-radius</span><span class="ch">:</span> <span class="dv">12</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  themed-card<span class="fu">.dark</span> {</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">--card-bg</span><span class="ch">:</span> <span class="cn">#333</span><span class="op">;</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">--card-text</span><span class="ch">:</span> <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">--card-border</span><span class="ch">:</span> <span class="cn">#555</span><span class="op">;</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">themed-card</span><span class="dt">&gt;</span>Normal theme<span class="dt">&lt;/</span><span class="kw">themed-card</span><span class="dt">&gt;</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">themed-card</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;dark&quot;</span><span class="dt">&gt;</span>Dark theme<span class="dt">&lt;/</span><span class="kw">themed-card</span><span class="dt">&gt;</span></span></code></pre></div>
<p>This pattern allows theming while maintaining encapsulation.</p>
<h3 id="parts-and-part">Parts and ::part()</h3>
<p>Expose specific shadow DOM elements for styling:</p>
<div class="sourceCode" id="cb93"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FancyButton <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        button { /* default styles */ }</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="vs">        .icon { /* icon styles */ }</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button part=&quot;button&quot;&gt;</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;span part=&quot;icon&quot; class=&quot;icon&quot;&gt;→&lt;/span&gt;</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/button&gt;</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Style from outside:</strong></p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>fancy-button<span class="in">::part(</span><span class="st">button</span><span class="in">)</span> {</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background</span><span class="ch">:</span> <span class="fu">linear-gradient(</span><span class="dv">135</span><span class="dt">deg</span><span class="op">,</span> <span class="cn">#667eea</span><span class="op">,</span> <span class="cn">#764ba2</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>fancy-button<span class="in">::part(</span><span class="st">icon</span><span class="in">)</span> {</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">color</span><span class="ch">:</span> <span class="cn">gold</span><span class="op">;</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This gives consumers more control while maintaining
encapsulation.</p>
<h2 id="attributes-and-properties">Attributes and Properties</h2>
<p>Understanding the difference between attributes and properties is
crucial for component design.</p>
<h3 id="attributes-vs-properties">Attributes vs Properties</h3>
<p><strong>Attributes:</strong></p>
<ul>
<li>HTML attributes (<code>&lt;my-el foo="bar"&gt;</code>)</li>
<li>Always strings</li>
<li>Visible in HTML</li>
<li>Trigger <code>attributeChangedCallback</code></li>
</ul>
<p><strong>Properties:</strong></p>
<ul>
<li>JavaScript properties (<code>element.foo = 123</code>)</li>
<li>Any type (string, number, object, etc.)</li>
<li>Not visible in HTML</li>
<li>Direct access, no callback</li>
</ul>
<h3 id="reflecting-properties-to-attributes">Reflecting Properties to
Attributes</h3>
<div class="sourceCode" id="cb95"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ToggleButton <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">static</span> <span class="kw">get</span> <span class="fu">observedAttributes</span>() {</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">&#39;checked&#39;</span>]<span class="op">;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_checked</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Property getter</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">checked</span>() {</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">_checked</span><span class="op">;</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Property setter - reflects to attribute</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">checked</span>(value) {</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> <span class="bu">Boolean</span>(value)<span class="op">;</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (isChecked) {</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;checked&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">removeAttribute</span>(<span class="st">&#39;checked&#39;</span>)<span class="op">;</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Attribute changed - updates property</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributeChangedCallback</span>(name<span class="op">,</span> oldValue<span class="op">,</span> newValue) {</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;checked&#39;</span>) {</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_checked</span> <span class="op">=</span> newValue <span class="op">!==</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button class=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_checked</span> <span class="op">?</span> <span class="st">&#39;checked&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_checked</span> <span class="op">?</span> <span class="st">&#39;✓&#39;</span> <span class="op">:</span> <span class="st">&#39;○&#39;</span><span class="sc">}</span></span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/button&gt;</span></span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb96"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Set via attribute --&gt;</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">toggle-button</span><span class="ot"> checked</span><span class="dt">&gt;&lt;/</span><span class="kw">toggle-button</span><span class="dt">&gt;</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> toggle <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;toggle-button&#39;</span>)<span class="op">;</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set via property</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  toggle<span class="op">.</span><span class="at">checked</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get property</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(toggle<span class="op">.</span><span class="at">checked</span>)<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check attribute</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(toggle<span class="op">.</span><span class="fu">hasAttribute</span>(<span class="st">&#39;checked&#39;</span>))<span class="op">;</span> <span class="co">// true</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="when-to-use-each-1">When to Use Each</h3>
<p><strong>Use Attributes for:</strong></p>
<ul>
<li>Simple configuration (strings, numbers, booleans)</li>
<li>Values that should be visible in HTML</li>
<li>Initial configuration from HTML</li>
<li>Values that need to work with CSS selectors</li>
</ul>
<p><strong>Use Properties for:</strong></p>
<ul>
<li>Complex data (objects, arrays, functions)</li>
<li>Data that changes frequently</li>
<li>Large data that shouldn’t serialize to HTML</li>
<li>Callback functions</li>
</ul>
<h3 id="type-conversion">Type Conversion</h3>
<p>Attributes are always strings, so convert appropriately:</p>
<div class="sourceCode" id="cb97"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributeChangedCallback</span>(name<span class="op">,</span> oldValue<span class="op">,</span> newValue) {</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;count&#39;</span>) {</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_count</span> <span class="op">=</span> <span class="bu">Number</span>(newValue) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;enabled&#39;</span>) {</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_enabled</span> <span class="op">=</span> newValue <span class="op">!==</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// Boolean attribute</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;options&#39;</span>) {</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_options</span> <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(newValue)<span class="op">;</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> {</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_options</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="boolean-attributes">Boolean Attributes</h3>
<p>Follow HTML conventions:</p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Boolean attribute: presence = true, absence = false</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">hasAttribute</span>(<span class="st">&#39;disabled&#39;</span>)) {</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Is disabled</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Set boolean attribute</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;disabled&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span> <span class="co">// value doesn&#39;t matter</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove boolean attribute</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="kw">this</span><span class="op">.</span><span class="fu">removeAttribute</span>(<span class="st">&#39;disabled&#39;</span>)<span class="op">;</span></span></code></pre></div>
<h2 id="component-styling">Component Styling</h2>
<h3 id="internal-styles">Internal Styles</h3>
<p>Most styles should be in shadow DOM:</p>
<div class="sourceCode" id="cb99"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">styles</span>() {</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="vs">    :host {</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="vs">      display: block;</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    .container {</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="vs">      padding: 16px;</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="vs">    /* All your component styles */</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="external-stylesheets">External Stylesheets</h3>
<p>For larger components, link external styles:</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">connectedCallback</span>() {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/styles/components/user-card.css&quot;&gt;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class=&quot;user-card&quot;&gt;</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;!-- content --&gt;</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="adoptable-stylesheets">Adoptable Stylesheets</h3>
<p>Share styles between component instances:</p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create shared stylesheet once</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sheet <span class="op">=</span> <span class="kw">new</span> <span class="bu">CSSStyleSheet</span>()<span class="op">;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>sheet<span class="op">.</span><span class="fu">replaceSync</span>(<span class="vs">`</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="vs">  .card {</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    padding: 16px;</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    border-radius: 8px;</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: white;</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="vs">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CardComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adopt shared stylesheet (very fast)</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">adoptedStyleSheets</span> <span class="op">=</span> [sheet]<span class="op">;</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card&quot;&gt;</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Benefits:</strong></p>
<ul>
<li>Styles parsed once, shared across instances</li>
<li>Better performance with many components</li>
<li>Modify shared styles dynamically</li>
</ul>
<h3 id="theming-strategies">Theming Strategies</h3>
<p><strong>Strategy 1: CSS Custom Properties</strong></p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ThemedComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">styles</span>() {</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="vs">      :host {</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="vs">        --primary-color: var(--app-primary, #667eea);</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="vs">        --background: var(--app-bg, white);</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        --text: var(--app-text, #333);</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      .content {</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: var(--background);</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: var(--text);</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="vs">      button {</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: var(--primary-color);</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Strategy 2: Class-Based Themes</strong></p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ThemeAwareComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Observe theme changes on documentElement</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="bu">MutationObserver</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">updateTheme</span>()<span class="op">;</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    observer<span class="op">.</span><span class="fu">observe</span>(<span class="bu">document</span><span class="op">.</span><span class="at">documentElement</span><span class="op">,</span> {</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">attributes</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">attributeFilter</span><span class="op">:</span> [<span class="st">&#39;data-theme&#39;</span>]</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateTheme</span>()<span class="op">;</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateTheme</span>() {</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> theme <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="at">documentElement</span><span class="op">.</span><span class="at">dataset</span><span class="op">.</span><span class="at">theme</span> <span class="op">||</span> <span class="st">&#39;light&#39;</span><span class="op">;</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;theme&#39;</span><span class="op">,</span> theme)<span class="op">;</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">styles</span>() {</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a><span class="vs">      :host([theme=&quot;light&quot;]) {</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: white;</span></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: black;</span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a><span class="vs">      :host([theme=&quot;dark&quot;]) {</span></span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: #333;</span></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: white;</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Strategy 3: PAN-Based Themes</strong></p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PanThemedComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;app.theme.changed&#39;</span><span class="op">,</span> ({ theme }) <span class="kw">=&gt;</span> {</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">applyTheme</span>(theme)<span class="op">;</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Request current theme</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;app.theme.get&#39;</span>)<span class="op">.</span><span class="fu">then</span>(theme <span class="kw">=&gt;</span> {</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">applyTheme</span>(theme)<span class="op">;</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">applyTheme</span>(theme) {</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;data-theme&#39;</span><span class="op">,</span> theme)<span class="op">;</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="lifecycle-methods-advanced-patterns">Lifecycle Methods (Advanced
Patterns)</h2>
<h3 id="deferred-rendering">Deferred Rendering</h3>
<p>Wait for dependencies before rendering:</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataDisplay <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Wait for dependencies to load</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> customElements<span class="op">.</span><span class="fu">whenDefined</span>(<span class="st">&#39;loading-spinner&#39;</span>)<span class="op">;</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> customElements<span class="op">.</span><span class="fu">whenDefined</span>(<span class="st">&#39;error-message&#39;</span>)<span class="op">;</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Now render</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="preventing-memory-leaks">Preventing Memory Leaks</h3>
<div class="sourceCode" id="cb106"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WebSocketComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">ws</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">WebSocket</span>(<span class="st">&#39;wss://api.example.com&#39;</span>)<span class="op">;</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">ws</span><span class="op">.</span><span class="at">onmessage</span> <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">handleMessage</span>(<span class="bu">event</span><span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">ws</span><span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> (error) <span class="kw">=&gt;</span> {</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;WebSocket error:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clean up WebSocket connection</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">ws</span>) {</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">ws</span><span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">ws</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="handling-rapid-reconnection">Handling Rapid Reconnection</h3>
<p>Components can be disconnected and reconnected quickly:</p>
<div class="sourceCode" id="cb107"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RobustComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Might be called multiple times</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use a guard to prevent duplicate setup</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_initialized</span>) {</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_initialized</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setup</span>()<span class="op">;</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use setTimeout to debounce</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_cleanupTimer</span> <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">cleanup</span>()<span class="op">;</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_initialized</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cancel cleanup if reconnected quickly</span></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_cleanupTimer</span>) {</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>      <span class="pp">clearTimeout</span>(<span class="kw">this</span><span class="op">.</span><span class="at">_cleanupTimer</span>)<span class="op">;</span></span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_cleanupTimer</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_initialized</span>) {</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_initialized</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setup</span>()<span class="op">;</span></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="testing-components">Testing Components</h2>
<h3 id="unit-testing">Unit Testing</h3>
<p>Test components in isolation:</p>
<div class="sourceCode" id="cb108"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">// tests/user-card.test.js</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { expect } <span class="im">from</span> <span class="st">&#39;@open-wc/testing&#39;</span><span class="op">;</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">&#39;../src/components/user-card.js&#39;</span><span class="op">;</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;UserCard&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> element<span class="op">;</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeEach</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    element <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;user-card&#39;</span>)<span class="op">;</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(element)<span class="op">;</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">afterEach</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;renders empty state by default&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> emptyText <span class="op">=</span> element<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.empty&#39;</span>)<span class="op">;</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(emptyText)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="at">exist</span><span class="op">;</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;loads user when user-id attribute is set&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Mock fetch</span></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">global</span><span class="op">.</span><span class="at">fetch</span> <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> ({</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ok</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">json</span><span class="op">:</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> ({ <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John Doe&#39;</span><span class="op">,</span> <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;john@example.com&#39;</span> })</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;user-id&#39;</span><span class="op">,</span> <span class="st">&#39;1&#39;</span>)<span class="op">;</span></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Wait for async operations</span></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> <span class="pp">setTimeout</span>(resolve<span class="op">,</span> <span class="dv">100</span>))<span class="op">;</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> name <span class="op">=</span> element<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;h2&#39;</span>)<span class="op">;</span></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(name<span class="op">.</span><span class="at">textContent</span>)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="fu">equal</span>(<span class="st">&#39;John Doe&#39;</span>)<span class="op">;</span></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;handles loading state&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;user-id&#39;</span><span class="op">,</span> <span class="st">&#39;1&#39;</span>)<span class="op">;</span></span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> spinner <span class="op">=</span> element<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.spinner&#39;</span>)<span class="op">;</span></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(spinner)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="at">exist</span><span class="op">;</span></span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;dispatches user-selected event on click&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="at">_user</span> <span class="op">=</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John&#39;</span> }<span class="op">;</span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> eventData <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;user-selected&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>      eventData <span class="op">=</span> e<span class="op">.</span><span class="at">detail</span><span class="op">;</span></span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.card&#39;</span>)<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(eventData)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="at">deep</span><span class="op">.</span><span class="fu">equal</span>({ <span class="dt">user</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John&#39;</span> } })<span class="op">;</span></span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="integration-testing">Integration Testing</h3>
<p>Test components working together:</p>
<div class="sourceCode" id="cb109"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">// tests/counter-integration.test.js</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Counter Integration&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeEach</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;counter-display&gt;&lt;/counter-display&gt;</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;counter-controls&gt;&lt;/counter-controls&gt;</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;updates display when controls are clicked&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> display <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;counter-display&#39;</span>)<span class="op">;</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> controls <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;counter-controls&#39;</span>)<span class="op">;</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> incrementBtn <span class="op">=</span> controls<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#increment&#39;</span>)<span class="op">;</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    incrementBtn<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(resolve <span class="kw">=&gt;</span> <span class="pp">setTimeout</span>(resolve<span class="op">,</span> <span class="dv">50</span>))<span class="op">;</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> displayValue <span class="op">=</span> display<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.display&#39;</span>)<span class="op">.</span><span class="at">textContent</span><span class="op">;</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(displayValue)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="fu">equal</span>(<span class="st">&#39;1&#39;</span>)<span class="op">;</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="visual-regression-testing">Visual Regression Testing</h3>
<p>Catch visual bugs:</p>
<div class="sourceCode" id="cb110"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">// tests/visual.test.js</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> puppeteer <span class="im">from</span> <span class="st">&#39;puppeteer&#39;</span><span class="op">;</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pixelmatch <span class="im">from</span> <span class="st">&#39;pixelmatch&#39;</span><span class="op">;</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Visual Regression&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> browser<span class="op">,</span> page<span class="op">;</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeAll</span>(<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    browser <span class="op">=</span> <span class="cf">await</span> puppeteer<span class="op">.</span><span class="fu">launch</span>()<span class="op">;</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    page <span class="op">=</span> <span class="cf">await</span> browser<span class="op">.</span><span class="fu">newPage</span>()<span class="op">;</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">afterAll</span>(<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> browser<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;user-card matches snapshot&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> page<span class="op">.</span><span class="fu">goto</span>(<span class="st">&#39;http://localhost:3000/tests/user-card.html&#39;</span>)<span class="op">;</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> screenshot <span class="op">=</span> <span class="cf">await</span> page<span class="op">.</span><span class="fu">screenshot</span>({ <span class="dt">fullPage</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseline <span class="op">=</span> fs<span class="op">.</span><span class="fu">readFileSync</span>(<span class="st">&#39;tests/snapshots/user-card.png&#39;</span>)<span class="op">;</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> diff <span class="op">=</span> <span class="fu">pixelmatch</span>(screenshot<span class="op">,</span> baseline<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">800</span><span class="op">,</span> <span class="dv">600</span><span class="op">,</span> {</span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">threshold</span><span class="op">:</span> <span class="fl">0.1</span></span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(diff)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="at">be</span><span class="op">.</span><span class="fu">lessThan</span>(<span class="dv">100</span>)<span class="op">;</span> <span class="co">// Allow small differences</span></span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="summary-3">Summary</h2>
<p>This chapter covered:</p>
<ul>
<li><strong>Component Anatomy</strong>: Structure, lifecycle, and
organization</li>
<li><strong>Shadow DOM</strong>: Encapsulation, slots, and styling</li>
<li><strong>Attributes vs Properties</strong>: When to use each and how
to reflect them</li>
<li><strong>Component Styling</strong>: Internal styles, theming, and
CSS custom properties</li>
<li><strong>Lifecycle Patterns</strong>: Memory management and robust
connection handling</li>
<li><strong>Testing</strong>: Unit, integration, and visual regression
testing</li>
</ul>
<p>You now know how to build production-quality Web Components. The next
chapter explores the PAN bus in depth, showing you how to orchestrate
component communication at scale.</p>
<hr />
<h2 id="best-practices">Best Practices</h2>
<ol type="1">
<li><strong>Always clean up in
<code>disconnectedCallback</code></strong>
<ul>
<li>Remove event listeners</li>
<li>Cancel pending operations</li>
<li>Unsubscribe from events</li>
</ul></li>
<li><strong>Use Shadow DOM for encapsulation</strong>
<ul>
<li>Keep styles scoped</li>
<li>Avoid global style pollution</li>
<li>Use <code>:host</code> and CSS custom properties for theming</li>
</ul></li>
<li><strong>Reflect important properties to attributes</strong>
<ul>
<li>Makes state visible in HTML</li>
<li>Enables CSS selectors</li>
<li>Improves debugging</li>
</ul></li>
<li><strong>Keep components focused</strong>
<ul>
<li>Single responsibility principle</li>
<li>Compose larger components from smaller ones</li>
<li>Extract shared logic to utilities</li>
</ul></li>
<li><strong>Test early and often</strong>
<ul>
<li>Write tests as you build components</li>
<li>Test both happy paths and error cases</li>
<li>Use integration tests for component interaction</li>
</ul></li>
</ol>
<h1 id="chapter-5-the-pan-bus">Chapter 5: The PAN Bus</h1>
<p>The Page Area Network (PAN) bus is LARC’s event-driven communication
backbone. It enables decoupled, scalable component architectures by
providing a pub/sub messaging system that works across your entire
application.</p>
<p>In this chapter, you’ll master the PAN bus: from basic
publish/subscribe patterns to advanced message routing, error handling,
and debugging techniques. By the end, you’ll be able to build complex
applications where components communicate seamlessly without tight
coupling.</p>
<h2 id="understanding-pubsub-architecture">Understanding Pub/Sub
Architecture</h2>
<p>Publish/Subscribe (pub/sub) is a messaging pattern where senders
(publishers) don’t directly target specific receivers (subscribers).
Instead, messages are sent to topics, and any component interested in
those topics receives them.</p>
<h3 id="traditional-communication">Traditional Communication</h3>
<p>Without pub/sub, components need direct references:</p>
<div class="sourceCode" id="cb111"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ Tight coupling</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LoginButton {</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleLogin</span>() {</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">authenticate</span>()<span class="op">;</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Direct reference to other components</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;user-menu&#39;</span>)<span class="op">.</span><span class="fu">updateUser</span>(user)<span class="op">;</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;sidebar&#39;</span>)<span class="op">.</span><span class="fu">showUserPanel</span>()<span class="op">;</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;notification&#39;</span>)<span class="op">.</span><span class="fu">show</span>(<span class="st">&#39;Welcome!&#39;</span>)<span class="op">;</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Problems:</strong></p>
<ul>
<li>LoginButton must know about all dependent components</li>
<li>Adding new components requires modifying LoginButton</li>
<li>Components can’t work independently</li>
<li>Testing requires mocking all dependencies</li>
</ul>
<h3 id="pubsub-communication">Pub/Sub Communication</h3>
<p>With the PAN bus:</p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✓ Loose coupling</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LoginButton {</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleLogin</span>() {</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">authenticate</span>()<span class="op">;</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish event - don&#39;t care who listens</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.logged-in&#39;</span><span class="op">,</span> { user })<span class="op">;</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Separate components subscribe independently</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserMenu {</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.logged-in&#39;</span><span class="op">,</span> ({ user }) <span class="kw">=&gt;</span> {</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">updateUser</span>(user)<span class="op">;</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Sidebar {</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.logged-in&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showUserPanel</span>()<span class="op">;</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="bu">Notification</span> {</span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.logged-in&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">show</span>(<span class="st">&#39;Welcome!&#39;</span>)<span class="op">;</span></span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Benefits:</strong></p>
<ul>
<li>LoginButton doesn’t know about consumers</li>
<li>Add new subscribers without changing publishers</li>
<li>Components work independently</li>
<li>Easy to test in isolation</li>
</ul>
<h3 id="the-pan-bus-api">The PAN Bus API</h3>
<p>The PAN bus provides three core operations:</p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Publish - send a message to a topic</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;topic.name&#39;</span><span class="op">,</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">&#39;value&#39;</span> })<span class="op">;</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Subscribe - listen for messages on a topic</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> unsubscribe <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;topic.name&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Received:&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Unsubscribe - stop listening</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="fu">unsubscribe</span>()<span class="op">;</span></span></code></pre></div>
<p>That’s the foundation. Everything else builds on these three
operations.</p>
<h2 id="topics-and-namespaces">Topics and Namespaces</h2>
<p>Topics are the routing keys for messages. Well-designed topics make
your application’s data flow clear and maintainable.</p>
<h3 id="topic-naming-conventions">Topic Naming Conventions</h3>
<p>Use dot notation to create hierarchies:</p>
<pre><code>domain.entity.action</code></pre>
<p><strong>Examples:</strong></p>
<pre><code>user.profile.updated
user.auth.login
user.auth.logout
user.settings.changed

cart.item.added
cart.item.removed
cart.total.calculated
cart.checkout.started
cart.checkout.completed

notification.info.show
notification.warning.show
notification.error.show

app.theme.changed
app.language.changed
app.route.changed</code></pre>
<h3 id="namespace-structure">Namespace Structure</h3>
<p>Organize topics by domain:</p>
<p><strong>User Domain:</strong></p>
<pre><code>user.auth.login
user.auth.logout
user.auth.refresh
user.profile.fetch
user.profile.update
user.settings.fetch
user.settings.update</code></pre>
<p><strong>Shopping Cart Domain:</strong></p>
<pre><code>cart.init
cart.item.add
cart.item.remove
cart.item.update
cart.clear
cart.checkout</code></pre>
<p><strong>Application Domain:</strong></p>
<pre><code>app.ready
app.error
app.navigate
app.theme.change
app.modal.open
app.modal.close</code></pre>
<h3 id="wildcards">Wildcards</h3>
<p>Subscribe to multiple topics using wildcards:</p>
<div class="sourceCode" id="cb119"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Subscribe to all user events</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.*&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;User event:&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Subscribe to all auth events across domains</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*.auth.*&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Auth event:&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Subscribe to ALL events (debugging)</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`[</span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">]`</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Wildcard Patterns:</strong></p>
<ul>
<li><code>user.*</code> - All user events (user.login, user.logout,
etc.)</li>
<li><code>*.created</code> - All create events (user.created,
post.created, etc.)</li>
<li><code>user.*.updated</code> - All user update events
(user.profile.updated, user.settings.updated, etc.)</li>
<li><code>*</code> - All events</li>
</ul>
<h3 id="topic-best-practices">Topic Best Practices</h3>
<p><strong>1. Be Specific:</strong></p>
<div class="sourceCode" id="cb120"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✓ Good - clear intent</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.added&#39;</span><span class="op">,</span> { item<span class="op">,</span> quantity })<span class="op">;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ Bad - vague</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.update&#39;</span><span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;add&#39;</span><span class="op">,</span> item<span class="op">,</span> quantity })<span class="op">;</span></span></code></pre></div>
<p><strong>2. Use Consistent Tense:</strong></p>
<div class="sourceCode" id="cb121"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✓ Good - past tense for events that happened</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.logged-in&#39;</span><span class="op">,</span> { user })<span class="op">;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;data.loaded&#39;</span><span class="op">,</span> { data })<span class="op">;</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ Bad - mixed tense</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.login&#39;</span><span class="op">,</span> { user })<span class="op">;</span>  <span class="co">// Is this a command or event?</span></span></code></pre></div>
<p><strong>3. Include Context:</strong></p>
<div class="sourceCode" id="cb122"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✓ Good - data includes context</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;task.completed&#39;</span><span class="op">,</span> {</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">taskId</span><span class="op">:</span> <span class="dv">123</span><span class="op">,</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">userId</span><span class="op">:</span> <span class="dv">456</span><span class="op">,</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">completedAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ Bad - missing context</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;task.done&#39;</span><span class="op">,</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">123</span> })<span class="op">;</span></span></code></pre></div>
<p><strong>4. Avoid Over-Nesting:</strong></p>
<div class="sourceCode" id="cb123"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✓ Good - clear and concise</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.profile.updated&#39;</span><span class="op">,</span> { user })<span class="op">;</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ Bad - too nested</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;app.domain.user.entity.profile.action.updated&#39;</span><span class="op">,</span> { user })<span class="op">;</span></span></code></pre></div>
<h2 id="publishing-messages">Publishing Messages</h2>
<p>Publishing is straightforward, but there are patterns and options to
understand.</p>
<h3 id="basic-publishing">Basic Publishing</h3>
<div class="sourceCode" id="cb124"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;event.name&#39;</span><span class="op">,</span> { <span class="dt">any</span><span class="op">:</span> <span class="st">&#39;data&#39;</span> })<span class="op">;</span></span></code></pre></div>
<p>The data can be anything JSON-serializable:</p>
<div class="sourceCode" id="cb125"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Simple value</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;counter.updated&#39;</span><span class="op">,</span> <span class="dv">42</span>)<span class="op">;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Object</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.logged-in&#39;</span><span class="op">,</span> {</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">userId</span><span class="op">:</span> <span class="dv">123</span><span class="op">,</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">username</span><span class="op">:</span> <span class="st">&#39;john&#39;</span><span class="op">,</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;john@example.com&#39;</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Array</span></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;items.loaded&#39;</span><span class="op">,</span> [</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Item 1&#39;</span> }<span class="op">,</span></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Item 2&#39;</span> }</span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Null/undefined</span></span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;data.cleared&#39;</span><span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span></code></pre></div>
<h3 id="publishing-from-components">Publishing from Components</h3>
<p>Publish in response to user actions or state changes:</p>
<div class="sourceCode" id="cb126"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AddToCartButton <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleClick</span>)<span class="op">;</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleClick</span>() {</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> productId <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;product-id&#39;</span>)<span class="op">;</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> quantity <span class="op">=</span> <span class="pp">parseInt</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;quantity&#39;</span>) <span class="op">||</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish intent</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add-requested&#39;</span><span class="op">,</span> { productId<span class="op">,</span> quantity })<span class="op">;</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Perform action</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">addToCart</span>(productId<span class="op">,</span> quantity)<span class="op">;</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Publish success</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.added&#39;</span><span class="op">,</span> {</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>        productId<span class="op">,</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>        quantity<span class="op">,</span></span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Publish failure</span></span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add-failed&#39;</span><span class="op">,</span> {</span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a>        productId<span class="op">,</span></span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a>        quantity<span class="op">,</span></span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span></span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb126-32"><a href="#cb126-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-33"><a href="#cb126-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">addToCart</span>(productId<span class="op">,</span> quantity) {</span>
<span id="cb126-34"><a href="#cb126-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/cart/items&#39;</span><span class="op">,</span> {</span>
<span id="cb126-35"><a href="#cb126-35" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb126-36"><a href="#cb126-36" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb126-37"><a href="#cb126-37" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({ productId<span class="op">,</span> quantity })</span>
<span id="cb126-38"><a href="#cb126-38" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb126-39"><a href="#cb126-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-40"><a href="#cb126-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb126-41"><a href="#cb126-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Failed to add item to cart&#39;</span>)<span class="op">;</span></span>
<span id="cb126-42"><a href="#cb126-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-43"><a href="#cb126-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-44"><a href="#cb126-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb126-45"><a href="#cb126-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb126-46"><a href="#cb126-46" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="event-metadata">Event Metadata</h3>
<p>Include metadata for debugging and auditing:</p>
<div class="sourceCode" id="cb127"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">publishWithMetadata</span>(topic<span class="op">,</span> data) {</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(topic<span class="op">,</span> {</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>data<span class="op">,</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">_meta</span><span class="op">:</span> {</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">source</span><span class="op">:</span> <span class="st">&#39;UserComponent&#39;</span><span class="op">,</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">userId</span><span class="op">:</span> currentUser<span class="op">?.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sessionId</span><span class="op">:</span> sessionId</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a><span class="fu">publishWithMetadata</span>(<span class="st">&#39;order.placed&#39;</span><span class="op">,</span> {</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">orderId</span><span class="op">:</span> <span class="dv">12345</span><span class="op">,</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">total</span><span class="op">:</span> <span class="fl">99.99</span></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="batch-publishing">Batch Publishing</h3>
<p>Publish multiple events efficiently:</p>
<div class="sourceCode" id="cb128"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">syncLocalChanges</span>(changes) {</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  changes<span class="op">.</span><span class="fu">forEach</span>(change <span class="kw">=&gt;</span> {</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> (change<span class="op">.</span><span class="at">type</span>) {</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;add&#39;</span><span class="op">:</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;data.item.added&#39;</span><span class="op">,</span> change<span class="op">.</span><span class="at">item</span>)<span class="op">;</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;update&#39;</span><span class="op">:</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;data.item.updated&#39;</span><span class="op">,</span> change<span class="op">.</span><span class="at">item</span>)<span class="op">;</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;delete&#39;</span><span class="op">:</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;data.item.deleted&#39;</span><span class="op">,</span> { <span class="dt">id</span><span class="op">:</span> change<span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Publish batch complete</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;data.sync.completed&#39;</span><span class="op">,</span> {</span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">changesCount</span><span class="op">:</span> changes<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="subscribing-to-events">Subscribing to Events</h2>
<p>Subscriptions are how components react to events they care about.</p>
<h3 id="basic-subscription">Basic Subscription</h3>
<div class="sourceCode" id="cb129"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> unsubscribe <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;event.name&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Received:&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Later, when done</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unsubscribe</span>()<span class="op">;</span></span></code></pre></div>
<h3 id="component-lifecycle-integration">Component Lifecycle
Integration</h3>
<p>Subscribe in <code>connectedCallback</code>, unsubscribe in
<code>disconnectedCallback</code>:</p>
<div class="sourceCode" id="cb130"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NotificationDisplay <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to notification events</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeInfo</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;notification.info&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">showInfo</span>)<span class="op">;</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeWarning</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;notification.warning&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">showWarning</span>)<span class="op">;</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeError</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;notification.error&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">showError</span>)<span class="op">;</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clean up subscriptions</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribeInfo</span>()<span class="op">;</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribeWarning</span>()<span class="op">;</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribeError</span>()<span class="op">;</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>  showInfo <span class="op">=</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">showNotification</span>(<span class="st">&#39;info&#39;</span><span class="op">,</span> data<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>  showWarning <span class="op">=</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">showNotification</span>(<span class="st">&#39;warning&#39;</span><span class="op">,</span> data<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a>  showError <span class="op">=</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">showNotification</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> data<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showNotification</span>(type<span class="op">,</span> message) {</span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Render notification UI</span></span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="multiple-subscriptions-helper">Multiple Subscriptions
Helper</h3>
<p>Manage multiple subscriptions easily:</p>
<div class="sourceCode" id="cb131"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SubscriptionManager {</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subscriptions</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subscribe</span>(topic<span class="op">,</span> handler) {</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> unsubscribe <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(topic<span class="op">,</span> handler)<span class="op">;</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subscriptions</span><span class="op">.</span><span class="fu">push</span>(unsubscribe)<span class="op">;</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unsubscribe<span class="op">;</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unsubscribeAll</span>() {</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subscriptions</span><span class="op">.</span><span class="fu">forEach</span>(unsubscribe <span class="kw">=&gt;</span> <span class="fu">unsubscribe</span>())<span class="op">;</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subscriptions</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage in component</span></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subs</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">SubscriptionManager</span>()<span class="op">;</span></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subs</span><span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.login&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleLogin</span>)<span class="op">;</span></span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subs</span><span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.logout&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleLogout</span>)<span class="op">;</span></span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subs</span><span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;app.theme.changed&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleThemeChange</span>)<span class="op">;</span></span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">subs</span><span class="op">.</span><span class="fu">unsubscribeAll</span>()<span class="op">;</span></span>
<span id="cb131-33"><a href="#cb131-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-34"><a href="#cb131-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-35"><a href="#cb131-35" aria-hidden="true" tabindex="-1"></a>  handleLogin <span class="op">=</span> (data) <span class="kw">=&gt;</span> { <span class="co">/* ... */</span> }</span>
<span id="cb131-36"><a href="#cb131-36" aria-hidden="true" tabindex="-1"></a>  handleLogout <span class="op">=</span> (data) <span class="kw">=&gt;</span> { <span class="co">/* ... */</span> }</span>
<span id="cb131-37"><a href="#cb131-37" aria-hidden="true" tabindex="-1"></a>  handleThemeChange <span class="op">=</span> (data) <span class="kw">=&gt;</span> { <span class="co">/* ... */</span> }</span>
<span id="cb131-38"><a href="#cb131-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="conditional-subscriptions">Conditional Subscriptions</h3>
<p>Subscribe only when conditions are met:</p>
<div class="sourceCode" id="cb132"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserDashboard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to user-specific events only when user is logged in</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeAuth</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;auth.state.changed&#39;</span><span class="op">,</span> ({ isAuthenticated<span class="op">,</span> user }) <span class="kw">=&gt;</span> {</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isAuthenticated) {</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">subscribeToUserEvents</span>(user<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribeFromUserEvents</span>()<span class="op">;</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subscribeToUserEvents</span>(userId) {</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeUserActivity</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.activity&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (data<span class="op">.</span><span class="at">userId</span> <span class="op">===</span> userId) {</span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">updateActivity</span>(data)<span class="op">;</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeUserNotifications</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.notifications&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (data<span class="op">.</span><span class="at">userId</span> <span class="op">===</span> userId) {</span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showNotification</span>(data)<span class="op">;</span></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unsubscribeFromUserEvents</span>() {</span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeUserActivity</span>) {</span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribeUserActivity</span>()<span class="op">;</span></span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeUserActivity</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeUserNotifications</span>) {</span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribeUserNotifications</span>()<span class="op">;</span></span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribeUserNotifications</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="filtering-events">Filtering Events</h3>
<p>Filter events in the subscriber:</p>
<div class="sourceCode" id="cb133"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;task.updated&#39;</span><span class="op">,</span> (task) <span class="kw">=&gt;</span> {</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Only handle tasks assigned to current user</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (task<span class="op">.</span><span class="at">assignedTo</span> <span class="op">===</span> currentUser<span class="op">.</span><span class="at">id</span>) {</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateTaskDisplay</span>(task)<span class="op">;</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;notification.*&#39;</span><span class="op">,</span> (notification) <span class="kw">=&gt;</span> {</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Only show high-priority notifications</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (notification<span class="op">.</span><span class="at">priority</span> <span class="op">&gt;=</span> <span class="dv">3</span>) {</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">showNotification</span>(notification)<span class="op">;</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="message-patterns-1">Message Patterns</h2>
<p>The PAN bus supports several messaging patterns for different use
cases.</p>
<h3 id="fire-and-forget-1">1. Fire and Forget</h3>
<p>Most common pattern. Publish and continue without waiting:</p>
<div class="sourceCode" id="cb134"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Publisher</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">saveSettings</span>(settings) {</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;settings&#39;</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(settings))<span class="op">;</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;settings.saved&#39;</span><span class="op">,</span> settings)<span class="op">;</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Subscriber</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;settings.saved&#39;</span><span class="op">,</span> (settings) <span class="kw">=&gt;</span> {</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Settings updated:&#39;</span><span class="op">,</span> settings)<span class="op">;</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateUI</span>(settings)<span class="op">;</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Use when:</strong></p>
<ul>
<li>Multiple components may react</li>
<li>You don’t need confirmation</li>
<li>Action is non-critical</li>
</ul>
<h3 id="requestresponse-1">2. Request/Response</h3>
<p>Request data and wait for a response:</p>
<div class="sourceCode" id="cb135"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Responder</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">respond</span>(<span class="st">&#39;auth.token.get&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;authToken&#39;</span>)<span class="op">;</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Requester</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> token <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.token.get&#39;</span>)<span class="op">;</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Token:&#39;</span><span class="op">,</span> token)<span class="op">;</span></span></code></pre></div>
<p><strong>Implementation:</strong></p>
<div class="sourceCode" id="cb136"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In PAN library</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PAN {</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request</span>(topic<span class="op">,</span> data<span class="op">,</span> timeout <span class="op">=</span> <span class="dv">5000</span>) {</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> responseId <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Subscribe to response</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> unsubscribe <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">subscribe</span>(<span class="vs">`</span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:response:</span><span class="sc">${</span>responseId<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> (response) <span class="kw">=&gt;</span> {</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>        <span class="pp">clearTimeout</span>(timer)<span class="op">;</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resolve</span>(response)<span class="op">;</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Set timeout</span></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> timer <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">reject</span>(<span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Request timeout: </span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">`</span>))<span class="op">;</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> timeout)<span class="op">;</span></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Publish request</span></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">publish</span>(<span class="vs">`</span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:request`</span><span class="op">,</span> {</span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>data<span class="op">,</span></span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">_responseId</span><span class="op">:</span> responseId</span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">respond</span>(topic<span class="op">,</span> handler) {</span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">subscribe</span>(<span class="vs">`</span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:request`</span><span class="op">,</span> <span class="kw">async</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span> {</span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="fu">handler</span>(data)<span class="op">;</span></span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">publish</span>(<span class="vs">`</span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:response:</span><span class="sc">${</span>data<span class="op">.</span><span class="at">_responseId</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">catch</span> (error) {</span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">publish</span>(<span class="vs">`</span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:response:</span><span class="sc">${</span>data<span class="op">.</span><span class="at">_responseId</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> {</span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a>          <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span></span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb136-37"><a href="#cb136-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb136-38"><a href="#cb136-38" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb136-39"><a href="#cb136-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb136-40"><a href="#cb136-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Use when:</strong></p>
<ul>
<li>Need data from another component</li>
<li>Waiting for response is acceptable</li>
<li>Asynchronous operations</li>
</ul>
<h3 id="command-pattern">3. Command Pattern</h3>
<p>Issue commands that components execute:</p>
<div class="sourceCode" id="cb137"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Command issuer</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;modal.open&#39;</span><span class="op">,</span> {</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">component</span><span class="op">:</span> <span class="st">&#39;user-profile&#39;</span><span class="op">,</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">props</span><span class="op">:</span> { <span class="dt">userId</span><span class="op">:</span> <span class="dv">123</span> }</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Command handler</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;modal.open&#39;</span><span class="op">,</span> ({ component<span class="op">,</span> props }) <span class="kw">=&gt;</span> {</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> modal <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;app-modal&#39;</span>)<span class="op">;</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  modal<span class="op">.</span><span class="at">component</span> <span class="op">=</span> component<span class="op">;</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  modal<span class="op">.</span><span class="at">props</span> <span class="op">=</span> props<span class="op">;</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(modal)<span class="op">;</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Use when:</strong></p>
<ul>
<li>Triggering actions in other components</li>
<li>Implementing undo/redo</li>
<li>Building command palette UIs</li>
</ul>
<h3 id="event-sourcing">4. Event Sourcing</h3>
<p>Store events for replay or auditing:</p>
<div class="sourceCode" id="cb138"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> eventStore <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Store all events</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  eventStore<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>    topic<span class="op">,</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>    data<span class="op">,</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Replay events</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">replayEvents</span>(fromTimestamp) {</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>  eventStore</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(<span class="bu">event</span> <span class="kw">=&gt;</span> <span class="bu">event</span><span class="op">.</span><span class="at">timestamp</span> <span class="op">&gt;=</span> fromTimestamp)</span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">forEach</span>(<span class="bu">event</span> <span class="kw">=&gt;</span> {</span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="bu">event</span><span class="op">.</span><span class="at">topic</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Get events for debugging</span></span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getEventHistory</span>(topic) {</span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> eventStore<span class="op">.</span><span class="fu">filter</span>(<span class="bu">event</span> <span class="kw">=&gt;</span></span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">event</span><span class="op">.</span><span class="at">topic</span> <span class="op">===</span> topic <span class="op">||</span> <span class="bu">event</span><span class="op">.</span><span class="at">topic</span><span class="op">.</span><span class="fu">startsWith</span>(topic <span class="op">+</span> <span class="st">&#39;.&#39;</span>)</span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Use when:</strong></p>
<ul>
<li>Debugging complex interactions</li>
<li>Implementing undo/redo</li>
<li>Auditing user actions</li>
<li>Syncing state across sessions</li>
</ul>
<h3 id="aggregation-pattern">5. Aggregation Pattern</h3>
<p>Collect multiple events before acting:</p>
<div class="sourceCode" id="cb139"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataAggregator <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">pendingUpdates</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>()<span class="op">;</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">debounceTimer</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;data.item.updated&#39;</span><span class="op">,</span> ({ id }) <span class="kw">=&gt;</span> {</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">pendingUpdates</span><span class="op">.</span><span class="fu">add</span>(id)<span class="op">;</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">scheduleRefresh</span>()<span class="op">;</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scheduleRefresh</span>() {</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>    <span class="pp">clearTimeout</span>(<span class="kw">this</span><span class="op">.</span><span class="at">debounceTimer</span>)<span class="op">;</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">debounceTimer</span> <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">refreshItems</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">this</span><span class="op">.</span><span class="at">pendingUpdates</span>))<span class="op">;</span></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">pendingUpdates</span><span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">refreshItems</span>(ids) {</span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> items <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetchItems</span>(ids)<span class="op">;</span></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(items)<span class="op">;</span></span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Use when:</strong></p>
<ul>
<li>Avoiding excessive updates</li>
<li>Batching API requests</li>
<li>Debouncing rapid events</li>
</ul>
<h3 id="saga-pattern">6. Saga Pattern</h3>
<p>Coordinate multi-step processes:</p>
<div class="sourceCode" id="cb140"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CheckoutSaga {</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setupListeners</span>()<span class="op">;</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setupListeners</span>() {</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;checkout.started&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleCheckoutStart</span>)<span class="op">;</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;payment.completed&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handlePaymentComplete</span>)<span class="op">;</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;order.created&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleOrderCreated</span>)<span class="op">;</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>  handleCheckoutStart <span class="op">=</span> <span class="kw">async</span> ({ cart }) <span class="kw">=&gt;</span> {</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 1: Validate cart</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.validating&#39;</span><span class="op">,</span> { cart })<span class="op">;</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateCart</span>(cart)<span class="op">;</span></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 2: Calculate totals</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.calculating&#39;</span><span class="op">,</span> { cart })<span class="op">;</span></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> totals <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculateTotals</span>(cart)<span class="op">;</span></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 3: Request payment</span></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;payment.requested&#39;</span><span class="op">,</span> { totals })<span class="op">;</span></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.failed&#39;</span><span class="op">,</span> { <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>  handlePaymentComplete <span class="op">=</span> <span class="kw">async</span> ({ paymentId<span class="op">,</span> totals }) <span class="kw">=&gt;</span> {</span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 4: Create order</span></span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.creating&#39;</span><span class="op">,</span> { paymentId })<span class="op">;</span></span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> order <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createOrder</span>(paymentId<span class="op">,</span> totals)<span class="op">;</span></span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.created&#39;</span><span class="op">,</span> { order })<span class="op">;</span></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Compensating transaction: refund payment</span></span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;payment.refund-requested&#39;</span><span class="op">,</span> { paymentId })<span class="op">;</span></span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.failed&#39;</span><span class="op">,</span> { <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a>  handleOrderCreated <span class="op">=</span> <span class="kw">async</span> ({ order }) <span class="kw">=&gt;</span> {</span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Step 5: Send confirmation</span></span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.confirmation-sending&#39;</span><span class="op">,</span> { order })<span class="op">;</span></span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">sendConfirmation</span>(order)<span class="op">;</span></span>
<span id="cb140-47"><a href="#cb140-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-48"><a href="#cb140-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Step 6: Complete checkout</span></span>
<span id="cb140-49"><a href="#cb140-49" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.completed&#39;</span><span class="op">,</span> { order })<span class="op">;</span></span>
<span id="cb140-50"><a href="#cb140-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-51"><a href="#cb140-51" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Use when:</strong></p>
<ul>
<li>Complex multi-step workflows</li>
<li>Need to handle failures and rollbacks</li>
<li>Coordinating multiple services</li>
</ul>
<h2 id="debugging-pan-communication">Debugging PAN Communication</h2>
<p>Debugging event-driven systems requires different techniques than
traditional debugging.</p>
<h3 id="logging-all-events">Logging All Events</h3>
<div class="sourceCode" id="cb141"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Enable debug mode</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">debug</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Or manually subscribe to all events</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">group</span>(<span class="vs">`[PAN] </span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Data:&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Timestamp:&#39;</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toISOString</span>())<span class="op">;</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">trace</span>(<span class="st">&#39;Stack trace&#39;</span>)<span class="op">;</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">groupEnd</span>()<span class="op">;</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="event-inspector">Event Inspector</h3>
<p>Build a visual event inspector:</p>
<div class="sourceCode" id="cb142"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PanInspector <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">events</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">maxEvents</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">logEvent</span>(topic<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logEvent</span>(topic<span class="op">,</span> data) {</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="fu">unshift</span>({</span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>      topic<span class="op">,</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="kw">this</span><span class="op">.</span><span class="at">maxEvents</span>) {</span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb142-25"><a href="#cb142-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb142-26"><a href="#cb142-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-27"><a href="#cb142-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb142-28"><a href="#cb142-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb142-29"><a href="#cb142-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-30"><a href="#cb142-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb142-31"><a href="#cb142-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb142-32"><a href="#cb142-32" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb142-33"><a href="#cb142-33" aria-hidden="true" tabindex="-1"></a><span class="vs">        .pan-inspector {</span></span>
<span id="cb142-34"><a href="#cb142-34" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: fixed;</span></span>
<span id="cb142-35"><a href="#cb142-35" aria-hidden="true" tabindex="-1"></a><span class="vs">          bottom: 0;</span></span>
<span id="cb142-36"><a href="#cb142-36" aria-hidden="true" tabindex="-1"></a><span class="vs">          right: 0;</span></span>
<span id="cb142-37"><a href="#cb142-37" aria-hidden="true" tabindex="-1"></a><span class="vs">          width: 400px;</span></span>
<span id="cb142-38"><a href="#cb142-38" aria-hidden="true" tabindex="-1"></a><span class="vs">          height: 300px;</span></span>
<span id="cb142-39"><a href="#cb142-39" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: white;</span></span>
<span id="cb142-40"><a href="#cb142-40" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: 1px solid #ccc;</span></span>
<span id="cb142-41"><a href="#cb142-41" aria-hidden="true" tabindex="-1"></a><span class="vs">          overflow: auto;</span></span>
<span id="cb142-42"><a href="#cb142-42" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-family: monospace;</span></span>
<span id="cb142-43"><a href="#cb142-43" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 12px;</span></span>
<span id="cb142-44"><a href="#cb142-44" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb142-45"><a href="#cb142-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-46"><a href="#cb142-46" aria-hidden="true" tabindex="-1"></a><span class="vs">        .event {</span></span>
<span id="cb142-47"><a href="#cb142-47" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 8px;</span></span>
<span id="cb142-48"><a href="#cb142-48" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-bottom: 1px solid #eee;</span></span>
<span id="cb142-49"><a href="#cb142-49" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb142-50"><a href="#cb142-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-51"><a href="#cb142-51" aria-hidden="true" tabindex="-1"></a><span class="vs">        .event:hover {</span></span>
<span id="cb142-52"><a href="#cb142-52" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #f5f5f5;</span></span>
<span id="cb142-53"><a href="#cb142-53" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb142-54"><a href="#cb142-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-55"><a href="#cb142-55" aria-hidden="true" tabindex="-1"></a><span class="vs">        .topic {</span></span>
<span id="cb142-56"><a href="#cb142-56" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-weight: bold;</span></span>
<span id="cb142-57"><a href="#cb142-57" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: #667eea;</span></span>
<span id="cb142-58"><a href="#cb142-58" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb142-59"><a href="#cb142-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-60"><a href="#cb142-60" aria-hidden="true" tabindex="-1"></a><span class="vs">        .timestamp {</span></span>
<span id="cb142-61"><a href="#cb142-61" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: #999;</span></span>
<span id="cb142-62"><a href="#cb142-62" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 10px;</span></span>
<span id="cb142-63"><a href="#cb142-63" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb142-64"><a href="#cb142-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-65"><a href="#cb142-65" aria-hidden="true" tabindex="-1"></a><span class="vs">        .data {</span></span>
<span id="cb142-66"><a href="#cb142-66" aria-hidden="true" tabindex="-1"></a><span class="vs">          margin-top: 4px;</span></span>
<span id="cb142-67"><a href="#cb142-67" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: #333;</span></span>
<span id="cb142-68"><a href="#cb142-68" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb142-69"><a href="#cb142-69" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb142-70"><a href="#cb142-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-71"><a href="#cb142-71" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;pan-inspector&quot;&gt;</span></span>
<span id="cb142-72"><a href="#cb142-72" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h3&gt;PAN Event Inspector&lt;/h3&gt;</span></span>
<span id="cb142-73"><a href="#cb142-73" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="fu">map</span>(<span class="bu">event</span> <span class="kw">=&gt;</span> <span class="vs">`</span></span>
<span id="cb142-74"><a href="#cb142-74" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;event&quot;&gt;</span></span>
<span id="cb142-75"><a href="#cb142-75" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div class=&quot;topic&quot;&gt;</span><span class="sc">${</span><span class="bu">event</span><span class="op">.</span><span class="at">topic</span><span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb142-76"><a href="#cb142-76" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div class=&quot;timestamp&quot;&gt;</span><span class="sc">${</span><span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">event</span><span class="op">.</span><span class="at">timestamp</span>)<span class="op">.</span><span class="fu">toLocaleTimeString</span>()<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb142-77"><a href="#cb142-77" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;div class=&quot;data&quot;&gt;</span><span class="sc">${</span><span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="bu">event</span><span class="op">.</span><span class="at">data</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb142-78"><a href="#cb142-78" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb142-79"><a href="#cb142-79" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;&#39;</span>)<span class="sc">}</span></span>
<span id="cb142-80"><a href="#cb142-80" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb142-81"><a href="#cb142-81" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb142-82"><a href="#cb142-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb142-83"><a href="#cb142-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-84"><a href="#cb142-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-85"><a href="#cb142-85" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;pan-inspector&#39;</span><span class="op">,</span> PanInspector)<span class="op">;</span></span></code></pre></div>
<h3 id="event-filtering">Event Filtering</h3>
<p>Filter events for specific topics:</p>
<div class="sourceCode" id="cb143"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">filterEvents</span>(pattern) {</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> regex <span class="op">=</span> <span class="kw">new</span> <span class="bu">RegExp</span>(pattern<span class="op">.</span><span class="fu">replace</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> <span class="st">&#39;.*&#39;</span>))<span class="op">;</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (regex<span class="op">.</span><span class="fu">test</span>(topic)) {</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`[FILTERED] </span><span class="sc">${</span>topic<span class="sc">}</span><span class="vs">:`</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="fu">filterEvents</span>(<span class="st">&#39;user.*&#39;</span>)<span class="op">;</span>     <span class="co">// Only user events</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a><span class="fu">filterEvents</span>(<span class="st">&#39;*.error&#39;</span>)<span class="op">;</span>    <span class="co">// All error events</span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a><span class="fu">filterEvents</span>(<span class="st">&#39;cart|order&#39;</span>)<span class="op">;</span> <span class="co">// Cart or order events</span></span></code></pre></div>
<h3 id="performance-monitoring">Performance Monitoring</h3>
<p>Track event frequency and performance:</p>
<div class="sourceCode" id="cb144"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PanMonitor {</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">stats</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic) <span class="kw">=&gt;</span> {</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> stat <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">stats</span><span class="op">.</span><span class="fu">get</span>(topic) <span class="op">||</span> { <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">timestamps</span><span class="op">:</span> [] }<span class="op">;</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>      stat<span class="op">.</span><span class="at">count</span><span class="op">++;</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>      stat<span class="op">.</span><span class="at">timestamps</span><span class="op">.</span><span class="fu">push</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>())<span class="op">;</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Keep only last 100 timestamps</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (stat<span class="op">.</span><span class="at">timestamps</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">100</span>) {</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>        stat<span class="op">.</span><span class="at">timestamps</span><span class="op">.</span><span class="fu">shift</span>()<span class="op">;</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">stats</span><span class="op">.</span><span class="fu">set</span>(topic<span class="op">,</span> stat)<span class="op">;</span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getStats</span>(topic) {</span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stat <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">stats</span><span class="op">.</span><span class="fu">get</span>(topic)<span class="op">;</span></span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>stat) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> timestamps <span class="op">=</span> stat<span class="op">.</span><span class="at">timestamps</span><span class="op">;</span></span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> duration <span class="op">=</span> timestamps[timestamps<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> timestamps[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> frequency <span class="op">=</span> timestamps<span class="op">.</span><span class="at">length</span> <span class="op">/</span> (duration <span class="op">/</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-28"><a href="#cb144-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb144-29"><a href="#cb144-29" aria-hidden="true" tabindex="-1"></a>      topic<span class="op">,</span></span>
<span id="cb144-30"><a href="#cb144-30" aria-hidden="true" tabindex="-1"></a>      <span class="dt">count</span><span class="op">:</span> stat<span class="op">.</span><span class="at">count</span><span class="op">,</span></span>
<span id="cb144-31"><a href="#cb144-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frequency</span><span class="op">:</span> frequency<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">&#39; events/sec&#39;</span><span class="op">,</span></span>
<span id="cb144-32"><a href="#cb144-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">lastEvent</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(timestamps[timestamps<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb144-33"><a href="#cb144-33" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb144-34"><a href="#cb144-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-35"><a href="#cb144-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-36"><a href="#cb144-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getAllStats</span>() {</span>
<span id="cb144-37"><a href="#cb144-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> results <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb144-38"><a href="#cb144-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-39"><a href="#cb144-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">stats</span><span class="op">.</span><span class="fu">forEach</span>((_<span class="op">,</span> topic) <span class="kw">=&gt;</span> {</span>
<span id="cb144-40"><a href="#cb144-40" aria-hidden="true" tabindex="-1"></a>      results<span class="op">.</span><span class="fu">push</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">getStats</span>(topic))<span class="op">;</span></span>
<span id="cb144-41"><a href="#cb144-41" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb144-42"><a href="#cb144-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-43"><a href="#cb144-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">count</span> <span class="op">-</span> a<span class="op">.</span><span class="at">count</span>)<span class="op">;</span></span>
<span id="cb144-44"><a href="#cb144-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-45"><a href="#cb144-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-46"><a href="#cb144-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reset</span>() {</span>
<span id="cb144-47"><a href="#cb144-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">stats</span><span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb144-48"><a href="#cb144-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-49"><a href="#cb144-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-50"><a href="#cb144-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-51"><a href="#cb144-51" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb144-52"><a href="#cb144-52" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> monitor <span class="op">=</span> <span class="kw">new</span> <span class="fu">PanMonitor</span>()<span class="op">;</span></span>
<span id="cb144-53"><a href="#cb144-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-54"><a href="#cb144-54" aria-hidden="true" tabindex="-1"></a><span class="co">// Later, check stats</span></span>
<span id="cb144-55"><a href="#cb144-55" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">table</span>(monitor<span class="op">.</span><span class="fu">getAllStats</span>())<span class="op">;</span></span></code></pre></div>
<h3 id="event-replay">Event Replay</h3>
<p>Capture and replay events for testing:</p>
<div class="sourceCode" id="cb145"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EventRecorder {</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">recording</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">events</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">start</span>() {</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">recording</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">events</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (topic<span class="op">,</span> data) <span class="kw">=&gt;</span> {</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">recording</span>) {</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="fu">push</span>({ topic<span class="op">,</span> data<span class="op">,</span> <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() })<span class="op">;</span></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>() {</span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">recording</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span>) {</span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb145-22"><a href="#cb145-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb145-23"><a href="#cb145-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-24"><a href="#cb145-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">events</span><span class="op">;</span></span>
<span id="cb145-25"><a href="#cb145-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb145-26"><a href="#cb145-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-27"><a href="#cb145-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replay</span>(events<span class="op">,</span> speed <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb145-28"><a href="#cb145-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>events <span class="op">||</span> events<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb145-29"><a href="#cb145-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-30"><a href="#cb145-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startTime <span class="op">=</span> events[<span class="dv">0</span>]<span class="op">.</span><span class="at">timestamp</span><span class="op">;</span></span>
<span id="cb145-31"><a href="#cb145-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-32"><a href="#cb145-32" aria-hidden="true" tabindex="-1"></a>    events<span class="op">.</span><span class="fu">forEach</span>((<span class="bu">event</span><span class="op">,</span> index) <span class="kw">=&gt;</span> {</span>
<span id="cb145-33"><a href="#cb145-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> delay <span class="op">=</span> (<span class="bu">event</span><span class="op">.</span><span class="at">timestamp</span> <span class="op">-</span> startTime) <span class="op">/</span> speed<span class="op">;</span></span>
<span id="cb145-34"><a href="#cb145-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-35"><a href="#cb145-35" aria-hidden="true" tabindex="-1"></a>      <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb145-36"><a href="#cb145-36" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="bu">event</span><span class="op">.</span><span class="at">topic</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb145-37"><a href="#cb145-37" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> delay)<span class="op">;</span></span>
<span id="cb145-38"><a href="#cb145-38" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb145-39"><a href="#cb145-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb145-40"><a href="#cb145-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-41"><a href="#cb145-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(name) {</span>
<span id="cb145-42"><a href="#cb145-42" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="vs">`pan-recording-</span><span class="sc">${</span>name<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="kw">this</span><span class="op">.</span><span class="at">events</span>))<span class="op">;</span></span>
<span id="cb145-43"><a href="#cb145-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb145-44"><a href="#cb145-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-45"><a href="#cb145-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(name) {</span>
<span id="cb145-46"><a href="#cb145-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="vs">`pan-recording-</span><span class="sc">${</span>name<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb145-47"><a href="#cb145-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data <span class="op">?</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(data) <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb145-48"><a href="#cb145-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb145-49"><a href="#cb145-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb145-50"><a href="#cb145-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-51"><a href="#cb145-51" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb145-52"><a href="#cb145-52" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> recorder <span class="op">=</span> <span class="kw">new</span> <span class="fu">EventRecorder</span>()<span class="op">;</span></span>
<span id="cb145-53"><a href="#cb145-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-54"><a href="#cb145-54" aria-hidden="true" tabindex="-1"></a><span class="co">// Start recording</span></span>
<span id="cb145-55"><a href="#cb145-55" aria-hidden="true" tabindex="-1"></a>recorder<span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span>
<span id="cb145-56"><a href="#cb145-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-57"><a href="#cb145-57" aria-hidden="true" tabindex="-1"></a><span class="co">// ... perform actions ...</span></span>
<span id="cb145-58"><a href="#cb145-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-59"><a href="#cb145-59" aria-hidden="true" tabindex="-1"></a><span class="co">// Stop and save</span></span>
<span id="cb145-60"><a href="#cb145-60" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> events <span class="op">=</span> recorder<span class="op">.</span><span class="fu">stop</span>()<span class="op">;</span></span>
<span id="cb145-61"><a href="#cb145-61" aria-hidden="true" tabindex="-1"></a>recorder<span class="op">.</span><span class="fu">save</span>(<span class="st">&#39;my-test-scenario&#39;</span>)<span class="op">;</span></span>
<span id="cb145-62"><a href="#cb145-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-63"><a href="#cb145-63" aria-hidden="true" tabindex="-1"></a><span class="co">// Later, replay</span></span>
<span id="cb145-64"><a href="#cb145-64" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> events <span class="op">=</span> recorder<span class="op">.</span><span class="fu">load</span>(<span class="st">&#39;my-test-scenario&#39;</span>)<span class="op">;</span></span>
<span id="cb145-65"><a href="#cb145-65" aria-hidden="true" tabindex="-1"></a>recorder<span class="op">.</span><span class="fu">replay</span>(events<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span> <span class="co">// 2x speed</span></span></code></pre></div>
<h2 id="summary-4">Summary</h2>
<p>This chapter covered:</p>
<ul>
<li><strong>Pub/Sub Architecture</strong>: Decoupled communication via
topics</li>
<li><strong>Topics and Namespaces</strong>: Organizing events with
hierarchical naming</li>
<li><strong>Publishing</strong>: Sending messages and event
patterns</li>
<li><strong>Subscribing</strong>: Receiving and filtering events</li>
<li><strong>Message Patterns</strong>: Fire-and-forget,
request/response, commands, sagas</li>
<li><strong>Debugging</strong>: Logging, inspection, monitoring, and
replay tools</li>
</ul>
<p>The PAN bus is central to LARC applications. Mastering it enables you
to build scalable, maintainable applications where components
collaborate without tight coupling.</p>
<hr />
<h2 id="best-practices-1">Best Practices</h2>
<ol type="1">
<li><strong>Use descriptive topic names</strong>
<ul>
<li><code>user.profile.updated</code> not <code>userUpdated</code></li>
<li>Past tense for events that happened</li>
<li>Include context in message data</li>
</ul></li>
<li><strong>Clean up subscriptions</strong>
<ul>
<li>Always unsubscribe in <code>disconnectedCallback</code></li>
<li>Use subscription managers for multiple subscriptions</li>
<li>Avoid memory leaks</li>
</ul></li>
<li><strong>Avoid infinite loops</strong>
<ul>
<li>Don’t publish the same event you’re subscribed to</li>
<li>Use different topics for input and output</li>
<li>Add loop detection in debug mode</li>
</ul></li>
<li><strong>Keep handlers fast</strong>
<ul>
<li>Don’t block the event loop</li>
<li>Use async/await for long operations</li>
<li>Consider debouncing rapid events</li>
</ul></li>
<li><strong>Include metadata</strong>
<ul>
<li>Timestamp, source, user ID for debugging</li>
<li>Request IDs for tracing</li>
<li>Error details for failures</li>
</ul></li>
<li><strong>Test event flows</strong>
<ul>
<li>Use event recorders for integration tests</li>
<li>Mock pan.publish/subscribe in unit tests</li>
<li>Verify event contracts between components</li>
</ul></li>
</ol>
<h1 id="chapter-6-state-management">Chapter 6: State Management</h1>
<p>State management is one of the most critical aspects of application
development. Poor state management leads to bugs, performance issues,
and maintenance nightmares. Good state management makes applications
predictable, testable, and maintainable.</p>
<p>LARC takes a pragmatic approach: start simple and scale complexity
only when needed. This chapter explores state management at every level,
from component-local state to distributed, offline-first
architectures.</p>
<h2 id="component-local-state-1">Component-Local State</h2>
<p>The simplest form of state lives entirely within a single component.
This is your first choice for most scenarios.</p>
<h3 id="instance-properties">Instance Properties</h3>
<p>Use instance properties for component-specific state:</p>
<div class="sourceCode" id="cb146"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ToggleSwitch <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Local state</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">isOn</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;button&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">isOn</span> <span class="op">=</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">isOn</span><span class="op">;</span>  <span class="co">// Update state</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span>            <span class="co">// Re-render</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Notify others</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">&#39;toggle&#39;</span><span class="op">,</span> {</span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">detail</span><span class="op">:</span> { <span class="dt">isOn</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">isOn</span> }</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">;</span></span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a><span class="vs">        button {</span></span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">isOn</span> <span class="op">?</span> <span class="st">&#39;#48bb78&#39;</span> <span class="op">:</span> <span class="st">&#39;#cbd5e0&#39;</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: white;</span></span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: none;</span></span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 8px 16px;</span></span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a><span class="vs">          cursor: pointer;</span></span>
<span id="cb146-34"><a href="#cb146-34" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb146-35"><a href="#cb146-35" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb146-36"><a href="#cb146-36" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">isOn</span> <span class="op">?</span> <span class="st">&#39;ON&#39;</span> <span class="op">:</span> <span class="st">&#39;OFF&#39;</span><span class="sc">}</span><span class="vs">&lt;/button&gt;</span></span>
<span id="cb146-37"><a href="#cb146-37" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb146-38"><a href="#cb146-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-39"><a href="#cb146-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>When to use:</strong></p>
<ul>
<li>UI state (expanded/collapsed, selected, etc.)</li>
<li>Temporary values (search input, form drafts)</li>
<li>Component-specific configuration</li>
</ul>
<p><strong>Advantages:</strong></p>
<ul>
<li>Simple and straightforward</li>
<li>No dependencies on external state</li>
<li>Easy to reason about</li>
<li>Easy to test</li>
</ul>
<h3 id="private-fields">Private Fields</h3>
<p>Use private fields (with <code>#</code>) for true encapsulation:</p>
<div class="sourceCode" id="cb147"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Counter <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Private fields</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  #count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  #max <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  #min <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Public getter</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">count</span>() {</span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span>#<span class="at">count</span><span class="op">;</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Public setter with validation</span></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">count</span>(value) {</span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newCount <span class="op">=</span> <span class="bu">Number</span>(value)<span class="op">;</span></span>
<span id="cb147-20"><a href="#cb147-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-21"><a href="#cb147-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="pp">isNaN</span>(newCount)) {</span>
<span id="cb147-22"><a href="#cb147-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Count must be a number&#39;</span>)<span class="op">;</span></span>
<span id="cb147-23"><a href="#cb147-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-24"><a href="#cb147-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-25"><a href="#cb147-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (newCount <span class="op">&lt;</span> <span class="kw">this</span><span class="op">.</span>#<span class="at">min</span> <span class="op">||</span> newCount <span class="op">&gt;</span> <span class="kw">this</span><span class="op">.</span>#<span class="at">max</span>) {</span>
<span id="cb147-26"><a href="#cb147-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Count must be between </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span>#<span class="at">min</span><span class="sc">}</span><span class="vs"> and </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span>#<span class="at">max</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb147-27"><a href="#cb147-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-28"><a href="#cb147-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-29"><a href="#cb147-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span>#<span class="at">count</span> <span class="op">=</span> newCount<span class="op">;</span></span>
<span id="cb147-30"><a href="#cb147-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb147-31"><a href="#cb147-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-32"><a href="#cb147-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-33"><a href="#cb147-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">increment</span>() {</span>
<span id="cb147-34"><a href="#cb147-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">count</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="kw">this</span><span class="op">.</span>#<span class="at">count</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span>#<span class="at">max</span>)<span class="op">;</span></span>
<span id="cb147-35"><a href="#cb147-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-36"><a href="#cb147-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-37"><a href="#cb147-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decrement</span>() {</span>
<span id="cb147-38"><a href="#cb147-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">count</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="kw">this</span><span class="op">.</span>#<span class="at">count</span> <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span>#<span class="at">min</span>)<span class="op">;</span></span>
<span id="cb147-39"><a href="#cb147-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-40"><a href="#cb147-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-41"><a href="#cb147-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb147-42"><a href="#cb147-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb147-43"><a href="#cb147-43" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span>#<span class="at">count</span><span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb147-44"><a href="#cb147-44" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb147-45"><a href="#cb147-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-46"><a href="#cb147-46" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Benefits:</strong></p>
<ul>
<li>True privacy (can’t access from outside)</li>
<li>Validation at setter boundaries</li>
<li>Clear public API</li>
</ul>
<h3 id="state-objects">State Objects</h3>
<p>Organize related state in objects:</p>
<div class="sourceCode" id="cb148"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserProfile <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Group related state</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">state</span> <span class="op">=</span> {</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">user</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">loading</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">error</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">editMode</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setState</span>(updates) {</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Merge updates into state</span></span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">state</span> <span class="op">=</span> {</span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">,</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>updates</span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">loadUser</span>(userId) {</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setState</span>({ <span class="dt">loading</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">error</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-28"><a href="#cb148-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb148-29"><a href="#cb148-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/users/</span><span class="sc">${</span>userId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb148-30"><a href="#cb148-30" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb148-31"><a href="#cb148-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-32"><a href="#cb148-32" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">setState</span>({ user<span class="op">,</span> <span class="dt">loading</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb148-33"><a href="#cb148-33" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb148-34"><a href="#cb148-34" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">setState</span>({ <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span><span class="op">,</span> <span class="dt">loading</span><span class="op">:</span> <span class="kw">false</span> })<span class="op">;</span></span>
<span id="cb148-35"><a href="#cb148-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-36"><a href="#cb148-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-37"><a href="#cb148-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-38"><a href="#cb148-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb148-39"><a href="#cb148-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { user<span class="op">,</span> loading<span class="op">,</span> error<span class="op">,</span> editMode } <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">;</span></span>
<span id="cb148-40"><a href="#cb148-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-41"><a href="#cb148-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (loading) {</span>
<span id="cb148-42"><a href="#cb148-42" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;div&gt;Loading...&lt;/div&gt;&#39;</span><span class="op">;</span></span>
<span id="cb148-43"><a href="#cb148-43" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (error) {</span>
<span id="cb148-44"><a href="#cb148-44" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;div class=&quot;error&quot;&gt;</span><span class="sc">${</span>error<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb148-45"><a href="#cb148-45" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (user) {</span>
<span id="cb148-46"><a href="#cb148-46" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb148-47"><a href="#cb148-47" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div&gt;</span></span>
<span id="cb148-48"><a href="#cb148-48" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;h2&gt;</span><span class="sc">${</span>user<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h2&gt;</span></span>
<span id="cb148-49"><a href="#cb148-49" aria-hidden="true" tabindex="-1"></a><span class="vs">          </span><span class="sc">${</span>editMode <span class="op">?</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderEditForm</span>() <span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderDisplay</span>()<span class="sc">}</span></span>
<span id="cb148-50"><a href="#cb148-50" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb148-51"><a href="#cb148-51" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb148-52"><a href="#cb148-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-53"><a href="#cb148-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb148-54"><a href="#cb148-54" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Benefits:</strong></p>
<ul>
<li>Organized state structure</li>
<li>Single method to update state</li>
<li>Clear state shape</li>
<li>Easier debugging (log entire state)</li>
</ul>
<h2 id="shared-state-patterns">Shared State Patterns</h2>
<p>When multiple components need access to the same data, you need
shared state.</p>
<h3 id="simple-global-state">Simple Global State</h3>
<p>Create a shared state object:</p>
<div class="sourceCode" id="cb149"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/state.js</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> appState <span class="op">=</span> {</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span><span class="op">,</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">language</span><span class="op">:</span> <span class="st">&#39;en&#39;</span><span class="op">,</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">notifications</span><span class="op">:</span> []</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Update state</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">updateState</span>(updates) {</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">assign</span>(appState<span class="op">,</span> updates)<span class="op">;</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;app.state.changed&#39;</span><span class="op">,</span> appState)<span class="op">;</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Get state</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">getState</span>() {</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { <span class="op">...</span>appState }<span class="op">;</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage in components:</strong></p>
<div class="sourceCode" id="cb150"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { appState<span class="op">,</span> updateState } <span class="im">from</span> <span class="st">&#39;../lib/state.js&#39;</span><span class="op">;</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ThemeSwitcher <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Read initial state</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(appState<span class="op">.</span><span class="at">theme</span>)<span class="op">;</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to changes</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;app.state.changed&#39;</span><span class="op">,</span> (state) <span class="kw">=&gt;</span> {</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(state<span class="op">.</span><span class="at">theme</span>)<span class="op">;</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add event listener</span></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> newTheme <span class="op">=</span> appState<span class="op">.</span><span class="at">theme</span> <span class="op">===</span> <span class="st">&#39;light&#39;</span> <span class="op">?</span> <span class="st">&#39;dark&#39;</span> <span class="op">:</span> <span class="st">&#39;light&#39;</span><span class="op">;</span></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateState</span>({ <span class="dt">theme</span><span class="op">:</span> newTheme })<span class="op">;</span></span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>(theme) {</span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Theme: </span><span class="sc">${</span>theme<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="reactive-state-with-proxy">Reactive State with Proxy</h3>
<p>Make state changes automatically trigger updates:</p>
<div class="sourceCode" id="cb151"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/reactive-state.js</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">createReactiveState</span>(initialState) {</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> listeners <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>()<span class="op">;</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> state <span class="op">=</span> <span class="kw">new</span> <span class="bu">Proxy</span>(initialState<span class="op">,</span> {</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(target<span class="op">,</span> property<span class="op">,</span> value) {</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> oldValue <span class="op">=</span> target[property]<span class="op">;</span></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>      target[property] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Notify listeners</span></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>      listeners<span class="op">.</span><span class="fu">forEach</span>(listener <span class="kw">=&gt;</span> {</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">listener</span>(property<span class="op">,</span> value<span class="op">,</span> oldValue)<span class="op">;</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Also publish via PAN</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;state.changed&#39;</span><span class="op">,</span> {</span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>        property<span class="op">,</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>        value<span class="op">,</span></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>        oldValue</span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">get</span>(target<span class="op">,</span> property) {</span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> target[property]<span class="op">;</span></span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb151-29"><a href="#cb151-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-30"><a href="#cb151-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb151-31"><a href="#cb151-31" aria-hidden="true" tabindex="-1"></a>    state<span class="op">,</span></span>
<span id="cb151-32"><a href="#cb151-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subscribe</span>(listener) {</span>
<span id="cb151-33"><a href="#cb151-33" aria-hidden="true" tabindex="-1"></a>      listeners<span class="op">.</span><span class="fu">add</span>(listener)<span class="op">;</span></span>
<span id="cb151-34"><a href="#cb151-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> () <span class="kw">=&gt;</span> listeners<span class="op">.</span><span class="fu">delete</span>(listener)<span class="op">;</span></span>
<span id="cb151-35"><a href="#cb151-35" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb151-36"><a href="#cb151-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">getState</span>() {</span>
<span id="cb151-37"><a href="#cb151-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { <span class="op">...</span>state }<span class="op">;</span></span>
<span id="cb151-38"><a href="#cb151-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb151-39"><a href="#cb151-39" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb151-40"><a href="#cb151-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb152"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create reactive state</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { state<span class="op">,</span> subscribe } <span class="op">=</span> <span class="fu">createReactiveState</span>({</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Components automatically react to changes</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CountDisplay <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to specific property changes</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> <span class="fu">subscribe</span>((property<span class="op">,</span> value) <span class="kw">=&gt;</span> {</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (property <span class="op">===</span> <span class="st">&#39;count&#39;</span>) {</span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Count: </span><span class="sc">${</span>value<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initial render</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Count: </span><span class="sc">${</span>state<span class="op">.</span><span class="at">count</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-27"><a href="#cb152-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Update state (automatically triggers updates)</span></span>
<span id="cb152-28"><a href="#cb152-28" aria-hidden="true" tabindex="-1"></a>state<span class="op">.</span><span class="at">count</span><span class="op">++;</span>  <span class="co">// All subscribers notified</span></span>
<span id="cb152-29"><a href="#cb152-29" aria-hidden="true" tabindex="-1"></a>state<span class="op">.</span><span class="at">count</span> <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>  <span class="co">// All subscribers notified</span></span></code></pre></div>
<h3 id="store-pattern">Store Pattern</h3>
<p>Build a more sophisticated store:</p>
<div class="sourceCode" id="cb153"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/store.js</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Store {</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(initialState <span class="op">=</span> {}) {</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">state</span> <span class="op">=</span> initialState<span class="op">;</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">listeners</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">middleware</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getState</span>() {</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="op">...</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span> }<span class="op">;</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setState</span>(updates) {</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> oldState <span class="op">=</span> { <span class="op">...</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span> }<span class="op">;</span></span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">state</span> <span class="op">=</span> { <span class="op">...</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">,</span> <span class="op">...</span>updates }<span class="op">;</span></span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Run middleware</span></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">middleware</span><span class="op">.</span><span class="fu">forEach</span>(fn <span class="kw">=&gt;</span> <span class="fu">fn</span>(<span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">,</span> oldState))<span class="op">;</span></span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Notify listeners</span></span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">listeners</span><span class="op">.</span><span class="fu">forEach</span>((listeners<span class="op">,</span> key) <span class="kw">=&gt;</span> {</span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (key <span class="op">===</span> <span class="st">&#39;*&#39;</span> <span class="op">||</span> key <span class="kw">in</span> updates) {</span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>        listeners<span class="op">.</span><span class="fu">forEach</span>(listener <span class="kw">=&gt;</span> {</span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">listener</span>(<span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">,</span> oldState)<span class="op">;</span></span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb153-29"><a href="#cb153-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-30"><a href="#cb153-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subscribe</span>(key<span class="op">,</span> listener) {</span>
<span id="cb153-31"><a href="#cb153-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">listeners</span><span class="op">.</span><span class="fu">has</span>(key)) {</span>
<span id="cb153-32"><a href="#cb153-32" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">listeners</span><span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> <span class="kw">new</span> <span class="bu">Set</span>())<span class="op">;</span></span>
<span id="cb153-33"><a href="#cb153-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb153-34"><a href="#cb153-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-35"><a href="#cb153-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">listeners</span><span class="op">.</span><span class="fu">get</span>(key)<span class="op">.</span><span class="fu">add</span>(listener)<span class="op">;</span></span>
<span id="cb153-36"><a href="#cb153-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-37"><a href="#cb153-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return unsubscribe function</span></span>
<span id="cb153-38"><a href="#cb153-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb153-39"><a href="#cb153-39" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> listeners <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">listeners</span><span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb153-40"><a href="#cb153-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (listeners) {</span>
<span id="cb153-41"><a href="#cb153-41" aria-hidden="true" tabindex="-1"></a>        listeners<span class="op">.</span><span class="fu">delete</span>(listener)<span class="op">;</span></span>
<span id="cb153-42"><a href="#cb153-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb153-43"><a href="#cb153-43" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb153-44"><a href="#cb153-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb153-45"><a href="#cb153-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-46"><a href="#cb153-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">use</span>(middleware) {</span>
<span id="cb153-47"><a href="#cb153-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">middleware</span><span class="op">.</span><span class="fu">push</span>(middleware)<span class="op">;</span></span>
<span id="cb153-48"><a href="#cb153-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb153-49"><a href="#cb153-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-50"><a href="#cb153-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dispatch</span>(action) {</span>
<span id="cb153-51"><a href="#cb153-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Action pattern: { type, payload }</span></span>
<span id="cb153-52"><a href="#cb153-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> (action<span class="op">.</span><span class="at">type</span>) {</span>
<span id="cb153-53"><a href="#cb153-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;user/login&#39;</span><span class="op">:</span></span>
<span id="cb153-54"><a href="#cb153-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">setState</span>({ <span class="dt">user</span><span class="op">:</span> action<span class="op">.</span><span class="at">payload</span> })<span class="op">;</span></span>
<span id="cb153-55"><a href="#cb153-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb153-56"><a href="#cb153-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;user/logout&#39;</span><span class="op">:</span></span>
<span id="cb153-57"><a href="#cb153-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">setState</span>({ <span class="dt">user</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb153-58"><a href="#cb153-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb153-59"><a href="#cb153-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;theme/change&#39;</span><span class="op">:</span></span>
<span id="cb153-60"><a href="#cb153-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">setState</span>({ <span class="dt">theme</span><span class="op">:</span> action<span class="op">.</span><span class="at">payload</span> })<span class="op">;</span></span>
<span id="cb153-61"><a href="#cb153-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb153-62"><a href="#cb153-62" aria-hidden="true" tabindex="-1"></a>      <span class="cf">default</span><span class="op">:</span></span>
<span id="cb153-63"><a href="#cb153-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">warn</span>(<span class="vs">`Unknown action: </span><span class="sc">${</span>action<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb153-64"><a href="#cb153-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb153-65"><a href="#cb153-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb153-66"><a href="#cb153-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb153-67"><a href="#cb153-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-68"><a href="#cb153-68" aria-hidden="true" tabindex="-1"></a><span class="co">// Create store instance</span></span>
<span id="cb153-69"><a href="#cb153-69" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> store <span class="op">=</span> <span class="kw">new</span> <span class="fu">Store</span>({</span>
<span id="cb153-70"><a href="#cb153-70" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb153-71"><a href="#cb153-71" aria-hidden="true" tabindex="-1"></a>  <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span><span class="op">,</span></span>
<span id="cb153-72"><a href="#cb153-72" aria-hidden="true" tabindex="-1"></a>  <span class="dt">notifications</span><span class="op">:</span> []</span>
<span id="cb153-73"><a href="#cb153-73" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb153-74"><a href="#cb153-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-75"><a href="#cb153-75" aria-hidden="true" tabindex="-1"></a><span class="co">// Add logging middleware</span></span>
<span id="cb153-76"><a href="#cb153-76" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="fu">use</span>((state<span class="op">,</span> oldState) <span class="kw">=&gt;</span> {</span>
<span id="cb153-77"><a href="#cb153-77" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;State changed:&#39;</span><span class="op">,</span> { <span class="dt">old</span><span class="op">:</span> oldState<span class="op">,</span> <span class="kw">new</span><span class="op">:</span> state })<span class="op">;</span></span>
<span id="cb153-78"><a href="#cb153-78" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb153-79"><a href="#cb153-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-80"><a href="#cb153-80" aria-hidden="true" tabindex="-1"></a><span class="co">// Add persistence middleware</span></span>
<span id="cb153-81"><a href="#cb153-81" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="fu">use</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb153-82"><a href="#cb153-82" aria-hidden="true" tabindex="-1"></a>  localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;app-state&#39;</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(state))<span class="op">;</span></span>
<span id="cb153-83"><a href="#cb153-83" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb154"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { store } <span class="im">from</span> <span class="st">&#39;../lib/store.js&#39;</span><span class="op">;</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserMenu <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to user changes only</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribe</span> <span class="op">=</span> store<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user&#39;</span><span class="op">,</span> (state) <span class="kw">=&gt;</span> {</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(state<span class="op">.</span><span class="at">user</span>)<span class="op">;</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initial render</span></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(store<span class="op">.</span><span class="fu">getState</span>()<span class="op">.</span><span class="at">user</span>)<span class="op">;</span></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>(user) {</span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (user) {</span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div&gt;Hello, </span><span class="sc">${</span>user<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button id=&quot;logout&quot;&gt;Logout&lt;/button&gt;</span></span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#logout&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a>        store<span class="op">.</span><span class="fu">dispatch</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;user/logout&#39;</span> })<span class="op">;</span></span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb154-29"><a href="#cb154-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;button id=&quot;login&quot;&gt;Login&lt;/button&gt;&#39;</span><span class="op">;</span></span>
<span id="cb154-30"><a href="#cb154-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-31"><a href="#cb154-31" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;#login&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb154-32"><a href="#cb154-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Trigger login flow</span></span>
<span id="cb154-33"><a href="#cb154-33" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;auth.login.requested&#39;</span>)<span class="op">;</span></span>
<span id="cb154-34"><a href="#cb154-34" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb154-35"><a href="#cb154-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-36"><a href="#cb154-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb154-37"><a href="#cb154-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="the-pan-store-component">The pan-store Component</h2>
<p>LARC provides a built-in component for state management:</p>
<div class="sourceCode" id="cb155"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">pan-store</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;app-store&quot;</span><span class="ot"> persist</span><span class="op">=</span><span class="st">&quot;true&quot;</span><span class="dt">&gt;</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Initial state --&gt;</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;application/json&quot;</span><span class="dt">&gt;</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;user&quot;</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;theme&quot;</span><span class="op">:</span> <span class="st">&quot;light&quot;</span><span class="op">,</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;cart&quot;</span><span class="op">:</span> {</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;items&quot;</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;total&quot;</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">pan-store</span><span class="dt">&gt;</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="dt">&gt;</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> store <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;app-store&#39;</span>)<span class="op">;</span></span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get state</span></span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> state <span class="op">=</span> store<span class="op">.</span><span class="fu">getState</span>()<span class="op">;</span></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update state</span></span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a>  store<span class="op">.</span><span class="fu">setState</span>({ <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;dark&#39;</span> })<span class="op">;</span></span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-24"><a href="#cb155-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Subscribe to changes</span></span>
<span id="cb155-25"><a href="#cb155-25" aria-hidden="true" tabindex="-1"></a>  store<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;state-changed&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb155-26"><a href="#cb155-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;State changed:&#39;</span><span class="op">,</span> e<span class="op">.</span><span class="at">detail</span>)<span class="op">;</span></span>
<span id="cb155-27"><a href="#cb155-27" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb155-28"><a href="#cb155-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-29"><a href="#cb155-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Or use PAN bus</span></span>
<span id="cb155-30"><a href="#cb155-30" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;store.changed&#39;</span><span class="op">,</span> (state) <span class="kw">=&gt;</span> {</span>
<span id="cb155-31"><a href="#cb155-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;State via PAN:&#39;</span><span class="op">,</span> state)<span class="op">;</span></span>
<span id="cb155-32"><a href="#cb155-32" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb155-33"><a href="#cb155-33" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Features:</strong></p>
<ul>
<li>Declarative state initialization</li>
<li>Optional persistence to localStorage</li>
<li>Integrates with PAN bus</li>
<li>Supports nested state updates</li>
<li>Time-travel debugging in dev mode</li>
</ul>
<p><strong>Advanced usage:</strong></p>
<div class="sourceCode" id="cb156"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Get nested state</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cartItems <span class="op">=</span> store<span class="op">.</span><span class="fu">getState</span>(<span class="st">&#39;cart.items&#39;</span>)<span class="op">;</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Update nested state</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="fu">setState</span>(<span class="st">&#39;cart.items&#39;</span><span class="op">,</span> [<span class="op">...</span>items<span class="op">,</span> newItem])<span class="op">;</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Subscribe to specific paths</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.total&#39;</span><span class="op">,</span> (value) <span class="kw">=&gt;</span> {</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Cart total changed:&#39;</span><span class="op">,</span> value)<span class="op">;</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Computed properties</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="fu">computed</span>(<span class="st">&#39;cart.itemCount&#39;</span><span class="op">,</span> (state) <span class="kw">=&gt;</span> {</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> state<span class="op">.</span><span class="at">cart</span><span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Actions</span></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="fu">action</span>(<span class="st">&#39;addToCart&#39;</span><span class="op">,</span> (item) <span class="kw">=&gt;</span> {</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cart <span class="op">=</span> store<span class="op">.</span><span class="fu">getState</span>(<span class="st">&#39;cart&#39;</span>)<span class="op">;</span></span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> items <span class="op">=</span> [<span class="op">...</span>cart<span class="op">.</span><span class="at">items</span><span class="op">,</span> item]<span class="op">;</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> total <span class="op">=</span> items<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> item) <span class="kw">=&gt;</span> sum <span class="op">+</span> item<span class="op">.</span><span class="at">price</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>  store<span class="op">.</span><span class="fu">setState</span>({</span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;cart.items&#39;</span><span class="op">:</span> items<span class="op">,</span></span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;cart.total&#39;</span><span class="op">:</span> total</span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Use action</span></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>store<span class="op">.</span><span class="fu">dispatch</span>(<span class="st">&#39;addToCart&#39;</span><span class="op">,</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Product&#39;</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="fl">29.99</span> })<span class="op">;</span></span></code></pre></div>
<h2 id="indexeddb-integration">IndexedDB Integration</h2>
<p>For large datasets or offline capability, use IndexedDB:</p>
<h3 id="basic-indexeddb-wrapper">Basic IndexedDB Wrapper</h3>
<div class="sourceCode" id="cb157"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/db.js</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Database {</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(name<span class="op">,</span> version <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">name</span> <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">version</span> <span class="op">=</span> version<span class="op">;</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">db</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">open</span>(stores) {</span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> request <span class="op">=</span> indexedDB<span class="op">.</span><span class="fu">open</span>(<span class="kw">this</span><span class="op">.</span><span class="at">name</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">version</span>)<span class="op">;</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reject</span>(request<span class="op">.</span><span class="at">error</span>)<span class="op">;</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">db</span> <span class="op">=</span> request<span class="op">.</span><span class="at">result</span><span class="op">;</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resolve</span>(<span class="kw">this</span><span class="op">.</span><span class="at">db</span>)<span class="op">;</span></span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onupgradeneeded</span> <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> db <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">result</span><span class="op">;</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>        stores<span class="op">.</span><span class="fu">forEach</span>(({ name<span class="op">,</span> keyPath<span class="op">,</span> indexes }) <span class="kw">=&gt;</span> {</span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="op">!</span>db<span class="op">.</span><span class="at">objectStoreNames</span><span class="op">.</span><span class="fu">contains</span>(name)) {</span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> store <span class="op">=</span> db<span class="op">.</span><span class="fu">createObjectStore</span>(name<span class="op">,</span> { keyPath })<span class="op">;</span></span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>            indexes<span class="op">?.</span><span class="fu">forEach</span>(({ name<span class="op">,</span> keyPath<span class="op">,</span> options }) <span class="kw">=&gt;</span> {</span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>              store<span class="op">.</span><span class="fu">createIndex</span>(name<span class="op">,</span> keyPath<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-34"><a href="#cb157-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-35"><a href="#cb157-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">add</span>(storeName<span class="op">,</span> data) {</span>
<span id="cb157-36"><a href="#cb157-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tx <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">transaction</span>(storeName<span class="op">,</span> <span class="st">&#39;readwrite&#39;</span>)<span class="op">;</span></span>
<span id="cb157-37"><a href="#cb157-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> store <span class="op">=</span> tx<span class="op">.</span><span class="fu">objectStore</span>(storeName)<span class="op">;</span></span>
<span id="cb157-38"><a href="#cb157-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-39"><a href="#cb157-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb157-40"><a href="#cb157-40" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> request <span class="op">=</span> store<span class="op">.</span><span class="fu">add</span>(data)<span class="op">;</span></span>
<span id="cb157-41"><a href="#cb157-41" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">resolve</span>(request<span class="op">.</span><span class="at">result</span>)<span class="op">;</span></span>
<span id="cb157-42"><a href="#cb157-42" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reject</span>(request<span class="op">.</span><span class="at">error</span>)<span class="op">;</span></span>
<span id="cb157-43"><a href="#cb157-43" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb157-44"><a href="#cb157-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-45"><a href="#cb157-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-46"><a href="#cb157-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">get</span>(storeName<span class="op">,</span> key) {</span>
<span id="cb157-47"><a href="#cb157-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tx <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">transaction</span>(storeName<span class="op">,</span> <span class="st">&#39;readonly&#39;</span>)<span class="op">;</span></span>
<span id="cb157-48"><a href="#cb157-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> store <span class="op">=</span> tx<span class="op">.</span><span class="fu">objectStore</span>(storeName)<span class="op">;</span></span>
<span id="cb157-49"><a href="#cb157-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-50"><a href="#cb157-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb157-51"><a href="#cb157-51" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> request <span class="op">=</span> store<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb157-52"><a href="#cb157-52" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">resolve</span>(request<span class="op">.</span><span class="at">result</span>)<span class="op">;</span></span>
<span id="cb157-53"><a href="#cb157-53" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reject</span>(request<span class="op">.</span><span class="at">error</span>)<span class="op">;</span></span>
<span id="cb157-54"><a href="#cb157-54" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb157-55"><a href="#cb157-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-56"><a href="#cb157-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-57"><a href="#cb157-57" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getAll</span>(storeName) {</span>
<span id="cb157-58"><a href="#cb157-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tx <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">transaction</span>(storeName<span class="op">,</span> <span class="st">&#39;readonly&#39;</span>)<span class="op">;</span></span>
<span id="cb157-59"><a href="#cb157-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> store <span class="op">=</span> tx<span class="op">.</span><span class="fu">objectStore</span>(storeName)<span class="op">;</span></span>
<span id="cb157-60"><a href="#cb157-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-61"><a href="#cb157-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb157-62"><a href="#cb157-62" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> request <span class="op">=</span> store<span class="op">.</span><span class="fu">getAll</span>()<span class="op">;</span></span>
<span id="cb157-63"><a href="#cb157-63" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">resolve</span>(request<span class="op">.</span><span class="at">result</span>)<span class="op">;</span></span>
<span id="cb157-64"><a href="#cb157-64" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reject</span>(request<span class="op">.</span><span class="at">error</span>)<span class="op">;</span></span>
<span id="cb157-65"><a href="#cb157-65" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb157-66"><a href="#cb157-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-67"><a href="#cb157-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-68"><a href="#cb157-68" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">update</span>(storeName<span class="op">,</span> data) {</span>
<span id="cb157-69"><a href="#cb157-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tx <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">transaction</span>(storeName<span class="op">,</span> <span class="st">&#39;readwrite&#39;</span>)<span class="op">;</span></span>
<span id="cb157-70"><a href="#cb157-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> store <span class="op">=</span> tx<span class="op">.</span><span class="fu">objectStore</span>(storeName)<span class="op">;</span></span>
<span id="cb157-71"><a href="#cb157-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-72"><a href="#cb157-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb157-73"><a href="#cb157-73" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> request <span class="op">=</span> store<span class="op">.</span><span class="fu">put</span>(data)<span class="op">;</span></span>
<span id="cb157-74"><a href="#cb157-74" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">resolve</span>(request<span class="op">.</span><span class="at">result</span>)<span class="op">;</span></span>
<span id="cb157-75"><a href="#cb157-75" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reject</span>(request<span class="op">.</span><span class="at">error</span>)<span class="op">;</span></span>
<span id="cb157-76"><a href="#cb157-76" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb157-77"><a href="#cb157-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-78"><a href="#cb157-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-79"><a href="#cb157-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">delete</span>(storeName<span class="op">,</span> key) {</span>
<span id="cb157-80"><a href="#cb157-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tx <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">transaction</span>(storeName<span class="op">,</span> <span class="st">&#39;readwrite&#39;</span>)<span class="op">;</span></span>
<span id="cb157-81"><a href="#cb157-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> store <span class="op">=</span> tx<span class="op">.</span><span class="fu">objectStore</span>(storeName)<span class="op">;</span></span>
<span id="cb157-82"><a href="#cb157-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-83"><a href="#cb157-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb157-84"><a href="#cb157-84" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> request <span class="op">=</span> store<span class="op">.</span><span class="fu">delete</span>(key)<span class="op">;</span></span>
<span id="cb157-85"><a href="#cb157-85" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">resolve</span>(request<span class="op">.</span><span class="at">result</span>)<span class="op">;</span></span>
<span id="cb157-86"><a href="#cb157-86" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reject</span>(request<span class="op">.</span><span class="at">error</span>)<span class="op">;</span></span>
<span id="cb157-87"><a href="#cb157-87" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb157-88"><a href="#cb157-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-89"><a href="#cb157-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-90"><a href="#cb157-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">clear</span>(storeName) {</span>
<span id="cb157-91"><a href="#cb157-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tx <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">transaction</span>(storeName<span class="op">,</span> <span class="st">&#39;readwrite&#39;</span>)<span class="op">;</span></span>
<span id="cb157-92"><a href="#cb157-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> store <span class="op">=</span> tx<span class="op">.</span><span class="fu">objectStore</span>(storeName)<span class="op">;</span></span>
<span id="cb157-93"><a href="#cb157-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-94"><a href="#cb157-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Promise</span>((resolve<span class="op">,</span> reject) <span class="kw">=&gt;</span> {</span>
<span id="cb157-95"><a href="#cb157-95" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> request <span class="op">=</span> store<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb157-96"><a href="#cb157-96" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onsuccess</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">resolve</span>(request<span class="op">.</span><span class="at">result</span>)<span class="op">;</span></span>
<span id="cb157-97"><a href="#cb157-97" aria-hidden="true" tabindex="-1"></a>      request<span class="op">.</span><span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="fu">reject</span>(request<span class="op">.</span><span class="at">error</span>)<span class="op">;</span></span>
<span id="cb157-98"><a href="#cb157-98" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb157-99"><a href="#cb157-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-100"><a href="#cb157-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-101"><a href="#cb157-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-102"><a href="#cb157-102" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize database</span></span>
<span id="cb157-103"><a href="#cb157-103" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> db <span class="op">=</span> <span class="kw">new</span> <span class="fu">Database</span>(<span class="st">&#39;MyApp&#39;</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb157-104"><a href="#cb157-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-105"><a href="#cb157-105" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> db<span class="op">.</span><span class="fu">open</span>([</span>
<span id="cb157-106"><a href="#cb157-106" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb157-107"><a href="#cb157-107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;todos&#39;</span><span class="op">,</span></span>
<span id="cb157-108"><a href="#cb157-108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">keyPath</span><span class="op">:</span> <span class="st">&#39;id&#39;</span><span class="op">,</span></span>
<span id="cb157-109"><a href="#cb157-109" aria-hidden="true" tabindex="-1"></a>    <span class="dt">indexes</span><span class="op">:</span> [</span>
<span id="cb157-110"><a href="#cb157-110" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;by-status&#39;</span><span class="op">,</span> <span class="dt">keyPath</span><span class="op">:</span> <span class="st">&#39;status&#39;</span> }<span class="op">,</span></span>
<span id="cb157-111"><a href="#cb157-111" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;by-created&#39;</span><span class="op">,</span> <span class="dt">keyPath</span><span class="op">:</span> <span class="st">&#39;createdAt&#39;</span> }</span>
<span id="cb157-112"><a href="#cb157-112" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb157-113"><a href="#cb157-113" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb157-114"><a href="#cb157-114" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb157-115"><a href="#cb157-115" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;users&#39;</span><span class="op">,</span></span>
<span id="cb157-116"><a href="#cb157-116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">keyPath</span><span class="op">:</span> <span class="st">&#39;id&#39;</span></span>
<span id="cb157-117"><a href="#cb157-117" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-118"><a href="#cb157-118" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb158"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { db } <span class="im">from</span> <span class="st">&#39;../lib/db.js&#39;</span><span class="op">;</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoList <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load todos from IndexedDB</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">getAll</span>(<span class="st">&#39;todos&#39;</span>)<span class="op">;</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to changes</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;todo.added&#39;</span><span class="op">,</span> <span class="kw">async</span> ({ todo }) <span class="kw">=&gt;</span> {</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> db<span class="op">.</span><span class="fu">add</span>(<span class="st">&#39;todos&#39;</span><span class="op">,</span> todo)<span class="op">;</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">getAll</span>(<span class="st">&#39;todos&#39;</span>)<span class="op">;</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;todo.updated&#39;</span><span class="op">,</span> <span class="kw">async</span> ({ todo }) <span class="kw">=&gt;</span> {</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> db<span class="op">.</span><span class="fu">update</span>(<span class="st">&#39;todos&#39;</span><span class="op">,</span> todo)<span class="op">;</span></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">getAll</span>(<span class="st">&#39;todos&#39;</span>)<span class="op">;</span></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;todo.deleted&#39;</span><span class="op">,</span> <span class="kw">async</span> ({ id }) <span class="kw">=&gt;</span> {</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> db<span class="op">.</span><span class="fu">delete</span>(<span class="st">&#39;todos&#39;</span><span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">todos</span> <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">getAll</span>(<span class="st">&#39;todos&#39;</span>)<span class="op">;</span></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;ul&gt;</span></span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">todos</span><span class="op">.</span><span class="fu">map</span>(todo <span class="kw">=&gt;</span> <span class="vs">`</span></span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;li&gt;</span></span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span&gt;</span><span class="sc">${</span>todo<span class="op">.</span><span class="at">text</span><span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;button data-id=&quot;</span><span class="sc">${</span>todo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">&quot;&gt;Delete&lt;/button&gt;</span></span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/li&gt;</span></span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a><span class="vs">        `</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;&#39;</span>)<span class="sc">}</span></span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/ul&gt;</span></span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb158-41"><a href="#cb158-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="cache-first-strategy">Cache-First Strategy</h3>
<p>Implement cache-first data loading:</p>
<div class="sourceCode" id="cb159"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataManager {</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(storeName) {</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">storeName</span> <span class="op">=</span> storeName<span class="op">;</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">cache</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">get</span>(id) {</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Check memory cache</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">has</span>(id)) {</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">get</span>(id)<span class="op">;</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Check IndexedDB</span></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cached <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">get</span>(<span class="kw">this</span><span class="op">.</span><span class="at">storeName</span><span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cached) {</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(id<span class="op">,</span> cached)<span class="op">;</span></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cached<span class="op">;</span></span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Fetch from API</span></span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetchFromAPI</span>(id)<span class="op">;</span></span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. Store in cache and IndexedDB</span></span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(id<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> db<span class="op">.</span><span class="fu">add</span>(<span class="kw">this</span><span class="op">.</span><span class="at">storeName</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">fetchFromAPI</span>(id) {</span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">storeName</span><span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">refresh</span>(id) {</span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Force refresh from API</span></span>
<span id="cb159-37"><a href="#cb159-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetchFromAPI</span>(id)<span class="op">;</span></span>
<span id="cb159-38"><a href="#cb159-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-39"><a href="#cb159-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update cache and IndexedDB</span></span>
<span id="cb159-40"><a href="#cb159-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(id<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb159-41"><a href="#cb159-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> db<span class="op">.</span><span class="fu">update</span>(<span class="kw">this</span><span class="op">.</span><span class="at">storeName</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb159-42"><a href="#cb159-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-43"><a href="#cb159-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb159-44"><a href="#cb159-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-45"><a href="#cb159-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-46"><a href="#cb159-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getAll</span>() {</span>
<span id="cb159-47"><a href="#cb159-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Load from IndexedDB first</span></span>
<span id="cb159-48"><a href="#cb159-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> items <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">getAll</span>(<span class="kw">this</span><span class="op">.</span><span class="at">storeName</span>)<span class="op">;</span></span>
<span id="cb159-49"><a href="#cb159-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-50"><a href="#cb159-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cache in memory</span></span>
<span id="cb159-51"><a href="#cb159-51" aria-hidden="true" tabindex="-1"></a>    items<span class="op">.</span><span class="fu">forEach</span>(item <span class="kw">=&gt;</span> {</span>
<span id="cb159-52"><a href="#cb159-52" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(item<span class="op">.</span><span class="at">id</span><span class="op">,</span> item)<span class="op">;</span></span>
<span id="cb159-53"><a href="#cb159-53" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb159-54"><a href="#cb159-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-55"><a href="#cb159-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> items<span class="op">;</span></span>
<span id="cb159-56"><a href="#cb159-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb159-57"><a href="#cb159-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-58"><a href="#cb159-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-59"><a href="#cb159-59" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb159-60"><a href="#cb159-60" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> userManager <span class="op">=</span> <span class="kw">new</span> <span class="fu">DataManager</span>(<span class="st">&#39;users&#39;</span>)<span class="op">;</span></span>
<span id="cb159-61"><a href="#cb159-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-62"><a href="#cb159-62" aria-hidden="true" tabindex="-1"></a><span class="co">// Always returns fast (from cache if available)</span></span>
<span id="cb159-63"><a href="#cb159-63" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> userManager<span class="op">.</span><span class="fu">get</span>(<span class="dv">123</span>)<span class="op">;</span></span>
<span id="cb159-64"><a href="#cb159-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-65"><a href="#cb159-65" aria-hidden="true" tabindex="-1"></a><span class="co">// Force refresh</span></span>
<span id="cb159-66"><a href="#cb159-66" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> freshUser <span class="op">=</span> <span class="cf">await</span> userManager<span class="op">.</span><span class="fu">refresh</span>(<span class="dv">123</span>)<span class="op">;</span></span></code></pre></div>
<h2 id="persistence-strategies">Persistence Strategies</h2>
<h3 id="localstorage">localStorage</h3>
<p>Simple key-value storage:</p>
<div class="sourceCode" id="cb160"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PersistentState {</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(key) {</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">key</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">state</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">load</span>()<span class="op">;</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>() {</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="kw">this</span><span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> data <span class="op">?</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(data) <span class="op">:</span> {}<span class="op">;</span></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Failed to load state:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {}<span class="op">;</span></span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>() {</span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a>      localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="kw">this</span><span class="op">.</span><span class="at">key</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="kw">this</span><span class="op">.</span><span class="at">state</span>))<span class="op">;</span></span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;Failed to save state:&#39;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span>(path) {</span>
<span id="cb160-26"><a href="#cb160-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getNestedValue</span>(<span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb160-27"><a href="#cb160-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-28"><a href="#cb160-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-29"><a href="#cb160-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(path<span class="op">,</span> value) {</span>
<span id="cb160-30"><a href="#cb160-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setNestedValue</span>(<span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">,</span> path<span class="op">,</span> value)<span class="op">;</span></span>
<span id="cb160-31"><a href="#cb160-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb160-32"><a href="#cb160-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-33"><a href="#cb160-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-34"><a href="#cb160-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getNestedValue</span>(obj<span class="op">,</span> path) {</span>
<span id="cb160-35"><a href="#cb160-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> path<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;.&#39;</span>)<span class="op">.</span><span class="fu">reduce</span>((current<span class="op">,</span> key) <span class="kw">=&gt;</span> current<span class="op">?.</span>[key]<span class="op">,</span> obj)<span class="op">;</span></span>
<span id="cb160-36"><a href="#cb160-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-37"><a href="#cb160-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-38"><a href="#cb160-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNestedValue</span>(obj<span class="op">,</span> path<span class="op">,</span> value) {</span>
<span id="cb160-39"><a href="#cb160-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> keys <span class="op">=</span> path<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;.&#39;</span>)<span class="op">;</span></span>
<span id="cb160-40"><a href="#cb160-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lastKey <span class="op">=</span> keys<span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb160-41"><a href="#cb160-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> target <span class="op">=</span> keys<span class="op">.</span><span class="fu">reduce</span>((current<span class="op">,</span> key) <span class="kw">=&gt;</span> {</span>
<span id="cb160-42"><a href="#cb160-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>(key <span class="kw">in</span> current)) current[key] <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb160-43"><a href="#cb160-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> current[key]<span class="op">;</span></span>
<span id="cb160-44"><a href="#cb160-44" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> obj)<span class="op">;</span></span>
<span id="cb160-45"><a href="#cb160-45" aria-hidden="true" tabindex="-1"></a>    target[lastKey] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb160-46"><a href="#cb160-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-47"><a href="#cb160-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-48"><a href="#cb160-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clear</span>() {</span>
<span id="cb160-49"><a href="#cb160-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">state</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb160-50"><a href="#cb160-50" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="kw">this</span><span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb160-51"><a href="#cb160-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb160-52"><a href="#cb160-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb160-53"><a href="#cb160-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-54"><a href="#cb160-54" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb160-55"><a href="#cb160-55" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> settings <span class="op">=</span> <span class="kw">new</span> <span class="fu">PersistentState</span>(<span class="st">&#39;app-settings&#39;</span>)<span class="op">;</span></span>
<span id="cb160-56"><a href="#cb160-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-57"><a href="#cb160-57" aria-hidden="true" tabindex="-1"></a>settings<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;theme&#39;</span><span class="op">,</span> <span class="st">&#39;dark&#39;</span>)<span class="op">;</span></span>
<span id="cb160-58"><a href="#cb160-58" aria-hidden="true" tabindex="-1"></a>settings<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;user.preferences.notifications&#39;</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb160-59"><a href="#cb160-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-60"><a href="#cb160-60" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(settings<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;theme&#39;</span>))<span class="op">;</span>  <span class="co">// &#39;dark&#39;</span></span>
<span id="cb160-61"><a href="#cb160-61" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(settings<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;user.preferences.notifications&#39;</span>))<span class="op">;</span>  <span class="co">// true</span></span></code></pre></div>
<h3 id="sessionstorage">sessionStorage</h3>
<p>For temporary session data:</p>
<div class="sourceCode" id="cb161"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SessionState {</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(key) {</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">key</span> <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(data) {</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>    sessionStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="kw">this</span><span class="op">.</span><span class="at">key</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data))<span class="op">;</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span>() {</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> sessionStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="kw">this</span><span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data <span class="op">?</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(data) <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clear</span>() {</span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>    sessionStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="kw">this</span><span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage - data persists only for the session</span></span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sessionData <span class="op">=</span> <span class="kw">new</span> <span class="fu">SessionState</span>(<span class="st">&#39;form-draft&#39;</span>)<span class="op">;</span></span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Save form draft</span></span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a>sessionData<span class="op">.</span><span class="fu">set</span>({ <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;user@example.com&#39;</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Draft...&#39;</span> })<span class="op">;</span></span>
<span id="cb161-25"><a href="#cb161-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-26"><a href="#cb161-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Restore on page reload (same session)</span></span>
<span id="cb161-27"><a href="#cb161-27" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> draft <span class="op">=</span> sessionData<span class="op">.</span><span class="fu">get</span>()<span class="op">;</span></span></code></pre></div>
<h3 id="hybrid-strategy">Hybrid Strategy</h3>
<p>Combine localStorage and IndexedDB:</p>
<div class="sourceCode" id="cb162"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HybridStorage {</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(namespace) {</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">namespace</span> <span class="op">=</span> namespace<span class="op">;</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">set</span>(key<span class="op">,</span> value) {</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fullKey <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">namespace</span><span class="sc">}</span><span class="vs">:</span><span class="sc">${</span>key<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Store small data in localStorage</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">isSmall</span>(value)) {</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>      localStorage<span class="op">.</span><span class="fu">setItem</span>(fullKey<span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(value))<span class="op">;</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Store large data in IndexedDB</span></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> db<span class="op">.</span><span class="fu">update</span>(<span class="st">&#39;storage&#39;</span><span class="op">,</span> { <span class="dt">key</span><span class="op">:</span> fullKey<span class="op">,</span> value })<span class="op">;</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">get</span>(key) {</span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fullKey <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">namespace</span><span class="sc">}</span><span class="vs">:</span><span class="sc">${</span>key<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-21"><a href="#cb162-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Try localStorage first</span></span>
<span id="cb162-22"><a href="#cb162-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> local <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(fullKey)<span class="op">;</span></span>
<span id="cb162-23"><a href="#cb162-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (local) {</span>
<span id="cb162-24"><a href="#cb162-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(local)<span class="op">;</span></span>
<span id="cb162-25"><a href="#cb162-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb162-26"><a href="#cb162-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-27"><a href="#cb162-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Try IndexedDB</span></span>
<span id="cb162-28"><a href="#cb162-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;storage&#39;</span><span class="op">,</span> fullKey)<span class="op">;</span></span>
<span id="cb162-29"><a href="#cb162-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">?.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb162-30"><a href="#cb162-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-31"><a href="#cb162-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-32"><a href="#cb162-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">isSmall</span>(value) {</span>
<span id="cb162-33"><a href="#cb162-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> str <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(value)<span class="op">;</span></span>
<span id="cb162-34"><a href="#cb162-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> str<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">10</span><span class="op">;</span> <span class="co">// 10KB threshold</span></span>
<span id="cb162-35"><a href="#cb162-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-36"><a href="#cb162-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-37"><a href="#cb162-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">clear</span>() {</span>
<span id="cb162-38"><a href="#cb162-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear localStorage items</span></span>
<span id="cb162-39"><a href="#cb162-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(localStorage)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb162-40"><a href="#cb162-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (key<span class="op">.</span><span class="fu">startsWith</span>(<span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">namespace</span><span class="sc">}</span><span class="vs">:`</span>)) {</span>
<span id="cb162-41"><a href="#cb162-41" aria-hidden="true" tabindex="-1"></a>        localStorage<span class="op">.</span><span class="fu">removeItem</span>(key)<span class="op">;</span></span>
<span id="cb162-42"><a href="#cb162-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb162-43"><a href="#cb162-43" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb162-44"><a href="#cb162-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-45"><a href="#cb162-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear IndexedDB items</span></span>
<span id="cb162-46"><a href="#cb162-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> all <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">getAll</span>(<span class="st">&#39;storage&#39;</span>)<span class="op">;</span></span>
<span id="cb162-47"><a href="#cb162-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> all) {</span>
<span id="cb162-48"><a href="#cb162-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (item<span class="op">.</span><span class="at">key</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">namespace</span><span class="sc">}</span><span class="vs">:`</span>)) {</span>
<span id="cb162-49"><a href="#cb162-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> db<span class="op">.</span><span class="fu">delete</span>(<span class="st">&#39;storage&#39;</span><span class="op">,</span> item<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb162-50"><a href="#cb162-50" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb162-51"><a href="#cb162-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb162-52"><a href="#cb162-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-53"><a href="#cb162-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="offline-first-applications">Offline-First Applications</h2>
<p>Build applications that work without connectivity:</p>
<h3 id="service-worker-state-management">Service Worker + State
Management</h3>
<div class="sourceCode" id="cb163"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">// sw.js - Service Worker</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;install&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">event</span><span class="op">.</span><span class="fu">waitUntil</span>(</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    caches<span class="op">.</span><span class="fu">open</span>(<span class="st">&#39;v1&#39;</span>)<span class="op">.</span><span class="fu">then</span>((cache) <span class="kw">=&gt;</span> {</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cache<span class="op">.</span><span class="fu">addAll</span>([</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;/&#39;</span><span class="op">,</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;/index.html&#39;</span><span class="op">,</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;/src/app.js&#39;</span><span class="op">,</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;/src/components/&#39;</span><span class="op">,</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cache critical assets</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>      ])<span class="op">;</span></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;fetch&#39;</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>  <span class="bu">event</span><span class="op">.</span><span class="fu">respondWith</span>(</span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a>    caches<span class="op">.</span><span class="fu">match</span>(<span class="bu">event</span><span class="op">.</span><span class="at">request</span>)<span class="op">.</span><span class="fu">then</span>((response) <span class="kw">=&gt;</span> {</span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Return cached version or fetch</span></span>
<span id="cb163-20"><a href="#cb163-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> response <span class="op">||</span> <span class="fu">fetch</span>(<span class="bu">event</span><span class="op">.</span><span class="at">request</span>)<span class="op">;</span></span>
<span id="cb163-21"><a href="#cb163-21" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb163-22"><a href="#cb163-22" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb163-23"><a href="#cb163-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="sync-queue">Sync Queue</h3>
<p>Queue operations when offline:</p>
<div class="sourceCode" id="cb164"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/sync-queue.js</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SyncQueue {</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">queue</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">loadQueue</span>()<span class="op">;</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">processing</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Listen for online events</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;online&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">process</span>()<span class="op">;</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start processing if online</span></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">navigator</span><span class="op">.</span><span class="at">onLine</span>) {</span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">process</span>()<span class="op">;</span></span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loadQueue</span>() {</span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;sync-queue&#39;</span>)<span class="op">;</span></span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data <span class="op">?</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(data) <span class="op">:</span> []<span class="op">;</span></span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveQueue</span>() {</span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;sync-queue&#39;</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="kw">this</span><span class="op">.</span><span class="at">queue</span>))<span class="op">;</span></span>
<span id="cb164-25"><a href="#cb164-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-26"><a href="#cb164-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-27"><a href="#cb164-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add</span>(operation) {</span>
<span id="cb164-28"><a href="#cb164-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb164-29"><a href="#cb164-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">,</span></span>
<span id="cb164-30"><a href="#cb164-30" aria-hidden="true" tabindex="-1"></a>      operation<span class="op">,</span></span>
<span id="cb164-31"><a href="#cb164-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb164-32"><a href="#cb164-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">attempts</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb164-33"><a href="#cb164-33" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb164-34"><a href="#cb164-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-35"><a href="#cb164-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">saveQueue</span>()<span class="op">;</span></span>
<span id="cb164-36"><a href="#cb164-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-37"><a href="#cb164-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">navigator</span><span class="op">.</span><span class="at">onLine</span>) {</span>
<span id="cb164-38"><a href="#cb164-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">process</span>()<span class="op">;</span></span>
<span id="cb164-39"><a href="#cb164-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb164-40"><a href="#cb164-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-41"><a href="#cb164-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-42"><a href="#cb164-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="bu">process</span>() {</span>
<span id="cb164-43"><a href="#cb164-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">processing</span> <span class="op">||</span> <span class="kw">this</span><span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb164-44"><a href="#cb164-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb164-45"><a href="#cb164-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb164-46"><a href="#cb164-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-47"><a href="#cb164-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">processing</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb164-48"><a href="#cb164-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-49"><a href="#cb164-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="kw">this</span><span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">onLine</span>) {</span>
<span id="cb164-50"><a href="#cb164-50" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> item <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">queue</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb164-51"><a href="#cb164-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-52"><a href="#cb164-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span> {</span>
<span id="cb164-53"><a href="#cb164-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">executeOperation</span>(item<span class="op">.</span><span class="at">operation</span>)<span class="op">;</span></span>
<span id="cb164-54"><a href="#cb164-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-55"><a href="#cb164-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Success - remove from queue</span></span>
<span id="cb164-56"><a href="#cb164-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">shift</span>()<span class="op">;</span></span>
<span id="cb164-57"><a href="#cb164-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">saveQueue</span>()<span class="op">;</span></span>
<span id="cb164-58"><a href="#cb164-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-59"><a href="#cb164-59" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;sync.success&#39;</span><span class="op">,</span> { <span class="dt">operation</span><span class="op">:</span> item<span class="op">.</span><span class="at">operation</span> })<span class="op">;</span></span>
<span id="cb164-60"><a href="#cb164-60" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">catch</span> (error) {</span>
<span id="cb164-61"><a href="#cb164-61" aria-hidden="true" tabindex="-1"></a>        item<span class="op">.</span><span class="at">attempts</span><span class="op">++;</span></span>
<span id="cb164-62"><a href="#cb164-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-63"><a href="#cb164-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (item<span class="op">.</span><span class="at">attempts</span> <span class="op">&gt;=</span> <span class="dv">3</span>) {</span>
<span id="cb164-64"><a href="#cb164-64" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Max attempts - remove and report error</span></span>
<span id="cb164-65"><a href="#cb164-65" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">shift</span>()<span class="op">;</span></span>
<span id="cb164-66"><a href="#cb164-66" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="fu">saveQueue</span>()<span class="op">;</span></span>
<span id="cb164-67"><a href="#cb164-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-68"><a href="#cb164-68" aria-hidden="true" tabindex="-1"></a>          pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;sync.failed&#39;</span><span class="op">,</span> {</span>
<span id="cb164-69"><a href="#cb164-69" aria-hidden="true" tabindex="-1"></a>            <span class="dt">operation</span><span class="op">:</span> item<span class="op">.</span><span class="at">operation</span><span class="op">,</span></span>
<span id="cb164-70"><a href="#cb164-70" aria-hidden="true" tabindex="-1"></a>            <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span></span>
<span id="cb164-71"><a href="#cb164-71" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb164-72"><a href="#cb164-72" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb164-73"><a href="#cb164-73" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Retry later</span></span>
<span id="cb164-74"><a href="#cb164-74" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb164-75"><a href="#cb164-75" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb164-76"><a href="#cb164-76" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb164-77"><a href="#cb164-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb164-78"><a href="#cb164-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-79"><a href="#cb164-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">processing</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb164-80"><a href="#cb164-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-81"><a href="#cb164-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-82"><a href="#cb164-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">executeOperation</span>(operation) {</span>
<span id="cb164-83"><a href="#cb164-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> (operation<span class="op">.</span><span class="at">type</span>) {</span>
<span id="cb164-84"><a href="#cb164-84" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;CREATE&#39;</span><span class="op">:</span></span>
<span id="cb164-85"><a href="#cb164-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">create</span>(operation<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb164-86"><a href="#cb164-86" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;UPDATE&#39;</span><span class="op">:</span></span>
<span id="cb164-87"><a href="#cb164-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">update</span>(operation<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb164-88"><a href="#cb164-88" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="st">&#39;DELETE&#39;</span><span class="op">:</span></span>
<span id="cb164-89"><a href="#cb164-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">delete</span>(operation<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb164-90"><a href="#cb164-90" aria-hidden="true" tabindex="-1"></a>      <span class="cf">default</span><span class="op">:</span></span>
<span id="cb164-91"><a href="#cb164-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Unknown operation: </span><span class="sc">${</span>operation<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb164-92"><a href="#cb164-92" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb164-93"><a href="#cb164-93" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-94"><a href="#cb164-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-95"><a href="#cb164-95" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">create</span>(data) {</span>
<span id="cb164-96"><a href="#cb164-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/items&#39;</span><span class="op">,</span> {</span>
<span id="cb164-97"><a href="#cb164-97" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb164-98"><a href="#cb164-98" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb164-99"><a href="#cb164-99" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data)</span>
<span id="cb164-100"><a href="#cb164-100" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb164-101"><a href="#cb164-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-102"><a href="#cb164-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Create failed&#39;</span>)<span class="op">;</span></span>
<span id="cb164-103"><a href="#cb164-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb164-104"><a href="#cb164-104" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-105"><a href="#cb164-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-106"><a href="#cb164-106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">update</span>(data) {</span>
<span id="cb164-107"><a href="#cb164-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/items/</span><span class="sc">${</span>data<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> {</span>
<span id="cb164-108"><a href="#cb164-108" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;PUT&#39;</span><span class="op">,</span></span>
<span id="cb164-109"><a href="#cb164-109" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb164-110"><a href="#cb164-110" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data)</span>
<span id="cb164-111"><a href="#cb164-111" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb164-112"><a href="#cb164-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-113"><a href="#cb164-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Update failed&#39;</span>)<span class="op">;</span></span>
<span id="cb164-114"><a href="#cb164-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb164-115"><a href="#cb164-115" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-116"><a href="#cb164-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-117"><a href="#cb164-117" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">delete</span>(id) {</span>
<span id="cb164-118"><a href="#cb164-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/items/</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> {</span>
<span id="cb164-119"><a href="#cb164-119" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;DELETE&#39;</span></span>
<span id="cb164-120"><a href="#cb164-120" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb164-121"><a href="#cb164-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-122"><a href="#cb164-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Delete failed&#39;</span>)<span class="op">;</span></span>
<span id="cb164-123"><a href="#cb164-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-124"><a href="#cb164-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-125"><a href="#cb164-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clear</span>() {</span>
<span id="cb164-126"><a href="#cb164-126" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">queue</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb164-127"><a href="#cb164-127" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">saveQueue</span>()<span class="op">;</span></span>
<span id="cb164-128"><a href="#cb164-128" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-129"><a href="#cb164-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-130"><a href="#cb164-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getStatus</span>() {</span>
<span id="cb164-131"><a href="#cb164-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb164-132"><a href="#cb164-132" aria-hidden="true" tabindex="-1"></a>      <span class="dt">queued</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb164-133"><a href="#cb164-133" aria-hidden="true" tabindex="-1"></a>      <span class="dt">online</span><span class="op">:</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">onLine</span><span class="op">,</span></span>
<span id="cb164-134"><a href="#cb164-134" aria-hidden="true" tabindex="-1"></a>      <span class="dt">processing</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">processing</span></span>
<span id="cb164-135"><a href="#cb164-135" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb164-136"><a href="#cb164-136" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb164-137"><a href="#cb164-137" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb164-138"><a href="#cb164-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-139"><a href="#cb164-139" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> syncQueue <span class="op">=</span> <span class="kw">new</span> <span class="fu">SyncQueue</span>()<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb165"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { syncQueue } <span class="im">from</span> <span class="st">&#39;../lib/sync-queue.js&#39;</span><span class="op">;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoManager {</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">addTodo</span>(text) {</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> todo <span class="op">=</span> {</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>      text<span class="op">,</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">completed</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">createdAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save locally immediately</span></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> db<span class="op">.</span><span class="fu">add</span>(<span class="st">&#39;todos&#39;</span><span class="op">,</span> todo)<span class="op">;</span></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;todo.added&#39;</span><span class="op">,</span> { todo })<span class="op">;</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Queue for server sync</span></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="bu">navigator</span><span class="op">.</span><span class="at">onLine</span>) {</span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>      syncQueue<span class="op">.</span><span class="fu">add</span>({</span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;CREATE&#39;</span><span class="op">,</span></span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">data</span><span class="op">:</span> todo</span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb165-22"><a href="#cb165-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-23"><a href="#cb165-23" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;notification.info&#39;</span><span class="op">,</span> {</span>
<span id="cb165-24"><a href="#cb165-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Saved locally. Will sync when online.&#39;</span></span>
<span id="cb165-25"><a href="#cb165-25" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb165-26"><a href="#cb165-26" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb165-27"><a href="#cb165-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Online - sync immediately</span></span>
<span id="cb165-28"><a href="#cb165-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span> {</span>
<span id="cb165-29"><a href="#cb165-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">syncToServer</span>(todo)<span class="op">;</span></span>
<span id="cb165-30"><a href="#cb165-30" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">catch</span> (error) {</span>
<span id="cb165-31"><a href="#cb165-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Failed - add to queue</span></span>
<span id="cb165-32"><a href="#cb165-32" aria-hidden="true" tabindex="-1"></a>        syncQueue<span class="op">.</span><span class="fu">add</span>({</span>
<span id="cb165-33"><a href="#cb165-33" aria-hidden="true" tabindex="-1"></a>          <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;CREATE&#39;</span><span class="op">,</span></span>
<span id="cb165-34"><a href="#cb165-34" aria-hidden="true" tabindex="-1"></a>          <span class="dt">data</span><span class="op">:</span> todo</span>
<span id="cb165-35"><a href="#cb165-35" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb165-36"><a href="#cb165-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb165-37"><a href="#cb165-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb165-38"><a href="#cb165-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-39"><a href="#cb165-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-40"><a href="#cb165-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">syncToServer</span>(todo) {</span>
<span id="cb165-41"><a href="#cb165-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/todos&#39;</span><span class="op">,</span> {</span>
<span id="cb165-42"><a href="#cb165-42" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb165-43"><a href="#cb165-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb165-44"><a href="#cb165-44" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(todo)</span>
<span id="cb165-45"><a href="#cb165-45" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb165-46"><a href="#cb165-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-47"><a href="#cb165-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb165-48"><a href="#cb165-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Sync failed&#39;</span>)<span class="op">;</span></span>
<span id="cb165-49"><a href="#cb165-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb165-50"><a href="#cb165-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-51"><a href="#cb165-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb165-52"><a href="#cb165-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-53"><a href="#cb165-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update local copy with server ID</span></span>
<span id="cb165-54"><a href="#cb165-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> db<span class="op">.</span><span class="fu">update</span>(<span class="st">&#39;todos&#39;</span><span class="op">,</span> { <span class="op">...</span>todo<span class="op">,</span> <span class="dt">serverId</span><span class="op">:</span> result<span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb165-55"><a href="#cb165-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-56"><a href="#cb165-56" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="summary-5">Summary</h2>
<p>This chapter covered state management at every level:</p>
<ul>
<li><strong>Component-Local State</strong>: Instance properties, private
fields, and state objects</li>
<li><strong>Shared State</strong>: Global state, reactive proxies, and
store patterns</li>
<li><strong>pan-store</strong>: Built-in state management component</li>
<li><strong>IndexedDB</strong>: Large dataset storage and offline
capability</li>
<li><strong>Persistence</strong>: localStorage, sessionStorage, and
hybrid strategies</li>
<li><strong>Offline-First</strong>: Service workers, sync queues, and
conflict resolution</li>
</ul>
<p>Choose the simplest solution that meets your needs, then scale up
complexity as requirements grow.</p>
<hr />
<h2 id="best-practices-2">Best Practices</h2>
<ol type="1">
<li><strong>Start with local state</strong>
<ul>
<li>Only share state when necessary</li>
<li>Keeps components independent</li>
<li>Easier to test and debug</li>
</ul></li>
<li><strong>Use IndexedDB for large data</strong>
<ul>
<li>localStorage limited to ~5-10MB</li>
<li>IndexedDB can store gigabytes</li>
<li>Better performance for large datasets</li>
</ul></li>
<li><strong>Implement cache-first strategies</strong>
<ul>
<li>Load from cache immediately</li>
<li>Update from server in background</li>
<li>Show stale data rather than loading spinner</li>
</ul></li>
<li><strong>Queue offline operations</strong>
<ul>
<li>Don’t lose user data</li>
<li>Sync when connection restored</li>
<li>Show sync status to user</li>
</ul></li>
<li><strong>Test offline scenarios</strong>
<ul>
<li>Use DevTools to simulate offline</li>
<li>Test sync queue behavior</li>
<li>Verify conflict resolution</li>
</ul></li>
<li><strong>Monitor storage usage</strong>
<ul>
<li>Check quota before storing</li>
<li>Clean up old data</li>
<li>Provide clear error messages when full </li>
</ul></li>
</ol>
<h1 id="chapter-7-advanced-component-patterns">Chapter 7: Advanced
Component Patterns</h1>
<p>As your LARC applications grow, you’ll encounter scenarios that
require sophisticated component architectures. This chapter explores
advanced patterns that enable code reuse, flexible composition, and
optimal performance.</p>
<p>These patterns come from years of component-based development across
frameworks. LARC implements them using web standards, making them
portable and future-proof.</p>
<h2 id="compound-components">Compound Components</h2>
<p>Compound components work together as a set, sharing implicit state.
Think of HTML’s <code>&lt;select&gt;</code> and
<code>&lt;option&gt;</code> elements—they form a cohesive unit.</p>
<h3 id="basic-compound-component">Basic Compound Component</h3>
<div class="sourceCode" id="cb166"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co">// tabs.js - Container component</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TabGroup <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">activeTab</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setupTabs</span>()<span class="op">;</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setupTabs</span>() {</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get all tab headers</span></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> headers <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;tab-header&#39;</span>)<span class="op">;</span></span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>    headers<span class="op">.</span><span class="fu">forEach</span>((header<span class="op">,</span> index) <span class="kw">=&gt;</span> {</span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>      header<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">activeTab</span> <span class="op">=</span> index<span class="op">;</span></span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">updateTabs</span>()<span class="op">;</span></span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateTabs</span>()<span class="op">;</span></span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateTabs</span>() {</span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update headers</span></span>
<span id="cb166-29"><a href="#cb166-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> headers <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;tab-header&#39;</span>)<span class="op">;</span></span>
<span id="cb166-30"><a href="#cb166-30" aria-hidden="true" tabindex="-1"></a>    headers<span class="op">.</span><span class="fu">forEach</span>((header<span class="op">,</span> index) <span class="kw">=&gt;</span> {</span>
<span id="cb166-31"><a href="#cb166-31" aria-hidden="true" tabindex="-1"></a>      header<span class="op">.</span><span class="at">active</span> <span class="op">=</span> index <span class="op">===</span> <span class="kw">this</span><span class="op">.</span><span class="at">activeTab</span><span class="op">;</span></span>
<span id="cb166-32"><a href="#cb166-32" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb166-33"><a href="#cb166-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-34"><a href="#cb166-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update panels</span></span>
<span id="cb166-35"><a href="#cb166-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> panels <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;tab-panel&#39;</span>)<span class="op">;</span></span>
<span id="cb166-36"><a href="#cb166-36" aria-hidden="true" tabindex="-1"></a>    panels<span class="op">.</span><span class="fu">forEach</span>((panel<span class="op">,</span> index) <span class="kw">=&gt;</span> {</span>
<span id="cb166-37"><a href="#cb166-37" aria-hidden="true" tabindex="-1"></a>      panel<span class="op">.</span><span class="at">active</span> <span class="op">=</span> index <span class="op">===</span> <span class="kw">this</span><span class="op">.</span><span class="at">activeTab</span><span class="op">;</span></span>
<span id="cb166-38"><a href="#cb166-38" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb166-39"><a href="#cb166-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-40"><a href="#cb166-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-41"><a href="#cb166-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb166-42"><a href="#cb166-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb166-43"><a href="#cb166-43" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb166-44"><a href="#cb166-44" aria-hidden="true" tabindex="-1"></a><span class="vs">        :host {</span></span>
<span id="cb166-45"><a href="#cb166-45" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb166-46"><a href="#cb166-46" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb166-47"><a href="#cb166-47" aria-hidden="true" tabindex="-1"></a><span class="vs">        .headers {</span></span>
<span id="cb166-48"><a href="#cb166-48" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: flex;</span></span>
<span id="cb166-49"><a href="#cb166-49" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-bottom: 2px solid #e2e8f0;</span></span>
<span id="cb166-50"><a href="#cb166-50" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb166-51"><a href="#cb166-51" aria-hidden="true" tabindex="-1"></a><span class="vs">        .panels {</span></span>
<span id="cb166-52"><a href="#cb166-52" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 16px 0;</span></span>
<span id="cb166-53"><a href="#cb166-53" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb166-54"><a href="#cb166-54" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb166-55"><a href="#cb166-55" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;headers&quot;&gt;</span></span>
<span id="cb166-56"><a href="#cb166-56" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;slot name=&quot;headers&quot;&gt;&lt;/slot&gt;</span></span>
<span id="cb166-57"><a href="#cb166-57" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb166-58"><a href="#cb166-58" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;panels&quot;&gt;</span></span>
<span id="cb166-59"><a href="#cb166-59" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;slot name=&quot;panels&quot;&gt;&lt;/slot&gt;</span></span>
<span id="cb166-60"><a href="#cb166-60" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb166-61"><a href="#cb166-61" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb166-62"><a href="#cb166-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-63"><a href="#cb166-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-64"><a href="#cb166-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-65"><a href="#cb166-65" aria-hidden="true" tabindex="-1"></a><span class="co">// tab-header.js</span></span>
<span id="cb166-66"><a href="#cb166-66" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TabHeader <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb166-67"><a href="#cb166-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb166-68"><a href="#cb166-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb166-69"><a href="#cb166-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb166-70"><a href="#cb166-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-71"><a href="#cb166-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-72"><a href="#cb166-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">active</span>(value) {</span>
<span id="cb166-73"><a href="#cb166-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_active</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb166-74"><a href="#cb166-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb166-75"><a href="#cb166-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-76"><a href="#cb166-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-77"><a href="#cb166-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb166-78"><a href="#cb166-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb166-79"><a href="#cb166-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-80"><a href="#cb166-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-81"><a href="#cb166-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb166-82"><a href="#cb166-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb166-83"><a href="#cb166-83" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb166-84"><a href="#cb166-84" aria-hidden="true" tabindex="-1"></a><span class="vs">        button {</span></span>
<span id="cb166-85"><a href="#cb166-85" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 12px 24px;</span></span>
<span id="cb166-86"><a href="#cb166-86" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: none;</span></span>
<span id="cb166-87"><a href="#cb166-87" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_active</span> <span class="op">?</span> <span class="st">&#39;#667eea&#39;</span> <span class="op">:</span> <span class="st">&#39;transparent&#39;</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb166-88"><a href="#cb166-88" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_active</span> <span class="op">?</span> <span class="st">&#39;white&#39;</span> <span class="op">:</span> <span class="st">&#39;#4a5568&#39;</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb166-89"><a href="#cb166-89" aria-hidden="true" tabindex="-1"></a><span class="vs">          cursor: pointer;</span></span>
<span id="cb166-90"><a href="#cb166-90" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-weight: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_active</span> <span class="op">?</span> <span class="st">&#39;600&#39;</span> <span class="op">:</span> <span class="st">&#39;400&#39;</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb166-91"><a href="#cb166-91" aria-hidden="true" tabindex="-1"></a><span class="vs">          transition: all 0.2s;</span></span>
<span id="cb166-92"><a href="#cb166-92" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb166-93"><a href="#cb166-93" aria-hidden="true" tabindex="-1"></a><span class="vs">        button:hover {</span></span>
<span id="cb166-94"><a href="#cb166-94" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_active</span> <span class="op">?</span> <span class="st">&#39;#5a67d8&#39;</span> <span class="op">:</span> <span class="st">&#39;#f7fafc&#39;</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb166-95"><a href="#cb166-95" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb166-96"><a href="#cb166-96" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb166-97"><a href="#cb166-97" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/button&gt;</span></span>
<span id="cb166-98"><a href="#cb166-98" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb166-99"><a href="#cb166-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-100"><a href="#cb166-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-101"><a href="#cb166-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-102"><a href="#cb166-102" aria-hidden="true" tabindex="-1"></a><span class="co">// tab-panel.js</span></span>
<span id="cb166-103"><a href="#cb166-103" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TabPanel <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb166-104"><a href="#cb166-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb166-105"><a href="#cb166-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb166-106"><a href="#cb166-106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb166-107"><a href="#cb166-107" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-108"><a href="#cb166-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-109"><a href="#cb166-109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">active</span>(value) {</span>
<span id="cb166-110"><a href="#cb166-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_active</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb166-111"><a href="#cb166-111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> value <span class="op">?</span> <span class="st">&#39;block&#39;</span> <span class="op">:</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></span>
<span id="cb166-112"><a href="#cb166-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-113"><a href="#cb166-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-114"><a href="#cb166-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb166-115"><a href="#cb166-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb166-116"><a href="#cb166-116" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb166-117"><a href="#cb166-117" aria-hidden="true" tabindex="-1"></a><span class="vs">        :host {</span></span>
<span id="cb166-118"><a href="#cb166-118" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb166-119"><a href="#cb166-119" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb166-120"><a href="#cb166-120" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb166-121"><a href="#cb166-121" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb166-122"><a href="#cb166-122" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb166-123"><a href="#cb166-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb166-124"><a href="#cb166-124" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb166-125"><a href="#cb166-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-126"><a href="#cb166-126" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;tab-group&#39;</span><span class="op">,</span> TabGroup)<span class="op">;</span></span>
<span id="cb166-127"><a href="#cb166-127" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;tab-header&#39;</span><span class="op">,</span> TabHeader)<span class="op">;</span></span>
<span id="cb166-128"><a href="#cb166-128" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;tab-panel&#39;</span><span class="op">,</span> TabPanel)<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb167"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">tab-group</span><span class="dt">&gt;</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tab-header</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;headers&quot;</span><span class="dt">&gt;</span>Profile<span class="dt">&lt;/</span><span class="kw">tab-header</span><span class="dt">&gt;</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tab-header</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;headers&quot;</span><span class="dt">&gt;</span>Settings<span class="dt">&lt;/</span><span class="kw">tab-header</span><span class="dt">&gt;</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tab-header</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;headers&quot;</span><span class="dt">&gt;</span>Billing<span class="dt">&lt;/</span><span class="kw">tab-header</span><span class="dt">&gt;</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tab-panel</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;panels&quot;</span><span class="dt">&gt;</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="dt">&gt;</span>Profile Content<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>User profile information...<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">tab-panel</span><span class="dt">&gt;</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tab-panel</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;panels&quot;</span><span class="dt">&gt;</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="dt">&gt;</span>Settings Content<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Application settings...<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">tab-panel</span><span class="dt">&gt;</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">tab-panel</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;panels&quot;</span><span class="dt">&gt;</span></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h2</span><span class="dt">&gt;</span>Billing Content<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Billing information...<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">tab-panel</span><span class="dt">&gt;</span></span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">tab-group</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="context-api-for-compound-components">Context API for Compound
Components</h3>
<p>Share state without prop drilling:</p>
<div class="sourceCode" id="cb168"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/context.js</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> contexts <span class="op">=</span> <span class="kw">new</span> <span class="bu">WeakMap</span>()<span class="op">;</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">createContext</span>(defaultValue) {</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Provider</span><span class="op">:</span> <span class="kw">class</span> <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">constructor</span>() {</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> defaultValue<span class="op">;</span></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>        contexts<span class="op">.</span><span class="fu">set</span>(<span class="kw">this</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">provide</span>(value) {</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>        contexts<span class="op">.</span><span class="fu">set</span>(<span class="kw">this</span><span class="op">,</span> value)<span class="op">;</span></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">notifyConsumers</span>()<span class="op">;</span></span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">notifyConsumers</span>() {</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> consumers <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;[data-context-consumer]&#39;</span>)<span class="op">;</span></span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a>        consumers<span class="op">.</span><span class="fu">forEach</span>(consumer <span class="kw">=&gt;</span> {</span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (consumer<span class="op">.</span><span class="at">onContextChange</span>) {</span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>            consumer<span class="op">.</span><span class="fu">onContextChange</span>(<span class="kw">this</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb168-25"><a href="#cb168-25" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb168-26"><a href="#cb168-26" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb168-27"><a href="#cb168-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-28"><a href="#cb168-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">connectedCallback</span>() {</span>
<span id="cb168-29"><a href="#cb168-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;slot&gt;&lt;/slot&gt;`</span><span class="op">;</span></span>
<span id="cb168-30"><a href="#cb168-30" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb168-31"><a href="#cb168-31" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb168-32"><a href="#cb168-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-33"><a href="#cb168-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Consumer</span><span class="op">:</span> <span class="kw">class</span> <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb168-34"><a href="#cb168-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">connectedCallback</span>() {</span>
<span id="cb168-35"><a href="#cb168-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;data-context-consumer&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb168-36"><a href="#cb168-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-37"><a href="#cb168-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Find provider up the tree</span></span>
<span id="cb168-38"><a href="#cb168-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> provider <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">closest</span>(<span class="st">&#39;[data-context-provider]&#39;</span>)<span class="op">;</span></span>
<span id="cb168-39"><a href="#cb168-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (provider <span class="op">&amp;&amp;</span> contexts<span class="op">.</span><span class="fu">has</span>(provider)) {</span>
<span id="cb168-40"><a href="#cb168-40" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="fu">onContextChange</span>(contexts<span class="op">.</span><span class="fu">get</span>(provider))<span class="op">;</span></span>
<span id="cb168-41"><a href="#cb168-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb168-42"><a href="#cb168-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb168-43"><a href="#cb168-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-44"><a href="#cb168-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">onContextChange</span>(value) {</span>
<span id="cb168-45"><a href="#cb168-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Override in subclasses</span></span>
<span id="cb168-46"><a href="#cb168-46" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb168-47"><a href="#cb168-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb168-48"><a href="#cb168-48" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb168-49"><a href="#cb168-49" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb169"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create context</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> ThemeContext <span class="op">=</span> <span class="fu">createContext</span>({ <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span> })<span class="op">;</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Provider component</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ThemeProvider <span class="kw">extends</span> ThemeContext<span class="op">.</span><span class="at">Provider</span> {</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">connectedCallback</span>()<span class="op">;</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;data-context-provider&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">provide</span>({</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span><span class="op">,</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">toggleTheme</span><span class="op">:</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> newTheme <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">theme</span> <span class="op">===</span> <span class="st">&#39;light&#39;</span> <span class="op">?</span> <span class="st">&#39;dark&#39;</span> <span class="op">:</span> <span class="st">&#39;light&#39;</span><span class="op">;</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">provide</span>({ <span class="op">...</span><span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">,</span> <span class="dt">theme</span><span class="op">:</span> newTheme })<span class="op">;</span></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Consumer component</span></span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ThemedButton <span class="kw">extends</span> ThemeContext<span class="op">.</span><span class="at">Consumer</span> {</span>
<span id="cb169-22"><a href="#cb169-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">onContextChange</span>(context) {</span>
<span id="cb169-23"><a href="#cb169-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">context</span> <span class="op">=</span> context<span class="op">;</span></span>
<span id="cb169-24"><a href="#cb169-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb169-25"><a href="#cb169-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-26"><a href="#cb169-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-27"><a href="#cb169-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb169-28"><a href="#cb169-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { theme } <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">context</span> <span class="op">||</span> { <span class="dt">theme</span><span class="op">:</span> <span class="st">&#39;light&#39;</span> }<span class="op">;</span></span>
<span id="cb169-29"><a href="#cb169-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-30"><a href="#cb169-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb169-31"><a href="#cb169-31" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;button style=&quot;</span></span>
<span id="cb169-32"><a href="#cb169-32" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: </span><span class="sc">${</span>theme <span class="op">===</span> <span class="st">&#39;dark&#39;</span> <span class="op">?</span> <span class="st">&#39;#333&#39;</span> <span class="op">:</span> <span class="st">&#39;#fff&#39;</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb169-33"><a href="#cb169-33" aria-hidden="true" tabindex="-1"></a><span class="vs">        color: </span><span class="sc">${</span>theme <span class="op">===</span> <span class="st">&#39;dark&#39;</span> <span class="op">?</span> <span class="st">&#39;#fff&#39;</span> <span class="op">:</span> <span class="st">&#39;#333&#39;</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb169-34"><a href="#cb169-34" aria-hidden="true" tabindex="-1"></a><span class="vs">      &quot;&gt;</span></span>
<span id="cb169-35"><a href="#cb169-35" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb169-36"><a href="#cb169-36" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/button&gt;</span></span>
<span id="cb169-37"><a href="#cb169-37" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb169-38"><a href="#cb169-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-39"><a href="#cb169-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb169-40"><a href="#cb169-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-41"><a href="#cb169-41" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;theme-provider&#39;</span><span class="op">,</span> ThemeProvider)<span class="op">;</span></span>
<span id="cb169-42"><a href="#cb169-42" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;themed-button&#39;</span><span class="op">,</span> ThemedButton)<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb170"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">theme-provider</span><span class="dt">&gt;</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">themed-button</span><span class="dt">&gt;</span>Light/Dark<span class="dt">&lt;/</span><span class="kw">themed-button</span><span class="dt">&gt;</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">themed-button</span><span class="dt">&gt;</span>Another Button<span class="dt">&lt;/</span><span class="kw">themed-button</span><span class="dt">&gt;</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">theme-provider</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="higher-order-components">Higher-Order Components</h2>
<p>Higher-order components (HOCs) wrap other components to add
functionality.</p>
<h3 id="mixin-pattern">Mixin Pattern</h3>
<p>JavaScript mixins add functionality to classes:</p>
<div class="sourceCode" id="cb171"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co">// mixins/observable.js</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> ObservableMixin <span class="op">=</span> (Base) <span class="kw">=&gt;</span> <span class="kw">class</span> <span class="kw">extends</span> Base {</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_observers</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observe</span>(property<span class="op">,</span> callback) {</span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">_observers</span><span class="op">.</span><span class="fu">has</span>(property)) {</span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_observers</span><span class="op">.</span><span class="fu">set</span>(property<span class="op">,</span> <span class="kw">new</span> <span class="bu">Set</span>())<span class="op">;</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_observers</span><span class="op">.</span><span class="fu">get</span>(property)<span class="op">.</span><span class="fu">add</span>(callback)<span class="op">;</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return unobserve function</span></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_observers</span><span class="op">.</span><span class="fu">get</span>(property)<span class="op">?.</span><span class="fu">delete</span>(callback)<span class="op">;</span></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(property<span class="op">,</span> value) {</span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_observers</span><span class="op">.</span><span class="fu">get</span>(property)<span class="op">?.</span><span class="fu">forEach</span>(callback <span class="kw">=&gt;</span> {</span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">callback</span>(value)<span class="op">;</span></span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb171-24"><a href="#cb171-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-25"><a href="#cb171-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-26"><a href="#cb171-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(property<span class="op">,</span> value) {</span>
<span id="cb171-27"><a href="#cb171-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span>[<span class="vs">`_</span><span class="sc">${</span>property<span class="sc">}</span><span class="vs">`</span>] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb171-28"><a href="#cb171-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">notify</span>(property<span class="op">,</span> value)<span class="op">;</span></span>
<span id="cb171-29"><a href="#cb171-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-30"><a href="#cb171-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-31"><a href="#cb171-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span>(property) {</span>
<span id="cb171-32"><a href="#cb171-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span>[<span class="vs">`_</span><span class="sc">${</span>property<span class="sc">}</span><span class="vs">`</span>]<span class="op">;</span></span>
<span id="cb171-33"><a href="#cb171-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-34"><a href="#cb171-34" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb171-35"><a href="#cb171-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-36"><a href="#cb171-36" aria-hidden="true" tabindex="-1"></a><span class="co">// mixins/resizable.js</span></span>
<span id="cb171-37"><a href="#cb171-37" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> ResizableMixin <span class="op">=</span> (Base) <span class="kw">=&gt;</span> <span class="kw">class</span> <span class="kw">extends</span> Base {</span>
<span id="cb171-38"><a href="#cb171-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb171-39"><a href="#cb171-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="at">connectedCallback</span><span class="op">?.</span>()<span class="op">;</span></span>
<span id="cb171-40"><a href="#cb171-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-41"><a href="#cb171-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">resizeObserver</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">ResizeObserver</span>((entries) <span class="kw">=&gt;</span> {</span>
<span id="cb171-42"><a href="#cb171-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">const</span> entry <span class="kw">of</span> entries) {</span>
<span id="cb171-43"><a href="#cb171-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">onResize</span><span class="op">?.</span>(entry<span class="op">.</span><span class="at">contentRect</span>)<span class="op">;</span></span>
<span id="cb171-44"><a href="#cb171-44" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb171-45"><a href="#cb171-45" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb171-46"><a href="#cb171-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-47"><a href="#cb171-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">resizeObserver</span><span class="op">.</span><span class="fu">observe</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb171-48"><a href="#cb171-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-49"><a href="#cb171-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-50"><a href="#cb171-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb171-51"><a href="#cb171-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="at">disconnectedCallback</span><span class="op">?.</span>()<span class="op">;</span></span>
<span id="cb171-52"><a href="#cb171-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">resizeObserver</span><span class="op">?.</span><span class="fu">disconnect</span>()<span class="op">;</span></span>
<span id="cb171-53"><a href="#cb171-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-54"><a href="#cb171-54" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb171-55"><a href="#cb171-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-56"><a href="#cb171-56" aria-hidden="true" tabindex="-1"></a><span class="co">// mixins/loading.js</span></span>
<span id="cb171-57"><a href="#cb171-57" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> LoadingMixin <span class="op">=</span> (Base) <span class="kw">=&gt;</span> <span class="kw">class</span> <span class="kw">extends</span> Base {</span>
<span id="cb171-58"><a href="#cb171-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb171-59"><a href="#cb171-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb171-60"><a href="#cb171-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb171-61"><a href="#cb171-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-62"><a href="#cb171-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-63"><a href="#cb171-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">startLoading</span>() {</span>
<span id="cb171-64"><a href="#cb171-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb171-65"><a href="#cb171-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;loading&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb171-66"><a href="#cb171-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">onLoadingChange</span><span class="op">?.</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb171-67"><a href="#cb171-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-68"><a href="#cb171-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-69"><a href="#cb171-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopLoading</span>() {</span>
<span id="cb171-70"><a href="#cb171-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb171-71"><a href="#cb171-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">removeAttribute</span>(<span class="st">&#39;loading&#39;</span>)<span class="op">;</span></span>
<span id="cb171-72"><a href="#cb171-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">onLoadingChange</span><span class="op">?.</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb171-73"><a href="#cb171-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-74"><a href="#cb171-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-75"><a href="#cb171-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">loading</span>() {</span>
<span id="cb171-76"><a href="#cb171-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">_loading</span><span class="op">;</span></span>
<span id="cb171-77"><a href="#cb171-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-78"><a href="#cb171-78" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb172"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ObservableMixin } <span class="im">from</span> <span class="st">&#39;./mixins/observable.js&#39;</span><span class="op">;</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ResizableMixin } <span class="im">from</span> <span class="st">&#39;./mixins/resizable.js&#39;</span><span class="op">;</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { LoadingMixin } <span class="im">from</span> <span class="st">&#39;./mixins/loading.js&#39;</span><span class="op">;</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Compose multiple mixins</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataTable <span class="kw">extends</span> <span class="fu">LoadingMixin</span>(<span class="fu">ResizableMixin</span>(<span class="fu">ObservableMixin</span>(<span class="bu">HTMLElement</span>))) {</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">connectedCallback</span>()<span class="op">;</span></span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use Observable mixin</span></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">observe</span>(<span class="st">&#39;data&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Data changed:&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-21"><a href="#cb172-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use Loading mixin</span></span>
<span id="cb172-22"><a href="#cb172-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">startLoading</span>()<span class="op">;</span></span>
<span id="cb172-23"><a href="#cb172-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetchData</span>()<span class="op">;</span></span>
<span id="cb172-24"><a href="#cb172-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;data&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb172-25"><a href="#cb172-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">stopLoading</span>()<span class="op">;</span></span>
<span id="cb172-26"><a href="#cb172-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-27"><a href="#cb172-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-28"><a href="#cb172-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use Resizable mixin</span></span>
<span id="cb172-29"><a href="#cb172-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">onResize</span>(rect) {</span>
<span id="cb172-30"><a href="#cb172-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Component resized:&#39;</span><span class="op">,</span> rect<span class="op">.</span><span class="at">width</span><span class="op">,</span> rect<span class="op">.</span><span class="at">height</span>)<span class="op">;</span></span>
<span id="cb172-31"><a href="#cb172-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateLayout</span>()<span class="op">;</span></span>
<span id="cb172-32"><a href="#cb172-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-33"><a href="#cb172-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-34"><a href="#cb172-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">onLoadingChange</span>(loading) {</span>
<span id="cb172-35"><a href="#cb172-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb172-36"><a href="#cb172-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-37"><a href="#cb172-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-38"><a href="#cb172-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">fetchData</span>() {</span>
<span id="cb172-39"><a href="#cb172-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/data&#39;</span>)<span class="op">;</span></span>
<span id="cb172-40"><a href="#cb172-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb172-41"><a href="#cb172-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-42"><a href="#cb172-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-43"><a href="#cb172-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb172-44"><a href="#cb172-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Render based on state</span></span>
<span id="cb172-45"><a href="#cb172-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-46"><a href="#cb172-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb172-47"><a href="#cb172-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-48"><a href="#cb172-48" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;data-table&#39;</span><span class="op">,</span> DataTable)<span class="op">;</span></span></code></pre></div>
<h3 id="decorator-pattern">Decorator Pattern</h3>
<p>Wrap components to enhance them:</p>
<div class="sourceCode" id="cb173"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co">// decorators/with-loading.js</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">withLoading</span>(ComponentClass) {</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">class</span> <span class="kw">extends</span> ComponentClass {</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">constructor</span>() {</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_originalConnectedCallback</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">connectedCallback</span><span class="op">;</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">connectedCallback</span>() {</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Inject loading overlay</span></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> loadingOverlay <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;div&#39;</span>)<span class="op">;</span></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>      loadingOverlay<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;loading-overlay&#39;</span><span class="op">;</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>      loadingOverlay<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cssText</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        position: absolute;</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        top: 0;</span></span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        left: 0;</span></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        right: 0;</span></span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a><span class="vs">        bottom: 0;</span></span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        background: rgba(255,255,255,0.8);</span></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a><span class="vs">        display: none;</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a><span class="vs">        align-items: center;</span></span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a><span class="vs">        justify-content: center;</span></span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a>      loadingOverlay<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;div class=&quot;spinner&quot;&gt;&lt;/div&gt;&#39;</span><span class="op">;</span></span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-26"><a href="#cb173-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">appendChild</span>(loadingOverlay)<span class="op">;</span></span>
<span id="cb173-27"><a href="#cb173-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">_loadingOverlay</span> <span class="op">=</span> loadingOverlay<span class="op">;</span></span>
<span id="cb173-28"><a href="#cb173-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-29"><a href="#cb173-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Call original</span></span>
<span id="cb173-30"><a href="#cb173-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_originalConnectedCallback</span>) {</span>
<span id="cb173-31"><a href="#cb173-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">_originalConnectedCallback</span><span class="op">.</span><span class="fu">call</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb173-32"><a href="#cb173-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb173-33"><a href="#cb173-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb173-34"><a href="#cb173-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-35"><a href="#cb173-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">showLoading</span>() {</span>
<span id="cb173-36"><a href="#cb173-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_loadingOverlay</span>) {</span>
<span id="cb173-37"><a href="#cb173-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">_loadingOverlay</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">&#39;flex&#39;</span><span class="op">;</span></span>
<span id="cb173-38"><a href="#cb173-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb173-39"><a href="#cb173-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb173-40"><a href="#cb173-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-41"><a href="#cb173-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hideLoading</span>() {</span>
<span id="cb173-42"><a href="#cb173-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">_loadingOverlay</span>) {</span>
<span id="cb173-43"><a href="#cb173-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">_loadingOverlay</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></span>
<span id="cb173-44"><a href="#cb173-44" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb173-45"><a href="#cb173-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb173-46"><a href="#cb173-46" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb173-47"><a href="#cb173-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-48"><a href="#cb173-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-49"><a href="#cb173-49" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb173-50"><a href="#cb173-50" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserProfile <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb173-51"><a href="#cb173-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb173-52"><a href="#cb173-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">showLoading</span>()<span class="op">;</span></span>
<span id="cb173-53"><a href="#cb173-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-54"><a href="#cb173-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/user&#39;</span>)<span class="op">.</span><span class="fu">then</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="fu">json</span>())<span class="op">;</span></span>
<span id="cb173-55"><a href="#cb173-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(user)<span class="op">;</span></span>
<span id="cb173-56"><a href="#cb173-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-57"><a href="#cb173-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">hideLoading</span>()<span class="op">;</span></span>
<span id="cb173-58"><a href="#cb173-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb173-59"><a href="#cb173-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-60"><a href="#cb173-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>(user) {</span>
<span id="cb173-61"><a href="#cb173-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;h1&gt;</span><span class="sc">${</span>user<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h1&gt;`</span><span class="op">;</span></span>
<span id="cb173-62"><a href="#cb173-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb173-63"><a href="#cb173-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb173-64"><a href="#cb173-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-65"><a href="#cb173-65" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply decorator</span></span>
<span id="cb173-66"><a href="#cb173-66" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> UserProfileWithLoading <span class="op">=</span> <span class="fu">withLoading</span>(UserProfile)<span class="op">;</span></span>
<span id="cb173-67"><a href="#cb173-67" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;user-profile&#39;</span><span class="op">,</span> UserProfileWithLoading)<span class="op">;</span></span></code></pre></div>
<h2 id="component-composition">Component Composition</h2>
<p>Build complex UIs from simple, focused components.</p>
<h3 id="containerpresentational-pattern">Container/Presentational
Pattern</h3>
<p>Separate logic from presentation:</p>
<div class="sourceCode" id="cb174"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Presentational - no logic, just rendering</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">user</span>(value) {</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_user</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card&quot;&gt;</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;img src=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">avatar</span><span class="sc">}</span><span class="vs">&quot; alt=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h3&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">email</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button class=&quot;follow-btn&quot;&gt;Follow&lt;/button&gt;</span></span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-20"><a href="#cb174-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Emit events, don&#39;t handle logic</span></span>
<span id="cb174-21"><a href="#cb174-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.follow-btn&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb174-22"><a href="#cb174-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">&#39;follow&#39;</span><span class="op">,</span> {</span>
<span id="cb174-23"><a href="#cb174-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">detail</span><span class="op">:</span> { <span class="dt">userId</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">id</span> }</span>
<span id="cb174-24"><a href="#cb174-24" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">;</span></span>
<span id="cb174-25"><a href="#cb174-25" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb174-26"><a href="#cb174-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb174-27"><a href="#cb174-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb174-28"><a href="#cb174-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-29"><a href="#cb174-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Container - handles logic and data</span></span>
<span id="cb174-30"><a href="#cb174-30" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserCardContainer <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb174-31"><a href="#cb174-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb174-32"><a href="#cb174-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> userId <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;user-id&#39;</span>)<span class="op">;</span></span>
<span id="cb174-33"><a href="#cb174-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-34"><a href="#cb174-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Fetch data</span></span>
<span id="cb174-35"><a href="#cb174-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">user</span> <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetchUser</span>(userId)<span class="op">;</span></span>
<span id="cb174-36"><a href="#cb174-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-37"><a href="#cb174-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create presentational component</span></span>
<span id="cb174-38"><a href="#cb174-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> card <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;user-card&#39;</span>)<span class="op">;</span></span>
<span id="cb174-39"><a href="#cb174-39" aria-hidden="true" tabindex="-1"></a>    card<span class="op">.</span><span class="at">user</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">user</span><span class="op">;</span></span>
<span id="cb174-40"><a href="#cb174-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-41"><a href="#cb174-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle events</span></span>
<span id="cb174-42"><a href="#cb174-42" aria-hidden="true" tabindex="-1"></a>    card<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;follow&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb174-43"><a href="#cb174-43" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">followUser</span>(e<span class="op">.</span><span class="at">detail</span><span class="op">.</span><span class="at">userId</span>)<span class="op">;</span></span>
<span id="cb174-44"><a href="#cb174-44" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb174-45"><a href="#cb174-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-46"><a href="#cb174-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">appendChild</span>(card)<span class="op">;</span></span>
<span id="cb174-47"><a href="#cb174-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb174-48"><a href="#cb174-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-49"><a href="#cb174-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">fetchUser</span>(id) {</span>
<span id="cb174-50"><a href="#cb174-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/users/</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb174-51"><a href="#cb174-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb174-52"><a href="#cb174-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb174-53"><a href="#cb174-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-54"><a href="#cb174-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">followUser</span>(userId) {</span>
<span id="cb174-55"><a href="#cb174-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/users/</span><span class="sc">${</span>userId<span class="sc">}</span><span class="vs">/follow`</span><span class="op">,</span> { <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span> })<span class="op">;</span></span>
<span id="cb174-56"><a href="#cb174-56" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.followed&#39;</span><span class="op">,</span> { userId })<span class="op">;</span></span>
<span id="cb174-57"><a href="#cb174-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb174-58"><a href="#cb174-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb174-59"><a href="#cb174-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-60"><a href="#cb174-60" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;user-card&#39;</span><span class="op">,</span> UserCard)<span class="op">;</span></span>
<span id="cb174-61"><a href="#cb174-61" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;user-card-container&#39;</span><span class="op">,</span> UserCardContainer)<span class="op">;</span></span></code></pre></div>
<h3 id="render-props-pattern">Render Props Pattern</h3>
<p>Pass rendering logic as a slot:</p>
<div class="sourceCode" id="cb175"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataProvider <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> url <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;url&#39;</span>)<span class="op">;</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Render loading state</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;slot name=&quot;loading&quot;&gt;Loading...&lt;/slot&gt;&#39;</span><span class="op">;</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(url)<span class="op">;</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Render with data</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> renderSlot <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;[slot=&quot;render&quot;]&#39;</span>)<span class="op">;</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (renderSlot) {</span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>        renderSlot<span class="op">.</span><span class="at">data</span> <span class="op">=</span> data<span class="op">;</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">appendChild</span>(renderSlot)<span class="op">;</span></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Render error state</span></span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;slot name=&quot;error&quot;&gt;Error: </span><span class="sc">${</span>error<span class="op">.</span><span class="at">message</span><span class="sc">}</span><span class="vs">&lt;/slot&gt;`</span><span class="op">;</span></span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-26"><a href="#cb175-26" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;data-provider&#39;</span><span class="op">,</span> DataProvider)<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb176"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">data-provider</span><span class="ot"> url</span><span class="op">=</span><span class="st">&quot;/api/users&quot;</span><span class="dt">&gt;</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;loading&quot;</span><span class="dt">&gt;</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">spinner-component</span><span class="dt">&gt;&lt;/</span><span class="kw">spinner-component</span><span class="dt">&gt;</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">user-list</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;render&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">user-list</span><span class="dt">&gt;</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="dt">&gt;</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">error-message</span><span class="dt">&gt;&lt;/</span><span class="kw">error-message</span><span class="dt">&gt;</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">data-provider</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="slots-and-content-projection">Slots and Content Projection</h2>
<p>Slots are powerful for flexible component composition.</p>
<h3 id="named-slots">Named Slots</h3>
<div class="sourceCode" id="cb177"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CardComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        .card {</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: 1px solid #e2e8f0;</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 8px;</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="vs">          overflow: hidden;</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a><span class="vs">        .header {</span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #f7fafc;</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 16px;</span></span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-bottom: 1px solid #e2e8f0;</span></span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        .body {</span></span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 16px;</span></span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a><span class="vs">        .footer {</span></span>
<span id="cb177-21"><a href="#cb177-21" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #f7fafc;</span></span>
<span id="cb177-22"><a href="#cb177-22" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 12px 16px;</span></span>
<span id="cb177-23"><a href="#cb177-23" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-top: 1px solid #e2e8f0;</span></span>
<span id="cb177-24"><a href="#cb177-24" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: flex;</span></span>
<span id="cb177-25"><a href="#cb177-25" aria-hidden="true" tabindex="-1"></a><span class="vs">          justify-content: flex-end;</span></span>
<span id="cb177-26"><a href="#cb177-26" aria-hidden="true" tabindex="-1"></a><span class="vs">          gap: 8px;</span></span>
<span id="cb177-27"><a href="#cb177-27" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb177-28"><a href="#cb177-28" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb177-29"><a href="#cb177-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-30"><a href="#cb177-30" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card&quot;&gt;</span></span>
<span id="cb177-31"><a href="#cb177-31" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;header&quot;&gt;</span></span>
<span id="cb177-32"><a href="#cb177-32" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot name=&quot;header&quot;&gt;Default Header&lt;/slot&gt;</span></span>
<span id="cb177-33"><a href="#cb177-33" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb177-34"><a href="#cb177-34" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;body&quot;&gt;</span></span>
<span id="cb177-35"><a href="#cb177-35" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb177-36"><a href="#cb177-36" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb177-37"><a href="#cb177-37" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;footer&quot;&gt;</span></span>
<span id="cb177-38"><a href="#cb177-38" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;</span></span>
<span id="cb177-39"><a href="#cb177-39" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb177-40"><a href="#cb177-40" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb177-41"><a href="#cb177-41" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb177-42"><a href="#cb177-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb177-43"><a href="#cb177-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb177-44"><a href="#cb177-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-45"><a href="#cb177-45" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;card-component&#39;</span><span class="op">,</span> CardComponent)<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb178"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">card-component</span><span class="dt">&gt;</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">h2</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;header&quot;</span><span class="dt">&gt;</span>User Profile<span class="dt">&lt;/</span><span class="kw">h2</span><span class="dt">&gt;</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">&lt;!-- Default slot --&gt;</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>User profile content goes here...<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> slot</span><span class="op">=</span><span class="st">&quot;footer&quot;</span><span class="dt">&gt;</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span><span class="dt">&gt;</span>Save<span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">button</span><span class="dt">&gt;</span>Cancel<span class="dt">&lt;/</span><span class="kw">button</span><span class="dt">&gt;</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">card-component</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="slot-change-detection">Slot Change Detection</h3>
<p>React to slot content changes:</p>
<div class="sourceCode" id="cb179"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DynamicList <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="vs">        .count { font-weight: bold; color: #667eea; }</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;count&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Listen for slot changes</span></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> slot <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;slot&#39;</span>)<span class="op">;</span></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>    slot<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;slotchange&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">updateCount</span>()<span class="op">;</span></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">updateCount</span>()<span class="op">;</span></span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateCount</span>() {</span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> slot <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;slot&#39;</span>)<span class="op">;</span></span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> elements <span class="op">=</span> slot<span class="op">.</span><span class="fu">assignedElements</span>()<span class="op">;</span></span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-26"><a href="#cb179-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> count <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.count&#39;</span>)<span class="op">;</span></span>
<span id="cb179-27"><a href="#cb179-27" aria-hidden="true" tabindex="-1"></a>    count<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>elements<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs"> items`</span><span class="op">;</span></span>
<span id="cb179-28"><a href="#cb179-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-29"><a href="#cb179-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb179-30"><a href="#cb179-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-31"><a href="#cb179-31" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;dynamic-list&#39;</span><span class="op">,</span> DynamicList)<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb180"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">dynamic-list</span><span class="dt">&gt;</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span>Item 1<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span>Item 2<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span>Item 3<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">dynamic-list</span><span class="dt">&gt;</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> list <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;dynamic-list&#39;</span>)<span class="op">;</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add item dynamically</span></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> newItem <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;div&#39;</span>)<span class="op">;</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>  newItem<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;Item 4&#39;</span><span class="op">;</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>  list<span class="op">.</span><span class="fu">appendChild</span>(newItem)<span class="op">;</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Count automatically updates!</span></span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="conditional-slots">Conditional Slots</h3>
<p>Show/hide content based on slot presence:</p>
<div class="sourceCode" id="cb181"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ConditionalCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hasHeader <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;[slot=&quot;header&quot;]&#39;</span>) <span class="op">!==</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hasFooter <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;[slot=&quot;footer&quot;]&#39;</span>) <span class="op">!==</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a><span class="vs">        .card { border: 1px solid #ddd; border-radius: 8px; }</span></span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        .header, .footer { background: #f5f5f5; padding: 16px; }</span></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a><span class="vs">        .body { padding: 16px; }</span></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a><span class="vs">        .hidden { display: none; }</span></span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card&quot;&gt;</span></span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;header </span><span class="sc">${</span>hasHeader <span class="op">?</span> <span class="st">&#39;&#39;</span> <span class="op">:</span> <span class="st">&#39;hidden&#39;</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;</span></span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;body&quot;&gt;</span></span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;footer </span><span class="sc">${</span>hasFooter <span class="op">?</span> <span class="st">&#39;&#39;</span> <span class="op">:</span> <span class="st">&#39;hidden&#39;</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;slot name=&quot;footer&quot;&gt;&lt;/slot&gt;</span></span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;conditional-card&#39;</span><span class="op">,</span> ConditionalCard)<span class="op">;</span></span></code></pre></div>
<h2 id="dynamic-component-loading">Dynamic Component Loading</h2>
<p>Load components on demand for better performance.</p>
<h3 id="lazy-loading">Lazy Loading</h3>
<div class="sourceCode" id="cb182"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LazyLoader <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">connectedCallback</span>() {</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> component <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;component&#39;</span>)<span class="op">;</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> src <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;src&#39;</span>)<span class="op">;</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Show placeholder</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;div&gt;Loading component...&lt;/div&gt;&#39;</span><span class="op">;</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Dynamically import component</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="im">import</span>(src)<span class="op">;</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Wait for component to be defined</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> customElements<span class="op">.</span><span class="fu">whenDefined</span>(component)<span class="op">;</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Create and append component</span></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> element <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(component)<span class="op">;</span></span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Copy attributes</span></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">this</span><span class="op">.</span><span class="at">attributes</span>)<span class="op">.</span><span class="fu">forEach</span>(attr <span class="kw">=&gt;</span> {</span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (attr<span class="op">.</span><span class="at">name</span> <span class="op">!==</span> <span class="st">&#39;component&#39;</span> <span class="op">&amp;&amp;</span> attr<span class="op">.</span><span class="at">name</span> <span class="op">!==</span> <span class="st">&#39;src&#39;</span>) {</span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a>          element<span class="op">.</span><span class="fu">setAttribute</span>(attr<span class="op">.</span><span class="at">name</span><span class="op">,</span> attr<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">appendChild</span>(element)<span class="op">;</span></span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;div class=&quot;error&quot;&gt;Failed to load component: </span><span class="sc">${</span>error<span class="op">.</span><span class="at">message</span><span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;lazy-loader&#39;</span><span class="op">,</span> LazyLoader)<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb183"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Component loads when added to DOM --&gt;</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">lazy-loader</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  component</span><span class="op">=</span><span class="st">&quot;heavy-chart&quot;</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  src</span><span class="op">=</span><span class="st">&quot;/components/heavy-chart.js&quot;</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  data-url</span><span class="op">=</span><span class="st">&quot;/api/chart-data&quot;</span><span class="dt">&gt;</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">lazy-loader</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="intersection-observer-for-viewport-loading">Intersection
Observer for Viewport Loading</h3>
<p>Load components when they enter the viewport:</p>
<div class="sourceCode" id="cb184"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ViewportLoader <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">observer</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">IntersectionObserver</span>((entries) <span class="kw">=&gt;</span> {</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>      entries<span class="op">.</span><span class="fu">forEach</span>(entry <span class="kw">=&gt;</span> {</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (entry<span class="op">.</span><span class="at">isIntersecting</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">loaded</span>) {</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="fu">load</span>()<span class="op">;</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">rootMargin</span><span class="op">:</span> <span class="st">&#39;50px&#39;</span>  <span class="co">// Start loading 50px before visible</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">observer</span><span class="op">.</span><span class="fu">observe</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">observer</span><span class="op">?.</span><span class="fu">disconnect</span>()<span class="op">;</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">load</span>() {</span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">loaded</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb184-22"><a href="#cb184-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> component <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;component&#39;</span>)<span class="op">;</span></span>
<span id="cb184-23"><a href="#cb184-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> src <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;src&#39;</span>)<span class="op">;</span></span>
<span id="cb184-24"><a href="#cb184-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-25"><a href="#cb184-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="im">import</span>(src)<span class="op">;</span></span>
<span id="cb184-26"><a href="#cb184-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> customElements<span class="op">.</span><span class="fu">whenDefined</span>(component)<span class="op">;</span></span>
<span id="cb184-27"><a href="#cb184-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-28"><a href="#cb184-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> element <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(component)<span class="op">;</span></span>
<span id="cb184-29"><a href="#cb184-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">this</span><span class="op">.</span><span class="at">attributes</span>)<span class="op">.</span><span class="fu">forEach</span>(attr <span class="kw">=&gt;</span> {</span>
<span id="cb184-30"><a href="#cb184-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>[<span class="st">&#39;component&#39;</span><span class="op">,</span> <span class="st">&#39;src&#39;</span>]<span class="op">.</span><span class="fu">includes</span>(attr<span class="op">.</span><span class="at">name</span>)) {</span>
<span id="cb184-31"><a href="#cb184-31" aria-hidden="true" tabindex="-1"></a>        element<span class="op">.</span><span class="fu">setAttribute</span>(attr<span class="op">.</span><span class="at">name</span><span class="op">,</span> attr<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb184-32"><a href="#cb184-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb184-33"><a href="#cb184-33" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb184-34"><a href="#cb184-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-35"><a href="#cb184-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">appendChild</span>(element)<span class="op">;</span></span>
<span id="cb184-36"><a href="#cb184-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-37"><a href="#cb184-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-38"><a href="#cb184-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-39"><a href="#cb184-39" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;viewport-loader&#39;</span><span class="op">,</span> ViewportLoader)<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb185"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Heavy image gallery - only loads when scrolled into view --&gt;</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">viewport-loader</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  component</span><span class="op">=</span><span class="st">&quot;image-gallery&quot;</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  src</span><span class="op">=</span><span class="st">&quot;/components/image-gallery.js&quot;</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  album-id</span><span class="op">=</span><span class="st">&quot;123&quot;</span><span class="dt">&gt;</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">viewport-loader</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="performance-optimization">Performance Optimization</h2>
<h3 id="virtual-scrolling">Virtual Scrolling</h3>
<p>Render only visible items in long lists:</p>
<div class="sourceCode" id="cb186"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> VirtualList <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">items</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">itemHeight</span> <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">visibleCount</span> <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">scrollTop</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-12"><a href="#cb186-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">data</span>(items) {</span>
<span id="cb186-13"><a href="#cb186-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">items</span> <span class="op">=</span> items<span class="op">;</span></span>
<span id="cb186-14"><a href="#cb186-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb186-15"><a href="#cb186-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb186-16"><a href="#cb186-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-17"><a href="#cb186-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb186-18"><a href="#cb186-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb186-19"><a href="#cb186-19" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb186-20"><a href="#cb186-20" aria-hidden="true" tabindex="-1"></a><span class="vs">        :host {</span></span>
<span id="cb186-21"><a href="#cb186-21" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb186-22"><a href="#cb186-22" aria-hidden="true" tabindex="-1"></a><span class="vs">          height: 100%;</span></span>
<span id="cb186-23"><a href="#cb186-23" aria-hidden="true" tabindex="-1"></a><span class="vs">          overflow-y: auto;</span></span>
<span id="cb186-24"><a href="#cb186-24" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: relative;</span></span>
<span id="cb186-25"><a href="#cb186-25" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb186-26"><a href="#cb186-26" aria-hidden="true" tabindex="-1"></a><span class="vs">        .viewport {</span></span>
<span id="cb186-27"><a href="#cb186-27" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: relative;</span></span>
<span id="cb186-28"><a href="#cb186-28" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb186-29"><a href="#cb186-29" aria-hidden="true" tabindex="-1"></a><span class="vs">        .item {</span></span>
<span id="cb186-30"><a href="#cb186-30" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: absolute;</span></span>
<span id="cb186-31"><a href="#cb186-31" aria-hidden="true" tabindex="-1"></a><span class="vs">          left: 0;</span></span>
<span id="cb186-32"><a href="#cb186-32" aria-hidden="true" tabindex="-1"></a><span class="vs">          right: 0;</span></span>
<span id="cb186-33"><a href="#cb186-33" aria-hidden="true" tabindex="-1"></a><span class="vs">          height: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">itemHeight</span><span class="sc">}</span><span class="vs">px;</span></span>
<span id="cb186-34"><a href="#cb186-34" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: flex;</span></span>
<span id="cb186-35"><a href="#cb186-35" aria-hidden="true" tabindex="-1"></a><span class="vs">          align-items: center;</span></span>
<span id="cb186-36"><a href="#cb186-36" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 0 16px;</span></span>
<span id="cb186-37"><a href="#cb186-37" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-bottom: 1px solid #eee;</span></span>
<span id="cb186-38"><a href="#cb186-38" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb186-39"><a href="#cb186-39" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb186-40"><a href="#cb186-40" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;viewport&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb186-41"><a href="#cb186-41" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb186-42"><a href="#cb186-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-43"><a href="#cb186-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">viewport</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.viewport&#39;</span>)<span class="op">;</span></span>
<span id="cb186-44"><a href="#cb186-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-45"><a href="#cb186-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;scroll&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb186-46"><a href="#cb186-46" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">scrollTop</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">scrollTop</span><span class="op">;</span></span>
<span id="cb186-47"><a href="#cb186-47" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">renderVisibleItems</span>()<span class="op">;</span></span>
<span id="cb186-48"><a href="#cb186-48" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb186-49"><a href="#cb186-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb186-50"><a href="#cb186-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-51"><a href="#cb186-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb186-52"><a href="#cb186-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">viewport</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb186-53"><a href="#cb186-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-54"><a href="#cb186-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set total height</span></span>
<span id="cb186-55"><a href="#cb186-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> totalHeight <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span> <span class="op">*</span> <span class="kw">this</span><span class="op">.</span><span class="at">itemHeight</span><span class="op">;</span></span>
<span id="cb186-56"><a href="#cb186-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">viewport</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>totalHeight<span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb186-57"><a href="#cb186-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-58"><a href="#cb186-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">renderVisibleItems</span>()<span class="op">;</span></span>
<span id="cb186-59"><a href="#cb186-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb186-60"><a href="#cb186-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-61"><a href="#cb186-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">renderVisibleItems</span>() {</span>
<span id="cb186-62"><a href="#cb186-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startIndex <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="kw">this</span><span class="op">.</span><span class="at">scrollTop</span> <span class="op">/</span> <span class="kw">this</span><span class="op">.</span><span class="at">itemHeight</span>)<span class="op">;</span></span>
<span id="cb186-63"><a href="#cb186-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> endIndex <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(</span>
<span id="cb186-64"><a href="#cb186-64" aria-hidden="true" tabindex="-1"></a>      startIndex <span class="op">+</span> <span class="kw">this</span><span class="op">.</span><span class="at">visibleCount</span><span class="op">,</span></span>
<span id="cb186-65"><a href="#cb186-65" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span></span>
<span id="cb186-66"><a href="#cb186-66" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb186-67"><a href="#cb186-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-68"><a href="#cb186-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear existing items</span></span>
<span id="cb186-69"><a href="#cb186-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">viewport</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb186-70"><a href="#cb186-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-71"><a href="#cb186-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Render only visible items</span></span>
<span id="cb186-72"><a href="#cb186-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> startIndex<span class="op">;</span> i <span class="op">&lt;</span> endIndex<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb186-73"><a href="#cb186-73" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> item <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;div&#39;</span>)<span class="op">;</span></span>
<span id="cb186-74"><a href="#cb186-74" aria-hidden="true" tabindex="-1"></a>      item<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;item&#39;</span><span class="op">;</span></span>
<span id="cb186-75"><a href="#cb186-75" aria-hidden="true" tabindex="-1"></a>      item<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">top</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>i <span class="op">*</span> <span class="kw">this</span><span class="op">.</span><span class="at">itemHeight</span><span class="sc">}</span><span class="vs">px`</span><span class="op">;</span></span>
<span id="cb186-76"><a href="#cb186-76" aria-hidden="true" tabindex="-1"></a>      item<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">items</span>[i]<span class="op">;</span></span>
<span id="cb186-77"><a href="#cb186-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-78"><a href="#cb186-78" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">viewport</span><span class="op">.</span><span class="fu">appendChild</span>(item)<span class="op">;</span></span>
<span id="cb186-79"><a href="#cb186-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb186-80"><a href="#cb186-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb186-81"><a href="#cb186-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb186-82"><a href="#cb186-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-83"><a href="#cb186-83" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;virtual-list&#39;</span><span class="op">,</span> VirtualList)<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb187"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> list <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;virtual-list&#39;</span>)<span class="op">;</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>list<span class="op">.</span><span class="at">data</span> <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> <span class="dv">10000</span> }<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`Item </span><span class="sc">${</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>list<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">height</span> <span class="op">=</span> <span class="st">&#39;400px&#39;</span><span class="op">;</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(list)<span class="op">;</span></span></code></pre></div>
<h3 id="memoization">Memoization</h3>
<p>Cache expensive computations:</p>
<div class="sourceCode" id="cb188"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MemoizedComponent <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">cache</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">memoize</span>(fn<span class="op">,</span> keyFn) {</span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="op">...</span>args) <span class="kw">=&gt;</span> {</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> key <span class="op">=</span> keyFn <span class="op">?</span> <span class="fu">keyFn</span>(<span class="op">...</span>args) <span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(args)<span class="op">;</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">has</span>(key)) {</span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="fu">fn</span>(<span class="op">...</span>args)<span class="op">;</span></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a>  computeExpensiveValue <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">memoize</span>(</span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a>    (data) <span class="kw">=&gt;</span> {</span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Expensive computation</span></span>
<span id="cb188-25"><a href="#cb188-25" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Computing...&#39;</span>)<span class="op">;</span></span>
<span id="cb188-26"><a href="#cb188-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> data<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> val) <span class="kw">=&gt;</span> acc <span class="op">+</span> val<span class="op">.</span><span class="at">price</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb188-27"><a href="#cb188-27" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb188-28"><a href="#cb188-28" aria-hidden="true" tabindex="-1"></a>    (data) <span class="kw">=&gt;</span> data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;,&#39;</span>)</span>
<span id="cb188-29"><a href="#cb188-29" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb188-30"><a href="#cb188-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-31"><a href="#cb188-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb188-32"><a href="#cb188-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb188-33"><a href="#cb188-33" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">,</span></span>
<span id="cb188-34"><a href="#cb188-34" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">200</span> }</span>
<span id="cb188-35"><a href="#cb188-35" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb188-36"><a href="#cb188-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-37"><a href="#cb188-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// First call - computes</span></span>
<span id="cb188-38"><a href="#cb188-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">computeExpensiveValue</span>(data))<span class="op">;</span></span>
<span id="cb188-39"><a href="#cb188-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-40"><a href="#cb188-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Second call - cached</span></span>
<span id="cb188-41"><a href="#cb188-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">computeExpensiveValue</span>(data))<span class="op">;</span></span>
<span id="cb188-42"><a href="#cb188-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-43"><a href="#cb188-43" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="debouncing-and-throttling">Debouncing and Throttling</h3>
<p>Limit expensive operations:</p>
<div class="sourceCode" id="cb189"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/performance.js</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">debounce</span>(fn<span class="op">,</span> delay) {</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> timeoutId<span class="op">;</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">function</span>(<span class="op">...</span>args) {</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">clearTimeout</span>(timeoutId)<span class="op">;</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>    timeoutId <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>      fn<span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> args)<span class="op">;</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> delay)<span class="op">;</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">throttle</span>(fn<span class="op">,</span> limit) {</span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> inThrottle<span class="op">;</span></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">function</span>(<span class="op">...</span>args) {</span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>inThrottle) {</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>      fn<span class="op">.</span><span class="fu">apply</span>(<span class="kw">this</span><span class="op">,</span> args)<span class="op">;</span></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>      inThrottle <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>      <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>        inThrottle <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> limit)<span class="op">;</span></span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb189-30"><a href="#cb189-30" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SearchBox <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb189-31"><a href="#cb189-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb189-32"><a href="#cb189-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb189-33"><a href="#cb189-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-34"><a href="#cb189-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Debounce search - wait for user to stop typing</span></span>
<span id="cb189-35"><a href="#cb189-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">handleSearch</span> <span class="op">=</span> <span class="fu">debounce</span>(<span class="kw">this</span><span class="op">.</span><span class="at">search</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>)<span class="op">,</span> <span class="dv">300</span>)<span class="op">;</span></span>
<span id="cb189-36"><a href="#cb189-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-37"><a href="#cb189-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Throttle scroll - limit updates</span></span>
<span id="cb189-38"><a href="#cb189-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">handleScroll</span> <span class="op">=</span> <span class="fu">throttle</span>(<span class="kw">this</span><span class="op">.</span><span class="at">onScroll</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>)<span class="op">,</span> <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb189-39"><a href="#cb189-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-40"><a href="#cb189-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-41"><a href="#cb189-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb189-42"><a href="#cb189-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;input type=&quot;search&quot; placeholder=&quot;Search...&quot;&gt;&#39;</span><span class="op">;</span></span>
<span id="cb189-43"><a href="#cb189-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-44"><a href="#cb189-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;input&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;input&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb189-45"><a href="#cb189-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">handleSearch</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb189-46"><a href="#cb189-46" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb189-47"><a href="#cb189-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-48"><a href="#cb189-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;scroll&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleScroll</span>)<span class="op">;</span></span>
<span id="cb189-49"><a href="#cb189-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-50"><a href="#cb189-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-51"><a href="#cb189-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">search</span>(query) {</span>
<span id="cb189-52"><a href="#cb189-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Searching for:&#39;</span><span class="op">,</span> query)<span class="op">;</span></span>
<span id="cb189-53"><a href="#cb189-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perform search</span></span>
<span id="cb189-54"><a href="#cb189-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-55"><a href="#cb189-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-56"><a href="#cb189-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">onScroll</span>() {</span>
<span id="cb189-57"><a href="#cb189-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Scrolled&#39;</span>)<span class="op">;</span></span>
<span id="cb189-58"><a href="#cb189-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update UI based on scroll</span></span>
<span id="cb189-59"><a href="#cb189-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-60"><a href="#cb189-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="summary-6">Summary</h2>
<p>This chapter explored advanced component patterns:</p>
<ul>
<li><strong>Compound Components</strong>: Components that work together
as a cohesive unit</li>
<li><strong>Higher-Order Components</strong>: Mixins and decorators for
code reuse</li>
<li><strong>Component Composition</strong>: Container/presentational
pattern and render props</li>
<li><strong>Slots</strong>: Named slots, slot change detection, and
conditional rendering</li>
<li><strong>Dynamic Loading</strong>: Lazy loading and viewport-based
loading</li>
<li><strong>Performance</strong>: Virtual scrolling, memoization,
debouncing, and throttling</li>
</ul>
<p>These patterns enable you to build sophisticated, performant
applications while keeping code maintainable and testable.</p>
<hr />
<h2 id="best-practices-3">Best Practices</h2>
<ol type="1">
<li><strong>Favor composition over inheritance</strong>
<ul>
<li>Build complex components from simple ones</li>
<li>Use slots for flexibility</li>
<li>Keep components focused</li>
</ul></li>
<li><strong>Use mixins for cross-cutting concerns</strong>
<ul>
<li>Observable behavior</li>
<li>Resize handling</li>
<li>Loading states</li>
</ul></li>
<li><strong>Separate logic from presentation</strong>
<ul>
<li>Container components handle data</li>
<li>Presentational components handle UI</li>
<li>Easier to test and reuse</li>
</ul></li>
<li><strong>Lazy load heavy components</strong>
<ul>
<li>Reduce initial bundle size</li>
<li>Load on demand or when visible</li>
<li>Show loading states</li>
</ul></li>
<li><strong>Optimize expensive operations</strong>
<ul>
<li>Memoize pure functions</li>
<li>Debounce user input</li>
<li>Throttle scroll/resize handlers</li>
<li>Use virtual scrolling for long lists</li>
</ul></li>
<li><strong>Keep performance in mind</strong>
<ul>
<li>Profile before optimizing</li>
<li>Measure impact of changes</li>
<li>Don’t over-optimize prematurely</li>
</ul></li>
</ol>
<h1 id="chapter-8-business-logic-patterns">Chapter 8: Business Logic
Patterns</h1>
<p>In the previous chapters, we’ve learned how to build components,
communicate via the PAN bus, and manage state. But when building
real-world applications, you’ll inevitably need to inject your own
custom business logic: validation rules, pricing calculations, access
control, analytics tracking, and countless other domain-specific
concerns.</p>
<p>A common question developers ask when adopting LARC is: <em>“Where do
I put my business logic?”</em> This chapter explores the architectural
patterns for integrating business logic into LARC applications, helping
you make informed decisions about code organization and separation of
concerns.</p>
<h2 id="the-philosophy-separation-of-concerns">The Philosophy:
Separation of Concerns</h2>
<p>LARC’s architecture naturally encourages a clean separation
between:</p>
<ul>
<li><strong>Components</strong>: UI and interaction concerns</li>
<li><strong>PAN Bus</strong>: Communication layer</li>
<li><strong>Business Logic</strong>: Domain rules and workflows</li>
</ul>
<p>This separation isn’t just academic—it makes your code:</p>
<ul>
<li><strong>Testable</strong>: Logic can be tested independently of
UI</li>
<li><strong>Maintainable</strong>: Changes to business rules don’t
require touching components</li>
<li><strong>Reusable</strong>: Logic can be shared across multiple
components</li>
<li><strong>Flexible</strong>: Easy to modify workflows without
refactoring components</li>
</ul>
<p>Let’s explore the patterns that make this possible.</p>
<h2 id="pattern-1-pan-bus-listeners-recommended">Pattern 1: PAN Bus
Listeners (Recommended)</h2>
<p>The most common and recommended approach is to create separate
modules that listen to PAN bus events and implement your business logic.
This pattern treats business logic as a <strong>first-class
concern</strong>, separate from both UI components and state
management.</p>
<h3 id="when-to-use">When to Use</h3>
<p>Use PAN bus listeners when you need to:</p>
<ul>
<li>Coordinate behavior across multiple components</li>
<li>Implement cross-cutting concerns (analytics, logging,
validation)</li>
<li>Add business rules that aren’t tied to a specific component</li>
<li>Keep components generic and reusable</li>
</ul>
<h3 id="basic-implementation">Basic Implementation</h3>
<p>Let’s build an e-commerce application where we need to enforce
business rules around cart operations:</p>
<div class="sourceCode" id="cb190"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co">// business-logic/cart-rules.js</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CartBusinessRules {</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">maxItemsPerOrder</span> <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">maxQuantityPerItem</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">init</span>() {</span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Subscribe to cart events</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleItemAdd</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.item.update&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleItemUpdate</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.checkout.start&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleCheckout</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleItemAdd</span>(data) {</span>
<span id="cb190-18"><a href="#cb190-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Business rule: Validating item add&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb190-19"><a href="#cb190-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-20"><a href="#cb190-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check current cart state</span></span>
<span id="cb190-21"><a href="#cb190-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentCart <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;cart.get&#39;</span>)<span class="op">;</span></span>
<span id="cb190-22"><a href="#cb190-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-23"><a href="#cb190-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule 1: Maximum items per order</span></span>
<span id="cb190-24"><a href="#cb190-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (currentCart<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;=</span> <span class="kw">this</span><span class="op">.</span><span class="at">maxItemsPerOrder</span>) {</span>
<span id="cb190-25"><a href="#cb190-25" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.error&#39;</span><span class="op">,</span> {</span>
<span id="cb190-26"><a href="#cb190-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;MAX_ITEMS_EXCEEDED&#39;</span><span class="op">,</span></span>
<span id="cb190-27"><a href="#cb190-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="vs">`Cannot add more than </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">maxItemsPerOrder</span><span class="sc">}</span><span class="vs"> items to cart`</span></span>
<span id="cb190-28"><a href="#cb190-28" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb190-29"><a href="#cb190-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb190-30"><a href="#cb190-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb190-31"><a href="#cb190-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-32"><a href="#cb190-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule 2: Check inventory</span></span>
<span id="cb190-33"><a href="#cb190-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> available <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkInventory</span>(data<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb190-34"><a href="#cb190-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>available <span class="op">||</span> available <span class="op">&lt;</span> data<span class="op">.</span><span class="at">quantity</span>) {</span>
<span id="cb190-35"><a href="#cb190-35" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.error&#39;</span><span class="op">,</span> {</span>
<span id="cb190-36"><a href="#cb190-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;INSUFFICIENT_INVENTORY&#39;</span><span class="op">,</span></span>
<span id="cb190-37"><a href="#cb190-37" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;This item is currently out of stock&#39;</span><span class="op">,</span></span>
<span id="cb190-38"><a href="#cb190-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">product</span><span class="op">:</span> data<span class="op">.</span><span class="at">product</span></span>
<span id="cb190-39"><a href="#cb190-39" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb190-40"><a href="#cb190-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb190-41"><a href="#cb190-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb190-42"><a href="#cb190-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-43"><a href="#cb190-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule 3: Apply pricing</span></span>
<span id="cb190-44"><a href="#cb190-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pricing <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculatePrice</span>(data<span class="op">.</span><span class="at">product</span><span class="op">,</span> data<span class="op">.</span><span class="at">quantity</span>)<span class="op">;</span></span>
<span id="cb190-45"><a href="#cb190-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-46"><a href="#cb190-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// All validations passed - allow the add and publish enriched data</span></span>
<span id="cb190-47"><a href="#cb190-47" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.validated&#39;</span><span class="op">,</span> {</span>
<span id="cb190-48"><a href="#cb190-48" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>data<span class="op">,</span></span>
<span id="cb190-49"><a href="#cb190-49" aria-hidden="true" tabindex="-1"></a>      pricing<span class="op">,</span></span>
<span id="cb190-50"><a href="#cb190-50" aria-hidden="true" tabindex="-1"></a>      <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb190-51"><a href="#cb190-51" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb190-52"><a href="#cb190-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-53"><a href="#cb190-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-54"><a href="#cb190-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleItemUpdate</span>(data) {</span>
<span id="cb190-55"><a href="#cb190-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule: Quantity limits</span></span>
<span id="cb190-56"><a href="#cb190-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">quantity</span> <span class="op">&gt;</span> <span class="kw">this</span><span class="op">.</span><span class="at">maxQuantityPerItem</span>) {</span>
<span id="cb190-57"><a href="#cb190-57" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.error&#39;</span><span class="op">,</span> {</span>
<span id="cb190-58"><a href="#cb190-58" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;MAX_QUANTITY_EXCEEDED&#39;</span><span class="op">,</span></span>
<span id="cb190-59"><a href="#cb190-59" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="vs">`Maximum </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">maxQuantityPerItem</span><span class="sc">}</span><span class="vs"> per item`</span></span>
<span id="cb190-60"><a href="#cb190-60" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb190-61"><a href="#cb190-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb190-62"><a href="#cb190-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb190-63"><a href="#cb190-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-64"><a href="#cb190-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check inventory for new quantity</span></span>
<span id="cb190-65"><a href="#cb190-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> available <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkInventory</span>(data<span class="op">.</span><span class="at">productId</span>)<span class="op">;</span></span>
<span id="cb190-66"><a href="#cb190-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (available <span class="op">&lt;</span> data<span class="op">.</span><span class="at">quantity</span>) {</span>
<span id="cb190-67"><a href="#cb190-67" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.error&#39;</span><span class="op">,</span> {</span>
<span id="cb190-68"><a href="#cb190-68" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;INSUFFICIENT_INVENTORY&#39;</span><span class="op">,</span></span>
<span id="cb190-69"><a href="#cb190-69" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="vs">`Only </span><span class="sc">${</span>available<span class="sc">}</span><span class="vs"> available`</span><span class="op">,</span></span>
<span id="cb190-70"><a href="#cb190-70" aria-hidden="true" tabindex="-1"></a>        available</span>
<span id="cb190-71"><a href="#cb190-71" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb190-72"><a href="#cb190-72" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb190-73"><a href="#cb190-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb190-74"><a href="#cb190-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-75"><a href="#cb190-75" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.update.validated&#39;</span><span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb190-76"><a href="#cb190-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-77"><a href="#cb190-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-78"><a href="#cb190-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleCheckout</span>(data) {</span>
<span id="cb190-79"><a href="#cb190-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule: Minimum order value</span></span>
<span id="cb190-80"><a href="#cb190-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cart <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;cart.get&#39;</span>)<span class="op">;</span></span>
<span id="cb190-81"><a href="#cb190-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> total <span class="op">=</span> cart<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> item) <span class="kw">=&gt;</span> sum <span class="op">+</span> item<span class="op">.</span><span class="at">total</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb190-82"><a href="#cb190-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-83"><a href="#cb190-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (total <span class="op">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb190-84"><a href="#cb190-84" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> {</span>
<span id="cb190-85"><a href="#cb190-85" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;MINIMUM_ORDER_NOT_MET&#39;</span><span class="op">,</span></span>
<span id="cb190-86"><a href="#cb190-86" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Minimum order value is $10&#39;</span><span class="op">,</span></span>
<span id="cb190-87"><a href="#cb190-87" aria-hidden="true" tabindex="-1"></a>        <span class="dt">current</span><span class="op">:</span> total<span class="op">,</span></span>
<span id="cb190-88"><a href="#cb190-88" aria-hidden="true" tabindex="-1"></a>        <span class="dt">required</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb190-89"><a href="#cb190-89" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb190-90"><a href="#cb190-90" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb190-91"><a href="#cb190-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb190-92"><a href="#cb190-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-93"><a href="#cb190-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule: User must be logged in</span></span>
<span id="cb190-94"><a href="#cb190-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb190-95"><a href="#cb190-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb190-96"><a href="#cb190-96" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> {</span>
<span id="cb190-97"><a href="#cb190-97" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;AUTH_REQUIRED&#39;</span><span class="op">,</span></span>
<span id="cb190-98"><a href="#cb190-98" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Please log in to continue&#39;</span></span>
<span id="cb190-99"><a href="#cb190-99" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb190-100"><a href="#cb190-100" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb190-101"><a href="#cb190-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb190-102"><a href="#cb190-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-103"><a href="#cb190-103" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.validated&#39;</span><span class="op">,</span> { cart<span class="op">,</span> user })<span class="op">;</span></span>
<span id="cb190-104"><a href="#cb190-104" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-105"><a href="#cb190-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-106"><a href="#cb190-106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">checkInventory</span>(productId) {</span>
<span id="cb190-107"><a href="#cb190-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">// In real app, this would call your backend</span></span>
<span id="cb190-108"><a href="#cb190-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/inventory/</span><span class="sc">${</span>productId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb190-109"><a href="#cb190-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb190-110"><a href="#cb190-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">available</span><span class="op">;</span></span>
<span id="cb190-111"><a href="#cb190-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-112"><a href="#cb190-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-113"><a href="#cb190-113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">calculatePrice</span>(product<span class="op">,</span> quantity) {</span>
<span id="cb190-114"><a href="#cb190-114" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply business logic: bulk discounts, promotions, etc.</span></span>
<span id="cb190-115"><a href="#cb190-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> unitPrice <span class="op">=</span> product<span class="op">.</span><span class="at">price</span><span class="op">;</span></span>
<span id="cb190-116"><a href="#cb190-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-117"><a href="#cb190-117" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Bulk discount: 10% off for 5+ items</span></span>
<span id="cb190-118"><a href="#cb190-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (quantity <span class="op">&gt;=</span> <span class="dv">5</span>) {</span>
<span id="cb190-119"><a href="#cb190-119" aria-hidden="true" tabindex="-1"></a>      unitPrice <span class="op">=</span> unitPrice <span class="op">*</span> <span class="fl">0.9</span><span class="op">;</span></span>
<span id="cb190-120"><a href="#cb190-120" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb190-121"><a href="#cb190-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-122"><a href="#cb190-122" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: Check for active promotions</span></span>
<span id="cb190-123"><a href="#cb190-123" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: Apply user-specific pricing</span></span>
<span id="cb190-124"><a href="#cb190-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-125"><a href="#cb190-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb190-126"><a href="#cb190-126" aria-hidden="true" tabindex="-1"></a>      unitPrice<span class="op">,</span></span>
<span id="cb190-127"><a href="#cb190-127" aria-hidden="true" tabindex="-1"></a>      quantity<span class="op">,</span></span>
<span id="cb190-128"><a href="#cb190-128" aria-hidden="true" tabindex="-1"></a>      <span class="dt">subtotal</span><span class="op">:</span> unitPrice <span class="op">*</span> quantity<span class="op">,</span></span>
<span id="cb190-129"><a href="#cb190-129" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discount</span><span class="op">:</span> quantity <span class="op">&gt;=</span> <span class="dv">5</span> <span class="op">?</span> (product<span class="op">.</span><span class="at">price</span> <span class="op">-</span> unitPrice) <span class="op">*</span> quantity <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb190-130"><a href="#cb190-130" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb190-131"><a href="#cb190-131" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb190-132"><a href="#cb190-132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb190-133"><a href="#cb190-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-134"><a href="#cb190-134" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize and export</span></span>
<span id="cb190-135"><a href="#cb190-135" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cartRules <span class="op">=</span> <span class="kw">new</span> <span class="fu">CartBusinessRules</span>()<span class="op">;</span></span>
<span id="cb190-136"><a href="#cb190-136" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> cartRules<span class="op">;</span></span></code></pre></div>
<p>Now in your main application file:</p>
<div class="sourceCode" id="cb191"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app.js</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartRules <span class="im">from</span> <span class="st">&#39;./business-logic/cart-rules.js&#39;</span><span class="op">;</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize business logic</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>cartRules<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Your components just publish events - the business logic handles the rest</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="co">// No business logic in components themselves!</span></span></code></pre></div>
<p>Your components remain simple and focused on UI:</p>
<div class="sourceCode" id="cb192"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/product-card.js</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProductCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... component setup ...</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleAddToCart</span>() {</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Just publish the event - business logic will validate</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> {</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">product</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">,</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">quantity</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Show optimistic UI</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">showAddingState</span>()<span class="op">;</span></span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">connectedCallback</span>()<span class="op">;</span></span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Listen for validation results</span></span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">unsubscribers</span> <span class="op">=</span> [</span>
<span id="cb192-21"><a href="#cb192-21" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.item.validated&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb192-22"><a href="#cb192-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (data<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">id</span> <span class="op">===</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">id</span>) {</span>
<span id="cb192-23"><a href="#cb192-23" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="fu">showSuccess</span>()<span class="op">;</span></span>
<span id="cb192-24"><a href="#cb192-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb192-25"><a href="#cb192-25" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb192-26"><a href="#cb192-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-27"><a href="#cb192-27" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.error&#39;</span><span class="op">,</span> (error) <span class="kw">=&gt;</span> {</span>
<span id="cb192-28"><a href="#cb192-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showError</span>(error<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb192-29"><a href="#cb192-29" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb192-30"><a href="#cb192-30" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb192-31"><a href="#cb192-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb192-32"><a href="#cb192-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="advantages">Advantages</h3>
<p>This pattern provides several key benefits:</p>
<ol type="1">
<li><strong>Separation of Concerns</strong>: Components handle UI,
business logic modules handle rules</li>
<li><strong>Easy Testing</strong>: Test business logic without rendering
components</li>
<li><strong>Centralized Rules</strong>: All cart rules in one place,
easy to modify</li>
<li><strong>Reusable</strong>: Multiple components can trigger the same
logic</li>
<li><strong>Flexible</strong>: Easy to add, remove, or modify rules</li>
</ol>
<h3 id="advanced-composable-business-logic">Advanced: Composable
Business Logic</h3>
<p>For larger applications, you can compose multiple business logic
modules:</p>
<div class="sourceCode" id="cb193"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co">// business-logic/index.js</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartRules <span class="im">from</span> <span class="st">&#39;./cart-rules.js&#39;</span><span class="op">;</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pricingRules <span class="im">from</span> <span class="st">&#39;./pricing-rules.js&#39;</span><span class="op">;</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inventoryRules <span class="im">from</span> <span class="st">&#39;./inventory-rules.js&#39;</span><span class="op">;</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> analyticsRules <span class="im">from</span> <span class="st">&#39;./analytics-rules.js&#39;</span><span class="op">;</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">initBusinessLogic</span>() {</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Initializing business logic...&#39;</span>)<span class="op">;</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialize all business logic modules</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>  cartRules<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>  pricingRules<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>  inventoryRules<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>  analyticsRules<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Business logic ready&#39;</span>)<span class="op">;</span></span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb194"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app.js</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { initBusinessLogic } <span class="im">from</span> <span class="st">&#39;./business-logic/index.js&#39;</span><span class="op">;</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Single call to initialize all business logic</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="fu">initBusinessLogic</span>()<span class="op">;</span></span></code></pre></div>
<h2 id="pattern-2-extending-components">Pattern 2: Extending
Components</h2>
<p>Sometimes you need to add business logic directly to a component,
especially when:</p>
<ul>
<li>The logic is specific to one component type</li>
<li>You need to override component behavior</li>
<li>You’re creating specialized versions of generic components</li>
</ul>
<h3 id="when-to-use-1">When to Use</h3>
<p>Use component extension when:</p>
<ul>
<li>Logic is tightly coupled to component rendering</li>
<li>You need access to component internals (Shadow DOM, private
methods)</li>
<li>Creating specialized variants of base components</li>
<li>Logic doesn’t need to be shared across different component
types</li>
</ul>
<h3 id="implementation">Implementation</h3>
<p>Let’s extend a generic product card with business-specific
behavior:</p>
<div class="sourceCode" id="cb195"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/base/product-card.js</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> ProductCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        /* Base styles */</span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;card&quot;&gt;</span></span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;img src=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">image</span><span class="sc">}</span><span class="vs">&quot; alt=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&quot;&gt;</span></span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h3&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h3&gt;</span></span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p class=&quot;price&quot;&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">formatPrice</span>(<span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">price</span>)<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button class=&quot;add-to-cart&quot;&gt;Add to Cart&lt;/button&gt;</span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.add-to-cart&#39;</span>)</span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="kw">this</span><span class="op">.</span><span class="fu">handleAddToCart</span>())<span class="op">;</span></span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleAddToCart</span>() {</span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> {</span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a>      <span class="dt">product</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">,</span></span>
<span id="cb195-28"><a href="#cb195-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb195-29"><a href="#cb195-29" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb195-30"><a href="#cb195-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb195-31"><a href="#cb195-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-32"><a href="#cb195-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatPrice</span>(price) {</span>
<span id="cb195-33"><a href="#cb195-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`$</span><span class="sc">${</span>price<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb195-34"><a href="#cb195-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb195-35"><a href="#cb195-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-36"><a href="#cb195-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">product</span>() {</span>
<span id="cb195-37"><a href="#cb195-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;product&#39;</span>))<span class="op">;</span></span>
<span id="cb195-38"><a href="#cb195-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb195-39"><a href="#cb195-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-40"><a href="#cb195-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-41"><a href="#cb195-41" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;product-card&#39;</span><span class="op">,</span> ProductCard)<span class="op">;</span></span></code></pre></div>
<p>Now extend it with business-specific logic:</p>
<div class="sourceCode" id="cb196"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/premium-product-card.js</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ProductCard } <span class="im">from</span> <span class="st">&#39;./base/product-card.js&#39;</span><span class="op">;</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> PremiumProductCard <span class="kw">extends</span> ProductCard {</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">connectedCallback</span>()<span class="op">;</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add business-specific subscriptions</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_unsubscribers</span> <span class="op">=</span> [</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;pricing.update&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handlePriceUpdate</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">,</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;user.tier.changed&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleTierChange</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize premium features</span></span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">loadMemberPricing</span>()<span class="op">;</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">loadMemberPricing</span>() {</span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (user<span class="op">?.</span><span class="at">tier</span> <span class="op">===</span> <span class="st">&#39;premium&#39;</span>) {</span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">applyPremiumDiscount</span>()<span class="op">;</span></span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">applyPremiumDiscount</span>() {</span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule: 15% discount for premium members</span></span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> discount <span class="op">=</span> <span class="fl">0.15</span><span class="op">;</span></span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> originalPrice <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">price</span><span class="op">;</span></span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> discountedPrice <span class="op">=</span> originalPrice <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> discount)<span class="op">;</span></span>
<span id="cb196-30"><a href="#cb196-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-31"><a href="#cb196-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">price</span> <span class="op">=</span> discountedPrice<span class="op">;</span></span>
<span id="cb196-32"><a href="#cb196-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">originalPrice</span> <span class="op">=</span> originalPrice<span class="op">;</span></span>
<span id="cb196-33"><a href="#cb196-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-34"><a href="#cb196-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span> <span class="co">// Re-render with new price</span></span>
<span id="cb196-35"><a href="#cb196-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-36"><a href="#cb196-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-37"><a href="#cb196-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb196-38"><a href="#cb196-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Call parent render</span></span>
<span id="cb196-39"><a href="#cb196-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb196-40"><a href="#cb196-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-41"><a href="#cb196-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add premium badge if applicable</span></span>
<span id="cb196-42"><a href="#cb196-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">originalPrice</span>) {</span>
<span id="cb196-43"><a href="#cb196-43" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">addPremiumBadge</span>()<span class="op">;</span></span>
<span id="cb196-44"><a href="#cb196-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb196-45"><a href="#cb196-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-46"><a href="#cb196-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-47"><a href="#cb196-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPremiumBadge</span>() {</span>
<span id="cb196-48"><a href="#cb196-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> badge <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;div&#39;</span>)<span class="op">;</span></span>
<span id="cb196-49"><a href="#cb196-49" aria-hidden="true" tabindex="-1"></a>    badge<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;premium-badge&#39;</span><span class="op">;</span></span>
<span id="cb196-50"><a href="#cb196-50" aria-hidden="true" tabindex="-1"></a>    badge<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb196-51"><a href="#cb196-51" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb196-52"><a href="#cb196-52" aria-hidden="true" tabindex="-1"></a><span class="vs">        .premium-badge {</span></span>
<span id="cb196-53"><a href="#cb196-53" aria-hidden="true" tabindex="-1"></a><span class="vs">          position: absolute;</span></span>
<span id="cb196-54"><a href="#cb196-54" aria-hidden="true" tabindex="-1"></a><span class="vs">          top: 10px;</span></span>
<span id="cb196-55"><a href="#cb196-55" aria-hidden="true" tabindex="-1"></a><span class="vs">          right: 10px;</span></span>
<span id="cb196-56"><a href="#cb196-56" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: gold;</span></span>
<span id="cb196-57"><a href="#cb196-57" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: black;</span></span>
<span id="cb196-58"><a href="#cb196-58" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 5px 10px;</span></span>
<span id="cb196-59"><a href="#cb196-59" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 3px;</span></span>
<span id="cb196-60"><a href="#cb196-60" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-weight: bold;</span></span>
<span id="cb196-61"><a href="#cb196-61" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb196-62"><a href="#cb196-62" aria-hidden="true" tabindex="-1"></a><span class="vs">        .original-price {</span></span>
<span id="cb196-63"><a href="#cb196-63" aria-hidden="true" tabindex="-1"></a><span class="vs">          text-decoration: line-through;</span></span>
<span id="cb196-64"><a href="#cb196-64" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: #999;</span></span>
<span id="cb196-65"><a href="#cb196-65" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-size: 0.9em;</span></span>
<span id="cb196-66"><a href="#cb196-66" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb196-67"><a href="#cb196-67" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb196-68"><a href="#cb196-68" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;span&gt;Premium Member&lt;/span&gt;</span></span>
<span id="cb196-69"><a href="#cb196-69" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;original-price&quot;&gt;</span></span>
<span id="cb196-70"><a href="#cb196-70" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">formatPrice</span>(<span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">originalPrice</span>)<span class="sc">}</span></span>
<span id="cb196-71"><a href="#cb196-71" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb196-72"><a href="#cb196-72" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb196-73"><a href="#cb196-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-74"><a href="#cb196-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.card&#39;</span>)<span class="op">.</span><span class="fu">prepend</span>(badge)<span class="op">;</span></span>
<span id="cb196-75"><a href="#cb196-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-76"><a href="#cb196-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-77"><a href="#cb196-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleAddToCart</span>() {</span>
<span id="cb196-78"><a href="#cb196-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business validation before adding</span></span>
<span id="cb196-79"><a href="#cb196-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> canAddPremiumItem <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validatePremiumAccess</span>()<span class="op">;</span></span>
<span id="cb196-80"><a href="#cb196-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-81"><a href="#cb196-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>canAddPremiumItem) {</span>
<span id="cb196-82"><a href="#cb196-82" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;app.error&#39;</span><span class="op">,</span> {</span>
<span id="cb196-83"><a href="#cb196-83" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Premium membership required for this product&#39;</span></span>
<span id="cb196-84"><a href="#cb196-84" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb196-85"><a href="#cb196-85" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb196-86"><a href="#cb196-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb196-87"><a href="#cb196-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-88"><a href="#cb196-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Track premium conversions</span></span>
<span id="cb196-89"><a href="#cb196-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">trackPremiumConversion</span>()<span class="op">;</span></span>
<span id="cb196-90"><a href="#cb196-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-91"><a href="#cb196-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Call parent behavior</span></span>
<span id="cb196-92"><a href="#cb196-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="fu">handleAddToCart</span>()<span class="op">;</span></span>
<span id="cb196-93"><a href="#cb196-93" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-94"><a href="#cb196-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-95"><a href="#cb196-95" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">validatePremiumAccess</span>() {</span>
<span id="cb196-96"><a href="#cb196-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">premiumOnly</span>) <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb196-97"><a href="#cb196-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-98"><a href="#cb196-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb196-99"><a href="#cb196-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user<span class="op">?.</span><span class="at">tier</span> <span class="op">===</span> <span class="st">&#39;premium&#39;</span><span class="op">;</span></span>
<span id="cb196-100"><a href="#cb196-100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-101"><a href="#cb196-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-102"><a href="#cb196-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trackPremiumConversion</span>() {</span>
<span id="cb196-103"><a href="#cb196-103" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;analytics.track&#39;</span><span class="op">,</span> {</span>
<span id="cb196-104"><a href="#cb196-104" aria-hidden="true" tabindex="-1"></a>      <span class="dt">event</span><span class="op">:</span> <span class="st">&#39;premium_product_add_to_cart&#39;</span><span class="op">,</span></span>
<span id="cb196-105"><a href="#cb196-105" aria-hidden="true" tabindex="-1"></a>      <span class="dt">product</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb196-106"><a href="#cb196-106" aria-hidden="true" tabindex="-1"></a>      <span class="dt">price</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">price</span><span class="op">,</span></span>
<span id="cb196-107"><a href="#cb196-107" aria-hidden="true" tabindex="-1"></a>      <span class="dt">discount</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">originalPrice</span> <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">price</span></span>
<span id="cb196-108"><a href="#cb196-108" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb196-109"><a href="#cb196-109" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-110"><a href="#cb196-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-111"><a href="#cb196-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handlePriceUpdate</span>(data) {</span>
<span id="cb196-112"><a href="#cb196-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">productId</span> <span class="op">===</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">id</span>) {</span>
<span id="cb196-113"><a href="#cb196-113" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">price</span> <span class="op">=</span> data<span class="op">.</span><span class="at">newPrice</span><span class="op">;</span></span>
<span id="cb196-114"><a href="#cb196-114" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb196-115"><a href="#cb196-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb196-116"><a href="#cb196-116" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-117"><a href="#cb196-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-118"><a href="#cb196-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleTierChange</span>(data) {</span>
<span id="cb196-119"><a href="#cb196-119" aria-hidden="true" tabindex="-1"></a>    <span class="co">// User tier changed - recalculate pricing</span></span>
<span id="cb196-120"><a href="#cb196-120" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">loadMemberPricing</span>()<span class="op">;</span></span>
<span id="cb196-121"><a href="#cb196-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-122"><a href="#cb196-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-123"><a href="#cb196-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb196-124"><a href="#cb196-124" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clean up subscriptions</span></span>
<span id="cb196-125"><a href="#cb196-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_unsubscribers</span><span class="op">.</span><span class="fu">forEach</span>(unsub <span class="kw">=&gt;</span> <span class="fu">unsub</span>())<span class="op">;</span></span>
<span id="cb196-126"><a href="#cb196-126" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="at">disconnectedCallback</span><span class="op">?.</span>()<span class="op">;</span></span>
<span id="cb196-127"><a href="#cb196-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-128"><a href="#cb196-128" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb196-129"><a href="#cb196-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-130"><a href="#cb196-130" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;premium-product-card&#39;</span><span class="op">,</span> PremiumProductCard)<span class="op">;</span></span></code></pre></div>
<h3 id="when-this-makes-sense">When This Makes Sense</h3>
<p>Component extension works well when:</p>
<ol type="1">
<li><strong>The logic changes how the component renders or
behaves</strong></li>
<li><strong>You need multiple variants of a base component</strong>
(premium, free, guest, etc.)</li>
<li><strong>Business logic is closely tied to component
lifecycle</strong></li>
</ol>
<p>However, be cautious: overuse of extension can lead to:</p>
<ul>
<li>Tight coupling between business logic and UI</li>
<li>Harder to test business rules independently</li>
<li>Duplication if multiple components need the same logic</li>
</ul>
<h2 id="pattern-3-wrapper-components">Pattern 3: Wrapper Components</h2>
<p>Wrapper components let you add behavior around existing components
without modifying them. This is useful when you want to:</p>
<ul>
<li>Add behavior to third-party components</li>
<li>Keep base components pristine</li>
<li>Compose behaviors dynamically</li>
</ul>
<h3 id="implementation-1">Implementation</h3>
<div class="sourceCode" id="cb197"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/business-wrapper.js</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BusinessWrapper <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Intercept events from slotted content</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;add-to-cart&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleBusinessLogic</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a><span class="vs">        :host {</span></span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a><span class="vs">        .validation-message {</span></span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: red;</span></span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 10px;</span></span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #fee;</span></span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a><span class="vs">          margin-bottom: 10px;</span></span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a><span class="vs">        .validation-message.hidden {</span></span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: none;</span></span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;validation-message hidden&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb197-26"><a href="#cb197-26" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;slot&gt;&lt;/slot&gt;</span></span>
<span id="cb197-27"><a href="#cb197-27" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb197-28"><a href="#cb197-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb197-29"><a href="#cb197-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-30"><a href="#cb197-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleBusinessLogic</span>(e) {</span>
<span id="cb197-31"><a href="#cb197-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Stop the event from propagating immediately</span></span>
<span id="cb197-32"><a href="#cb197-32" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">stopPropagation</span>()<span class="op">;</span></span>
<span id="cb197-33"><a href="#cb197-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-34"><a href="#cb197-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply business validation</span></span>
<span id="cb197-35"><a href="#cb197-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validation <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateBusinessRules</span>(e<span class="op">.</span><span class="at">detail</span>)<span class="op">;</span></span>
<span id="cb197-36"><a href="#cb197-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-37"><a href="#cb197-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>validation<span class="op">.</span><span class="at">valid</span>) {</span>
<span id="cb197-38"><a href="#cb197-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showError</span>(validation<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb197-39"><a href="#cb197-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb197-40"><a href="#cb197-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb197-41"><a href="#cb197-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-42"><a href="#cb197-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validation passed - let the event continue</span></span>
<span id="cb197-43"><a href="#cb197-43" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> e<span class="op">.</span><span class="at">detail</span>)<span class="op">;</span></span>
<span id="cb197-44"><a href="#cb197-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb197-45"><a href="#cb197-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-46"><a href="#cb197-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">validateBusinessRules</span>(data) {</span>
<span id="cb197-47"><a href="#cb197-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check user eligibility</span></span>
<span id="cb197-48"><a href="#cb197-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb197-49"><a href="#cb197-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb197-50"><a href="#cb197-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb197-51"><a href="#cb197-51" aria-hidden="true" tabindex="-1"></a>        <span class="dt">valid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb197-52"><a href="#cb197-52" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Please log in to add items to cart&#39;</span></span>
<span id="cb197-53"><a href="#cb197-53" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb197-54"><a href="#cb197-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb197-55"><a href="#cb197-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-56"><a href="#cb197-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check age restriction</span></span>
<span id="cb197-57"><a href="#cb197-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">ageRestricted</span> <span class="op">&amp;&amp;</span> user<span class="op">.</span><span class="at">age</span> <span class="op">&lt;</span> <span class="dv">21</span>) {</span>
<span id="cb197-58"><a href="#cb197-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb197-59"><a href="#cb197-59" aria-hidden="true" tabindex="-1"></a>        <span class="dt">valid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb197-60"><a href="#cb197-60" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;This product requires age verification (21+)&#39;</span></span>
<span id="cb197-61"><a href="#cb197-61" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb197-62"><a href="#cb197-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb197-63"><a href="#cb197-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-64"><a href="#cb197-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check geographic restriction</span></span>
<span id="cb197-65"><a href="#cb197-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">geoRestricted</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="fu">isAllowedRegion</span>(user<span class="op">.</span><span class="at">region</span>)) {</span>
<span id="cb197-66"><a href="#cb197-66" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb197-67"><a href="#cb197-67" aria-hidden="true" tabindex="-1"></a>        <span class="dt">valid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb197-68"><a href="#cb197-68" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;This product is not available in your region&#39;</span></span>
<span id="cb197-69"><a href="#cb197-69" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb197-70"><a href="#cb197-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb197-71"><a href="#cb197-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-72"><a href="#cb197-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">valid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">;</span></span>
<span id="cb197-73"><a href="#cb197-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb197-74"><a href="#cb197-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-75"><a href="#cb197-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">isAllowedRegion</span>(region) {</span>
<span id="cb197-76"><a href="#cb197-76" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business logic for regional restrictions</span></span>
<span id="cb197-77"><a href="#cb197-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> allowedRegions <span class="op">=</span> [<span class="st">&#39;US&#39;</span><span class="op">,</span> <span class="st">&#39;CA&#39;</span><span class="op">,</span> <span class="st">&#39;UK&#39;</span>]<span class="op">;</span></span>
<span id="cb197-78"><a href="#cb197-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> allowedRegions<span class="op">.</span><span class="fu">includes</span>(region)<span class="op">;</span></span>
<span id="cb197-79"><a href="#cb197-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb197-80"><a href="#cb197-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-81"><a href="#cb197-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showError</span>(message) {</span>
<span id="cb197-82"><a href="#cb197-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> errorEl <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.validation-message&#39;</span>)<span class="op">;</span></span>
<span id="cb197-83"><a href="#cb197-83" aria-hidden="true" tabindex="-1"></a>    errorEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> message<span class="op">;</span></span>
<span id="cb197-84"><a href="#cb197-84" aria-hidden="true" tabindex="-1"></a>    errorEl<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">remove</span>(<span class="st">&#39;hidden&#39;</span>)<span class="op">;</span></span>
<span id="cb197-85"><a href="#cb197-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-86"><a href="#cb197-86" aria-hidden="true" tabindex="-1"></a>    <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb197-87"><a href="#cb197-87" aria-hidden="true" tabindex="-1"></a>      errorEl<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">add</span>(<span class="st">&#39;hidden&#39;</span>)<span class="op">;</span></span>
<span id="cb197-88"><a href="#cb197-88" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="dv">5000</span>)<span class="op">;</span></span>
<span id="cb197-89"><a href="#cb197-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb197-90"><a href="#cb197-90" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb197-91"><a href="#cb197-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-92"><a href="#cb197-92" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;business-wrapper&#39;</span><span class="op">,</span> BusinessWrapper)<span class="op">;</span></span></code></pre></div>
<p>Usage:</p>
<div class="sourceCode" id="cb198"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Wrap any component with business logic --&gt;</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">business-wrapper</span><span class="dt">&gt;</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">product-card</span><span class="ot"> product-id</span><span class="op">=</span><span class="st">&quot;123&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">product-card</span><span class="dt">&gt;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">business-wrapper</span><span class="dt">&gt;</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">business-wrapper</span><span class="dt">&gt;</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">quick-buy-button</span><span class="ot"> product-id</span><span class="op">=</span><span class="st">&quot;456&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">quick-buy-button</span><span class="dt">&gt;</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">business-wrapper</span><span class="dt">&gt;</span></span></code></pre></div>
<p>The wrapper intercepts events and applies business logic
<strong>without modifying</strong> the wrapped components.</p>
<h2 id="pattern-4-behavior-mixins">Pattern 4: Behavior Mixins</h2>
<p>Mixins let you share behavior across multiple component types. This
is useful for cross-cutting concerns like analytics, logging, or
validation.</p>
<h3 id="implementation-2">Implementation</h3>
<div class="sourceCode" id="cb199"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co">// mixins/analytics-mixin.js</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> AnalyticsMixin <span class="op">=</span> (BaseClass) <span class="kw">=&gt;</span> <span class="kw">class</span> <span class="kw">extends</span> BaseClass {</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">track</span>(<span class="bu">event</span><span class="op">,</span> data <span class="op">=</span> {}) {</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;analytics.track&#39;</span><span class="op">,</span> {</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>      <span class="bu">event</span><span class="op">,</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">component</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">tagName</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">,</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">timestamp</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">,</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span><span class="kw">this</span><span class="op">.</span><span class="fu">getAnalyticsContext</span>()</span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-13"><a href="#cb199-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trackInteraction</span>(element<span class="op">,</span> action) {</span>
<span id="cb199-14"><a href="#cb199-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">track</span>(<span class="vs">`</span><span class="sc">${</span>element<span class="sc">}</span><span class="vs">.</span><span class="sc">${</span>action<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> {</span>
<span id="cb199-15"><a href="#cb199-15" aria-hidden="true" tabindex="-1"></a>      element<span class="op">,</span></span>
<span id="cb199-16"><a href="#cb199-16" aria-hidden="true" tabindex="-1"></a>      action</span>
<span id="cb199-17"><a href="#cb199-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb199-18"><a href="#cb199-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb199-19"><a href="#cb199-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-20"><a href="#cb199-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getAnalyticsContext</span>() {</span>
<span id="cb199-21"><a href="#cb199-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add common context to all analytics events</span></span>
<span id="cb199-22"><a href="#cb199-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb199-23"><a href="#cb199-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">page</span><span class="op">:</span> <span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span><span class="op">,</span></span>
<span id="cb199-24"><a href="#cb199-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">referrer</span><span class="op">:</span> <span class="bu">document</span><span class="op">.</span><span class="at">referrer</span></span>
<span id="cb199-25"><a href="#cb199-25" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb199-26"><a href="#cb199-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb199-27"><a href="#cb199-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-28"><a href="#cb199-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb199-29"><a href="#cb199-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="at">connectedCallback</span><span class="op">?.</span>()<span class="op">;</span></span>
<span id="cb199-30"><a href="#cb199-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">track</span>(<span class="st">&#39;component.mounted&#39;</span><span class="op">,</span> { <span class="dt">id</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb199-31"><a href="#cb199-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb199-32"><a href="#cb199-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-33"><a href="#cb199-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disconnectedCallback</span>() {</span>
<span id="cb199-34"><a href="#cb199-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">track</span>(<span class="st">&#39;component.unmounted&#39;</span><span class="op">,</span> { <span class="dt">id</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb199-35"><a href="#cb199-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span><span class="op">.</span><span class="at">disconnectedCallback</span><span class="op">?.</span>()<span class="op">;</span></span>
<span id="cb199-36"><a href="#cb199-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb199-37"><a href="#cb199-37" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb200"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co">// mixins/validation-mixin.js</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> ValidationMixin <span class="op">=</span> (BaseClass) <span class="kw">=&gt;</span> <span class="kw">class</span> <span class="kw">extends</span> BaseClass {</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">validate</span>(data<span class="op">,</span> rules) {</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> errors <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> [field<span class="op">,</span> rule] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(rules)) {</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> value <span class="op">=</span> data[field]<span class="op">;</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rule<span class="op">.</span><span class="at">required</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>value) {</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>field<span class="sc">}</span><span class="vs"> is required`</span>)<span class="op">;</span></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rule<span class="op">.</span><span class="at">min</span> <span class="op">&amp;&amp;</span> value <span class="op">&lt;</span> rule<span class="op">.</span><span class="at">min</span>) {</span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>field<span class="sc">}</span><span class="vs"> must be at least </span><span class="sc">${</span>rule<span class="op">.</span><span class="at">min</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rule<span class="op">.</span><span class="at">max</span> <span class="op">&amp;&amp;</span> value <span class="op">&gt;</span> rule<span class="op">.</span><span class="at">max</span>) {</span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>field<span class="sc">}</span><span class="vs"> must be at most </span><span class="sc">${</span>rule<span class="op">.</span><span class="at">max</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rule<span class="op">.</span><span class="at">pattern</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>rule<span class="op">.</span><span class="at">pattern</span><span class="op">.</span><span class="fu">test</span>(value)) {</span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>field<span class="sc">}</span><span class="vs"> is invalid`</span>)<span class="op">;</span></span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rule<span class="op">.</span><span class="at">custom</span>) {</span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> customError <span class="op">=</span> <span class="cf">await</span> rule<span class="op">.</span><span class="fu">custom</span>(value<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (customError) errors<span class="op">.</span><span class="fu">push</span>(customError)<span class="op">;</span></span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-31"><a href="#cb200-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb200-32"><a href="#cb200-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">valid</span><span class="op">:</span> errors<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb200-33"><a href="#cb200-33" aria-hidden="true" tabindex="-1"></a>      errors</span>
<span id="cb200-34"><a href="#cb200-34" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb200-35"><a href="#cb200-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb200-36"><a href="#cb200-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-37"><a href="#cb200-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showValidationErrors</span>(errors) {</span>
<span id="cb200-38"><a href="#cb200-38" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;validation.errors&#39;</span><span class="op">,</span> {</span>
<span id="cb200-39"><a href="#cb200-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">component</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">tagName</span><span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">,</span></span>
<span id="cb200-40"><a href="#cb200-40" aria-hidden="true" tabindex="-1"></a>      errors</span>
<span id="cb200-41"><a href="#cb200-41" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb200-42"><a href="#cb200-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb200-43"><a href="#cb200-43" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Use mixins to compose behavior:</p>
<div class="sourceCode" id="cb201"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { AnalyticsMixin } <span class="im">from</span> <span class="st">&#39;./mixins/analytics-mixin.js&#39;</span><span class="op">;</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ValidationMixin } <span class="im">from</span> <span class="st">&#39;./mixins/validation-mixin.js&#39;</span><span class="op">;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CheckoutForm <span class="kw">extends</span> <span class="fu">ValidationMixin</span>(<span class="fu">AnalyticsMixin</span>(<span class="bu">HTMLElement</span>)) {</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleSubmit</span>() {</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use validation from mixin</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validation <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validate</span>(<span class="kw">this</span><span class="op">.</span><span class="at">formData</span><span class="op">,</span> {</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">email</span><span class="op">:</span> {</span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pattern</span><span class="op">:</span> <span class="ss">/</span><span class="sc">^[^\s@]+</span><span class="ss">@</span><span class="sc">[^\s@]+\.[^\s@]+$</span><span class="ss">/</span></span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cardNumber</span><span class="op">:</span> {</span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">required</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">custom</span><span class="op">:</span> <span class="kw">async</span> (value) <span class="kw">=&gt;</span> {</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> valid <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateCard</span>(value)<span class="op">;</span></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> valid <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> <span class="st">&#39;Invalid card number&#39;</span><span class="op">;</span></span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>validation<span class="op">.</span><span class="at">valid</span>) {</span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showValidationErrors</span>(validation<span class="op">.</span><span class="at">errors</span>)<span class="op">;</span></span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb201-24"><a href="#cb201-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb201-25"><a href="#cb201-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-26"><a href="#cb201-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use analytics from mixin</span></span>
<span id="cb201-27"><a href="#cb201-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">track</span>(<span class="st">&#39;checkout.submit&#39;</span><span class="op">,</span> {</span>
<span id="cb201-28"><a href="#cb201-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">amount</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">total</span><span class="op">,</span></span>
<span id="cb201-29"><a href="#cb201-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">items</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span></span>
<span id="cb201-30"><a href="#cb201-30" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb201-31"><a href="#cb201-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-32"><a href="#cb201-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Process checkout</span></span>
<span id="cb201-33"><a href="#cb201-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">processOrder</span>()<span class="op">;</span></span>
<span id="cb201-34"><a href="#cb201-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb201-35"><a href="#cb201-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="pattern-5-service-layer">Pattern 5: Service Layer</h2>
<p>For complex business logic, create a dedicated service layer that
components and PAN listeners can both use:</p>
<div class="sourceCode" id="cb202"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co">// services/pricing-service.js</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PricingService {</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">calculatePrice</span>(product<span class="op">,</span> quantity<span class="op">,</span> user) {</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> price <span class="op">=</span> product<span class="op">.</span><span class="at">basePrice</span><span class="op">;</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule: Volume discounts</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (quantity <span class="op">&gt;=</span> <span class="dv">10</span>) price <span class="op">*=</span> <span class="fl">0.85</span><span class="op">;</span></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (quantity <span class="op">&gt;=</span> <span class="dv">5</span>) price <span class="op">*=</span> <span class="fl">0.90</span><span class="op">;</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule: Member discounts</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (user<span class="op">?.</span><span class="at">tier</span> <span class="op">===</span> <span class="st">&#39;premium&#39;</span>) {</span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>      price <span class="op">*=</span> <span class="fl">0.85</span><span class="op">;</span></span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (user<span class="op">?.</span><span class="at">tier</span> <span class="op">===</span> <span class="st">&#39;gold&#39;</span>) {</span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>      price <span class="op">*=</span> <span class="fl">0.90</span><span class="op">;</span></span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business Rule: Active promotions</span></span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> promotions <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getActivePromotions</span>(product<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> promo <span class="kw">of</span> promotions) {</span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a>      price <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">applyPromotion</span>(price<span class="op">,</span> promo)<span class="op">;</span></span>
<span id="cb202-21"><a href="#cb202-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb202-22"><a href="#cb202-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-23"><a href="#cb202-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb202-24"><a href="#cb202-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unitPrice</span><span class="op">:</span> price<span class="op">,</span></span>
<span id="cb202-25"><a href="#cb202-25" aria-hidden="true" tabindex="-1"></a>      quantity<span class="op">,</span></span>
<span id="cb202-26"><a href="#cb202-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">subtotal</span><span class="op">:</span> price <span class="op">*</span> quantity<span class="op">,</span></span>
<span id="cb202-27"><a href="#cb202-27" aria-hidden="true" tabindex="-1"></a>      <span class="dt">savings</span><span class="op">:</span> (product<span class="op">.</span><span class="at">basePrice</span> <span class="op">-</span> price) <span class="op">*</span> quantity</span>
<span id="cb202-28"><a href="#cb202-28" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb202-29"><a href="#cb202-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb202-30"><a href="#cb202-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-31"><a href="#cb202-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getActivePromotions</span>(productId) {</span>
<span id="cb202-32"><a href="#cb202-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/promotions?product=</span><span class="sc">${</span>productId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb202-33"><a href="#cb202-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb202-34"><a href="#cb202-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb202-35"><a href="#cb202-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-36"><a href="#cb202-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">applyPromotion</span>(price<span class="op">,</span> promotion) {</span>
<span id="cb202-37"><a href="#cb202-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (promotion<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">&#39;percentage&#39;</span>) {</span>
<span id="cb202-38"><a href="#cb202-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> price <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> promotion<span class="op">.</span><span class="at">value</span> <span class="op">/</span> <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb202-39"><a href="#cb202-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (promotion<span class="op">.</span><span class="at">type</span> <span class="op">===</span> <span class="st">&#39;fixed&#39;</span>) {</span>
<span id="cb202-40"><a href="#cb202-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> price <span class="op">-</span> promotion<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb202-41"><a href="#cb202-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb202-42"><a href="#cb202-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> price<span class="op">;</span></span>
<span id="cb202-43"><a href="#cb202-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb202-44"><a href="#cb202-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-45"><a href="#cb202-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getTax</span>(subtotal<span class="op">,</span> region) {</span>
<span id="cb202-46"><a href="#cb202-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> taxRates <span class="op">=</span> {</span>
<span id="cb202-47"><a href="#cb202-47" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;CA&#39;</span><span class="op">:</span> <span class="fl">0.0725</span><span class="op">,</span></span>
<span id="cb202-48"><a href="#cb202-48" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;NY&#39;</span><span class="op">:</span> <span class="fl">0.08</span><span class="op">,</span></span>
<span id="cb202-49"><a href="#cb202-49" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;TX&#39;</span><span class="op">:</span> <span class="fl">0.0625</span></span>
<span id="cb202-50"><a href="#cb202-50" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb202-51"><a href="#cb202-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-52"><a href="#cb202-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> subtotal <span class="op">*</span> (taxRates[region] <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb202-53"><a href="#cb202-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb202-54"><a href="#cb202-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb202-55"><a href="#cb202-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-56"><a href="#cb202-56" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">new</span> <span class="fu">PricingService</span>()<span class="op">;</span></span></code></pre></div>
<p>Use the service from both components and PAN listeners:</p>
<div class="sourceCode" id="cb203"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In a component</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pricingService <span class="im">from</span> <span class="st">&#39;./services/pricing-service.js&#39;</span><span class="op">;</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ProductCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">updatePrice</span>() {</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pricing <span class="op">=</span> <span class="cf">await</span> pricingService<span class="op">.</span><span class="fu">calculatePrice</span>(</span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">,</span></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">quantity</span><span class="op">,</span></span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>      user</span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">displayPrice</span>(pricing)<span class="op">;</span></span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb204"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In business logic</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pricingService <span class="im">from</span> <span class="st">&#39;./services/pricing-service.js&#39;</span><span class="op">;</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CartBusinessLogic {</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">init</span>() {</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> <span class="kw">async</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pricing <span class="op">=</span> <span class="cf">await</span> pricingService<span class="op">.</span><span class="fu">calculatePrice</span>(</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="at">product</span><span class="op">,</span></span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="at">quantity</span><span class="op">,</span></span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>        user</span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.priced&#39;</span><span class="op">,</span> { <span class="op">...</span>data<span class="op">,</span> pricing })<span class="op">;</span></span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb204-16"><a href="#cb204-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb204-17"><a href="#cb204-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="decision-matrix">Decision Matrix</h2>
<p>Here’s how to choose the right pattern:</p>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 55%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th>Scenario</th>
<th>Recommended Pattern</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cross-component coordination</td>
<td>PAN Bus Listeners</td>
<td>Decoupled, flexible</td>
</tr>
<tr>
<td>Analytics/logging</td>
<td>Mixins</td>
<td>Reusable across all components</td>
</tr>
<tr>
<td>Validation before actions</td>
<td>PAN Bus Listeners</td>
<td>Centralized rules</td>
</tr>
<tr>
<td>Component-specific UI logic</td>
<td>Extend Component</td>
<td>Access to internals</td>
</tr>
<tr>
<td>Add behavior to third-party components</td>
<td>Wrapper</td>
<td>Non-invasive</td>
</tr>
<tr>
<td>Complex business calculations</td>
<td>Service Layer</td>
<td>Testable, reusable</td>
</tr>
<tr>
<td>Component variants (premium, free)</td>
<td>Extend Component</td>
<td>Clear inheritance</td>
</tr>
<tr>
<td>Feature flags / A-B testing</td>
<td>Wrapper or PAN Listeners</td>
<td>Easy to toggle</td>
</tr>
</tbody>
</table>
<h2 id="real-world-example-e-commerce-checkout">Real-World Example:
E-Commerce Checkout</h2>
<p>Let’s see how these patterns work together in a complete checkout
flow:</p>
<div class="sourceCode" id="cb205"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co">// services/checkout-service.js</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CheckoutService {</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">processOrder</span>(cart<span class="op">,</span> paymentInfo<span class="op">,</span> shippingInfo) {</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Complex business logic</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pricing <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculateFinalPricing</span>(cart)<span class="op">;</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> shipping <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculateShipping</span>(cart<span class="op">,</span> shippingInfo)<span class="op">;</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tax <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculateTax</span>(pricing<span class="op">.</span><span class="at">subtotal</span><span class="op">,</span> shippingInfo<span class="op">.</span><span class="at">state</span>)<span class="op">;</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">items</span><span class="op">:</span> cart<span class="op">.</span><span class="at">items</span><span class="op">,</span></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>      pricing<span class="op">,</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>      shipping<span class="op">,</span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>      tax<span class="op">,</span></span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">total</span><span class="op">:</span> pricing<span class="op">.</span><span class="at">subtotal</span> <span class="op">+</span> shipping<span class="op">.</span><span class="at">cost</span> <span class="op">+</span> tax</span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">calculateFinalPricing</span>(cart) {</span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Apply all discounts, coupons, etc.</span></span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> subtotal <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> savings <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb205-22"><a href="#cb205-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-23"><a href="#cb205-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> cart<span class="op">.</span><span class="at">items</span>) {</span>
<span id="cb205-24"><a href="#cb205-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> itemPricing <span class="op">=</span> <span class="cf">await</span> pricingService<span class="op">.</span><span class="fu">calculatePrice</span>(</span>
<span id="cb205-25"><a href="#cb205-25" aria-hidden="true" tabindex="-1"></a>        item<span class="op">.</span><span class="at">product</span><span class="op">,</span></span>
<span id="cb205-26"><a href="#cb205-26" aria-hidden="true" tabindex="-1"></a>        item<span class="op">.</span><span class="at">quantity</span><span class="op">,</span></span>
<span id="cb205-27"><a href="#cb205-27" aria-hidden="true" tabindex="-1"></a>        cart<span class="op">.</span><span class="at">user</span></span>
<span id="cb205-28"><a href="#cb205-28" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb205-29"><a href="#cb205-29" aria-hidden="true" tabindex="-1"></a>      subtotal <span class="op">+=</span> itemPricing<span class="op">.</span><span class="at">subtotal</span><span class="op">;</span></span>
<span id="cb205-30"><a href="#cb205-30" aria-hidden="true" tabindex="-1"></a>      savings <span class="op">+=</span> itemPricing<span class="op">.</span><span class="at">savings</span><span class="op">;</span></span>
<span id="cb205-31"><a href="#cb205-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb205-32"><a href="#cb205-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-33"><a href="#cb205-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { subtotal<span class="op">,</span> savings }<span class="op">;</span></span>
<span id="cb205-34"><a href="#cb205-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb205-35"><a href="#cb205-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-36"><a href="#cb205-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">calculateShipping</span>(cart<span class="op">,</span> shippingInfo) {</span>
<span id="cb205-37"><a href="#cb205-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Shipping business rules</span></span>
<span id="cb205-38"><a href="#cb205-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cart<span class="op">.</span><span class="at">total</span> <span class="op">&gt;=</span> <span class="dv">50</span>) {</span>
<span id="cb205-39"><a href="#cb205-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;standard&#39;</span><span class="op">,</span> <span class="dt">cost</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">freeShipping</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">;</span></span>
<span id="cb205-40"><a href="#cb205-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb205-41"><a href="#cb205-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-42"><a href="#cb205-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> weight <span class="op">=</span> cart<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> item) <span class="kw">=&gt;</span> sum <span class="op">+</span> item<span class="op">.</span><span class="at">weight</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb205-43"><a href="#cb205-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> zone <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getShippingZone</span>(shippingInfo<span class="op">.</span><span class="at">state</span>)<span class="op">;</span></span>
<span id="cb205-44"><a href="#cb205-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-45"><a href="#cb205-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb205-46"><a href="#cb205-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;standard&#39;</span><span class="op">,</span></span>
<span id="cb205-47"><a href="#cb205-47" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cost</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">calculateShippingCost</span>(weight<span class="op">,</span> zone)<span class="op">,</span></span>
<span id="cb205-48"><a href="#cb205-48" aria-hidden="true" tabindex="-1"></a>      <span class="dt">freeShipping</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb205-49"><a href="#cb205-49" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb205-50"><a href="#cb205-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb205-51"><a href="#cb205-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-52"><a href="#cb205-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculateShippingCost</span>(weight<span class="op">,</span> zone) {</span>
<span id="cb205-53"><a href="#cb205-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseRate <span class="op">=</span> { <span class="dv">1</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">2</span><span class="op">:</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">3</span><span class="op">:</span> <span class="dv">10</span> }<span class="op">;</span></span>
<span id="cb205-54"><a href="#cb205-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> baseRate[zone] <span class="op">+</span> (weight <span class="op">&gt;</span> <span class="dv">5</span> <span class="op">?</span> (weight <span class="op">-</span> <span class="dv">5</span>) <span class="op">*</span> <span class="fl">0.5</span> <span class="op">:</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb205-55"><a href="#cb205-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb205-56"><a href="#cb205-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-57"><a href="#cb205-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getShippingZone</span>(state) {</span>
<span id="cb205-58"><a href="#cb205-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> zones <span class="op">=</span> {</span>
<span id="cb205-59"><a href="#cb205-59" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span><span class="op">:</span> [<span class="st">&#39;CA&#39;</span><span class="op">,</span> <span class="st">&#39;OR&#39;</span><span class="op">,</span> <span class="st">&#39;WA&#39;</span>]<span class="op">,</span></span>
<span id="cb205-60"><a href="#cb205-60" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span><span class="op">:</span> [<span class="st">&#39;NV&#39;</span><span class="op">,</span> <span class="st">&#39;AZ&#39;</span><span class="op">,</span> <span class="st">&#39;UT&#39;</span><span class="op">,</span> <span class="st">&#39;ID&#39;</span>]<span class="op">,</span></span>
<span id="cb205-61"><a href="#cb205-61" aria-hidden="true" tabindex="-1"></a>      <span class="dv">3</span><span class="op">:</span> [] <span class="co">// All other states</span></span>
<span id="cb205-62"><a href="#cb205-62" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb205-63"><a href="#cb205-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-64"><a href="#cb205-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> [zone<span class="op">,</span> states] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(zones)) {</span>
<span id="cb205-65"><a href="#cb205-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (states<span class="op">.</span><span class="fu">includes</span>(state)) <span class="cf">return</span> <span class="pp">parseInt</span>(zone)<span class="op">;</span></span>
<span id="cb205-66"><a href="#cb205-66" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb205-67"><a href="#cb205-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb205-68"><a href="#cb205-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb205-69"><a href="#cb205-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-70"><a href="#cb205-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">calculateTax</span>(subtotal<span class="op">,</span> state) {</span>
<span id="cb205-71"><a href="#cb205-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pricingService<span class="op">.</span><span class="fu">getTax</span>(subtotal<span class="op">,</span> state)<span class="op">;</span></span>
<span id="cb205-72"><a href="#cb205-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb205-73"><a href="#cb205-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb205-74"><a href="#cb205-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-75"><a href="#cb205-75" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">new</span> <span class="fu">CheckoutService</span>()<span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb206"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co">// business-logic/checkout-rules.js</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> checkoutService <span class="im">from</span> <span class="st">&#39;../services/checkout-service.js&#39;</span><span class="op">;</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CheckoutBusinessRules {</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">init</span>() {</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;checkout.start&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleCheckoutStart</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;checkout.submit&#39;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">handleCheckoutSubmit</span><span class="op">.</span><span class="fu">bind</span>(<span class="kw">this</span>))<span class="op">;</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleCheckoutStart</span>(data) {</span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Business validations</span></span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cart <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;cart.get&#39;</span>)<span class="op">;</span></span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validation 1: Cart not empty</span></span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>cart<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> {</span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;EMPTY_CART&#39;</span><span class="op">,</span></span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Your cart is empty&#39;</span></span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb206-21"><a href="#cb206-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb206-22"><a href="#cb206-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb206-23"><a href="#cb206-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-24"><a href="#cb206-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validation 2: User logged in</span></span>
<span id="cb206-25"><a href="#cb206-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb206-26"><a href="#cb206-26" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> {</span>
<span id="cb206-27"><a href="#cb206-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;AUTH_REQUIRED&#39;</span><span class="op">,</span></span>
<span id="cb206-28"><a href="#cb206-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Please log in to continue&#39;</span></span>
<span id="cb206-29"><a href="#cb206-29" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb206-30"><a href="#cb206-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb206-31"><a href="#cb206-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb206-32"><a href="#cb206-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-33"><a href="#cb206-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validation 3: Inventory check</span></span>
<span id="cb206-34"><a href="#cb206-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> cart<span class="op">.</span><span class="at">items</span>) {</span>
<span id="cb206-35"><a href="#cb206-35" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> available <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkInventory</span>(item<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb206-36"><a href="#cb206-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (available <span class="op">&lt;</span> item<span class="op">.</span><span class="at">quantity</span>) {</span>
<span id="cb206-37"><a href="#cb206-37" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> {</span>
<span id="cb206-38"><a href="#cb206-38" aria-hidden="true" tabindex="-1"></a>          <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;INSUFFICIENT_INVENTORY&#39;</span><span class="op">,</span></span>
<span id="cb206-39"><a href="#cb206-39" aria-hidden="true" tabindex="-1"></a>          <span class="dt">message</span><span class="op">:</span> <span class="vs">`Only </span><span class="sc">${</span>available<span class="sc">}</span><span class="vs"> of &quot;</span><span class="sc">${</span>item<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&quot; available`</span><span class="op">,</span></span>
<span id="cb206-40"><a href="#cb206-40" aria-hidden="true" tabindex="-1"></a>          item</span>
<span id="cb206-41"><a href="#cb206-41" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb206-42"><a href="#cb206-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb206-43"><a href="#cb206-43" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb206-44"><a href="#cb206-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb206-45"><a href="#cb206-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-46"><a href="#cb206-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// All validations passed</span></span>
<span id="cb206-47"><a href="#cb206-47" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.validated&#39;</span><span class="op">,</span> { cart<span class="op">,</span> user })<span class="op">;</span></span>
<span id="cb206-48"><a href="#cb206-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb206-49"><a href="#cb206-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-50"><a href="#cb206-50" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleCheckoutSubmit</span>(data) {</span>
<span id="cb206-51"><a href="#cb206-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb206-52"><a href="#cb206-52" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Process order through service</span></span>
<span id="cb206-53"><a href="#cb206-53" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> order <span class="op">=</span> <span class="cf">await</span> checkoutService<span class="op">.</span><span class="fu">processOrder</span>(</span>
<span id="cb206-54"><a href="#cb206-54" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="at">cart</span><span class="op">,</span></span>
<span id="cb206-55"><a href="#cb206-55" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="at">paymentInfo</span><span class="op">,</span></span>
<span id="cb206-56"><a href="#cb206-56" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="at">shippingInfo</span></span>
<span id="cb206-57"><a href="#cb206-57" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb206-58"><a href="#cb206-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-59"><a href="#cb206-59" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Submit to backend</span></span>
<span id="cb206-60"><a href="#cb206-60" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/orders&#39;</span><span class="op">,</span> {</span>
<span id="cb206-61"><a href="#cb206-61" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb206-62"><a href="#cb206-62" aria-hidden="true" tabindex="-1"></a>        <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb206-63"><a href="#cb206-63" aria-hidden="true" tabindex="-1"></a>        <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(order)</span>
<span id="cb206-64"><a href="#cb206-64" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb206-65"><a href="#cb206-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-66"><a href="#cb206-66" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb206-67"><a href="#cb206-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Order submission failed&#39;</span>)<span class="op">;</span></span>
<span id="cb206-68"><a href="#cb206-68" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb206-69"><a href="#cb206-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-70"><a href="#cb206-70" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb206-71"><a href="#cb206-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-72"><a href="#cb206-72" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Success</span></span>
<span id="cb206-73"><a href="#cb206-73" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.success&#39;</span><span class="op">,</span> {</span>
<span id="cb206-74"><a href="#cb206-74" aria-hidden="true" tabindex="-1"></a>        <span class="dt">orderId</span><span class="op">:</span> result<span class="op">.</span><span class="at">orderId</span><span class="op">,</span></span>
<span id="cb206-75"><a href="#cb206-75" aria-hidden="true" tabindex="-1"></a>        <span class="dt">order</span><span class="op">:</span> result</span>
<span id="cb206-76"><a href="#cb206-76" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb206-77"><a href="#cb206-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-78"><a href="#cb206-78" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Clear cart</span></span>
<span id="cb206-79"><a href="#cb206-79" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.clear&#39;</span>)<span class="op">;</span></span>
<span id="cb206-80"><a href="#cb206-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-81"><a href="#cb206-81" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb206-82"><a href="#cb206-82" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> {</span>
<span id="cb206-83"><a href="#cb206-83" aria-hidden="true" tabindex="-1"></a>        <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;SUBMISSION_FAILED&#39;</span><span class="op">,</span></span>
<span id="cb206-84"><a href="#cb206-84" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Unable to process order. Please try again.&#39;</span><span class="op">,</span></span>
<span id="cb206-85"><a href="#cb206-85" aria-hidden="true" tabindex="-1"></a>        error</span>
<span id="cb206-86"><a href="#cb206-86" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb206-87"><a href="#cb206-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb206-88"><a href="#cb206-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb206-89"><a href="#cb206-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-90"><a href="#cb206-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">checkInventory</span>(productId) {</span>
<span id="cb206-91"><a href="#cb206-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/inventory/</span><span class="sc">${</span>productId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb206-92"><a href="#cb206-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb206-93"><a href="#cb206-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="at">available</span><span class="op">;</span></span>
<span id="cb206-94"><a href="#cb206-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb206-95"><a href="#cb206-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb206-96"><a href="#cb206-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-97"><a href="#cb206-97" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">new</span> <span class="fu">CheckoutBusinessRules</span>()<span class="op">;</span></span></code></pre></div>
<p>The checkout component stays simple:</p>
<div class="sourceCode" id="cb207"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/checkout-form.js</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CheckoutForm <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachEventListeners</span>()<span class="op">;</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">subscribeToEvents</span>()<span class="op">;</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subscribeToEvents</span>() {</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_unsubscribers</span> <span class="op">=</span> [</span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;checkout.validated&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showCheckoutForm</span>()<span class="op">;</span></span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> (error) <span class="kw">=&gt;</span> {</span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showError</span>(error<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb207-18"><a href="#cb207-18" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb207-19"><a href="#cb207-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-20"><a href="#cb207-20" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;checkout.success&#39;</span><span class="op">,</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb207-21"><a href="#cb207-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showSuccess</span>(data<span class="op">.</span><span class="at">orderId</span>)<span class="op">;</span></span>
<span id="cb207-22"><a href="#cb207-22" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb207-23"><a href="#cb207-23" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb207-24"><a href="#cb207-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb207-25"><a href="#cb207-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-26"><a href="#cb207-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleSubmit</span>(e) {</span>
<span id="cb207-27"><a href="#cb207-27" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb207-28"><a href="#cb207-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-29"><a href="#cb207-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Just collect data and publish - business logic handles the rest</span></span>
<span id="cb207-30"><a href="#cb207-30" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.submit&#39;</span><span class="op">,</span> {</span>
<span id="cb207-31"><a href="#cb207-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cart</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">cart</span><span class="op">,</span></span>
<span id="cb207-32"><a href="#cb207-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">paymentInfo</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getPaymentInfo</span>()<span class="op">,</span></span>
<span id="cb207-33"><a href="#cb207-33" aria-hidden="true" tabindex="-1"></a>      <span class="dt">shippingInfo</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getShippingInfo</span>()</span>
<span id="cb207-34"><a href="#cb207-34" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb207-35"><a href="#cb207-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-36"><a href="#cb207-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">showProcessing</span>()<span class="op">;</span></span>
<span id="cb207-37"><a href="#cb207-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb207-38"><a href="#cb207-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-39"><a href="#cb207-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// UI methods only - no business logic</span></span>
<span id="cb207-40"><a href="#cb207-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showCheckoutForm</span>() { <span class="co">/* ... */</span> }</span>
<span id="cb207-41"><a href="#cb207-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showError</span>(message) { <span class="co">/* ... */</span> }</span>
<span id="cb207-42"><a href="#cb207-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showSuccess</span>(orderId) { <span class="co">/* ... */</span> }</span>
<span id="cb207-43"><a href="#cb207-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showProcessing</span>() { <span class="co">/* ... */</span> }</span>
<span id="cb207-44"><a href="#cb207-44" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="testing-business-logic">Testing Business Logic</h2>
<p>One of the biggest advantages of separating business logic is
testability. Here’s how to test each pattern:</p>
<h3 id="testing-pan-bus-listeners">Testing PAN Bus Listeners</h3>
<div class="sourceCode" id="cb208"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">// __tests__/cart-rules.test.js</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { describe<span class="op">,</span> it<span class="op">,</span> expect<span class="op">,</span> beforeEach<span class="op">,</span> vi } <span class="im">from</span> <span class="st">&#39;vitest&#39;</span><span class="op">;</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { pan } <span class="im">from</span> <span class="st">&#39;@larcjs/core&#39;</span><span class="op">;</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartRules <span class="im">from</span> <span class="st">&#39;../business-logic/cart-rules.js&#39;</span><span class="op">;</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Cart Business Rules&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beforeEach</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reset PAN bus between tests</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>    cartRules<span class="op">.</span><span class="fu">init</span>()<span class="op">;</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;should reject adding more than max items&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Mock cart with max items</span></span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">respond</span>(<span class="st">&#39;cart.get&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> ({</span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">items</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Array</span>(<span class="dv">50</span>)<span class="op">.</span><span class="fu">fill</span>({})</span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb208-18"><a href="#cb208-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-19"><a href="#cb208-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> errorHandler <span class="op">=</span> vi<span class="op">.</span><span class="fu">fn</span>()<span class="op">;</span></span>
<span id="cb208-20"><a href="#cb208-20" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.error&#39;</span><span class="op">,</span> errorHandler)<span class="op">;</span></span>
<span id="cb208-21"><a href="#cb208-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-22"><a href="#cb208-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Try to add another item</span></span>
<span id="cb208-23"><a href="#cb208-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> {</span>
<span id="cb208-24"><a href="#cb208-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">product</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Test&#39;</span> }<span class="op">,</span></span>
<span id="cb208-25"><a href="#cb208-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb208-26"><a href="#cb208-26" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb208-27"><a href="#cb208-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-28"><a href="#cb208-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(errorHandler)<span class="op">.</span><span class="fu">toHaveBeenCalledWith</span>({</span>
<span id="cb208-29"><a href="#cb208-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">code</span><span class="op">:</span> <span class="st">&#39;MAX_ITEMS_EXCEEDED&#39;</span><span class="op">,</span></span>
<span id="cb208-30"><a href="#cb208-30" aria-hidden="true" tabindex="-1"></a>      <span class="dt">message</span><span class="op">:</span> expect<span class="op">.</span><span class="fu">stringContaining</span>(<span class="st">&#39;50 items&#39;</span>)</span>
<span id="cb208-31"><a href="#cb208-31" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb208-32"><a href="#cb208-32" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb208-33"><a href="#cb208-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-34"><a href="#cb208-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;should apply bulk discount for 5+ items&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb208-35"><a href="#cb208-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validated <span class="op">=</span> vi<span class="op">.</span><span class="fu">fn</span>()<span class="op">;</span></span>
<span id="cb208-36"><a href="#cb208-36" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;cart.item.validated&#39;</span><span class="op">,</span> validated)<span class="op">;</span></span>
<span id="cb208-37"><a href="#cb208-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-38"><a href="#cb208-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> {</span>
<span id="cb208-39"><a href="#cb208-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">product</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Test&#39;</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">,</span></span>
<span id="cb208-40"><a href="#cb208-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb208-41"><a href="#cb208-41" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb208-42"><a href="#cb208-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-43"><a href="#cb208-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(validated)<span class="op">.</span><span class="fu">toHaveBeenCalledWith</span>(</span>
<span id="cb208-44"><a href="#cb208-44" aria-hidden="true" tabindex="-1"></a>      expect<span class="op">.</span><span class="fu">objectContaining</span>({</span>
<span id="cb208-45"><a href="#cb208-45" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pricing</span><span class="op">:</span> expect<span class="op">.</span><span class="fu">objectContaining</span>({</span>
<span id="cb208-46"><a href="#cb208-46" aria-hidden="true" tabindex="-1"></a>          <span class="dt">unitPrice</span><span class="op">:</span> <span class="dv">90</span><span class="op">,</span> <span class="co">// 10% discount</span></span>
<span id="cb208-47"><a href="#cb208-47" aria-hidden="true" tabindex="-1"></a>          <span class="dt">discount</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb208-48"><a href="#cb208-48" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb208-49"><a href="#cb208-49" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb208-50"><a href="#cb208-50" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb208-51"><a href="#cb208-51" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb208-52"><a href="#cb208-52" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="testing-services">Testing Services</h3>
<div class="sourceCode" id="cb209"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">// __tests__/pricing-service.test.js</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { describe<span class="op">,</span> it<span class="op">,</span> expect } <span class="im">from</span> <span class="st">&#39;vitest&#39;</span><span class="op">;</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pricingService <span class="im">from</span> <span class="st">&#39;../services/pricing-service.js&#39;</span><span class="op">;</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;Pricing Service&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;should apply volume discount&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> { <span class="dt">basePrice</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">;</span></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pricing <span class="op">=</span> <span class="cf">await</span> pricingService<span class="op">.</span><span class="fu">calculatePrice</span>(product<span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(pricing<span class="op">.</span><span class="at">unitPrice</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">85</span>)<span class="op">;</span> <span class="co">// 15% off for 10+</span></span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(pricing<span class="op">.</span><span class="at">subtotal</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">850</span>)<span class="op">;</span></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;should stack member and volume discounts&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> { <span class="dt">basePrice</span><span class="op">:</span> <span class="dv">100</span> }<span class="op">;</span></span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> { <span class="dt">tier</span><span class="op">:</span> <span class="st">&#39;premium&#39;</span> }<span class="op">;</span></span>
<span id="cb209-17"><a href="#cb209-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-18"><a href="#cb209-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pricing <span class="op">=</span> <span class="cf">await</span> pricingService<span class="op">.</span><span class="fu">calculatePrice</span>(product<span class="op">,</span> <span class="dv">10</span><span class="op">,</span> user)<span class="op">;</span></span>
<span id="cb209-19"><a href="#cb209-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-20"><a href="#cb209-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 15% volume + 15% premium = 72.25</span></span>
<span id="cb209-21"><a href="#cb209-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(pricing<span class="op">.</span><span class="at">unitPrice</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="fl">72.25</span>)<span class="op">;</span></span>
<span id="cb209-22"><a href="#cb209-22" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb209-23"><a href="#cb209-23" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="best-practices-4">Best Practices</h2>
<h3 id="keep-components-dumb">1. Keep Components Dumb</h3>
<p>Components should focus on UI and user interaction. They publish
events but don’t implement business rules.</p>
<p><strong>Good:</strong></p>
<div class="sourceCode" id="cb210"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">handleAddToCart</span>() {</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;cart.item.add&#39;</span><span class="op">,</span> { <span class="dt">product</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span> })<span class="op">;</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Bad:</strong></p>
<div class="sourceCode" id="cb211"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">handleAddToCart</span>() {</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Business logic in component - hard to test and reuse</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> inventory <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/inventory&#39;</span>)<span class="op">;</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (inventory <span class="op">&lt;</span> <span class="kw">this</span><span class="op">.</span><span class="at">quantity</span>) {</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alert</span>(<span class="st">&#39;Out of stock&#39;</span>)<span class="op">;</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/user&#39;</span>)<span class="op">;</span></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (user<span class="op">.</span><span class="at">age</span> <span class="op">&lt;</span> <span class="dv">21</span> <span class="op">&amp;&amp;</span> <span class="kw">this</span><span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="at">ageRestricted</span>) {</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alert</span>(<span class="st">&#39;Age restricted&#39;</span>)<span class="op">;</span></span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... more business logic</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="use-services-for-complex-logic">2. Use Services for Complex
Logic</h3>
<p>If business logic involves multiple steps, calculations, or external
APIs, put it in a service:</p>
<div class="sourceCode" id="cb212"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Good: Service handles complexity</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pricing <span class="op">=</span> <span class="cf">await</span> pricingService<span class="op">.</span><span class="fu">calculatePrice</span>(product<span class="op">,</span> quantity<span class="op">,</span> user)<span class="op">;</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Bad: Business logic scattered across components and PAN listeners</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> basePrice <span class="op">=</span> product<span class="op">.</span><span class="at">price</span><span class="op">;</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> volumeDiscount <span class="op">=</span> quantity <span class="op">&gt;=</span> <span class="dv">10</span> <span class="op">?</span> <span class="fl">0.15</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> memberDiscount <span class="op">=</span> user<span class="op">?.</span><span class="at">tier</span> <span class="op">===</span> <span class="st">&#39;premium&#39;</span> <span class="op">?</span> <span class="fl">0.15</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ... etc</span></span></code></pre></div>
<h3 id="make-business-logic-observable">3. Make Business Logic
Observable</h3>
<p>Use PAN bus to make business logic transparent:</p>
<div class="sourceCode" id="cb213"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OrderProcessor {</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">processOrder</span>(order) {</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.processing.start&#39;</span><span class="op">,</span> { <span class="dt">orderId</span><span class="op">:</span> order<span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateOrder</span>(order)<span class="op">;</span></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.validated&#39;</span><span class="op">,</span> { <span class="dt">orderId</span><span class="op">:</span> order<span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">chargePayment</span>(order)<span class="op">;</span></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.charged&#39;</span><span class="op">,</span> { <span class="dt">orderId</span><span class="op">:</span> order<span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createShipment</span>(order)<span class="op">;</span></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.shipped&#39;</span><span class="op">,</span> { <span class="dt">orderId</span><span class="op">:</span> order<span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.complete&#39;</span><span class="op">,</span> { <span class="dt">orderId</span><span class="op">:</span> order<span class="op">.</span><span class="at">id</span> })<span class="op">;</span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;order.failed&#39;</span><span class="op">,</span> { <span class="dt">orderId</span><span class="op">:</span> order<span class="op">.</span><span class="at">id</span><span class="op">,</span> error })<span class="op">;</span></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now other parts of your app can react to these events (analytics,
notifications, UI updates, etc.).</p>
<h3 id="document-business-rules">4. Document Business Rules</h3>
<p>Make business rules explicit and documented:</p>
<div class="sourceCode" id="cb214"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * Shopping Cart Business Rules</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * 1. Maximum 50 items per order</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * 2. Maximum 10 quantity per item</span></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * 3. Free shipping over $50</span></span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * 4. Volume discounts:</span></span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a><span class="co"> *    - 5-9 items: 10% off</span></span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a><span class="co"> *    - 10+ items: 15% off</span></span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a><span class="co"> * 5. Member discounts:</span></span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a><span class="co"> *    - Premium: 15% off</span></span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a><span class="co"> *    - Gold: 10% off</span></span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a><span class="co"> * 6. Minimum order value: $10</span></span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CartBusinessRules {</span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Implementation</span></span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="use-feature-flags">5. Use Feature Flags</h3>
<p>Make business logic toggleable:</p>
<div class="sourceCode" id="cb215"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CheckoutRules {</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">features</span> <span class="op">=</span> {</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">guestCheckout</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">expressCheckout</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">digitalWallet</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleCheckout</span>(data) {</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="at">guestCheckout</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>data<span class="op">.</span><span class="at">user</span>) {</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;checkout.error&#39;</span><span class="op">,</span> {</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Account required for checkout&#39;</span></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... rest of logic</span></span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="summary-7">Summary</h2>
<p>When integrating business logic into LARC applications:</p>
<ol type="1">
<li><strong>Default to PAN Bus listeners</strong> for most business
logic - it’s decoupled, testable, and flexible</li>
<li><strong>Use services</strong> for complex calculations and
workflows</li>
<li><strong>Extend components</strong> only when logic is tightly
coupled to UI</li>
<li><strong>Use mixins</strong> for cross-cutting concerns like
analytics</li>
<li><strong>Wrap components</strong> when adding behavior to third-party
code</li>
<li><strong>Keep components dumb</strong> - they publish events,
business logic handles the rest</li>
</ol>
<p>This separation of concerns makes your application:</p>
<ul>
<li><strong>Easier to test</strong> - business logic without rendering
components</li>
<li><strong>More maintainable</strong> - business rules in one
place</li>
<li><strong>More flexible</strong> - easy to change rules without
touching UI</li>
<li><strong>More reusable</strong> - logic can be shared across
components</li>
</ul>
<p>In the next chapter, we’ll explore routing and navigation, building
on these patterns to create complete single-page applications.</p>
<h1 id="chapter-8-routing-and-navigation">Chapter 8: Routing and
Navigation</h1>
<p>Client-side routing enables single-page applications (SPAs) to feel
like multi-page websites without full page reloads. LARC provides
routing through web standards and the PAN bus, keeping things simple and
framework-free.</p>
<h2 id="client-side-routing-basics">Client-Side Routing Basics</h2>
<p>Client-side routing intercepts link clicks and updates the URL
without reloading:</p>
<div class="sourceCode" id="cb216"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/router.js</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Router {</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">routes</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">currentRoute</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Intercept link clicks</span></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="fu">matches</span>(<span class="st">&#39;a[href^=&quot;/&quot;]&#39;</span>)) {</span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>        e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">navigate</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;href&#39;</span>))<span class="op">;</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle browser back/forward</span></span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;popstate&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">handleRoute</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span>)<span class="op">;</span></span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">register</span>(path<span class="op">,</span> handler) {</span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">routes</span><span class="op">.</span><span class="fu">set</span>(path<span class="op">,</span> handler)<span class="op">;</span></span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">navigate</span>(path<span class="op">,</span> state <span class="op">=</span> {}) {</span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">pushState</span>(state<span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">handleRoute</span>(path)<span class="op">;</span></span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish navigation event</span></span>
<span id="cb216-30"><a href="#cb216-30" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.navigated&#39;</span><span class="op">,</span> { path<span class="op">,</span> state })<span class="op">;</span></span>
<span id="cb216-31"><a href="#cb216-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-32"><a href="#cb216-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-33"><a href="#cb216-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleRoute</span>(path) {</span>
<span id="cb216-34"><a href="#cb216-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find matching route</span></span>
<span id="cb216-35"><a href="#cb216-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> [pattern<span class="op">,</span> handler] <span class="kw">of</span> <span class="kw">this</span><span class="op">.</span><span class="at">routes</span>) {</span>
<span id="cb216-36"><a href="#cb216-36" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> params <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">matchRoute</span>(pattern<span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb216-37"><a href="#cb216-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (params) {</span>
<span id="cb216-38"><a href="#cb216-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">currentRoute</span> <span class="op">=</span> { path<span class="op">,</span> pattern<span class="op">,</span> params }<span class="op">;</span></span>
<span id="cb216-39"><a href="#cb216-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">handler</span>(params)<span class="op">;</span></span>
<span id="cb216-40"><a href="#cb216-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb216-41"><a href="#cb216-41" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb216-42"><a href="#cb216-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb216-43"><a href="#cb216-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-44"><a href="#cb216-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 404 - no match</span></span>
<span id="cb216-45"><a href="#cb216-45" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.not-found&#39;</span><span class="op">,</span> { path })<span class="op">;</span></span>
<span id="cb216-46"><a href="#cb216-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-47"><a href="#cb216-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-48"><a href="#cb216-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matchRoute</span>(pattern<span class="op">,</span> path) {</span>
<span id="cb216-49"><a href="#cb216-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Simple pattern matching</span></span>
<span id="cb216-50"><a href="#cb216-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> patternParts <span class="op">=</span> pattern<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;/&#39;</span>)<span class="op">.</span><span class="fu">filter</span>(<span class="bu">Boolean</span>)<span class="op">;</span></span>
<span id="cb216-51"><a href="#cb216-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pathParts <span class="op">=</span> path<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;/&#39;</span>)<span class="op">.</span><span class="fu">filter</span>(<span class="bu">Boolean</span>)<span class="op">;</span></span>
<span id="cb216-52"><a href="#cb216-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-53"><a href="#cb216-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (patternParts<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> pathParts<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb216-54"><a href="#cb216-54" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb216-55"><a href="#cb216-55" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb216-56"><a href="#cb216-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-57"><a href="#cb216-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> params <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb216-58"><a href="#cb216-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-59"><a href="#cb216-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> patternParts<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb216-60"><a href="#cb216-60" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> patternPart <span class="op">=</span> patternParts[i]<span class="op">;</span></span>
<span id="cb216-61"><a href="#cb216-61" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pathPart <span class="op">=</span> pathParts[i]<span class="op">;</span></span>
<span id="cb216-62"><a href="#cb216-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-63"><a href="#cb216-63" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (patternPart<span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;:&#39;</span>)) {</span>
<span id="cb216-64"><a href="#cb216-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Dynamic segment</span></span>
<span id="cb216-65"><a href="#cb216-65" aria-hidden="true" tabindex="-1"></a>        params[patternPart<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)] <span class="op">=</span> pathPart<span class="op">;</span></span>
<span id="cb216-66"><a href="#cb216-66" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (patternPart <span class="op">!==</span> pathPart) {</span>
<span id="cb216-67"><a href="#cb216-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Mismatch</span></span>
<span id="cb216-68"><a href="#cb216-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb216-69"><a href="#cb216-69" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb216-70"><a href="#cb216-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb216-71"><a href="#cb216-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-72"><a href="#cb216-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> params<span class="op">;</span></span>
<span id="cb216-73"><a href="#cb216-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-74"><a href="#cb216-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-75"><a href="#cb216-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">start</span>() {</span>
<span id="cb216-76"><a href="#cb216-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">handleRoute</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span>)<span class="op">;</span></span>
<span id="cb216-77"><a href="#cb216-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-78"><a href="#cb216-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb216-79"><a href="#cb216-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-80"><a href="#cb216-80" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> router <span class="op">=</span> <span class="kw">new</span> <span class="fu">Router</span>()<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb217"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { router } <span class="im">from</span> <span class="st">&#39;./lib/router.js&#39;</span><span class="op">;</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Register routes</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">register</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;home-page&gt;&lt;/home-page&gt;&#39;</span><span class="op">;</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">register</span>(<span class="st">&#39;/about&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;about-page&gt;&lt;/about-page&gt;&#39;</span><span class="op">;</span></span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">register</span>(<span class="st">&#39;/users/:id&#39;</span><span class="op">,</span> (params) <span class="kw">=&gt;</span> {</span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> page <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;user-page&#39;</span>)<span class="op">;</span></span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a>  page<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;user-id&#39;</span><span class="op">,</span> params<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">.</span><span class="fu">appendChild</span>(page)<span class="op">;</span></span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Start router</span></span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a>router<span class="op">.</span><span class="fu">start</span>()<span class="op">;</span></span></code></pre></div>
<h2 id="the-pan-router-component">The pan-router Component</h2>
<p>LARC provides a declarative router component:</p>
<div class="sourceCode" id="cb218"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;home-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/about&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;about-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/users/:id&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;user-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/posts/:postId/comments/:commentId&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;comment-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;*&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;not-found-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Implementation:</strong></p>
<div class="sourceCode" id="cb219"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PanRouter <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">routes</span> <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;pan-route&#39;</span>))<span class="op">.</span><span class="fu">map</span>(route <span class="kw">=&gt;</span> ({</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">path</span><span class="op">:</span> route<span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;path&#39;</span>)<span class="op">,</span></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">component</span><span class="op">:</span> route<span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;component&#39;</span>)<span class="op">,</span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">guard</span><span class="op">:</span> route<span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;guard&#39;</span>)</span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create outlet</span></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">outlet</span> <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;div&#39;</span>)<span class="op">;</span></span>
<span id="cb219-11"><a href="#cb219-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">outlet</span><span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;router-outlet&#39;</span><span class="op">;</span></span>
<span id="cb219-12"><a href="#cb219-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">appendChild</span>(<span class="kw">this</span><span class="op">.</span><span class="at">outlet</span>)<span class="op">;</span></span>
<span id="cb219-13"><a href="#cb219-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-14"><a href="#cb219-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Listen for navigation</span></span>
<span id="cb219-15"><a href="#cb219-15" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;router.navigate&#39;</span><span class="op">,</span> ({ path<span class="op">,</span> params }) <span class="kw">=&gt;</span> {</span>
<span id="cb219-16"><a href="#cb219-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">navigate</span>(path<span class="op">,</span> params)<span class="op">;</span></span>
<span id="cb219-17"><a href="#cb219-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb219-18"><a href="#cb219-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-19"><a href="#cb219-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle browser navigation</span></span>
<span id="cb219-20"><a href="#cb219-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;popstate&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb219-21"><a href="#cb219-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">handleRoute</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span>)<span class="op">;</span></span>
<span id="cb219-22"><a href="#cb219-22" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb219-23"><a href="#cb219-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-24"><a href="#cb219-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Intercept links</span></span>
<span id="cb219-25"><a href="#cb219-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb219-26"><a href="#cb219-26" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> link <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="fu">closest</span>(<span class="st">&#39;a[href^=&quot;/&quot;]&#39;</span>)<span class="op">;</span></span>
<span id="cb219-27"><a href="#cb219-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (link) {</span>
<span id="cb219-28"><a href="#cb219-28" aria-hidden="true" tabindex="-1"></a>        e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb219-29"><a href="#cb219-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">navigate</span>(link<span class="op">.</span><span class="fu">getAttribute</span>(<span class="st">&#39;href&#39;</span>))<span class="op">;</span></span>
<span id="cb219-30"><a href="#cb219-30" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb219-31"><a href="#cb219-31" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb219-32"><a href="#cb219-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-33"><a href="#cb219-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initial route</span></span>
<span id="cb219-34"><a href="#cb219-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">handleRoute</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">pathname</span>)<span class="op">;</span></span>
<span id="cb219-35"><a href="#cb219-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-36"><a href="#cb219-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-37"><a href="#cb219-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">navigate</span>(path<span class="op">,</span> params <span class="op">=</span> {}) {</span>
<span id="cb219-38"><a href="#cb219-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">window</span><span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">pushState</span>(params<span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb219-39"><a href="#cb219-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">handleRoute</span>(path)<span class="op">;</span></span>
<span id="cb219-40"><a href="#cb219-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-41"><a href="#cb219-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-42"><a href="#cb219-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleRoute</span>(path) {</span>
<span id="cb219-43"><a href="#cb219-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find matching route</span></span>
<span id="cb219-44"><a href="#cb219-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> route <span class="kw">of</span> <span class="kw">this</span><span class="op">.</span><span class="at">routes</span>) {</span>
<span id="cb219-45"><a href="#cb219-45" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> params <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">matchRoute</span>(route<span class="op">.</span><span class="at">path</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb219-46"><a href="#cb219-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-47"><a href="#cb219-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (params) {</span>
<span id="cb219-48"><a href="#cb219-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check route guard</span></span>
<span id="cb219-49"><a href="#cb219-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (route<span class="op">.</span><span class="at">guard</span>) {</span>
<span id="cb219-50"><a href="#cb219-50" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> canActivate <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">runGuard</span>(route<span class="op">.</span><span class="at">guard</span><span class="op">,</span> params)<span class="op">;</span></span>
<span id="cb219-51"><a href="#cb219-51" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="op">!</span>canActivate) {</span>
<span id="cb219-52"><a href="#cb219-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span>
<span id="cb219-53"><a href="#cb219-53" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb219-54"><a href="#cb219-54" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb219-55"><a href="#cb219-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-56"><a href="#cb219-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Render component</span></span>
<span id="cb219-57"><a href="#cb219-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">renderComponent</span>(route<span class="op">.</span><span class="at">component</span><span class="op">,</span> params)<span class="op">;</span></span>
<span id="cb219-58"><a href="#cb219-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb219-59"><a href="#cb219-59" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb219-60"><a href="#cb219-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb219-61"><a href="#cb219-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-62"><a href="#cb219-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 404</span></span>
<span id="cb219-63"><a href="#cb219-63" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.not-found&#39;</span><span class="op">,</span> { path })<span class="op">;</span></span>
<span id="cb219-64"><a href="#cb219-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-65"><a href="#cb219-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-66"><a href="#cb219-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matchRoute</span>(pattern<span class="op">,</span> path) {</span>
<span id="cb219-67"><a href="#cb219-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (pattern <span class="op">===</span> <span class="st">&#39;*&#39;</span>) <span class="cf">return</span> {}<span class="op">;</span></span>
<span id="cb219-68"><a href="#cb219-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-69"><a href="#cb219-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> patternParts <span class="op">=</span> pattern<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;/&#39;</span>)<span class="op">.</span><span class="fu">filter</span>(<span class="bu">Boolean</span>)<span class="op">;</span></span>
<span id="cb219-70"><a href="#cb219-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pathParts <span class="op">=</span> path<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;/&#39;</span>)<span class="op">.</span><span class="fu">filter</span>(<span class="bu">Boolean</span>)<span class="op">;</span></span>
<span id="cb219-71"><a href="#cb219-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-72"><a href="#cb219-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (patternParts<span class="op">.</span><span class="at">length</span> <span class="op">!==</span> pathParts<span class="op">.</span><span class="at">length</span>) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb219-73"><a href="#cb219-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-74"><a href="#cb219-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> params <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb219-75"><a href="#cb219-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-76"><a href="#cb219-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> patternParts<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb219-77"><a href="#cb219-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (patternParts[i]<span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;:&#39;</span>)) {</span>
<span id="cb219-78"><a href="#cb219-78" aria-hidden="true" tabindex="-1"></a>        params[patternParts[i]<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)] <span class="op">=</span> pathParts[i]<span class="op">;</span></span>
<span id="cb219-79"><a href="#cb219-79" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (patternParts[i] <span class="op">!==</span> pathParts[i]) {</span>
<span id="cb219-80"><a href="#cb219-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb219-81"><a href="#cb219-81" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb219-82"><a href="#cb219-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb219-83"><a href="#cb219-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-84"><a href="#cb219-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> params<span class="op">;</span></span>
<span id="cb219-85"><a href="#cb219-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-86"><a href="#cb219-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-87"><a href="#cb219-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">runGuard</span>(guardName<span class="op">,</span> params) {</span>
<span id="cb219-88"><a href="#cb219-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="vs">`guard.</span><span class="sc">${</span>guardName<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> params)<span class="op">;</span></span>
<span id="cb219-89"><a href="#cb219-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result <span class="op">!==</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb219-90"><a href="#cb219-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-91"><a href="#cb219-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-92"><a href="#cb219-92" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">renderComponent</span>(componentName<span class="op">,</span> params) {</span>
<span id="cb219-93"><a href="#cb219-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Wait for component to be defined</span></span>
<span id="cb219-94"><a href="#cb219-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> customElements<span class="op">.</span><span class="fu">whenDefined</span>(componentName)<span class="op">;</span></span>
<span id="cb219-95"><a href="#cb219-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-96"><a href="#cb219-96" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create component</span></span>
<span id="cb219-97"><a href="#cb219-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> component <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(componentName)<span class="op">;</span></span>
<span id="cb219-98"><a href="#cb219-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-99"><a href="#cb219-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pass route params</span></span>
<span id="cb219-100"><a href="#cb219-100" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(params)<span class="op">.</span><span class="fu">forEach</span>(([key<span class="op">,</span> value]) <span class="kw">=&gt;</span> {</span>
<span id="cb219-101"><a href="#cb219-101" aria-hidden="true" tabindex="-1"></a>      component<span class="op">.</span><span class="fu">setAttribute</span>(key<span class="op">,</span> value)<span class="op">;</span></span>
<span id="cb219-102"><a href="#cb219-102" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb219-103"><a href="#cb219-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-104"><a href="#cb219-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear outlet and add component</span></span>
<span id="cb219-105"><a href="#cb219-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">outlet</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb219-106"><a href="#cb219-106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">outlet</span><span class="op">.</span><span class="fu">appendChild</span>(component)<span class="op">;</span></span>
<span id="cb219-107"><a href="#cb219-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-108"><a href="#cb219-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish route change</span></span>
<span id="cb219-109"><a href="#cb219-109" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.changed&#39;</span><span class="op">,</span> { <span class="dt">component</span><span class="op">:</span> componentName<span class="op">,</span> params })<span class="op">;</span></span>
<span id="cb219-110"><a href="#cb219-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-111"><a href="#cb219-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb219-112"><a href="#cb219-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-113"><a href="#cb219-113" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;pan-router&#39;</span><span class="op">,</span> PanRouter)<span class="op">;</span></span>
<span id="cb219-114"><a href="#cb219-114" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;pan-route&#39;</span><span class="op">,</span> <span class="kw">class</span> <span class="kw">extends</span> <span class="bu">HTMLElement</span> {})<span class="op">;</span></span></code></pre></div>
<h2 id="route-parameters">Route Parameters</h2>
<p>Access route parameters in components:</p>
<div class="sourceCode" id="cb220"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserPage <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">static</span> <span class="kw">get</span> <span class="fu">observedAttributes</span>() {</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="st">&#39;user-id&#39;</span>]<span class="op">;</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributeChangedCallback</span>(name<span class="op">,</span> oldValue<span class="op">,</span> newValue) {</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&#39;user-id&#39;</span> <span class="op">&amp;&amp;</span> newValue) {</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">loadUser</span>(newValue)<span class="op">;</span></span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">loadUser</span>(id) {</span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/users/</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb220-14"><a href="#cb220-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb220-15"><a href="#cb220-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>(user)<span class="op">;</span></span>
<span id="cb220-16"><a href="#cb220-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb220-17"><a href="#cb220-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-18"><a href="#cb220-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>(user) {</span>
<span id="cb220-19"><a href="#cb220-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb220-20"><a href="#cb220-20" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;h1&gt;</span><span class="sc">${</span>user<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h1&gt;</span></span>
<span id="cb220-21"><a href="#cb220-21" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;p&gt;</span><span class="sc">${</span>user<span class="op">.</span><span class="at">email</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb220-22"><a href="#cb220-22" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb220-23"><a href="#cb220-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb220-24"><a href="#cb220-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb220-25"><a href="#cb220-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-26"><a href="#cb220-26" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;user-page&#39;</span><span class="op">,</span> UserPage)<span class="op">;</span></span></code></pre></div>
<h2 id="route-guards">Route Guards</h2>
<p>Protect routes with authentication checks:</p>
<div class="sourceCode" id="cb221"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Respond to auth guard</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">respond</span>(<span class="st">&#39;guard.auth&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> token <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;authToken&#39;</span>)<span class="op">;</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>token) {</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Redirect to login</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.navigate&#39;</span><span class="op">,</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/login&#39;</span> })<span class="op">;</span></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Verify token</span></span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/auth/verify&#39;</span><span class="op">,</span> {</span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Authorization&#39;</span><span class="op">:</span> <span class="vs">`Bearer </span><span class="sc">${</span>token<span class="sc">}</span><span class="vs">`</span> }</span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="at">ok</span><span class="op">;</span></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> {</span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Respond to admin guard</span></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">respond</span>(<span class="st">&#39;guard.admin&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(<span class="st">&#39;auth.user.get&#39;</span>)<span class="op">;</span></span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> user<span class="op">?.</span><span class="at">role</span> <span class="op">===</span> <span class="st">&#39;admin&#39;</span><span class="op">;</span></span>
<span id="cb221-27"><a href="#cb221-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb222"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/login&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;login-page&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/dashboard&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;dashboard-page&quot;</span><span class="ot"> guard</span><span class="op">=</span><span class="st">&quot;auth&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/admin&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;admin-page&quot;</span><span class="ot"> guard</span><span class="op">=</span><span class="st">&quot;admin&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="nested-routes">Nested Routes</h2>
<p>Support hierarchical routing:</p>
<div class="sourceCode" id="cb223"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/settings&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;settings-layout&quot;</span><span class="dt">&gt;</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/settings/profile&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;profile-settings&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/settings/security&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;security-settings&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">pan-route</span><span class="ot"> path</span><span class="op">=</span><span class="st">&quot;/settings/billing&quot;</span><span class="ot"> component</span><span class="op">=</span><span class="st">&quot;billing-settings&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">pan-route</span><span class="dt">&gt;</span></span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">pan-router</span><span class="dt">&gt;</span></span></code></pre></div>
<h2 id="programmatic-navigation">Programmatic Navigation</h2>
<p>Navigate from JavaScript:</p>
<div class="sourceCode" id="cb224"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Navigate to a path</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.navigate&#39;</span><span class="op">,</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/users/123&#39;</span> })<span class="op">;</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Navigate with state</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.navigate&#39;</span><span class="op">,</span> {</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/search&#39;</span><span class="op">,</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">state</span><span class="op">:</span> { <span class="dt">query</span><span class="op">:</span> <span class="st">&#39;web components&#39;</span> }</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Go back</span></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.back&#39;</span>)<span class="op">;</span></span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Go forward</span></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.forward&#39;</span>)<span class="op">;</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace current route (no history entry)</span></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.replace&#39;</span><span class="op">,</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/new-path&#39;</span> })<span class="op">;</span></span></code></pre></div>
<h2 id="query-parameters">Query Parameters</h2>
<p>Parse and use query parameters:</p>
<div class="sourceCode" id="cb225"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SearchPage <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Parse query params</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> params <span class="op">=</span> <span class="kw">new</span> <span class="fu">URLSearchParams</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">search</span>)<span class="op">;</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> query <span class="op">=</span> params<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;q&#39;</span>)<span class="op">;</span></span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> page <span class="op">=</span> <span class="pp">parseInt</span>(params<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;page&#39;</span>) <span class="op">||</span> <span class="st">&#39;1&#39;</span>)<span class="op">;</span></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">performSearch</span>(query<span class="op">,</span> page)<span class="op">;</span></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Listen for query changes</span></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;router.changed&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> params <span class="op">=</span> <span class="kw">new</span> <span class="fu">URLSearchParams</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">search</span>)<span class="op">;</span></span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> newQuery <span class="op">=</span> params<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;q&#39;</span>)<span class="op">;</span></span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> newPage <span class="op">=</span> <span class="pp">parseInt</span>(params<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;page&#39;</span>) <span class="op">||</span> <span class="st">&#39;1&#39;</span>)<span class="op">;</span></span>
<span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (newQuery <span class="op">!==</span> query <span class="op">||</span> newPage <span class="op">!==</span> page) {</span>
<span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">performSearch</span>(newQuery<span class="op">,</span> newPage)<span class="op">;</span></span>
<span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-22"><a href="#cb225-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">performSearch</span>(query<span class="op">,</span> page) {</span>
<span id="cb225-23"><a href="#cb225-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Search implementation</span></span>
<span id="cb225-24"><a href="#cb225-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb225-25"><a href="#cb225-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Update query params:</strong></p>
<div class="sourceCode" id="cb226"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateQuery</span>(params) {</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> url <span class="op">=</span> <span class="kw">new</span> <span class="fu">URL</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span>)<span class="op">;</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(params)<span class="op">.</span><span class="fu">forEach</span>(([key<span class="op">,</span> value]) <span class="kw">=&gt;</span> {</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>    url<span class="op">.</span><span class="at">searchParams</span><span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> value)<span class="op">;</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>  pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;router.navigate&#39;</span><span class="op">,</span> { <span class="dt">path</span><span class="op">:</span> url<span class="op">.</span><span class="at">pathname</span> <span class="op">+</span> url<span class="op">.</span><span class="at">search</span> })<span class="op">;</span></span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb226-12"><a href="#cb226-12" aria-hidden="true" tabindex="-1"></a><span class="fu">updateQuery</span>({ <span class="dt">q</span><span class="op">:</span> <span class="st">&#39;web components&#39;</span><span class="op">,</span> <span class="dt">page</span><span class="op">:</span> <span class="st">&#39;2&#39;</span> })<span class="op">;</span></span></code></pre></div>
<h2 id="summary-8">Summary</h2>
<p>LARC routing provides:</p>
<ul>
<li>Client-side navigation without page reloads</li>
<li>Declarative route configuration</li>
<li>Route parameters and guards</li>
<li>Nested routing support</li>
<li>Browser history integration</li>
<li>PAN bus integration</li>
</ul>
<hr />
<h2 id="best-practices-5">Best Practices</h2>
<ol type="1">
<li><strong>Use declarative routing</strong> - Prefer
<code>&lt;pan-router&gt;</code> over imperative API</li>
<li><strong>Implement route guards</strong> - Protect sensitive
routes</li>
<li><strong>Handle 404s gracefully</strong> - Always include catch-all
route</li>
<li><strong>Preserve scroll position</strong> - Restore scroll on back
navigation</li>
<li><strong>Use query params for filters</strong> - Makes URLs
shareable</li>
</ol>
<h1 id="chapter-9-forms-and-validation">Chapter 9: Forms and
Validation</h1>
<p>Forms are the primary way users input data into web applications.
LARC provides patterns for building accessible, validated forms using
web standards and the PAN bus.</p>
<h2 id="form-components">Form Components</h2>
<h3 id="basic-form-component">Basic Form Component</h3>
<div class="sourceCode" id="cb227"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ContactForm <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachEventListeners</span>()<span class="op">;</span></span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attachEventListeners</span>() {</span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> form <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">;</span></span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">async</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb227-16"><a href="#cb227-16" aria-hidden="true" tabindex="-1"></a>      e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb227-17"><a href="#cb227-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-18"><a href="#cb227-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">validate</span>()) {</span>
<span id="cb227-19"><a href="#cb227-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> data <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getFormData</span>()<span class="op">;</span></span>
<span id="cb227-20"><a href="#cb227-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">handleSubmit</span>(data)<span class="op">;</span></span>
<span id="cb227-21"><a href="#cb227-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb227-22"><a href="#cb227-22" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb227-23"><a href="#cb227-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-24"><a href="#cb227-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-25"><a href="#cb227-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getFormData</span>() {</span>
<span id="cb227-26"><a href="#cb227-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> form <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">;</span></span>
<span id="cb227-27"><a href="#cb227-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formData <span class="op">=</span> <span class="kw">new</span> <span class="bu">FormData</span>(form)<span class="op">;</span></span>
<span id="cb227-28"><a href="#cb227-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(formData)<span class="op">;</span></span>
<span id="cb227-29"><a href="#cb227-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-30"><a href="#cb227-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-31"><a href="#cb227-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>() {</span>
<span id="cb227-32"><a href="#cb227-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> form <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">;</span></span>
<span id="cb227-33"><a href="#cb227-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> form<span class="op">.</span><span class="fu">checkValidity</span>()<span class="op">;</span></span>
<span id="cb227-34"><a href="#cb227-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-35"><a href="#cb227-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-36"><a href="#cb227-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">handleSubmit</span>(data) {</span>
<span id="cb227-37"><a href="#cb227-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb227-38"><a href="#cb227-38" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/contact&#39;</span><span class="op">,</span> {</span>
<span id="cb227-39"><a href="#cb227-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb227-40"><a href="#cb227-40" aria-hidden="true" tabindex="-1"></a>        <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb227-41"><a href="#cb227-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data)</span>
<span id="cb227-42"><a href="#cb227-42" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb227-43"><a href="#cb227-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-44"><a href="#cb227-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb227-45"><a href="#cb227-45" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;form.submitted&#39;</span><span class="op">,</span> { <span class="dt">form</span><span class="op">:</span> <span class="st">&#39;contact&#39;</span><span class="op">,</span> data })<span class="op">;</span></span>
<span id="cb227-46"><a href="#cb227-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showSuccess</span>()<span class="op">;</span></span>
<span id="cb227-47"><a href="#cb227-47" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb227-48"><a href="#cb227-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Submission failed&#39;</span>)<span class="op">;</span></span>
<span id="cb227-49"><a href="#cb227-49" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb227-50"><a href="#cb227-50" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb227-51"><a href="#cb227-51" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showError</span>(error<span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb227-52"><a href="#cb227-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb227-53"><a href="#cb227-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-54"><a href="#cb227-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-55"><a href="#cb227-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showSuccess</span>() {</span>
<span id="cb227-56"><a href="#cb227-56" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;notification.success&#39;</span><span class="op">,</span> { <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Form submitted successfully!&#39;</span> })<span class="op">;</span></span>
<span id="cb227-57"><a href="#cb227-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">.</span><span class="fu">reset</span>()<span class="op">;</span></span>
<span id="cb227-58"><a href="#cb227-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-59"><a href="#cb227-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-60"><a href="#cb227-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showError</span>(message) {</span>
<span id="cb227-61"><a href="#cb227-61" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;notification.error&#39;</span><span class="op">,</span> { message })<span class="op">;</span></span>
<span id="cb227-62"><a href="#cb227-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-63"><a href="#cb227-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-64"><a href="#cb227-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb227-65"><a href="#cb227-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb227-66"><a href="#cb227-66" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb227-67"><a href="#cb227-67" aria-hidden="true" tabindex="-1"></a><span class="vs">        form { max-width: 500px; }</span></span>
<span id="cb227-68"><a href="#cb227-68" aria-hidden="true" tabindex="-1"></a><span class="vs">        .field { margin-bottom: 16px; }</span></span>
<span id="cb227-69"><a href="#cb227-69" aria-hidden="true" tabindex="-1"></a><span class="vs">        label {</span></span>
<span id="cb227-70"><a href="#cb227-70" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: block;</span></span>
<span id="cb227-71"><a href="#cb227-71" aria-hidden="true" tabindex="-1"></a><span class="vs">          margin-bottom: 4px;</span></span>
<span id="cb227-72"><a href="#cb227-72" aria-hidden="true" tabindex="-1"></a><span class="vs">          font-weight: 600;</span></span>
<span id="cb227-73"><a href="#cb227-73" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb227-74"><a href="#cb227-74" aria-hidden="true" tabindex="-1"></a><span class="vs">        input, textarea {</span></span>
<span id="cb227-75"><a href="#cb227-75" aria-hidden="true" tabindex="-1"></a><span class="vs">          width: 100%;</span></span>
<span id="cb227-76"><a href="#cb227-76" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 8px 12px;</span></span>
<span id="cb227-77"><a href="#cb227-77" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: 1px solid #cbd5e0;</span></span>
<span id="cb227-78"><a href="#cb227-78" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb227-79"><a href="#cb227-79" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb227-80"><a href="#cb227-80" aria-hidden="true" tabindex="-1"></a><span class="vs">        input:invalid, textarea:invalid {</span></span>
<span id="cb227-81"><a href="#cb227-81" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-color: #fc8181;</span></span>
<span id="cb227-82"><a href="#cb227-82" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb227-83"><a href="#cb227-83" aria-hidden="true" tabindex="-1"></a><span class="vs">        button {</span></span>
<span id="cb227-84"><a href="#cb227-84" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #667eea;</span></span>
<span id="cb227-85"><a href="#cb227-85" aria-hidden="true" tabindex="-1"></a><span class="vs">          color: white;</span></span>
<span id="cb227-86"><a href="#cb227-86" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 10px 24px;</span></span>
<span id="cb227-87"><a href="#cb227-87" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: none;</span></span>
<span id="cb227-88"><a href="#cb227-88" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 4px;</span></span>
<span id="cb227-89"><a href="#cb227-89" aria-hidden="true" tabindex="-1"></a><span class="vs">          cursor: pointer;</span></span>
<span id="cb227-90"><a href="#cb227-90" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb227-91"><a href="#cb227-91" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb227-92"><a href="#cb227-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-93"><a href="#cb227-93" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;form&gt;</span></span>
<span id="cb227-94"><a href="#cb227-94" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;field&quot;&gt;</span></span>
<span id="cb227-95"><a href="#cb227-95" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;label for=&quot;name&quot;&gt;Name *&lt;/label&gt;</span></span>
<span id="cb227-96"><a href="#cb227-96" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; required minlength=&quot;2&quot;&gt;</span></span>
<span id="cb227-97"><a href="#cb227-97" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb227-98"><a href="#cb227-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-99"><a href="#cb227-99" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;field&quot;&gt;</span></span>
<span id="cb227-100"><a href="#cb227-100" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;label for=&quot;email&quot;&gt;Email *&lt;/label&gt;</span></span>
<span id="cb227-101"><a href="#cb227-101" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;input type=&quot;email&quot; id=&quot;email&quot; name=&quot;email&quot; required&gt;</span></span>
<span id="cb227-102"><a href="#cb227-102" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb227-103"><a href="#cb227-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-104"><a href="#cb227-104" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;field&quot;&gt;</span></span>
<span id="cb227-105"><a href="#cb227-105" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;label for=&quot;message&quot;&gt;Message *&lt;/label&gt;</span></span>
<span id="cb227-106"><a href="#cb227-106" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;textarea id=&quot;message&quot; name=&quot;message&quot; required minlength=&quot;10&quot; rows=&quot;5&quot;&gt;&lt;/textarea&gt;</span></span>
<span id="cb227-107"><a href="#cb227-107" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb227-108"><a href="#cb227-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-109"><a href="#cb227-109" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button type=&quot;submit&quot;&gt;Send Message&lt;/button&gt;</span></span>
<span id="cb227-110"><a href="#cb227-110" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/form&gt;</span></span>
<span id="cb227-111"><a href="#cb227-111" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb227-112"><a href="#cb227-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb227-113"><a href="#cb227-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb227-114"><a href="#cb227-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-115"><a href="#cb227-115" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;contact-form&#39;</span><span class="op">,</span> ContactForm)<span class="op">;</span></span></code></pre></div>
<h2 id="two-way-data-binding">Two-Way Data Binding</h2>
<p>Sync form inputs with component state:</p>
<div class="sourceCode" id="cb228"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataBoundForm <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">state</span> <span class="op">=</span> {</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;&#39;</span></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">bindInputs</span>()<span class="op">;</span></span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bindInputs</span>() {</span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> inputs <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;input&#39;</span>)<span class="op">;</span></span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-20"><a href="#cb228-20" aria-hidden="true" tabindex="-1"></a>    inputs<span class="op">.</span><span class="fu">forEach</span>(input <span class="kw">=&gt;</span> {</span>
<span id="cb228-21"><a href="#cb228-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Update state when input changes</span></span>
<span id="cb228-22"><a href="#cb228-22" aria-hidden="true" tabindex="-1"></a>      input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;input&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb228-23"><a href="#cb228-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">state</span>[e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">name</span>] <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb228-24"><a href="#cb228-24" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;form.state.changed&#39;</span><span class="op">,</span> { <span class="dt">state</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">state</span> })<span class="op">;</span></span>
<span id="cb228-25"><a href="#cb228-25" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb228-26"><a href="#cb228-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-27"><a href="#cb228-27" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Update input when state changes</span></span>
<span id="cb228-28"><a href="#cb228-28" aria-hidden="true" tabindex="-1"></a>      pan<span class="op">.</span><span class="fu">subscribe</span>(<span class="st">&#39;form.state.update&#39;</span><span class="op">,</span> (updates) <span class="kw">=&gt;</span> {</span>
<span id="cb228-29"><a href="#cb228-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (updates[input<span class="op">.</span><span class="at">name</span>] <span class="op">!==</span> <span class="kw">undefined</span>) {</span>
<span id="cb228-30"><a href="#cb228-30" aria-hidden="true" tabindex="-1"></a>          input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> updates[input<span class="op">.</span><span class="at">name</span>]<span class="op">;</span></span>
<span id="cb228-31"><a href="#cb228-31" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">state</span>[input<span class="op">.</span><span class="at">name</span>] <span class="op">=</span> updates[input<span class="op">.</span><span class="at">name</span>]<span class="op">;</span></span>
<span id="cb228-32"><a href="#cb228-32" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb228-33"><a href="#cb228-33" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb228-34"><a href="#cb228-34" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb228-35"><a href="#cb228-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb228-36"><a href="#cb228-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-37"><a href="#cb228-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb228-38"><a href="#cb228-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb228-39"><a href="#cb228-39" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;form&gt;</span></span>
<span id="cb228-40"><a href="#cb228-40" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type=&quot;text&quot; name=&quot;firstName&quot; value=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">firstName</span><span class="sc">}</span><span class="vs">&quot; placeholder=&quot;First Name&quot;&gt;</span></span>
<span id="cb228-41"><a href="#cb228-41" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type=&quot;text&quot; name=&quot;lastName&quot; value=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">lastName</span><span class="sc">}</span><span class="vs">&quot; placeholder=&quot;Last Name&quot;&gt;</span></span>
<span id="cb228-42"><a href="#cb228-42" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type=&quot;email&quot; name=&quot;email&quot; value=&quot;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">email</span><span class="sc">}</span><span class="vs">&quot; placeholder=&quot;Email&quot;&gt;</span></span>
<span id="cb228-43"><a href="#cb228-43" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/form&gt;</span></span>
<span id="cb228-44"><a href="#cb228-44" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;preview&quot;&gt;</span></span>
<span id="cb228-45"><a href="#cb228-45" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;Hello, </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">firstName</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">lastName</span><span class="sc">}</span><span class="vs">!&lt;/p&gt;</span></span>
<span id="cb228-46"><a href="#cb228-46" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;Email: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">email</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb228-47"><a href="#cb228-47" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb228-48"><a href="#cb228-48" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb228-49"><a href="#cb228-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb228-50"><a href="#cb228-50" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="validation-strategies">Validation Strategies</h2>
<h3 id="native-html5-validation">Native HTML5 Validation</h3>
<div class="sourceCode" id="cb229"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="ot"> required</span><span class="dt">&gt;</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;number&quot;</span><span class="ot"> min</span><span class="op">=</span><span class="st">&quot;1&quot;</span><span class="ot"> max</span><span class="op">=</span><span class="st">&quot;100&quot;</span><span class="dt">&gt;</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;text&quot;</span><span class="ot"> pattern</span><span class="op">=</span><span class="st">&quot;[A-Za-z]{3,}&quot;</span><span class="ot"> title</span><span class="op">=</span><span class="st">&quot;At least 3 letters&quot;</span><span class="dt">&gt;</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">&quot;url&quot;</span><span class="ot"> required</span><span class="dt">&gt;</span></span></code></pre></div>
<h3 id="custom-validation">Custom Validation</h3>
<div class="sourceCode" id="cb230"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ValidatedInput <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;input type=&quot;text&quot; id=&quot;input&quot;&gt;</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;span class=&quot;error&quot;&gt;&lt;/span&gt;</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;input&#39;</span>)<span class="op">;</span></span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> error <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.error&#39;</span>)<span class="op">;</span></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;blur&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> validationResult <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">customValidate</span>(input<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>validationResult<span class="op">.</span><span class="at">valid</span>) {</span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>        error<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> validationResult<span class="op">.</span><span class="at">message</span><span class="op">;</span></span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a>        input<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">add</span>(<span class="st">&#39;invalid&#39;</span>)<span class="op">;</span></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a>        error<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a>        input<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">remove</span>(<span class="st">&#39;invalid&#39;</span>)<span class="op">;</span></span>
<span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb230-21"><a href="#cb230-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb230-22"><a href="#cb230-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb230-23"><a href="#cb230-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-24"><a href="#cb230-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">customValidate</span>(value) {</span>
<span id="cb230-25"><a href="#cb230-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Custom validation logic</span></span>
<span id="cb230-26"><a href="#cb230-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb230-27"><a href="#cb230-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { <span class="dt">valid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Must be at least 3 characters&#39;</span> }<span class="op">;</span></span>
<span id="cb230-28"><a href="#cb230-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb230-29"><a href="#cb230-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-30"><a href="#cb230-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="ss">/</span><span class="sc">^[a-zA-Z]+$</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(value)) {</span>
<span id="cb230-31"><a href="#cb230-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { <span class="dt">valid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Only letters allowed&#39;</span> }<span class="op">;</span></span>
<span id="cb230-32"><a href="#cb230-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb230-33"><a href="#cb230-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-34"><a href="#cb230-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">valid</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">;</span></span>
<span id="cb230-35"><a href="#cb230-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb230-36"><a href="#cb230-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="async-validation">Async Validation</h3>
<div class="sourceCode" id="cb231"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UsernameInput <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;input&#39;</span>)<span class="op">;</span></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> timeoutId<span class="op">;</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;input&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>      <span class="pp">clearTimeout</span>(timeoutId)<span class="op">;</span></span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>      timeoutId <span class="op">=</span> <span class="pp">setTimeout</span>(<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">checkAvailability</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">checkAvailability</span>(username) {</span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> status <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.status&#39;</span>)<span class="op">;</span></span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (username<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a>      status<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb231-22"><a href="#cb231-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb231-23"><a href="#cb231-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb231-24"><a href="#cb231-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-25"><a href="#cb231-25" aria-hidden="true" tabindex="-1"></a>    status<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;Checking...&#39;</span><span class="op">;</span></span>
<span id="cb231-26"><a href="#cb231-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-27"><a href="#cb231-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb231-28"><a href="#cb231-28" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api/check-username?username=</span><span class="sc">${</span>username<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb231-29"><a href="#cb231-29" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> { available } <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb231-30"><a href="#cb231-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-31"><a href="#cb231-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (available) {</span>
<span id="cb231-32"><a href="#cb231-32" aria-hidden="true" tabindex="-1"></a>        status<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;✓ Available&#39;</span><span class="op">;</span></span>
<span id="cb231-33"><a href="#cb231-33" aria-hidden="true" tabindex="-1"></a>        status<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;status success&#39;</span><span class="op">;</span></span>
<span id="cb231-34"><a href="#cb231-34" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb231-35"><a href="#cb231-35" aria-hidden="true" tabindex="-1"></a>        status<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;✗ Already taken&#39;</span><span class="op">;</span></span>
<span id="cb231-36"><a href="#cb231-36" aria-hidden="true" tabindex="-1"></a>        status<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;status error&#39;</span><span class="op">;</span></span>
<span id="cb231-37"><a href="#cb231-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb231-38"><a href="#cb231-38" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb231-39"><a href="#cb231-39" aria-hidden="true" tabindex="-1"></a>      status<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;Could not check availability&#39;</span><span class="op">;</span></span>
<span id="cb231-40"><a href="#cb231-40" aria-hidden="true" tabindex="-1"></a>      status<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;status error&#39;</span><span class="op">;</span></span>
<span id="cb231-41"><a href="#cb231-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb231-42"><a href="#cb231-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb231-43"><a href="#cb231-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-44"><a href="#cb231-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb231-45"><a href="#cb231-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb231-46"><a href="#cb231-46" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;label&gt;Username&lt;/label&gt;</span></span>
<span id="cb231-47"><a href="#cb231-47" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;input type=&quot;text&quot; placeholder=&quot;Choose a username&quot;&gt;</span></span>
<span id="cb231-48"><a href="#cb231-48" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;span class=&quot;status&quot;&gt;&lt;/span&gt;</span></span>
<span id="cb231-49"><a href="#cb231-49" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb231-50"><a href="#cb231-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb231-51"><a href="#cb231-51" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="error-handling">Error Handling</h2>
<p>Display validation errors elegantly:</p>
<div class="sourceCode" id="cb232"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FormWithErrors <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">errors</span> <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> form <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">;</span></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>      e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">clearErrors</span>()<span class="op">;</span></span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> errors <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateForm</span>()<span class="op">;</span></span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(errors)<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">handleSubmit</span>()<span class="op">;</span></span>
<span id="cb232-20"><a href="#cb232-20" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb232-21"><a href="#cb232-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showErrors</span>(errors)<span class="op">;</span></span>
<span id="cb232-22"><a href="#cb232-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb232-23"><a href="#cb232-23" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb232-24"><a href="#cb232-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb232-25"><a href="#cb232-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-26"><a href="#cb232-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validateForm</span>() {</span>
<span id="cb232-27"><a href="#cb232-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> errors <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb232-28"><a href="#cb232-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> inputs <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;input&#39;</span>)<span class="op">;</span></span>
<span id="cb232-29"><a href="#cb232-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-30"><a href="#cb232-30" aria-hidden="true" tabindex="-1"></a>    inputs<span class="op">.</span><span class="fu">forEach</span>(input <span class="kw">=&gt;</span> {</span>
<span id="cb232-31"><a href="#cb232-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>input<span class="op">.</span><span class="at">validity</span><span class="op">.</span><span class="at">valid</span>) {</span>
<span id="cb232-32"><a href="#cb232-32" aria-hidden="true" tabindex="-1"></a>        errors[input<span class="op">.</span><span class="at">name</span>] <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getErrorMessage</span>(input)<span class="op">;</span></span>
<span id="cb232-33"><a href="#cb232-33" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb232-34"><a href="#cb232-34" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb232-35"><a href="#cb232-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-36"><a href="#cb232-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> errors<span class="op">;</span></span>
<span id="cb232-37"><a href="#cb232-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb232-38"><a href="#cb232-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-39"><a href="#cb232-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getErrorMessage</span>(input) {</span>
<span id="cb232-40"><a href="#cb232-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">validity</span><span class="op">.</span><span class="at">valueMissing</span>) {</span>
<span id="cb232-41"><a href="#cb232-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">&#39;This field is required&#39;</span><span class="op">;</span></span>
<span id="cb232-42"><a href="#cb232-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb232-43"><a href="#cb232-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">validity</span><span class="op">.</span><span class="at">typeMismatch</span>) {</span>
<span id="cb232-44"><a href="#cb232-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`Please enter a valid </span><span class="sc">${</span>input<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb232-45"><a href="#cb232-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb232-46"><a href="#cb232-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">validity</span><span class="op">.</span><span class="at">tooShort</span>) {</span>
<span id="cb232-47"><a href="#cb232-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`Must be at least </span><span class="sc">${</span>input<span class="op">.</span><span class="at">minLength</span><span class="sc">}</span><span class="vs"> characters`</span><span class="op">;</span></span>
<span id="cb232-48"><a href="#cb232-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb232-49"><a href="#cb232-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">validity</span><span class="op">.</span><span class="at">tooLong</span>) {</span>
<span id="cb232-50"><a href="#cb232-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`Must be no more than </span><span class="sc">${</span>input<span class="op">.</span><span class="at">maxLength</span><span class="sc">}</span><span class="vs"> characters`</span><span class="op">;</span></span>
<span id="cb232-51"><a href="#cb232-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb232-52"><a href="#cb232-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="op">.</span><span class="at">validity</span><span class="op">.</span><span class="at">patternMismatch</span>) {</span>
<span id="cb232-53"><a href="#cb232-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> input<span class="op">.</span><span class="at">title</span> <span class="op">||</span> <span class="st">&#39;Invalid format&#39;</span><span class="op">;</span></span>
<span id="cb232-54"><a href="#cb232-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb232-55"><a href="#cb232-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-56"><a href="#cb232-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&#39;Invalid input&#39;</span><span class="op">;</span></span>
<span id="cb232-57"><a href="#cb232-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb232-58"><a href="#cb232-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-59"><a href="#cb232-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showErrors</span>(errors) {</span>
<span id="cb232-60"><a href="#cb232-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(errors)<span class="op">.</span><span class="fu">forEach</span>(([fieldName<span class="op">,</span> message]) <span class="kw">=&gt;</span> {</span>
<span id="cb232-61"><a href="#cb232-61" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> field <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="vs">`[name=&quot;</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs">&quot;]`</span>)<span class="op">;</span></span>
<span id="cb232-62"><a href="#cb232-62" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> errorEl <span class="op">=</span> field<span class="op">.</span><span class="at">parentElement</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.error&#39;</span>)<span class="op">;</span></span>
<span id="cb232-63"><a href="#cb232-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-64"><a href="#cb232-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (errorEl) {</span>
<span id="cb232-65"><a href="#cb232-65" aria-hidden="true" tabindex="-1"></a>        errorEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> message<span class="op">;</span></span>
<span id="cb232-66"><a href="#cb232-66" aria-hidden="true" tabindex="-1"></a>        field<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">add</span>(<span class="st">&#39;invalid&#39;</span>)<span class="op">;</span></span>
<span id="cb232-67"><a href="#cb232-67" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb232-68"><a href="#cb232-68" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb232-69"><a href="#cb232-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb232-70"><a href="#cb232-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-71"><a href="#cb232-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clearErrors</span>() {</span>
<span id="cb232-72"><a href="#cb232-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;.error&#39;</span>)<span class="op">.</span><span class="fu">forEach</span>(el <span class="kw">=&gt;</span> {</span>
<span id="cb232-73"><a href="#cb232-73" aria-hidden="true" tabindex="-1"></a>      el<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb232-74"><a href="#cb232-74" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb232-75"><a href="#cb232-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-76"><a href="#cb232-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;.invalid&#39;</span>)<span class="op">.</span><span class="fu">forEach</span>(el <span class="kw">=&gt;</span> {</span>
<span id="cb232-77"><a href="#cb232-77" aria-hidden="true" tabindex="-1"></a>      el<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">remove</span>(<span class="st">&#39;invalid&#39;</span>)<span class="op">;</span></span>
<span id="cb232-78"><a href="#cb232-78" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb232-79"><a href="#cb232-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb232-80"><a href="#cb232-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-81"><a href="#cb232-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb232-82"><a href="#cb232-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb232-83"><a href="#cb232-83" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;form&gt;</span></span>
<span id="cb232-84"><a href="#cb232-84" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;field&quot;&gt;</span></span>
<span id="cb232-85"><a href="#cb232-85" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;label&gt;Email&lt;/label&gt;</span></span>
<span id="cb232-86"><a href="#cb232-86" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;input type=&quot;email&quot; name=&quot;email&quot; required&gt;</span></span>
<span id="cb232-87"><a href="#cb232-87" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;span class=&quot;error&quot;&gt;&lt;/span&gt;</span></span>
<span id="cb232-88"><a href="#cb232-88" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb232-89"><a href="#cb232-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-90"><a href="#cb232-90" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;field&quot;&gt;</span></span>
<span id="cb232-91"><a href="#cb232-91" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;label&gt;Password&lt;/label&gt;</span></span>
<span id="cb232-92"><a href="#cb232-92" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;input type=&quot;password&quot; name=&quot;password&quot; required minlength=&quot;8&quot;&gt;</span></span>
<span id="cb232-93"><a href="#cb232-93" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;span class=&quot;error&quot;&gt;&lt;/span&gt;</span></span>
<span id="cb232-94"><a href="#cb232-94" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb232-95"><a href="#cb232-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-96"><a href="#cb232-96" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span></span>
<span id="cb232-97"><a href="#cb232-97" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/form&gt;</span></span>
<span id="cb232-98"><a href="#cb232-98" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb232-99"><a href="#cb232-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb232-100"><a href="#cb232-100" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="file-uploads">File Uploads</h2>
<p>Handle file uploads with progress tracking:</p>
<div class="sourceCode" id="cb233"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FileUpload <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> input <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;input[type=&quot;file&quot;]&#39;</span>)<span class="op">;</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> button <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;button&#39;</span>)<span class="op">;</span></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>    input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> file <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">files</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (file) {</span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showPreview</span>(file)<span class="op">;</span></span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>        button<span class="op">.</span><span class="at">disabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>    button<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> file <span class="op">=</span> input<span class="op">.</span><span class="at">files</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (file) {</span>
<span id="cb233-19"><a href="#cb233-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">uploadFile</span>(file)<span class="op">;</span></span>
<span id="cb233-20"><a href="#cb233-20" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb233-21"><a href="#cb233-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb233-22"><a href="#cb233-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-23"><a href="#cb233-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-24"><a href="#cb233-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showPreview</span>(file) {</span>
<span id="cb233-25"><a href="#cb233-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> preview <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.preview&#39;</span>)<span class="op">;</span></span>
<span id="cb233-26"><a href="#cb233-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-27"><a href="#cb233-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (file<span class="op">.</span><span class="at">type</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;image/&#39;</span>)) {</span>
<span id="cb233-28"><a href="#cb233-28" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="bu">FileReader</span>()<span class="op">;</span></span>
<span id="cb233-29"><a href="#cb233-29" aria-hidden="true" tabindex="-1"></a>      reader<span class="op">.</span><span class="at">onload</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb233-30"><a href="#cb233-30" aria-hidden="true" tabindex="-1"></a>        preview<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;img src=&quot;</span><span class="sc">${</span>e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">result</span><span class="sc">}</span><span class="vs">&quot; alt=&quot;Preview&quot;&gt;`</span><span class="op">;</span></span>
<span id="cb233-31"><a href="#cb233-31" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb233-32"><a href="#cb233-32" aria-hidden="true" tabindex="-1"></a>      reader<span class="op">.</span><span class="fu">readAsDataURL</span>(file)<span class="op">;</span></span>
<span id="cb233-33"><a href="#cb233-33" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb233-34"><a href="#cb233-34" aria-hidden="true" tabindex="-1"></a>      preview<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb233-35"><a href="#cb233-35" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span><span class="sc">${</span>file<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb233-36"><a href="#cb233-36" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="fu">formatFileSize</span>(file<span class="op">.</span><span class="at">size</span>)<span class="sc">}</span><span class="vs">&lt;/p&gt;</span></span>
<span id="cb233-37"><a href="#cb233-37" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb233-38"><a href="#cb233-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb233-39"><a href="#cb233-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-40"><a href="#cb233-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-41"><a href="#cb233-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">uploadFile</span>(file) {</span>
<span id="cb233-42"><a href="#cb233-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formData <span class="op">=</span> <span class="kw">new</span> <span class="bu">FormData</span>()<span class="op">;</span></span>
<span id="cb233-43"><a href="#cb233-43" aria-hidden="true" tabindex="-1"></a>    formData<span class="op">.</span><span class="fu">append</span>(<span class="st">&#39;file&#39;</span><span class="op">,</span> file)<span class="op">;</span></span>
<span id="cb233-44"><a href="#cb233-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-45"><a href="#cb233-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> xhr <span class="op">=</span> <span class="kw">new</span> <span class="bu">XMLHttpRequest</span>()<span class="op">;</span></span>
<span id="cb233-46"><a href="#cb233-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-47"><a href="#cb233-47" aria-hidden="true" tabindex="-1"></a>    xhr<span class="op">.</span><span class="at">upload</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;progress&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb233-48"><a href="#cb233-48" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> percent <span class="op">=</span> (e<span class="op">.</span><span class="at">loaded</span> <span class="op">/</span> e<span class="op">.</span><span class="at">total</span>) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb233-49"><a href="#cb233-49" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">updateProgress</span>(percent)<span class="op">;</span></span>
<span id="cb233-50"><a href="#cb233-50" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb233-51"><a href="#cb233-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-52"><a href="#cb233-52" aria-hidden="true" tabindex="-1"></a>    xhr<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;load&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb233-53"><a href="#cb233-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (xhr<span class="op">.</span><span class="at">status</span> <span class="op">===</span> <span class="dv">200</span>) {</span>
<span id="cb233-54"><a href="#cb233-54" aria-hidden="true" tabindex="-1"></a>        pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;file.uploaded&#39;</span><span class="op">,</span> {</span>
<span id="cb233-55"><a href="#cb233-55" aria-hidden="true" tabindex="-1"></a>          <span class="dt">filename</span><span class="op">:</span> file<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb233-56"><a href="#cb233-56" aria-hidden="true" tabindex="-1"></a>          <span class="dt">response</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(xhr<span class="op">.</span><span class="at">response</span>)</span>
<span id="cb233-57"><a href="#cb233-57" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb233-58"><a href="#cb233-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showSuccess</span>()<span class="op">;</span></span>
<span id="cb233-59"><a href="#cb233-59" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb233-60"><a href="#cb233-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">showError</span>(<span class="st">&#39;Upload failed&#39;</span>)<span class="op">;</span></span>
<span id="cb233-61"><a href="#cb233-61" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb233-62"><a href="#cb233-62" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb233-63"><a href="#cb233-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-64"><a href="#cb233-64" aria-hidden="true" tabindex="-1"></a>    xhr<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb233-65"><a href="#cb233-65" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">showError</span>(<span class="st">&#39;Upload failed&#39;</span>)<span class="op">;</span></span>
<span id="cb233-66"><a href="#cb233-66" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb233-67"><a href="#cb233-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-68"><a href="#cb233-68" aria-hidden="true" tabindex="-1"></a>    xhr<span class="op">.</span><span class="fu">open</span>(<span class="st">&#39;POST&#39;</span><span class="op">,</span> <span class="st">&#39;/api/upload&#39;</span>)<span class="op">;</span></span>
<span id="cb233-69"><a href="#cb233-69" aria-hidden="true" tabindex="-1"></a>    xhr<span class="op">.</span><span class="fu">send</span>(formData)<span class="op">;</span></span>
<span id="cb233-70"><a href="#cb233-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-71"><a href="#cb233-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-72"><a href="#cb233-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateProgress</span>(percent) {</span>
<span id="cb233-73"><a href="#cb233-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> progress <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.progress-bar&#39;</span>)<span class="op">;</span></span>
<span id="cb233-74"><a href="#cb233-74" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">width</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>percent<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb233-75"><a href="#cb233-75" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(percent)<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb233-76"><a href="#cb233-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-77"><a href="#cb233-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-78"><a href="#cb233-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatFileSize</span>(bytes) {</span>
<span id="cb233-79"><a href="#cb233-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bytes <span class="op">&lt;</span> <span class="dv">1024</span>) <span class="cf">return</span> bytes <span class="op">+</span> <span class="st">&#39; B&#39;</span><span class="op">;</span></span>
<span id="cb233-80"><a href="#cb233-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bytes <span class="op">&lt;</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>) <span class="cf">return</span> (bytes <span class="op">/</span> <span class="dv">1024</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">&#39; KB&#39;</span><span class="op">;</span></span>
<span id="cb233-81"><a href="#cb233-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (bytes <span class="op">/</span> (<span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="st">&#39; MB&#39;</span><span class="op">;</span></span>
<span id="cb233-82"><a href="#cb233-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-83"><a href="#cb233-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-84"><a href="#cb233-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showSuccess</span>() {</span>
<span id="cb233-85"><a href="#cb233-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.status&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;✓ Uploaded successfully&#39;</span><span class="op">;</span></span>
<span id="cb233-86"><a href="#cb233-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-87"><a href="#cb233-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-88"><a href="#cb233-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showError</span>(message) {</span>
<span id="cb233-89"><a href="#cb233-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.status&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`✗ </span><span class="sc">${</span>message<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb233-90"><a href="#cb233-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-91"><a href="#cb233-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-92"><a href="#cb233-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb233-93"><a href="#cb233-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb233-94"><a href="#cb233-94" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;upload-container&quot;&gt;</span></span>
<span id="cb233-95"><a href="#cb233-95" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input type=&quot;file&quot; accept=&quot;image/*&quot;&gt;</span></span>
<span id="cb233-96"><a href="#cb233-96" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;preview&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb233-97"><a href="#cb233-97" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;progress&quot;&gt;</span></span>
<span id="cb233-98"><a href="#cb233-98" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;progress-bar&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb233-99"><a href="#cb233-99" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;/div&gt;</span></span>
<span id="cb233-100"><a href="#cb233-100" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button disabled&gt;Upload&lt;/button&gt;</span></span>
<span id="cb233-101"><a href="#cb233-101" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;status&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb233-102"><a href="#cb233-102" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb233-103"><a href="#cb233-103" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb233-104"><a href="#cb233-104" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-105"><a href="#cb233-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb233-106"><a href="#cb233-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-107"><a href="#cb233-107" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;file-upload&#39;</span><span class="op">,</span> FileUpload)<span class="op">;</span></span></code></pre></div>
<h2 id="form-submission">Form Submission</h2>
<p>Handle form submission with loading states and error recovery:</p>
<div class="sourceCode" id="cb234"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SmartForm <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">attachShadow</span>({ <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;open&#39;</span> })<span class="op">;</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">submitting</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">async</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>      e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">submitting</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">submitting</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">disableForm</span>()<span class="op">;</span></span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">try</span> {</span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> data <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getFormData</span>()<span class="op">;</span></span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">submitForm</span>(data)<span class="op">;</span></span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">handleSuccess</span>()<span class="op">;</span></span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">catch</span> (error) {</span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">handleError</span>(error)<span class="op">;</span></span>
<span id="cb234-25"><a href="#cb234-25" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">finally</span> {</span>
<span id="cb234-26"><a href="#cb234-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">submitting</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb234-27"><a href="#cb234-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">enableForm</span>()<span class="op">;</span></span>
<span id="cb234-28"><a href="#cb234-28" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb234-29"><a href="#cb234-29" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb234-30"><a href="#cb234-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-31"><a href="#cb234-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-32"><a href="#cb234-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getFormData</span>() {</span>
<span id="cb234-33"><a href="#cb234-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> form <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">;</span></span>
<span id="cb234-34"><a href="#cb234-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formData <span class="op">=</span> <span class="kw">new</span> <span class="bu">FormData</span>(form)<span class="op">;</span></span>
<span id="cb234-35"><a href="#cb234-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(formData)<span class="op">;</span></span>
<span id="cb234-36"><a href="#cb234-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-37"><a href="#cb234-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-38"><a href="#cb234-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">submitForm</span>(data) {</span>
<span id="cb234-39"><a href="#cb234-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/submit&#39;</span><span class="op">,</span> {</span>
<span id="cb234-40"><a href="#cb234-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb234-41"><a href="#cb234-41" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb234-42"><a href="#cb234-42" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data)</span>
<span id="cb234-43"><a href="#cb234-43" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb234-44"><a href="#cb234-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-45"><a href="#cb234-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb234-46"><a href="#cb234-46" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> error <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb234-47"><a href="#cb234-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(error<span class="op">.</span><span class="at">message</span> <span class="op">||</span> <span class="st">&#39;Submission failed&#39;</span>)<span class="op">;</span></span>
<span id="cb234-48"><a href="#cb234-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb234-49"><a href="#cb234-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-50"><a href="#cb234-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb234-51"><a href="#cb234-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-52"><a href="#cb234-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-53"><a href="#cb234-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">disableForm</span>() {</span>
<span id="cb234-54"><a href="#cb234-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> inputs <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;input, button, textarea&#39;</span>)<span class="op">;</span></span>
<span id="cb234-55"><a href="#cb234-55" aria-hidden="true" tabindex="-1"></a>    inputs<span class="op">.</span><span class="fu">forEach</span>(el <span class="kw">=&gt;</span> el<span class="op">.</span><span class="at">disabled</span> <span class="op">=</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb234-56"><a href="#cb234-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-57"><a href="#cb234-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.loading&#39;</span>)<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></span>
<span id="cb234-58"><a href="#cb234-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-59"><a href="#cb234-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-60"><a href="#cb234-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enableForm</span>() {</span>
<span id="cb234-61"><a href="#cb234-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> inputs <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;input, button, textarea&#39;</span>)<span class="op">;</span></span>
<span id="cb234-62"><a href="#cb234-62" aria-hidden="true" tabindex="-1"></a>    inputs<span class="op">.</span><span class="fu">forEach</span>(el <span class="kw">=&gt;</span> el<span class="op">.</span><span class="at">disabled</span> <span class="op">=</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb234-63"><a href="#cb234-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-64"><a href="#cb234-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.loading&#39;</span>)<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></span>
<span id="cb234-65"><a href="#cb234-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-66"><a href="#cb234-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-67"><a href="#cb234-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleSuccess</span>() {</span>
<span id="cb234-68"><a href="#cb234-68" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;notification.success&#39;</span><span class="op">,</span> { <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;Form submitted successfully!&#39;</span> })<span class="op">;</span></span>
<span id="cb234-69"><a href="#cb234-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;form&#39;</span>)<span class="op">.</span><span class="fu">reset</span>()<span class="op">;</span></span>
<span id="cb234-70"><a href="#cb234-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-71"><a href="#cb234-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-72"><a href="#cb234-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handleError</span>(error) {</span>
<span id="cb234-73"><a href="#cb234-73" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;notification.error&#39;</span><span class="op">,</span> { <span class="dt">message</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb234-74"><a href="#cb234-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-75"><a href="#cb234-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-76"><a href="#cb234-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb234-77"><a href="#cb234-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb234-78"><a href="#cb234-78" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;style&gt;</span></span>
<span id="cb234-79"><a href="#cb234-79" aria-hidden="true" tabindex="-1"></a><span class="vs">        .loading {</span></span>
<span id="cb234-80"><a href="#cb234-80" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: none;</span></span>
<span id="cb234-81"><a href="#cb234-81" aria-hidden="true" tabindex="-1"></a><span class="vs">          text-align: center;</span></span>
<span id="cb234-82"><a href="#cb234-82" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding: 16px;</span></span>
<span id="cb234-83"><a href="#cb234-83" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb234-84"><a href="#cb234-84" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/style&gt;</span></span>
<span id="cb234-85"><a href="#cb234-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-86"><a href="#cb234-86" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;form&gt;</span></span>
<span id="cb234-87"><a href="#cb234-87" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;!-- Form fields --&gt;</span></span>
<span id="cb234-88"><a href="#cb234-88" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span></span>
<span id="cb234-89"><a href="#cb234-89" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/form&gt;</span></span>
<span id="cb234-90"><a href="#cb234-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-91"><a href="#cb234-91" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;loading&quot;&gt;</span></span>
<span id="cb234-92"><a href="#cb234-92" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;div class=&quot;spinner&quot;&gt;&lt;/div&gt;</span></span>
<span id="cb234-93"><a href="#cb234-93" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;p&gt;Submitting...&lt;/p&gt;</span></span>
<span id="cb234-94"><a href="#cb234-94" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb234-95"><a href="#cb234-95" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb234-96"><a href="#cb234-96" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-97"><a href="#cb234-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb234-98"><a href="#cb234-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-99"><a href="#cb234-99" aria-hidden="true" tabindex="-1"></a>customElements<span class="op">.</span><span class="fu">define</span>(<span class="st">&#39;smart-form&#39;</span><span class="op">,</span> SmartForm)<span class="op">;</span></span></code></pre></div>
<h2 id="summary-9">Summary</h2>
<p>This chapter covered:</p>
<ul>
<li>Building accessible form components</li>
<li>Two-way data binding patterns</li>
<li>Validation strategies (native and custom)</li>
<li>Error handling and display</li>
<li>File upload with progress tracking</li>
<li>Form submission with loading states</li>
</ul>
<hr />
<h2 id="best-practices-6">Best Practices</h2>
<ol type="1">
<li><strong>Use native validation first</strong> - HTML5 provides
powerful built-in validation</li>
<li><strong>Provide clear error messages</strong> - Tell users exactly
what’s wrong</li>
<li><strong>Validate on blur</strong> - Don’t show errors while user is
typing</li>
<li><strong>Disable during submission</strong> - Prevent
double-submission</li>
<li><strong>Show progress for uploads</strong> - Users want to see
progress</li>
<li><strong>Handle errors gracefully</strong> - Network can fail, handle
it well</li>
</ol>
<h1 id="chapters-11-19-summary-outlines">Chapters 11-19: Summary
Outlines</h1>
<h2 id="chapter-11-data-fetching-and-apis">Chapter 11: Data Fetching and
APIs</h2>
<h3 id="key-topics">Key Topics:</h3>
<ul>
<li><strong>REST API Integration</strong>: Using fetch() with proper
error handling</li>
<li><strong>GraphQL Support</strong>: Query/mutation patterns with
LARC</li>
<li><strong>WebSocket Communication</strong>: Real-time bi-directional
communication</li>
<li><strong>Server-Sent Events</strong>: One-way server push for live
updates</li>
<li><strong>Caching Strategies</strong>: Cache-first, network-first,
stale-while-revalidate</li>
<li><strong>Retry Logic</strong>: Exponential backoff and circuit
breakers</li>
</ul>
<h3 id="code-example---api-client">Code Example - API Client:</h3>
<div class="sourceCode" id="cb235"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ApiClient {</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">fetch</span>(endpoint<span class="op">,</span> options <span class="op">=</span> {}) {</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`/api</span><span class="sc">${</span>endpoint<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> {</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>options<span class="op">,</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> {</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span><span class="op">,</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>options<span class="op">.</span><span class="at">headers</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`API Error: </span><span class="sc">${</span>response<span class="op">.</span><span class="at">status</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">get</span>(endpoint) {</span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetch</span>(endpoint)<span class="op">;</span></span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">post</span>(endpoint<span class="op">,</span> data) {</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">fetch</span>(endpoint<span class="op">,</span> {</span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data)</span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="chapter-12-authentication-and-security">Chapter 12:
Authentication and Security</h2>
<h3 id="key-topics-1">Key Topics:</h3>
<ul>
<li><strong>JWT Token Management</strong>: Storing, refreshing, and
validating tokens</li>
<li><strong>The pan-auth Component</strong>: Centralized authentication
state</li>
<li><strong>Protected Routes</strong>: Route guards for authenticated
pages</li>
<li><strong>CORS Handling</strong>: Cross-origin resource sharing
configuration</li>
<li><strong>XSS Prevention</strong>: Sanitizing user input</li>
<li><strong>CSRF Protection</strong>: Token-based request
validation</li>
</ul>
<h3 id="code-example---auth-service">Code Example - Auth Service:</h3>
<div class="sourceCode" id="cb236"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AuthService {</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">login</span>(credentials) {</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/auth/login&#39;</span><span class="op">,</span> {</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(credentials)</span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { token<span class="op">,</span> user } <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;authToken&#39;</span><span class="op">,</span> token)<span class="op">;</span></span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;auth.login&#39;</span><span class="op">,</span> { user })<span class="op">;</span></span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { token<span class="op">,</span> user }<span class="op">;</span></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">refresh</span>() {</span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> token <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;authToken&#39;</span>)<span class="op">;</span></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/auth/refresh&#39;</span><span class="op">,</span> {</span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> { <span class="st">&#39;Authorization&#39;</span><span class="op">:</span> <span class="vs">`Bearer </span><span class="sc">${</span>token<span class="sc">}</span><span class="vs">`</span> }</span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { <span class="dt">token</span><span class="op">:</span> newToken } <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;authToken&#39;</span><span class="op">,</span> newToken)<span class="op">;</span></span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logout</span>() {</span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&#39;authToken&#39;</span>)<span class="op">;</span></span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a>    pan<span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;auth.logout&#39;</span>)<span class="op">;</span></span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="chapter-13-server-integration">Chapter 13: Server
Integration</h2>
<h3 id="key-topics-2">Key Topics:</h3>
<ul>
<li><strong>Node.js/Express Backend</strong>: RESTful API design for
LARC</li>
<li><strong>PHP Integration</strong>: Connecting LARC to PHP
backends</li>
<li><strong>Python/Django</strong>: Django REST framework
integration</li>
<li><strong>Database Patterns</strong>: ORM usage and raw SQL</li>
<li><strong>Real-Time</strong>: WebSocket servers with Socket.io</li>
<li><strong>File Serving</strong>: Static assets and CDN
integration</li>
</ul>
<h3 id="node.js-example">Node.js Example:</h3>
<div class="sourceCode" id="cb237"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co">// server.js</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(express<span class="op">.</span><span class="fu">json</span>())<span class="op">;</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(express<span class="op">.</span><span class="fu">static</span>(<span class="st">&#39;public&#39;</span>))<span class="op">;</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/users&#39;</span><span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> users <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="at">users</span><span class="op">.</span><span class="fu">findAll</span>()<span class="op">;</span></span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>(users)<span class="op">;</span></span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">post</span>(<span class="st">&#39;/api/users&#39;</span><span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="at">users</span><span class="op">.</span><span class="fu">create</span>(req<span class="op">.</span><span class="at">body</span>)<span class="op">;</span></span>
<span id="cb237-15"><a href="#cb237-15" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>(user)<span class="op">;</span></span>
<span id="cb237-16"><a href="#cb237-16" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb237-17"><a href="#cb237-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-18"><a href="#cb237-18" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">3000</span>)<span class="op">;</span></span></code></pre></div>
<h2 id="chapter-14-testing">Chapter 14: Testing</h2>
<h3 id="key-topics-3">Key Topics:</h3>
<ul>
<li><strong>Unit Testing</strong>: Testing components in isolation with
Web Test Runner</li>
<li><strong>Integration Testing</strong>: Testing component
interactions</li>
<li><strong>E2E Testing</strong>: Playwright/Puppeteer for full user
flows</li>
<li><strong>Visual Regression</strong>: Percy or BackstopJS for UI
testing</li>
<li><strong>Mocking</strong>: Fetch mocks and PAN bus mocks</li>
<li><strong>CI/CD</strong>: GitHub Actions test automation</li>
</ul>
<h3 id="test-example">Test Example:</h3>
<div class="sourceCode" id="cb238"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { expect<span class="op">,</span> fixture<span class="op">,</span> html } <span class="im">from</span> <span class="st">&#39;@open-wc/testing&#39;</span><span class="op">;</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="st">&#39;../src/components/user-card.js&#39;</span><span class="op">;</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;UserCard&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;renders user data&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> el <span class="op">=</span> <span class="cf">await</span> <span class="fu">fixture</span>(<span class="fu">html</span><span class="vs">`</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;user-card .user=</span><span class="sc">${</span>{ <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John&#39;</span><span class="op">,</span> <span class="dt">email</span><span class="op">:</span> <span class="st">&#39;john@example.com&#39;</span> }<span class="sc">}</span><span class="vs">&gt;</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/user-card&gt;</span></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(el<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;h2&#39;</span>)<span class="op">.</span><span class="at">textContent</span>)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="fu">equal</span>(<span class="st">&#39;John&#39;</span>)<span class="op">;</span></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(el<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;.email&#39;</span>)<span class="op">.</span><span class="at">textContent</span>)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="fu">equal</span>(<span class="st">&#39;john@example.com&#39;</span>)<span class="op">;</span></span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;dispatches follow event on button click&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> el <span class="op">=</span> <span class="cf">await</span> <span class="fu">fixture</span>(<span class="fu">html</span><span class="vs">`&lt;user-card&gt;&lt;/user-card&gt;`</span>)<span class="op">;</span></span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> eventData <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a>    el<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;follow&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> {</span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a>      eventData <span class="op">=</span> e<span class="op">.</span><span class="at">detail</span><span class="op">;</span></span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a>    el<span class="op">.</span><span class="at">shadowRoot</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">&#39;button&#39;</span>)<span class="op">.</span><span class="fu">click</span>()<span class="op">;</span></span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-25"><a href="#cb238-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(eventData)<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="at">exist</span><span class="op">;</span></span>
<span id="cb238-26"><a href="#cb238-26" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb238-27"><a href="#cb238-27" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="chapter-15-performance-and-optimization">Chapter 15: Performance
and Optimization</h2>
<h3 id="key-topics-4">Key Topics:</h3>
<ul>
<li><strong>Code Splitting</strong>: Dynamic imports for lazy
loading</li>
<li><strong>Tree Shaking</strong>: Removing unused code</li>
<li><strong>Lazy Loading</strong>: Intersection Observer patterns</li>
<li><strong>Image Optimization</strong>: WebP, lazy loading, responsive
images</li>
<li><strong>Caching</strong>: Service Worker caching strategies</li>
<li><strong>Performance Monitoring</strong>: Web Vitals and metrics</li>
</ul>
<h3 id="performance-patterns">Performance Patterns:</h3>
<div class="sourceCode" id="cb239"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Lazy load on interaction</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>button<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { HeavyComponent } <span class="op">=</span> <span class="cf">await</span> <span class="im">import</span>(<span class="st">&#39;./heavy-component.js&#39;</span>)<span class="op">;</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use component</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> { <span class="dt">once</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Intersection Observer for images</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="fu">IntersectionObserver</span>((entries) <span class="kw">=&gt;</span> {</span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>  entries<span class="op">.</span><span class="fu">forEach</span>(entry <span class="kw">=&gt;</span> {</span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (entry<span class="op">.</span><span class="at">isIntersecting</span>) {</span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a>      entry<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">src</span> <span class="op">=</span> entry<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">dataset</span><span class="op">.</span><span class="at">src</span><span class="op">;</span></span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>      observer<span class="op">.</span><span class="fu">unobserve</span>(entry<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb239-14"><a href="#cb239-14" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb239-15"><a href="#cb239-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb239-16"><a href="#cb239-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-17"><a href="#cb239-17" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;img[data-src]&#39;</span>)<span class="op">.</span><span class="fu">forEach</span>(img <span class="kw">=&gt;</span> {</span>
<span id="cb239-18"><a href="#cb239-18" aria-hidden="true" tabindex="-1"></a>  observer<span class="op">.</span><span class="fu">observe</span>(img)<span class="op">;</span></span>
<span id="cb239-19"><a href="#cb239-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="chapter-16-deployment">Chapter 16: Deployment</h2>
<h3 id="key-topics-5">Key Topics:</h3>
<ul>
<li><strong>Static Hosting</strong>: Netlify, Vercel, GitHub Pages</li>
<li><strong>CDN Configuration</strong>: CloudFlare, AWS CloudFront</li>
<li><strong>Environment Variables</strong>: Managing config across
environments</li>
<li><strong>Build Scripts</strong>: Optional production
optimization</li>
<li><strong>CI/CD Pipelines</strong>: Automated deployment
workflows</li>
<li><strong>Monitoring</strong>: Error tracking and analytics</li>
</ul>
<h3 id="deployment-checklist">Deployment Checklist:</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Minify JavaScript (optional but
recommended)</label></li>
<li><label><input type="checkbox" />Optimize images</label></li>
<li><label><input type="checkbox" />Set up CDN for assets</label></li>
<li><label><input type="checkbox" />Configure caching
headers</label></li>
<li><label><input type="checkbox" />Enable HTTPS</label></li>
<li><label><input type="checkbox" />Set up error monitoring
(Sentry)</label></li>
<li><label><input type="checkbox" />Configure analytics (Plausible,
Fathom)</label></li>
<li><label><input type="checkbox" />Test in all target
browsers</label></li>
<li><label><input type="checkbox" />Set up automated
deployments</label></li>
</ul>
<h2 id="chapter-17-component-library">Chapter 17: Component Library</h2>
<h3 id="key-topics-6">Key Topics:</h3>
<ul>
<li><strong>Using the Registry</strong>: Finding and installing
components</li>
<li><strong>Contributing Components</strong>: Publishing to the
registry</li>
<li><strong>Component Quality</strong>: Tests, types, documentation</li>
<li><strong>Versioning</strong>: Semantic versioning and changelogs</li>
<li><strong>Documentation</strong>: API docs and usage examples</li>
<li><strong>Design Systems</strong>: Building consistent component
libraries</li>
</ul>
<h3 id="registry-integration">Registry Integration:</h3>
<div class="sourceCode" id="cb240"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install component from registry</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="ex">larc</span> add @larcjs/ui</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Publish component to registry</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="ex">larc</span> publish ./components/my-component.js</span></code></pre></div>
<h2 id="chapter-18-tooling">Chapter 18: Tooling</h2>
<h3 id="key-topics-7">Key Topics:</h3>
<ul>
<li><strong>LARC CLI</strong>: create-larc-app, dev server,
generators</li>
<li><strong>VS Code Extension</strong>: Snippets, IntelliSense,
commands</li>
<li><strong>Browser DevTools</strong>: Debugging Web Components and
Shadow DOM</li>
<li><strong>Hot Module Reload</strong>: Live updates without full
refresh</li>
<li><strong>Linting</strong>: ESLint configuration for LARC</li>
<li><strong>Formatting</strong>: Prettier setup</li>
</ul>
<h3 id="vs-code-snippets">VS Code Snippets:</h3>
<div class="sourceCode" id="cb241"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;LARC Component&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;prefix&quot;</span><span class="fu">:</span> <span class="st">&quot;larc-component&quot;</span><span class="fu">,</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;body&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;class ${1:ComponentName} extends HTMLElement {&quot;</span><span class="ot">,</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  constructor() {&quot;</span><span class="ot">,</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;    super();&quot;</span><span class="ot">,</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;    this.attachShadow({ mode: &#39;open&#39; });&quot;</span><span class="ot">,</span></span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  }&quot;</span><span class="ot">,</span></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  &quot;</span><span class="ot">,</span></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  connectedCallback() {&quot;</span><span class="ot">,</span></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;    this.render();&quot;</span><span class="ot">,</span></span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  }&quot;</span><span class="ot">,</span></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  &quot;</span><span class="ot">,</span></span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  render() {&quot;</span><span class="ot">,</span></span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;    this.shadowRoot.innerHTML = </span><span class="ch">\\</span><span class="st">`&quot;</span><span class="ot">,</span></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;      &lt;style&gt;&quot;</span><span class="ot">,</span></span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;        :host { display: block; }&quot;</span><span class="ot">,</span></span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;      &lt;/style&gt;&quot;</span><span class="ot">,</span></span>
<span id="cb241-20"><a href="#cb241-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;      $2&quot;</span><span class="ot">,</span></span>
<span id="cb241-21"><a href="#cb241-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;    </span><span class="ch">\\</span><span class="st">`;&quot;</span><span class="ot">,</span></span>
<span id="cb241-22"><a href="#cb241-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;  }&quot;</span><span class="ot">,</span></span>
<span id="cb241-23"><a href="#cb241-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;}&quot;</span><span class="ot">,</span></span>
<span id="cb241-24"><a href="#cb241-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;&quot;</span><span class="ot">,</span></span>
<span id="cb241-25"><a href="#cb241-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;customElements.define(&#39;${3:component-name}&#39;, ${1:ComponentName});&quot;</span></span>
<span id="cb241-26"><a href="#cb241-26" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb241-27"><a href="#cb241-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb241-28"><a href="#cb241-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="chapter-19-real-world-applications">Chapter 19: Real-World
Applications</h2>
<h3 id="case-study-1-e-commerce-platform">Case Study 1: E-Commerce
Platform</h3>
<p><strong>Features:</strong></p>
<ul>
<li>Product catalog with search and filters</li>
<li>Shopping cart with persistence</li>
<li>Checkout flow with payment integration</li>
<li>User authentication and profiles</li>
<li>Order history and tracking</li>
</ul>
<p><strong>Architecture:</strong></p>
<ul>
<li>Components: product-card, cart-widget, checkout-form</li>
<li>State: IndexedDB for cart, localStorage for preferences</li>
<li>API: REST backend with Stripe integration</li>
<li>Routing: /products, /cart, /checkout, /orders</li>
</ul>
<h3 id="case-study-2-dashboard-application">Case Study 2: Dashboard
Application</h3>
<p><strong>Features:</strong></p>
<ul>
<li>Real-time data visualization</li>
<li>User permissions and roles</li>
<li>Data export functionality</li>
<li>Responsive layout</li>
<li>Dark mode support</li>
</ul>
<p><strong>Architecture:</strong></p>
<ul>
<li>Components: chart-widget, data-table, filter-bar</li>
<li>State: Reactive store with WebSocket updates</li>
<li>API: GraphQL for flexible queries</li>
<li>Real-time: WebSocket for live updates</li>
</ul>
<h3 id="case-study-3-blogcms">Case Study 3: Blog/CMS</h3>
<p><strong>Features:</strong></p>
<ul>
<li>Markdown editor</li>
<li>Draft auto-save</li>
<li>Media library</li>
<li>SEO optimization</li>
<li>Static site generation</li>
</ul>
<p><strong>Architecture:</strong></p>
<ul>
<li>Components: markdown-editor, media-upload, post-list</li>
<li>State: IndexedDB for drafts</li>
<li>API: Headless CMS (Contentful/Strapi)</li>
<li>Build: Optional SSG for production</li>
</ul>
<h3 id="lessons-learned">Lessons Learned:</h3>
<ol type="1">
<li>Start simple, add complexity as needed</li>
<li>Use the PAN bus for cross-component communication</li>
<li>Implement offline-first for better UX</li>
<li>Test early and often</li>
<li>Profile before optimizing</li>
<li>Document your components</li>
<li>Use TypeScript for larger projects</li>
<li>Implement error boundaries</li>
<li>Monitor performance in production</li>
<li>Build progressively</li>
</ol>
<hr />
<h1 id="appendices-1">Appendices</h1>
<h2 id="appendix-a-web-components-api-reference">Appendix A: Web
Components API Reference</h2>
<h3 id="custom-elements-1">Custom Elements</h3>
<ul>
<li><code>customElements.define(name, constructor, options)</code></li>
<li><code>customElements.get(name)</code></li>
<li><code>customElements.whenDefined(name)</code></li>
<li><code>customElements.upgrade(root)</code></li>
</ul>
<h3 id="lifecycle-callbacks-1">Lifecycle Callbacks</h3>
<ul>
<li><code>constructor()</code></li>
<li><code>connectedCallback()</code></li>
<li><code>disconnectedCallback()</code></li>
<li><code>attributeChangedCallback(name, oldValue, newValue)</code></li>
<li><code>adoptedCallback()</code></li>
</ul>
<h3 id="shadow-dom-1">Shadow DOM</h3>
<ul>
<li><code>element.attachShadow({ mode: 'open'|'closed' })</code></li>
<li><code>element.shadowRoot</code></li>
<li><code>slot.assignedNodes()</code></li>
<li><code>slot.assignedElements()</code></li>
</ul>
<h2 id="appendix-b-pan-bus-api-reference">Appendix B: PAN Bus API
Reference</h2>
<h3 id="core-methods">Core Methods</h3>
<div class="sourceCode" id="cb242"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Publish</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">publish</span>(topic<span class="op">,</span> data)</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Subscribe</span></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> unsubscribe <span class="op">=</span> pan<span class="op">.</span><span class="fu">subscribe</span>(topic<span class="op">,</span> handler)</span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Request/Response</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> pan<span class="op">.</span><span class="fu">request</span>(topic<span class="op">,</span> data<span class="op">,</span> timeout)</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>pan<span class="op">.</span><span class="fu">respond</span>(topic<span class="op">,</span> handler)</span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Unsubscribe</span></span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a><span class="fu">unsubscribe</span>()</span></code></pre></div>
<h3 id="topic-patterns">Topic Patterns</h3>
<ul>
<li><code>user.login</code> - Specific event</li>
<li><code>user.*</code> - All user events</li>
<li><code>*.error</code> - All error events</li>
<li><code>*</code> - All events (debugging)</li>
</ul>
<h2 id="appendix-c-component-api-reference">Appendix C: Component API
Reference</h2>
<h3 id="built-in-components">Built-in Components</h3>
<p><strong>pan-store</strong> - Attributes: <code>persist</code>,
<code>namespace</code> - Methods: <code>getState()</code>,
<code>setState(updates)</code>, <code>subscribe(path, handler)</code> -
Events: <code>state-changed</code></p>
<p><strong>pan-router</strong> - Child:
<code>&lt;pan-route path="" component="" guard=""&gt;</code> - Events:
<code>router.navigated</code>, <code>router.not-found</code> - PAN
Topics: <code>router.navigate</code>, <code>router.back</code>,
<code>router.forward</code></p>
<p><strong>pan-fetch</strong> - Attributes: <code>url</code>,
<code>method</code>, <code>auto</code> - Properties: <code>data</code>,
<code>loading</code>, <code>error</code> - Events:
<code>data-loaded</code>, <code>fetch-error</code></p>
<p><strong>pan-auth</strong> - Methods: <code>login(credentials)</code>,
<code>logout()</code>, <code>refresh()</code> - Properties:
<code>user</code>, <code>authenticated</code> - Events:
<code>auth-changed</code></p>
<h2 id="appendix-d-migration-guides">Appendix D: Migration Guides</h2>
<h3 id="from-react">From React</h3>
<p><strong>Concepts:</strong></p>
<ul>
<li>JSX → Template literals</li>
<li>Props → Attributes/properties</li>
<li>State → Instance properties</li>
<li>Context → PAN bus or Context API pattern</li>
<li>Hooks → Lifecycle callbacks</li>
<li>Redux → pan-store or custom store</li>
</ul>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb243"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co">// React</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">UserCard</span>({ user }) {</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [expanded<span class="op">,</span> setExpanded] <span class="op">=</span> <span class="fu">useState</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div onClick<span class="op">=</span>{() <span class="kw">=&gt;</span> <span class="fu">setExpanded</span>(<span class="op">!</span>expanded)}<span class="op">&gt;</span></span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>h2<span class="op">&gt;</span>{user<span class="op">.</span><span class="at">name</span>}<span class="op">&lt;/</span>h2<span class="op">&gt;</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>      {expanded <span class="op">&amp;&amp;</span> <span class="op">&lt;</span>p<span class="op">&gt;</span>{user<span class="op">.</span><span class="at">bio</span>}<span class="op">&lt;/</span>p<span class="op">&gt;</span>}</span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a><span class="co">// LARC</span></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserCard <span class="kw">extends</span> <span class="bu">HTMLElement</span> {</span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>() {</span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">expanded</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb243-19"><a href="#cb243-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-20"><a href="#cb243-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="fu">user</span>(value) {</span>
<span id="cb243-21"><a href="#cb243-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">_user</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb243-22"><a href="#cb243-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb243-23"><a href="#cb243-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb243-24"><a href="#cb243-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-25"><a href="#cb243-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">connectedCallback</span>() {</span>
<span id="cb243-26"><a href="#cb243-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb243-27"><a href="#cb243-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">expanded</span> <span class="op">=</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">expanded</span><span class="op">;</span></span>
<span id="cb243-28"><a href="#cb243-28" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb243-29"><a href="#cb243-29" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb243-30"><a href="#cb243-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">render</span>()<span class="op">;</span></span>
<span id="cb243-31"><a href="#cb243-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb243-32"><a href="#cb243-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-33"><a href="#cb243-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render</span>() {</span>
<span id="cb243-34"><a href="#cb243-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb243-35"><a href="#cb243-35" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;div&gt;</span></span>
<span id="cb243-36"><a href="#cb243-36" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;h2&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">&lt;/h2&gt;</span></span>
<span id="cb243-37"><a href="#cb243-37" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">expanded</span> <span class="op">?</span> <span class="vs">`&lt;p&gt;</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">_user</span><span class="op">.</span><span class="at">bio</span><span class="sc">}</span><span class="vs">&lt;/p&gt;`</span> <span class="op">:</span> <span class="st">&#39;&#39;</span><span class="sc">}</span></span>
<span id="cb243-38"><a href="#cb243-38" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb243-39"><a href="#cb243-39" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">;</span></span>
<span id="cb243-40"><a href="#cb243-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb243-41"><a href="#cb243-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="from-vue">From Vue</h3>
<p><strong>Concepts:</strong></p>
<ul>
<li>Templates → Template literals</li>
<li>v-model → Two-way binding patterns</li>
<li>Computed → Getters</li>
<li>Watch → Observe patterns</li>
<li>Vuex → pan-store</li>
</ul>
<h3 id="from-angular">From Angular</h3>
<p><strong>Concepts:</strong></p>
<ul>
<li>Decorators → Static properties</li>
<li>Dependency Injection → Constructor patterns</li>
<li>Services → Modules</li>
<li>RxJS → PAN bus observables</li>
<li>NgRx → pan-store</li>
</ul>
<h2 id="appendix-e-resources">Appendix E: Resources</h2>
<h3 id="official-documentation">Official Documentation</h3>
<ul>
<li>LARC Docs: https://larcjs.com/docs</li>
<li>Component Registry: https://components.larcjs.com</li>
<li>GitHub: https://github.com/larcjs</li>
</ul>
<h3 id="web-standards">Web Standards</h3>
<ul>
<li>MDN Web Components:
https://developer.mozilla.org/en-US/docs/Web/Web_Components</li>
<li>Custom Elements Spec:
https://html.spec.whatwg.org/multipage/custom-elements.html</li>
<li>Shadow DOM Spec: https://dom.spec.whatwg.org/#shadow-trees</li>
</ul>
<h3 id="community">Community</h3>
<ul>
<li>Discord: https://discord.gg/larcjs</li>
<li>Forum: https://forum.larcjs.com</li>
<li>Twitter: <span class="citation"
data-cites="larcjs">@larcjs</span></li>
</ul>
<h3 id="learning-resources">Learning Resources</h3>
<ul>
<li>Web Components Tutorial: https://webcomponents.org</li>
<li>ES Modules Guide: https://javascript.info/modules</li>
<li>IndexedDB Tutorial: https://javascript.info/indexeddb</li>
</ul>
<h3 id="tools">Tools</h3>
<ul>
<li>LARC CLI: https://www.npmjs.com/package/create-larc-app</li>
<li>VS Code Extension: Search “LARC” in marketplace</li>
<li>Component Analyzer: https://github.com/larcjs/analyzer</li>
</ul>
<h3 id="example-projects">Example Projects</h3>
<ul>
<li>TodoMVC: https://github.com/larcjs/todomvc</li>
<li>E-Commerce: https://github.com/larcjs/ecommerce-example</li>
<li>Dashboard: https://github.com/larcjs/dashboard-example</li>
</ul>
</body>
</html>
