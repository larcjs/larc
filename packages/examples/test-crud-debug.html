<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CRUD Debug Test</title>
  <style>
    body { font-family: system-ui; padding: 20px; }
    .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border: 1px solid #ddd; }
    pan-data-table { display: block; margin: 20px 0; border: 1px solid #ccc; min-height: 200px; }
    pan-form { display: block; margin: 20px 0; border: 1px solid #ccc; padding: 10px; }
    pan-inspector { display: block; height: 300px; border: 1px solid #ccc; margin: 20px 0; }
  </style>
</head>
<body>
  <h1>CRUD Debug Test</h1>
  <div class="log" id="log"></div>
  
  <h2>Data Table</h2>
  <pan-data-table resource="users" columns="id,name,email"></pan-data-table>
  
  <h2>Form</h2>
  <pan-form resource="users" fields="name,email"></pan-form>
  
  <h2>Inspector</h2>
  <pan-inspector></pan-inspector>
  
  <pan-data-provider resource="users" persist="localStorage">
    <script type="application/json">[
      {"id":"u1","name":"Ada Lovelace","email":"ada@example.com"},
      {"id":"u2","name":"Grace Hopper","email":"grace@example.com"},
      {"id":"u3","name":"Alan Turing","email":"alan@example.com"}
    ]</script>
  </pan-data-provider>

  <script type="module">
    if (!customElements.get('pan-bus')) {
      await import('../core/src/components/pan-bus.mjs');
    }
  </script>
  <script type="module">
    const log = document.getElementById('log');
    function addLog(msg) {
      const div = document.createElement('div');
      div.textContent = `${new Date().toLocaleTimeString()}: ${msg}`;
      log.appendChild(div);
      console.log(msg);
    }
    
    await new Promise(r => setTimeout(r, 1000));
    
    addLog('Checking components...');
    addLog(`pan-bus: ${customElements.get('pan-bus') ? 'DEFINED' : 'NOT DEFINED'}`);
    addLog(`pan-data-table: ${customElements.get('pan-data-table') ? 'DEFINED' : 'NOT DEFINED'}`);
    addLog(`pan-form: ${customElements.get('pan-form') ? 'DEFINED' : 'NOT DEFINED'}`);
    addLog(`pan-inspector: ${customElements.get('pan-inspector') ? 'DEFINED' : 'NOT DEFINED'}`);
    addLog(`pan-data-provider: ${customElements.get('pan-data-provider') ? 'DEFINED' : 'NOT DEFINED'}`);
    
    // Check if bus exists
    const bus = document.querySelector('pan-bus');
    addLog(`pan-bus element: ${bus ? 'EXISTS' : 'MISSING'}`);
    
    // Listen to all PAN messages
    if (bus) {
      document.addEventListener('pan:deliver', (e) => {
        addLog(`Message: ${e.detail.topic}`);
      });
    }
  </script>

  <pan-bus debug="true"></pan-bus>
</body>
</html>
