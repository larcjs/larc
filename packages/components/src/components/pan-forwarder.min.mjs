import{PanClient as h}from"../../../core/src/components/pan-client.mjs";class n extends HTMLElement{static get observedAttributes(){return["dest","topics","headers","method","with-credentials","enabled"]}constructor(){super(),this.pc=new h(this),this._off=null,this._enabled=!0,this._recent=new Set,this._gcTimer=null}connectedCallback(){this.#e()}disconnectedCallback(){this.#t()}attributeChangedCallback(){this.#s()}get dest(){return(this.getAttribute("dest")||"").trim()}get topics(){const t=(this.getAttribute("topics")||"*").trim();return t?t.split(/\s+/):["*"]}get method(){return(this.getAttribute("method")||"POST").toUpperCase()}get withCredentials(){return(this.getAttribute("with-credentials")||"").toLowerCase()!=="false"}get enabled(){const t=(this.getAttribute("enabled")||"true").toLowerCase();return t!=="false"&&t!=="0"}get headers(){const t=this.getAttribute("headers")||"";if(!t)return{};try{const e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}const s={};return t.split(";").forEach(e=>{const i=e.split(":");if(i.length>=2){const r=i.shift().trim(),a=i.join(":").trim();r&&(s[r]=a)}}),s}#s(){this.#t(),this.#e()}#t(){try{this._off&&this._off()}catch{}this._off=null,this._gcTimer&&(clearInterval(this._gcTimer),this._gcTimer=null)}#e(){!this.dest||!this.enabled||(this._off=this.pc.subscribe(this.topics,t=>this.#i(t)),this._gcTimer=setInterval(()=>this.#r(),3e4))}async#i(t){if(t?.id&&this._recent.has(t.id))return;const s={topic:t.topic,data:t.data,retain:!!t.retain,id:t.id,ts:t.ts},e=Object.assign({"Content-Type":"application/json"},this.headers);try{(await fetch(this.dest,{method:this.method,credentials:this.withCredentials?"include":"omit",headers:e,body:JSON.stringify(s)})).ok,t?.id&&this._recent.add(t.id)}catch{}}#r(){this._recent=new Set}}customElements.define("pan-forwarder",n);var d=n;export{n as PanForwarder,d as default};
