import{PanClient as r}from"../../../core/pan-client.mjs";class h{constructor(){this.pc=new r,this.authState=null,this.pc.subscribe("auth.internal.state",s=>{this.authState=s.data},{retained:!0})}async fetch(s,t={}){const e={...t};return e.headers=new Headers(e.headers||{}),e.credentials||(e.credentials="include"),this.authState?.authenticated&&this.authState?.token&&(e.headers.has("Authorization")||(e.headers.set("Authorization",`Bearer ${this.authState.token}`),console.warn("âš  Using token from localStorage - vulnerable to XSS. Use HttpOnly cookies instead."))),fetch(s,e)}async fetchJson(s,t={}){const e={...t};e.headers=new Headers(e.headers||{}),e.headers.has("Content-Type")||e.headers.set("Content-Type","application/json");const a=await this.fetch(s,e);if(!a.ok){const n=new Error(`HTTP ${a.status}: ${a.statusText}`);n.status=a.status,n.response=a;try{n.data=await a.json()}catch{n.data=await a.text()}throw n}return a.json()}async get(s,t={}){return this.fetchJson(s,{...t,method:"GET"})}async post(s,t,e={}){return this.fetchJson(s,{...e,method:"POST",body:typeof t=="string"?t:JSON.stringify(t)})}async put(s,t,e={}){return this.fetchJson(s,{...e,method:"PUT",body:typeof t=="string"?t:JSON.stringify(t)})}async patch(s,t,e={}){return this.fetchJson(s,{...e,method:"PATCH",body:typeof t=="string"?t:JSON.stringify(t)})}async delete(s,t={}){return this.fetchJson(s,{...t,method:"DELETE"})}getAuthState(){return this.authState}isAuthenticated(){return this.authState?.authenticated===!0}}const i=new h;var u=i;export{h as PanFetch,u as default,i as panFetch};
