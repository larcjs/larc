const f=typeof window<"u"&&window.panAutoload||{},a={paths:f.paths||["./components/","./","/ui/","/core/"],extension:f.extension||".mjs",rootMargin:f.rootMargin??600};a.extension.startsWith(".")||(a.extension=`.${a.extension}`);const w=new URL("./",import.meta.url).href,m=a.paths.map(e=>{if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/"))return e.endsWith("/")?e:`${e}/`;try{return new URL(e,w).href}catch{return e.endsWith("/")?e:`${e}/`}}),d=new Map,l=new Set,u=new WeakSet,r=typeof IntersectionObserver<"u"?new IntersectionObserver(e=>{for(const{isIntersecting:t,target:n}of e)t&&(r.unobserve(n),i(n))},{rootMargin:`${a.rootMargin}px`}):null;function c(e){return e?.nodeType===1&&e.tagName?.includes("-")&&!customElements.get(e.localName)}async function h(e){if(d.has(e))return d.get(e);const t=`${e}${a.extension}`;for(const o of m){const s=`${o}${t}`;try{if((await fetch(s,{method:"HEAD"})).ok)return d.set(e,s),s}catch{}}const n=`${m[0]}${t}`;return d.set(e,n),n}async function i(e){if(!e||!c(e))return;const t=e.localName,o=e.getAttribute("data-module")||await h(t);if(!(!o||l.has(o)||customElements.get(t))){l.add(o);try{const s=await import(o);!customElements.get(t)&&s?.default instanceof Function&&customElements.define(t,s.default)}catch(s){console.warn(`[pan] Failed to load ${o} for <${t}>`,s)}finally{l.delete(o)}}}function b(e=document){if(!e||u.has(e))return;(e.querySelectorAll?.(":not(:defined)")||[]).forEach(n=>{c(n)&&!u.has(n)&&(u.add(n),r?r.observe(n):i(n))}),c(e)&&!u.has(e)&&(u.add(e),r?r.observe(e):i(e))}function y(){typeof MutationObserver>"u"||new MutationObserver(e=>{for(const t of e)t.type==="childList"?t.addedNodes.forEach(n=>b(n)):t.type==="attributes"&&t.attributeName==="data-module"&&c(t.target)&&(r?r.observe(t.target):i(t.target))}).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-module"]})}async function g(){let e=document.querySelector("pan-bus");e||(e=document.createElement("pan-bus"),(document.body||document.documentElement).prepend(e)),!(e.hasAttribute("debug")||e.hasAttribute("enable-routing")||e.hasAttribute("enable-tracing"))&&!e.hasAttribute("data-module")&&e.setAttribute("data-module",new URL("./pan-bus-lite.mjs",import.meta.url).href),await i(e)}function v(){typeof document>"u"||g().then(()=>{b(document),y();const e=()=>{document.querySelectorAll(":not(:defined)").forEach(t=>{c(t)&&i(t)})};typeof requestIdleCallback=="function"?requestIdleCallback(e):e()})}v();const p={config:a,paths:m,observeTree:b,maybeLoadFor:i,resolveComponent:h};typeof window<"u"&&(window.panAutoload=Object.assign(window.panAutoload||{},p));var A=p;export{A as default,i as maybeLoadFor,b as observeTree,p as panAutoload};
