const d={baseUrl:null,componentsPath:"./components/",extension:".mjs",rootMargin:600},p=typeof window<"u"&&window.panAutoload&&typeof window.panAutoload=="object"?window.panAutoload:{},t=Object.assign({},d,p);t.extension=t.extension?.startsWith(".")?t.extension:`.${t.extension||"mjs"}`;t.componentsPath=t.componentsPath||d.componentsPath;t.rootMargin=Number.isFinite(t.rootMargin)?t.rootMargin:d.rootMargin;let a;if(t.baseUrl){const e=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`,n=t.componentsPath.startsWith("./")?t.componentsPath.slice(2):t.componentsPath;try{a=new URL(n,e).href}catch{a=`${e}${n}`}}else try{const e=t.componentsPath.endsWith("/")?t.componentsPath:`${t.componentsPath}/`;a=new URL(e,import.meta.url).href}catch{a=t.componentsPath.endsWith("/")?t.componentsPath:`${t.componentsPath}/`}t.resolvedComponentsPath=a;const u=new Set,c=new WeakSet,h=typeof window<"u"&&"IntersectionObserver"in window,r=h?new IntersectionObserver(e=>{for(const{isIntersecting:n,target:o}of e)n&&(r.unobserve(o),s(o))},{rootMargin:`${t.rootMargin}px`}):null;function b(e){if(t.resolveComponent&&typeof t.resolveComponent=="function")try{const n=t.resolveComponent(e);if(n)return n}catch(n){console.warn(`[pan-autoload] Custom resolver failed for ${e}:`,n)}if(t.componentPaths&&t.componentPaths[e]){const n=t.componentPaths[e];return t.paths&&typeof t.paths.resolve=="function"?t.paths.resolve(n):n}try{return new URL(`${e}${t.extension}`,a).href}catch{return`${a.endsWith("/")?a:`${a}/`}${e}${t.extension}`}}function i(e){return typeof customElements>"u"?!1:e&&e.nodeType===1&&typeof e.tagName=="string"&&e.tagName.includes("-")&&!customElements.get(e.localName)}function w(e){const n=e.getAttribute("data-module");return n||b(e.localName)}async function s(e){if(!e||!i(e))return;const n=w(e);if(!(!n||u.has(n)||customElements.get(e.localName))){u.add(n);try{const o=await import(n);!customElements.get(e.localName)&&o?.default instanceof Function&&customElements.define(e.localName,o.default)}catch(o){console.warn(`[pan-autoload] Failed to load ${n} for <${e.localName}>`,o)}finally{u.delete(n)}}}function l(e=document){if(!e||c.has(e))return;(typeof e.querySelectorAll=="function"?e.querySelectorAll(":not(:defined)"):[]).forEach(o=>{i(o)&&!c.has(o)&&(c.add(o),r?r.observe(o):s(o))}),i(e)&&!c.has(e)&&(c.add(e),r?r.observe(e):s(e))}function y(){if(typeof MutationObserver>"u")return;const e=document.documentElement;e&&new MutationObserver(n=>{for(const o of n)o.type==="childList"?o.addedNodes.forEach(m=>l(m)):o.type==="attributes"&&o.attributeName==="data-module"&&i(o.target)&&(r?r.observe(o.target):s(o.target))}).observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-module"]})}async function g(){let e=document.querySelector("pan-bus");if(!e){e=document.createElement("pan-bus");const o=document.body||document.documentElement;o&&o.insertBefore(e,o.firstChild)}!(e.hasAttribute("enable-routing")||e.hasAttribute("debug")||e.hasAttribute("enable-tracing"))&&!e.hasAttribute("data-module")&&e.setAttribute("data-module",new URL("./components/pan-bus-lite.mjs",import.meta.url).href),await s(e)}function v(){typeof document>"u"||typeof customElements>"u"||g().then(()=>{l(document),y(),typeof requestIdleCallback=="function"?requestIdleCallback(()=>{document.querySelectorAll(":not(:defined)").forEach(e=>{i(e)&&s(e)})}):document.querySelectorAll(":not(:defined)").forEach(e=>{i(e)&&s(e)})})}v();const f={config:t,observeTree:l,maybeLoadFor:s};typeof window<"u"&&(window.panAutoload=Object.assign(window.panAutoload||{},f));var P=f;export{P as default,s as maybeLoadFor,l as observeTree,f as panAutoload};
