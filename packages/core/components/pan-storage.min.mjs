class r{async load(){throw new Error("load() must be implemented")}async save(t){throw new Error("save() must be implemented")}}class n extends r{constructor(t="pan-routes"){super(),this.key=t}async load(){try{const t=localStorage.getItem(this.key);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e:[]}catch(t){return console.error("[PAN Storage] Failed to load from localStorage:",t),[]}}async save(t){try{const e=JSON.stringify(t,null,2);localStorage.setItem(this.key,e)}catch(e){throw console.error("[PAN Storage] Failed to save to localStorage:",e),e}}}class i extends r{constructor(t="pan-routes"){super(),this.key=t}async load(){try{const t=sessionStorage.getItem(this.key);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e:[]}catch(t){return console.error("[PAN Storage] Failed to load from sessionStorage:",t),[]}}async save(t){try{const e=JSON.stringify(t,null,2);sessionStorage.setItem(this.key,e)}catch(e){throw console.error("[PAN Storage] Failed to save to sessionStorage:",e),e}}}class c extends r{constructor(t={}){super(),this.loadUrl=t.loadUrl||"/api/pan/routes",this.saveUrl=t.saveUrl||"/api/pan/routes",this.headers=t.headers||{"Content-Type":"application/json"},this.credentials=t.credentials||"same-origin"}async load(){try{const t=await fetch(this.loadUrl,{method:"GET",headers:this.headers,credentials:this.credentials});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();return Array.isArray(e)?e:[]}catch(t){return console.error("[PAN Storage] Failed to load from HTTP:",t),[]}}async save(t){try{const e=await fetch(this.saveUrl,{method:"POST",headers:this.headers,credentials:this.credentials,body:JSON.stringify(t)});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`)}catch(e){throw console.error("[PAN Storage] Failed to save to HTTP:",e),e}}}class l extends r{constructor(){super(),this.data=[]}async load(){return[...this.data]}async save(t){this.data=[...t]}}class d extends r{constructor(t=[]){super(),this.adapters=t}async load(){for(const t of this.adapters)try{const e=await t.load();if(e.length>0)return e}catch(e){console.warn("[PAN Storage] Adapter failed, trying next:",e)}return[]}async save(t){const e=[];for(const s of this.adapters)try{await s.save(t)}catch(o){e.push(o)}if(e.length===this.adapters.length)throw new Error("All storage adapters failed")}}class h extends r{constructor(t,e=1e3){super(),this.adapter=t,this.delayMs=e,this.timer=null,this.pending=null}async load(){return this.adapter.load()}async save(t){return this.timer&&clearTimeout(this.timer),this.pending=t,new Promise((e,s)=>{this.timer=setTimeout(async()=>{try{await this.adapter.save(this.pending),this.pending=null,this.timer=null,e()}catch(o){s(o)}},this.delayMs)})}async flush(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.pending&&(await this.adapter.save(this.pending),this.pending=null)}}var p={StorageAdapter:r,LocalStorageAdapter:n,SessionStorageAdapter:i,HttpStorageAdapter:c,MemoryStorageAdapter:l,CompositeStorageAdapter:d,DebouncedStorageAdapter:h};export{d as CompositeStorageAdapter,h as DebouncedStorageAdapter,c as HttpStorageAdapter,n as LocalStorageAdapter,l as MemoryStorageAdapter,i as SessionStorageAdapter,r as StorageAdapter,p as default};
