import{PanClient as i}from"../core/pan-client.mjs";class e extends HTMLElement{static get observedAttributes(){return["resource","src"]}constructor(){super(),this.pc=new i(this),this.schema=null,this._offs=[]}connectedCallback(){this.#t()}disconnectedCallback(){this._offs.forEach(t=>t&&t()),this._offs=[]}attributeChangedCallback(){this.#t()}get resource(){return(this.getAttribute("resource")||"items").trim()}get src(){return(this.getAttribute("src")||"").trim()}async#t(){this._offs.forEach(t=>t&&t()),this._offs=[],this._offs.push(this.pc.subscribe(`${this.resource}.schema.get`,t=>{this.#s().then(()=>{const s=!!this.schema;t?.replyTo&&this.pc.publish({topic:t.replyTo,correlationId:t.correlationId,data:{ok:s,schema:this.schema}}),s&&this.#e()})})),await this.#s(),this.#e()}async#s(){if(!this.schema){if(this.src)try{const s=await(await fetch(this.src,{credentials:"same-origin"})).json();this.schema=s||null}catch{}if(!this.schema){const t=this.querySelector('script[type="application/json"]');if(t&&t.textContent?.trim())try{this.schema=JSON.parse(t.textContent.trim())}catch{}}}}#e(){this.schema&&this.pc.publish({topic:`${this.resource}.schema.state`,data:{schema:this.schema},retain:!0})}}customElements.define("pan-schema",e);var h=e;export{e as PanSchema,h as default};
