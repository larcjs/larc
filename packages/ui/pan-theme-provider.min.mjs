class s extends HTMLElement{static observedAttributes=["theme"];constructor(){super(),this.attachShadow({mode:"open"}),this._storageKey="larc-theme-preference",this._theme=this._loadThemeFromStorage()||"auto",this._systemTheme=this._getSystemTheme(),this._mediaQuery=null}connectedCallback(){this.render(),this._setupSystemThemeListener(),this._applyTheme(),this._broadcastThemeChange()}_loadThemeFromStorage(){try{return localStorage.getItem(this._storageKey)||null}catch(e){return console.warn("[pan-theme-provider] localStorage not available:",e),null}}_saveThemeToStorage(e){try{localStorage.setItem(this._storageKey,e)}catch(t){console.warn("[pan-theme-provider] Could not save theme to localStorage:",t)}}disconnectedCallback(){this._mediaQuery&&this._mediaQuery.removeEventListener("change",this._handleSystemThemeChange)}attributeChangedCallback(e,t,h){e==="theme"&&t!==h&&(this._theme=h||"auto",this._saveThemeToStorage(this._theme),this._applyTheme(),this._broadcastThemeChange())}render(){this.shadowRoot.innerHTML=`
      <style>
        :host {
          display: none;
        }
      </style>
    `}_getSystemTheme(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}_setupSystemThemeListener(){typeof window>"u"||(this._mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this._handleSystemThemeChange=this._handleSystemThemeChange.bind(this),this._mediaQuery.addEventListener("change",this._handleSystemThemeChange))}_handleSystemThemeChange(e){this._systemTheme=e.matches?"dark":"light",this._broadcast("theme.system-changed",{theme:this._systemTheme}),this._theme==="auto"&&(this._applyTheme(),this._broadcastThemeChange())}_getEffectiveTheme(){return this._theme==="auto"?this._systemTheme:this._theme}_applyTheme(){const e=this._getEffectiveTheme();document.documentElement.setAttribute("data-theme",e),document.documentElement.style.colorScheme=e}_broadcastThemeChange(){this._broadcast("theme.changed",{theme:this._theme,effective:this._getEffectiveTheme()})}_broadcast(e,t){const h=document.querySelector("pan-bus");h&&h.publish(e,t),this.dispatchEvent(new CustomEvent("theme-change",{bubbles:!0,composed:!0,detail:t}))}setTheme(e){["light","dark","auto"].includes(e)&&this.setAttribute("theme",e)}getTheme(){return this._theme}getEffectiveTheme(){return this._getEffectiveTheme()}getSystemTheme(){return this._systemTheme}}customElements.define("pan-theme-provider",s);export{s as PanThemeProvider};
