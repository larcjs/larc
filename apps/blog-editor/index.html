<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- CRITICAL: Load theme BEFORE CSS to prevent flash -->
  <script src="../../playground/theme-init.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog Editor - LARC Demo</title>
  <script type="module">window.panAutoload = { paths: ['/ui/', '/core/'] };</script>
  <script type="module" src="/packages/core/pan.mjs"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <h1 class="app-title">Blog Editor</h1>
        <span class="app-subtitle">Progressive Enhancement Demo</span>
      </div>
      <div class="header-right">
        <button class="btn btn-icon" id="toggle-feature-panel" title="Toggle Feature Panel">
          <span class="icon">&#9881;</span>
        </button>
        <pan-theme-toggle variant="icon"></pan-theme-toggle>
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-wrapper">
      <!-- Feature Panel (Production Mode Demo) -->
      <aside class="feature-panel" id="feature-panel">
        <blog-feature-panel></blog-feature-panel>
      </aside>

      <!-- Editor Area -->
      <main class="editor-wrapper">
        <blog-editor></blog-editor>
      </main>
    </div>
  </div>

  <!-- PAN Bus -->
  <pan-bus debug="true"></pan-bus>
  <pan-theme-provider theme="auto"></pan-theme-provider>

  <!-- Core Components -->
  <script type="module" src="/packages/core/pan-bus.mjs"></script>
  <script type="module" src="/packages/ui/pan-theme-provider.mjs"></script>
  <script type="module" src="/packages/ui/pan-theme-toggle.mjs"></script>
  <script type="module" src="/packages/ui/pan-markdown-renderer.mjs"></script>

  <!-- Blog Editor Components -->
  <script type="module" src="./components/blog-editor.mjs"></script>
  <script type="module" src="./components/blog-toolbar.mjs"></script>
  <script type="module" src="./components/blog-source-editor.mjs"></script>
  <script type="module" src="./components/blog-wysiwyg-editor.mjs"></script>
  <script type="module" src="./components/blog-preview.mjs"></script>
  <script type="module" src="./components/blog-metadata.mjs"></script>
  <script type="module" src="./components/blog-storage.mjs"></script>
  <script type="module" src="./components/blog-feature-panel.mjs"></script>

  <!-- Base Features (always loaded) -->
  <script type="module" src="./features/feature-formatting.mjs"></script>

  <script type="module">
    // Toggle feature panel
    const toggleBtn = document.getElementById('toggle-feature-panel');
    const featurePanel = document.getElementById('feature-panel');

    toggleBtn?.addEventListener('click', () => {
      featurePanel.classList.toggle('collapsed');
      localStorage.setItem('blog-editor-panel', featurePanel.classList.contains('collapsed') ? 'collapsed' : 'open');
    });

    // Restore panel state
    if (localStorage.getItem('blog-editor-panel') === 'collapsed') {
      featurePanel.classList.add('collapsed');
    }

    console.log('Blog Editor initialized');
  </script>
</body>
</html>
